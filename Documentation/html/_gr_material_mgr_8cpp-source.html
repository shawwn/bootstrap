<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Bootstrap Engine: C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrMaterialMgr.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrMaterialMgr.cpp</h1><a href="_gr_material_mgr_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//----------------------------------------------------------</span>
<a name="l00006"></a>00006 <span class="comment"></span><span class="comment">//----------------------------------------------------------</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="graphics__afx_8h.html">graphics_afx.h</a>"</span>
<a name="l00008"></a>00008 
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="_gr_material_mgr_8h.html">GrMaterialMgr.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="_gr_material_8h.html">GrMaterial.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="_gr_material_pass_8h.html">GrMaterialPass.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="_gr_shader_mgr_8h.html">GrShaderMgr.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="_r_rsrc_mgr_8h.html">RRsrcMgr.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="_u_expr_number_8h.html">UExprNumber.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="_u_expr_mgr_8h.html">UExprMgr.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="_gr_texture_mgr_8h.html">GrTextureMgr.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "<a class="code" href="_gr_texture_base_8h.html">GrTextureBase.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="_gr_parse_8h.html">GrParse.h</a>"</span>
<a name="l00022"></a>00022 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;set&gt;</span>
<a name="l00025"></a>00025 
<a name="l00027"></a><a class="code" href="_gr_material_mgr_8h.html#d46df50546f8a390c61c9a93e41ec428">00027</a> <a class="code" href="class_gr_material_mgr.html" title="Purpose: To contain parameters for a program and is intended.">GrMaterialMgr</a>* <a class="code" href="_gr_material_mgr_8cpp.html#d46df50546f8a390c61c9a93e41ec428" title="class header.">gGrMaterialMgr</a> = 0;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="_gr_material_mgr_8cpp.html#8a423ce02757431216d0e4bbf6d69f28">kDefaultLightVP</a>;
<a name="l00030"></a>00030 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="_gr_material_mgr_8cpp.html#ede6ddd06b37b934a664a624358f6e29">kDefaultLightFP</a>;
<a name="l00031"></a>00031 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="_gr_material_mgr_8cpp.html#14206ca591cf45bdf2353e22140e7cd2">kDefaultAmbientVP</a>;
<a name="l00032"></a>00032 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="_gr_material_mgr_8cpp.html#03823b9e70ff4d8c9daee92534e51067">kDefaultAmbientFP</a>;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">//**********************************************************</span>
<a name="l00036"></a>00036 <span class="comment"></span><span class="comment">//**********************************************************</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="comment">//==========================================================</span>
<a name="l00040"></a>00040 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="comment">//----------------------------------------------------------</span>
<a name="l00043"></a><a class="code" href="class_gr_material_mgr.html#f8c35eace8645ea7aa4be86286438670">00043</a> <a class="code" href="class_gr_material_mgr.html#f8c35eace8645ea7aa4be86286438670" title="class GrMaterialMgr">GrMaterialMgr::GrMaterialMgr</a>()
<a name="l00044"></a>00044 : _quality( <a class="code" href="enums_8h.html#697c1ee1354746841860d5bf9f81c033a65aecaadc4e83e6faf13f9983899775">EGQ_LOW</a> )
<a name="l00045"></a>00045 {
<a name="l00047"></a>00047         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( <a class="code" href="_gr_shader_mgr_8cpp.html#72561a5bdde97bf632da40c53beaf8e9" title="Purpose: To manage OpenGL vertex/fragment programs.">gGrShaderMgr</a> != 0 );
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( gGrMaterialMgr == 0 );
<a name="l00050"></a>00050         gGrMaterialMgr = <span class="keyword">this</span>;
<a name="l00051"></a>00051 
<a name="l00053"></a>00053         <a class="code" href="struct_s_material_pass_info.html">SMaterialPassInfo</a> passInfo;
<a name="l00054"></a>00054         passInfo.<a class="code" href="struct_s_material_pass_info.html#88f257e5b6e6b9e21392219be74df05c" title="primary shader for the pass.">shader</a> = <a class="code" href="_gr_shader_mgr_8cpp.html#72561a5bdde97bf632da40c53beaf8e9" title="Purpose: To manage OpenGL vertex/fragment programs.">gGrShaderMgr</a>-&gt;<a class="code" href="class_gr_shader_mgr.html#808c8e1152500a452398977b1b1ff650" title="public methods">GetShader</a>( <a class="code" href="_gr_config_8h.html#676bc242b717e392367e68833a9a22a3" title="System shaders.">GR_SHADER_DEFAULT_LIGHT</a>, <a class="code" href="_gr_material_mgr_8cpp.html#8a423ce02757431216d0e4bbf6d69f28">kDefaultLightVP</a>, <a class="code" href="_gr_material_mgr_8cpp.html#ede6ddd06b37b934a664a624358f6e29">kDefaultLightFP</a> );
<a name="l00055"></a>00055         passInfo.<a class="code" href="struct_s_material_pass_info.html#b355f2664fb9a12aaf019c80a5b54a03">ambientShader</a> = <a class="code" href="_gr_shader_mgr_8cpp.html#72561a5bdde97bf632da40c53beaf8e9" title="Purpose: To manage OpenGL vertex/fragment programs.">gGrShaderMgr</a>-&gt;<a class="code" href="class_gr_shader_mgr.html#808c8e1152500a452398977b1b1ff650" title="public methods">GetShader</a>( <a class="code" href="_gr_config_8h.html#2f519bb21e5fcca2bcd1756aecb37d2e">GR_SHADER_DEFAULT_AMBIENT</a>, <a class="code" href="_gr_material_mgr_8cpp.html#14206ca591cf45bdf2353e22140e7cd2">kDefaultAmbientVP</a>, <a class="code" href="_gr_material_mgr_8cpp.html#03823b9e70ff4d8c9daee92534e51067">kDefaultAmbientFP</a> );
<a name="l00056"></a>00056         passInfo.<a class="code" href="struct_s_material_pass_info.html#a129865ee753ac3056cd69490330f782" title="vertex parameters.">vertexColorMod</a> = <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>( 0.0f );
<a name="l00057"></a>00057         passInfo.<a class="code" href="struct_s_material_pass_info.html#8d6e08ed3afd1c51ea0320bd485dadf5">vertexColorAdd</a> = <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>( 0.0f );
<a name="l00058"></a>00058         passInfo.<a class="code" href="struct_s_material_pass_info.html#9209733df2e6a655d595dfc1d810b28f">alphaTestRef</a> = <a class="code" href="_u_expr_mgr_8cpp.html#cdd5fc42d72fbe66d56686d969971ea0" title="class header.">gUExprMgr</a>-&gt;<a class="code" href="class_u_expr_mgr.html#a69ed663f2ce4467182f40877cff51fe" title="simple types.">CreateNumber</a>( 0.0f );
<a name="l00059"></a>00059         passInfo.<a class="code" href="struct_s_material_pass_info.html#47066b32f4d65c956ec8789a7ec14fb2" title="pass enable.">passEnable</a> = <a class="code" href="_u_expr_mgr_8cpp.html#cdd5fc42d72fbe66d56686d969971ea0" title="class header.">gUExprMgr</a>-&gt;<a class="code" href="class_u_expr_mgr.html#a69ed663f2ce4467182f40877cff51fe" title="simple types.">CreateNumber</a>( 1.0f );
<a name="l00060"></a>00060         passInfo.<a class="code" href="struct_s_material_pass_info.html#47b874b3efb05afc0ccbecc01ebf62bc" title="various flags.">receiveShadow</a> = <span class="keyword">false</span>;
<a name="l00061"></a>00061         passInfo.<a class="code" href="struct_s_material_pass_info.html#b4f60776995332748e40270d6c2dc318" title="states.">enableState</a> = <a class="code" href="_gr_util_8h.html#df38fed29d4a8214bf4a51a0df0a7512" title="render states.">GR_DEPTHTEST</a> | <a class="code" href="_gr_util_8h.html#43f8fbc0073e1858f6bba0a73acfe8a6">GR_CULLFACE</a>;
<a name="l00062"></a>00062         passInfo.<a class="code" href="struct_s_material_pass_info.html#06ba69d3100e1ce0a27d8da74c1f342d">writeMask</a> = <a class="code" href="_gr_util_8h.html#d091dcc5dafb6944427eb6d9895b25d3">GR_RGBA</a> | <a class="code" href="_gr_util_8h.html#263ecb0b6dc90d2aca7b9291d81a7024">GR_DEPTH</a>;
<a name="l00063"></a>00063         passInfo.<a class="code" href="struct_s_material_pass_info.html#148b9b02c76e38c6be30dc599ad35dad">castShadow</a> = <span class="keyword">false</span>;
<a name="l00064"></a>00064         passInfo.<a class="code" href="struct_s_material_pass_info.html#43b0b16486a5a825210158b5c55db342" title="depth bias.">slopeBias</a> = 0.0f;
<a name="l00065"></a>00065         passInfo.<a class="code" href="struct_s_material_pass_info.html#e2071f6643a25e1f3866adb9b33c5079">constBias</a> = 0.0f;
<a name="l00066"></a>00066         passInfo.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#fb1134ab25291932ab686cf72156a571" title="states specific to various passes.">srcColorBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l00067"></a>00067         passInfo.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#26219f41c410a0c020e84c2a7bc32eab">srcAlphaBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l00068"></a>00068         passInfo.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#5e75b2942d23722d7886bccc5612d1b6">dstColorBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ecc9c0a06efec84a35b4d9586676fa3815">EBM_ZERO</a>;
<a name="l00069"></a>00069         passInfo.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#8c63ffc9017a3e850dbba2ecf9d55636">dstAlphaBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ecc9c0a06efec84a35b4d9586676fa3815">EBM_ZERO</a>;
<a name="l00070"></a>00070         passInfo.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#fb1134ab25291932ab686cf72156a571" title="states specific to various passes.">srcColorBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l00071"></a>00071         passInfo.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#26219f41c410a0c020e84c2a7bc32eab">srcAlphaBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l00072"></a>00072         passInfo.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#5e75b2942d23722d7886bccc5612d1b6">dstColorBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l00073"></a>00073         passInfo.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#8c63ffc9017a3e850dbba2ecf9d55636">dstAlphaBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l00074"></a>00074         passInfo.<a class="code" href="struct_s_material_pass_info.html#8c047353d3e838c5a3d11ba448847d23" title="alpha test reference value.">alphaTestMode</a> = <a class="code" href="_gr_util_8h.html#abff98128b1f220d1ceff538f4abdef3fe705b2d83e29a130a97914af12ef178">EAM_LESSEQUAL</a>;
<a name="l00075"></a>00075         passInfo.<a class="code" href="struct_s_material_pass_info.html#1c5a2ded6a57901feed193d620db014e" title="culling mode.">cullMode</a> = <a class="code" href="_gr_util_8h.html#ea790ef067767354691d0d60c51542fe5fb45ade8a2def0e22899c5f34497da4">ECM_BACK</a>;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> white = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#83321c109ae9862b3e9ad6acabd8819d">FindTexture</a>( <a class="code" href="_gr_config_8h.html#0bc42af43d2149756d12e05ee44e1e05">GR_SYSTEX_WHITE</a> );
<a name="l00078"></a>00078         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> black = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#83321c109ae9862b3e9ad6acabd8819d">FindTexture</a>( <a class="code" href="_gr_config_8h.html#87d5c3c8045b8fca2ecc24fc60efcfd5" title="System texture names.">GR_SYSTEX_BLACK</a> );
<a name="l00079"></a>00079         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> normal = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#83321c109ae9862b3e9ad6acabd8819d">FindTexture</a>( <a class="code" href="_gr_config_8h.html#102570f15de72ca56ff40df90b10d880">GR_SYSTEX_NORMAL</a> );
<a name="l00080"></a>00080 
<a name="l00082"></a>00082         passInfo.<a class="code" href="struct_s_material_pass_info.html#3696de9c4421b3ff40036e84bde3e630">textures</a>.<a class="code" href="class_gr_texture_set.html#33494fb6526112643fbd6f98b86bc15a">SetStageTexColorMod</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688b1b35286c474a867806a21cea61952b5">ES_BUMP</a>, <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>( 0.006f ) );
<a name="l00083"></a>00083         passInfo.<a class="code" href="struct_s_material_pass_info.html#3696de9c4421b3ff40036e84bde3e630">textures</a>.<a class="code" href="class_gr_texture_set.html#9c070e7bbebf0a430d44f102f3c1e4e1">SetStageTexColorAdd</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688b1b35286c474a867806a21cea61952b5">ES_BUMP</a>, <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>( -0.003f ) );
<a name="l00084"></a>00084         passInfo.<a class="code" href="struct_s_material_pass_info.html#3696de9c4421b3ff40036e84bde3e630">textures</a>.<a class="code" href="class_gr_texture_set.html#33494fb6526112643fbd6f98b86bc15a">SetStageTexColorMod</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606885c089af9c447c3ea195ed80458a1a49e">ES_SPECULAR</a>, <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>( 2.0f ) );
<a name="l00085"></a>00085         passInfo.<a class="code" href="struct_s_material_pass_info.html#3696de9c4421b3ff40036e84bde3e630">textures</a>.<a class="code" href="class_gr_texture_set.html#9c070e7bbebf0a430d44f102f3c1e4e1">SetStageTexColorAdd</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606885c089af9c447c3ea195ed80458a1a49e">ES_SPECULAR</a>, <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>( 0.0f ) );
<a name="l00086"></a>00086 
<a name="l00088"></a>00088         passInfo.<a class="code" href="struct_s_material_pass_info.html#3696de9c4421b3ff40036e84bde3e630">textures</a>.<a class="code" href="class_gr_texture_set.html#778c6a7b1b24b8eed0a01ac77ae53fcc">SetStageTexture</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688b1b35286c474a867806a21cea61952b5">ES_BUMP</a>, white );
<a name="l00089"></a>00089         passInfo.<a class="code" href="struct_s_material_pass_info.html#3696de9c4421b3ff40036e84bde3e630">textures</a>.<a class="code" href="class_gr_texture_set.html#778c6a7b1b24b8eed0a01ac77ae53fcc">SetStageTexture</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688293de1727613be2259dad1827bcfa0d0">ES_NORMAL</a>, normal );
<a name="l00090"></a>00090         passInfo.<a class="code" href="struct_s_material_pass_info.html#3696de9c4421b3ff40036e84bde3e630">textures</a>.<a class="code" href="class_gr_texture_set.html#778c6a7b1b24b8eed0a01ac77ae53fcc">SetStageTexture</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606884a3d034db25df349c89094e48978258d">ES_DIFFUSE</a>, white );
<a name="l00091"></a>00091         passInfo.<a class="code" href="struct_s_material_pass_info.html#3696de9c4421b3ff40036e84bde3e630">textures</a>.<a class="code" href="class_gr_texture_set.html#778c6a7b1b24b8eed0a01ac77ae53fcc">SetStageTexture</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606885c089af9c447c3ea195ed80458a1a49e">ES_SPECULAR</a>, white );
<a name="l00092"></a>00092         passInfo.<a class="code" href="struct_s_material_pass_info.html#3696de9c4421b3ff40036e84bde3e630">textures</a>.<a class="code" href="class_gr_texture_set.html#778c6a7b1b24b8eed0a01ac77ae53fcc">SetStageTexture</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f96816068812f1980d8a826e26b4418064956f0d97">ES_EMISSIVE</a>, black );
<a name="l00093"></a>00093         passInfo.<a class="code" href="struct_s_material_pass_info.html#3696de9c4421b3ff40036e84bde3e630">textures</a>.<a class="code" href="class_gr_texture_set.html#778c6a7b1b24b8eed0a01ac77ae53fcc">SetStageTexture</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688d0fafee9d454a53ad1398707987e5c8e">ES_AMBIENT</a>, white );
<a name="l00094"></a>00094 
<a name="l00095"></a>00095         <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>** passes = <span class="keyword">new</span> <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>*[ 1 ];
<a name="l00096"></a>00096         passes[ 0 ] = <span class="keyword">new</span> <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>( 0, passInfo );
<a name="l00097"></a>00097 
<a name="l00099"></a>00099         <a class="code" href="struct_gr_material_1_1_s_info.html" title="this is used to describe how a material should be constructed.">GrMaterial::SInfo</a> matInfo;
<a name="l00100"></a>00100         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#d582f630813982a1a364956aa804ca82" title="passes.">passCount</a> = 1;
<a name="l00101"></a>00101         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#65b4844858083fced789f35b812d43a8">passes</a> = passes;
<a name="l00102"></a>00102         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#1ce2cf4342c4ca673c726468213833d4" title="passes.">postProcessPassCount</a> = 0;
<a name="l00103"></a>00103         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#d0f2426e55d78a596ef62dd78624a180">postProcessPasses</a> = 0;
<a name="l00104"></a>00104         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#26bcefa25e0ad2e18440c4c660fbc6bf" title="sort priority.">sortType</a> = <a class="code" href="class_gr_material.html#0277ae85793f8cce8f8e3939fb5540e9436e9e42d8c25cd09c6c644af3555a9d">GrMaterial::EST_OPAQUE</a>;
<a name="l00105"></a>00105         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#f18b720a0aad7eae7be10f3b0622bd77" title="material info.">castShadow</a> = <span class="keyword">true</span>;
<a name="l00106"></a>00106         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#83ca23e73b506b9bdab98b43ab1bdf6f">receiveShadow</a> = <span class="keyword">true</span>;
<a name="l00107"></a>00107         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#67a1d89836a0e6033e8e65a4a13b6e67">stipple</a> = <span class="keyword">false</span>;
<a name="l00108"></a>00108         _defaultMaterial = <span class="keyword">new</span> <a class="code" href="class_gr_material.html" title="class GrMaterial">GrMaterial</a>( <span class="stringliteral">"SystemDefault"</span>, matInfo );
<a name="l00109"></a>00109 
<a name="l00111"></a>00111         _materialMap[ _defaultMaterial-&gt;GetName() ] = _defaultMaterial;
<a name="l00112"></a>00112 
<a name="l00114"></a>00114         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( <a class="code" href="_r_rsrc_mgr_8cpp.html#619efa543e7eb2088397c02f921dff1b" title="class header.">gRRsrcMgr</a> );
<a name="l00115"></a>00115         <a class="code" href="_r_rsrc_mgr_8cpp.html#619efa543e7eb2088397c02f921dff1b" title="class header.">gRRsrcMgr</a>-&gt;<a class="code" href="class_r_rsrc_mgr.html#6f9573818e19ea3c0510e7e29750968a" title="public methods">RegisterScriptParser</a>( <a class="code" href="_gr_config_8h.html#0532984353315136aca4bf46639a40e4">GR_KW_MATERIAL</a>, <a class="code" href="_gr_parse_8cpp.html#1b6b0e8fc60b88563dd3c79bedcfa10c" title="GrParse forward declarations.">ParseMaterial</a> );
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="comment">//----------------------------------------------------------</span>
<a name="l00119"></a><a class="code" href="class_gr_material_mgr.html#6f3351d8076b7507fa619d690a5080bc">00119</a> <a class="code" href="class_gr_material_mgr.html#6f3351d8076b7507fa619d690a5080bc">GrMaterialMgr::~GrMaterialMgr</a>()
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( gGrMaterialMgr != 0 );
<a name="l00122"></a>00122         gGrMaterialMgr = 0;
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 <span class="comment">//==========================================================</span>
<a name="l00128"></a>00128 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <span class="comment">//----------------------------------------------------------</span>
<a name="l00131"></a>00131 <a class="code" href="class_u_ref.html">URef&lt; GrMaterial &gt;</a>
<a name="l00132"></a><a class="code" href="class_gr_material_mgr.html#7134ce45c3dc3b873ea2c5deb896ba08">00132</a> <a class="code" href="class_gr_material_mgr.html#7134ce45c3dc3b873ea2c5deb896ba08" title="registers a material. This is usually called when a material is specified in a script...">GrMaterialMgr::SetMaterial</a>( <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; <a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a>, <span class="keyword">const</span> <a class="code" href="struct_gr_material_1_1_s_info.html" title="this is used to describe how a material should be constructed.">GrMaterial::SInfo</a>&amp; info )
<a name="l00133"></a>00133 {
<a name="l00135"></a>00135         MaterialMap::iterator iter = _materialMap.find( name );
<a name="l00136"></a>00136         <span class="keywordflow">if</span> ( iter != _materialMap.end() )
<a name="l00137"></a>00137         {
<a name="l00139"></a>00139                 iter-&gt;second-&gt;Rebuild( info );
<a name="l00140"></a>00140                 <span class="keywordflow">return</span> iter-&gt;second;
<a name="l00141"></a>00141         }
<a name="l00142"></a>00142 
<a name="l00144"></a>00144         <a class="code" href="class_gr_material.html" title="class GrMaterial">GrMaterial</a>* material = <span class="keyword">new</span> <a class="code" href="class_gr_material.html" title="class GrMaterial">GrMaterial</a>( name, info );
<a name="l00145"></a>00145 <span class="comment">//      _materialMap.insert( std::pair&lt; UPath, URef&lt; GrMaterial &gt; &gt;( name, material ) );</span>
<a name="l00146"></a>00146         _materialMap[ name ] = material;
<a name="l00147"></a>00147         _materials.push_back( material );
<a name="l00148"></a>00148 
<a name="l00150"></a>00150         <span class="keywordflow">return</span> material;
<a name="l00151"></a>00151 }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="comment">//----------------------------------------------------------</span>
<a name="l00154"></a>00154 <a class="code" href="class_u_ref.html">URef&lt; GrMaterial &gt;</a>
<a name="l00155"></a><a class="code" href="class_gr_material_mgr.html#5cd1ffc48f5700668491231502af7be9">00155</a> <a class="code" href="class_gr_material_mgr.html#5cd1ffc48f5700668491231502af7be9">GrMaterialMgr::GetMaterial</a>( <span class="keyword">const</span> <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a>&amp; <a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a>, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; error )
<a name="l00156"></a>00156 {
<a name="l00158"></a>00158         MaterialMap::iterator iter = _materialMap.find( name );
<a name="l00159"></a>00159         <span class="keywordflow">if</span> ( iter != _materialMap.end() )
<a name="l00160"></a>00160                 <span class="keywordflow">return</span> iter-&gt;second;
<a name="l00161"></a>00161 
<a name="l00163"></a>00163         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> scriptName;
<a name="l00164"></a>00164         <a class="code" href="class_gr_material_mgr.html#1bdfefc758711cf3d91e5a3cff632ffc" title="returns the name of the script a material should reside in.">GetScriptName</a>( scriptName, name.<a class="code" href="class_u_path.html#970648bc09145c6da1712022d84ad3b7" title="returns the path string.">GetPathString</a>() );
<a name="l00165"></a>00165 
<a name="l00167"></a>00167         <span class="keywordflow">if</span> ( !<a class="code" href="_r_rsrc_mgr_8cpp.html#619efa543e7eb2088397c02f921dff1b" title="class header.">gRRsrcMgr</a>-&gt;<a class="code" href="class_r_rsrc_mgr.html#bb72c237e1e5983a8e9b440849f4b66f">LoadScript</a>( scriptName, <span class="stringliteral">"material"</span>, error ) )
<a name="l00168"></a>00168                 <span class="keywordflow">return</span> 0;
<a name="l00169"></a>00169 
<a name="l00171"></a>00171         iter = _materialMap.find( name );
<a name="l00172"></a>00172         <span class="keywordflow">if</span> ( iter != _materialMap.end() )
<a name="l00173"></a>00173         {
<a name="l00174"></a>00174 <span class="comment">/*</span>
<a name="l00177"></a>00177 <span class="comment"></span>
<a name="l00179"></a>00179 <span class="comment">                if ( iter-&gt;second-&gt;HasDeformers() )</span>
<a name="l00180"></a>00180 <span class="comment">                {</span>
<a name="l00181"></a>00181 <span class="comment">                        URef&lt; GrMaterial &gt; clone = iter-&gt;second-&gt;Clone();</span>
<a name="l00182"></a>00182 <span class="comment">                        std::pair&lt; UPath, URef&lt; GrMaterial &gt; &gt;( name, clone );</span>
<a name="l00183"></a>00183 <span class="comment">                        _materials.push_back( clone );</span>
<a name="l00184"></a>00184 <span class="comment">                        return clone;</span>
<a name="l00185"></a>00185 <span class="comment">                }</span>
<a name="l00186"></a>00186 <span class="comment">*/</span>
<a name="l00189"></a>00189                 <span class="keywordflow">return</span> iter-&gt;second;
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191 
<a name="l00193"></a>00193         error = <span class="stringliteral">"Material "</span> + name.<a class="code" href="class_u_path.html#970648bc09145c6da1712022d84ad3b7" title="returns the path string.">GetPathString</a>() + <span class="stringliteral">" not found."</span>;
<a name="l00194"></a>00194         <span class="keywordflow">return</span> 0;
<a name="l00195"></a>00195 }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 <span class="comment">//----------------------------------------------------------</span>
<a name="l00198"></a>00198 <a class="code" href="class_u_ref.html">URef&lt; GrMaterial &gt;</a>
<a name="l00199"></a><a class="code" href="class_gr_material_mgr.html#43336b522deb18479fb8a40756ef37f0">00199</a> <a class="code" href="class_gr_material_mgr.html#43336b522deb18479fb8a40756ef37f0">GrMaterialMgr::GetDefaultMaterial</a>()
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201         <span class="keywordflow">return</span> _defaultMaterial;
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 <span class="comment">//----------------------------------------------------------</span>
<a name="l00205"></a>00205 <span class="keywordtype">bool</span>
<a name="l00206"></a><a class="code" href="class_gr_material_mgr.html#fd19248af5f08710d9607b9db84c52b5">00206</a> <a class="code" href="class_gr_material_mgr.html#fd19248af5f08710d9607b9db84c52b5" title="reloads the script a given material resides in.">GrMaterialMgr::ReloadMaterial</a>( <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; materialName, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l00207"></a>00207 {
<a name="l00209"></a>00209         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> scriptName;
<a name="l00210"></a>00210         <a class="code" href="class_gr_material_mgr.html#1bdfefc758711cf3d91e5a3cff632ffc" title="returns the name of the script a material should reside in.">GetScriptName</a>( scriptName, materialName );
<a name="l00211"></a>00211         <span class="keywordflow">return</span> <a class="code" href="_r_rsrc_mgr_8cpp.html#619efa543e7eb2088397c02f921dff1b" title="class header.">gRRsrcMgr</a>-&gt;<a class="code" href="class_r_rsrc_mgr.html#bb72c237e1e5983a8e9b440849f4b66f">LoadScript</a>( scriptName, <span class="stringliteral">"material"</span>, errors );
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <span class="comment">//----------------------------------------------------------</span>
<a name="l00215"></a>00215 <span class="keywordtype">void</span>
<a name="l00216"></a><a class="code" href="class_gr_material_mgr.html#c0272e7cbc2981ad1996ac569346054f">00216</a> <a class="code" href="class_gr_material_mgr.html#c0272e7cbc2981ad1996ac569346054f">GrMaterialMgr::ReloadAll</a>()
<a name="l00217"></a>00217 {
<a name="l00219"></a>00219         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> scriptName;
<a name="l00220"></a>00220         std::set&lt; tstring &gt; scripts;
<a name="l00221"></a>00221         MaterialVec::iterator iter = _materials.begin();
<a name="l00222"></a>00222         <span class="keyword">const</span> MaterialVec::iterator <a class="code" href="_g_l_8h.html#432111147038972f06e049e18a837002">end</a> = _materials.end();
<a name="l00223"></a>00223         <span class="keywordflow">for</span> ( ; iter != end; ++iter )
<a name="l00224"></a>00224         {
<a name="l00225"></a>00225                 <a class="code" href="class_gr_material_mgr.html#1bdfefc758711cf3d91e5a3cff632ffc" title="returns the name of the script a material should reside in.">GetScriptName</a>( scriptName, ( *iter )-&gt;GetName() );
<a name="l00226"></a>00226                 <span class="keywordflow">if</span> ( scriptName.length() &gt; 0 )
<a name="l00227"></a>00227                         scripts.insert( scriptName );
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229 
<a name="l00231"></a>00231         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> errors;
<a name="l00232"></a>00232         std::set&lt; tstring &gt;::iterator scriptIter = scripts.begin();
<a name="l00233"></a>00233         <span class="keyword">const</span> std::set&lt; tstring &gt;::iterator scriptEnd = scripts.end();
<a name="l00234"></a>00234         <span class="keywordflow">for</span> ( ; scriptIter != scriptEnd; ++scriptIter )
<a name="l00235"></a>00235         {
<a name="l00236"></a>00236                 <a class="code" href="_r_rsrc_mgr_8cpp.html#619efa543e7eb2088397c02f921dff1b" title="class header.">gRRsrcMgr</a>-&gt;<a class="code" href="class_r_rsrc_mgr.html#bb72c237e1e5983a8e9b440849f4b66f">LoadScript</a>( *scriptIter, <span class="stringliteral">"material"</span>, errors );
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 <span class="comment">//----------------------------------------------------------</span>
<a name="l00241"></a>00241 <span class="keywordtype">void</span>
<a name="l00242"></a><a class="code" href="class_gr_material_mgr.html#24e6473a848193ef15400e817debc4a0">00242</a> <a class="code" href="class_gr_material_mgr.html#24e6473a848193ef15400e817debc4a0">GrMaterialMgr::UnloadAll</a>()
<a name="l00243"></a>00243 {
<a name="l00244"></a>00244         _materialMap.clear();
<a name="l00245"></a>00245         _materials.clear();
<a name="l00246"></a>00246         _materialMap[ _defaultMaterial-&gt;GetName() ] = _defaultMaterial;
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="comment">//----------------------------------------------------------</span>
<a name="l00250"></a>00250 <span class="keywordtype">void</span>
<a name="l00251"></a><a class="code" href="class_gr_material_mgr.html#fd6d9312e225637c1300dc0703c853f7">00251</a> <a class="code" href="class_gr_material_mgr.html#fd6d9312e225637c1300dc0703c853f7" title="updates all materials.">GrMaterialMgr::Update</a>()
<a name="l00252"></a>00252 {
<a name="l00253"></a>00253         MaterialVec::iterator iter = _materials.begin();
<a name="l00254"></a>00254         <span class="keyword">const</span> MaterialVec::iterator <a class="code" href="_g_l_8h.html#432111147038972f06e049e18a837002">end</a> = _materials.end();
<a name="l00255"></a>00255         <span class="keywordflow">for</span> ( ; iter != end; ++iter )
<a name="l00256"></a>00256         {
<a name="l00257"></a>00257                 ( *iter )-&gt;Update();
<a name="l00258"></a>00258         }
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="comment">//----------------------------------------------------------</span>
<a name="l00262"></a>00262 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00263"></a><a class="code" href="class_gr_material_mgr.html#2e5b48c6003f1d3449ba8dbff47d4fc7">00263</a> <a class="code" href="class_gr_material_mgr.html#2e5b48c6003f1d3449ba8dbff47d4fc7">GrMaterialMgr::GetMaterialCount</a>()<span class="keyword"> const</span>
<a name="l00264"></a>00264 <span class="keyword"></span>{
<a name="l00265"></a>00265         <span class="keywordflow">return</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> )_materials.size();
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 <span class="comment">//----------------------------------------------------------</span>
<a name="l00269"></a>00269 <a class="code" href="class_u_ref.html">URef&lt; GrMaterial &gt;</a>
<a name="l00270"></a><a class="code" href="class_gr_material_mgr.html#ce15b2856e2cbcb867f012daac7e8ed2">00270</a> <a class="code" href="class_gr_material_mgr.html#ce15b2856e2cbcb867f012daac7e8ed2">GrMaterialMgr::GetMaterialByIdx</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#57f14e05b1900f16a2da82ade47d0c6d">index</a> )
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272         <span class="keywordflow">return</span> _materials[ index ];
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="comment">//----------------------------------------------------------</span>
<a name="l00276"></a>00276 <span class="keywordtype">void</span>
<a name="l00277"></a><a class="code" href="class_gr_material_mgr.html#e3b56eb5530047e084fb96c595da517b">00277</a> <a class="code" href="class_gr_material_mgr.html#e3b56eb5530047e084fb96c595da517b" title="context reset notification.">GrMaterialMgr::PreContextReset</a>()
<a name="l00278"></a>00278 {
<a name="l00279"></a>00279 <span class="comment">/*</span>
<a name="l00280"></a>00280 <span class="comment">        MaterialVec::iterator iter = _materials.begin();</span>
<a name="l00281"></a>00281 <span class="comment">        const MaterialVec::iterator end = _materials.end();</span>
<a name="l00282"></a>00282 <span class="comment">        for ( ; iter != end; ++iter )</span>
<a name="l00283"></a>00283 <span class="comment">        {</span>
<a name="l00284"></a>00284 <span class="comment">                ( *iter )-&gt;PreContextReset();</span>
<a name="l00285"></a>00285 <span class="comment">        }</span>
<a name="l00286"></a>00286 <span class="comment">*/</span>
<a name="l00287"></a>00287 }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="comment">//----------------------------------------------------------</span>
<a name="l00290"></a>00290 <span class="keywordtype">void</span>
<a name="l00291"></a><a class="code" href="class_gr_material_mgr.html#daadacddba70859d762f1d776bfcfcb1">00291</a> <a class="code" href="class_gr_material_mgr.html#daadacddba70859d762f1d776bfcfcb1">GrMaterialMgr::PostContextReset</a>()
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293 <span class="comment">/*</span>
<a name="l00295"></a>00295 <span class="comment">        MaterialVec::iterator iter = _materials.begin();</span>
<a name="l00296"></a>00296 <span class="comment">        const MaterialVec::iterator end = _materials.end();</span>
<a name="l00297"></a>00297 <span class="comment">        for ( ; iter != end; ++iter )</span>
<a name="l00298"></a>00298 <span class="comment">        {</span>
<a name="l00299"></a>00299 <span class="comment">                ( *iter )-&gt;PostContextReset();</span>
<a name="l00300"></a>00300 <span class="comment">        }</span>
<a name="l00301"></a>00301 <span class="comment">*/</span>
<a name="l00303"></a>00303 <span class="comment">//      ReloadAll();</span>
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">//----------------------------------------------------------</span>
<a name="l00307"></a>00307 <span class="keywordtype">void</span>
<a name="l00308"></a><a class="code" href="class_gr_material_mgr.html#1bdfefc758711cf3d91e5a3cff632ffc">00308</a> <a class="code" href="class_gr_material_mgr.html#1bdfefc758711cf3d91e5a3cff632ffc" title="returns the name of the script a material should reside in.">GrMaterialMgr::GetScriptName</a>( <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; scriptName, <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; materialName )
<a name="l00309"></a>00309 {
<a name="l00311"></a>00311         <span class="keywordtype">size_t</span> scriptPathEnd = materialName.find_last_of( <span class="charliteral">'/'</span> );
<a name="l00312"></a>00312         <span class="keywordflow">if</span> ( scriptPathEnd != tstring::npos )
<a name="l00313"></a>00313         {
<a name="l00314"></a>00314                 scriptName = materialName;
<a name="l00315"></a>00315                 scriptName = scriptName.substr( 0, scriptPathEnd );
<a name="l00316"></a>00316                 scriptPathEnd = scriptName.find_last_of( <span class="charliteral">'/'</span> );
<a name="l00317"></a>00317                 <span class="keywordflow">if</span> ( scriptPathEnd != tstring::npos )
<a name="l00318"></a>00318                         scriptName = scriptName.substr( 0, scriptPathEnd + 1 );
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320         <span class="keywordflow">else</span>
<a name="l00321"></a>00321                 scriptName = <span class="stringliteral">""</span>;
<a name="l00322"></a>00322 
<a name="l00323"></a>00323         scriptName += <a class="code" href="_gr_config_8h.html#b5d5abe28b97a3032db470609416f2e5" title="graphics resource file names">GR_MATERIAL_FILENAME</a>;
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a><a class="code" href="_gr_material_mgr_8cpp.html#8a423ce02757431216d0e4bbf6d69f28">00326</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="_gr_material_mgr_8cpp.html#8a423ce02757431216d0e4bbf6d69f28">kDefaultLightVP</a> = <span class="stringliteral">"\</span>
<a name="l00327"></a>00327 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00332"></a>00332 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00333"></a>00333 <span class="stringliteral">\n\</span>
<a name="l00334"></a>00334 <span class="stringliteral">invariant gl_Position;\n\</span>
<a name="l00335"></a>00335 <span class="stringliteral">\n\</span>
<a name="l00336"></a>00336 <span class="stringliteral">//==========================================================\n\</span>
<a name="l00338"></a>00338 <span class="stringliteral">//==========================================================\n\</span>
<a name="l00339"></a>00339 <span class="stringliteral">attribute vec3 a_Position;\n\</span>
<a name="l00340"></a>00340 <span class="stringliteral">attribute vec3 a_Tangent;\n\</span>
<a name="l00341"></a>00341 <span class="stringliteral">attribute vec3 a_Binormal;\n\</span>
<a name="l00342"></a>00342 <span class="stringliteral">attribute vec3 a_Normal;\n\</span>
<a name="l00343"></a>00343 <span class="stringliteral">attribute vec2 a_TexCoord;\n\</span>
<a name="l00344"></a>00344 <span class="stringliteral">\n\</span>
<a name="l00345"></a>00345 <span class="stringliteral">//==========================================================\n\</span>
<a name="l00347"></a>00347 <span class="stringliteral">//==========================================================\n\</span>
<a name="l00348"></a>00348 <span class="stringliteral">varying vec3 v_LocalEyeVec;\n\</span>
<a name="l00349"></a>00349 <span class="stringliteral">varying vec3 v_LocalLightVec;\n\</span>
<a name="l00350"></a>00350 <span class="stringliteral">varying vec4 v_ProjTexCoord;\n\</span>
<a name="l00351"></a>00351 <span class="stringliteral">varying vec4 v_ShadowTexCoord;\n\</span>
<a name="l00352"></a>00352 <span class="stringliteral">varying vec2 v_TexCoord;\n\</span>
<a name="l00353"></a>00353 <span class="stringliteral">\n\</span>
<a name="l00354"></a>00354 <span class="stringliteral">//==========================================================\n\</span>
<a name="l00356"></a>00356 <span class="stringliteral">//==========================================================\n\</span>
<a name="l00357"></a>00357 <span class="stringliteral">uniform mat4 u_ModelViewProjectionMatrix;\n\</span>
<a name="l00358"></a>00358 <span class="stringliteral">uniform vec4 u_ViewPos;                         //! X,Y,Z,undef\n\</span>
<a name="l00359"></a>00359 <span class="stringliteral">uniform vec4 u_LightPos;                        //! X,Y,Z,undef\n\</span>
<a name="l00360"></a>00360 <span class="stringliteral">uniform vec4 u_LightDirOverride;        //! X,Y,Z,[0=override;1=no override]\n\</span>
<a name="l00361"></a>00361 <span class="stringliteral">uniform mat4 u_LightProjMatrix;\n\</span>
<a name="l00362"></a>00362 <span class="stringliteral">uniform mat4 u_ShadowMatrix;\n\</span>
<a name="l00363"></a>00363 <span class="stringliteral">uniform mat4x2 u_TextureMatrix;\n\</span>
<a name="l00364"></a>00364 <span class="stringliteral">\n\</span>
<a name="l00365"></a>00365 <span class="stringliteral">//==========================================================\n\</span>
<a name="l00367"></a>00367 <span class="stringliteral">//==========================================================\n\</span>
<a name="l00368"></a>00368 <span class="stringliteral">void main()\n\</span>
<a name="l00369"></a>00369 <span class="stringliteral">{\n\</span>
<a name="l00370"></a>00370 <span class="stringliteral">        gl_Position = u_ModelViewProjectionMatrix * vec4( a_Position.xyz, 1.0 );\n\</span>
<a name="l00371"></a>00371 <span class="stringliteral">\n\</span>
<a name="l00373"></a>00373 <span class="stringliteral">        vec3 localEyeVec = u_ViewPos.xyz - a_Position.xyz;\n\</span>
<a name="l00374"></a>00374 <span class="stringliteral">\n\</span>
<a name="l00376"></a>00376 <span class="stringliteral">        vec3 localLightVec = u_LightPos.xyz - a_Position.xyz;\n\</span>
<a name="l00377"></a>00377 <span class="stringliteral">        localLightVec = u_LightDirOverride.w * localLightVec + u_LightDirOverride.xyz;\n\</span>
<a name="l00378"></a>00378 <span class="stringliteral">\n\</span>
<a name="l00380"></a>00380 <span class="stringliteral">        v_LocalEyeVec.x = dot( localEyeVec, a_Tangent.xyz );\n\</span>
<a name="l00381"></a>00381 <span class="stringliteral">        v_LocalEyeVec.y = dot( localEyeVec, a_Binormal.xyz );\n\</span>
<a name="l00382"></a>00382 <span class="stringliteral">        v_LocalEyeVec.z = dot( localEyeVec, a_Normal.xyz );\n\</span>
<a name="l00383"></a>00383 <span class="stringliteral">\n\</span>
<a name="l00385"></a>00385 <span class="stringliteral">        v_LocalLightVec.x = dot( localLightVec, a_Tangent.xyz );\n\</span>
<a name="l00386"></a>00386 <span class="stringliteral">        v_LocalLightVec.y = dot( localLightVec, a_Binormal.xyz );\n\</span>
<a name="l00387"></a>00387 <span class="stringliteral">        v_LocalLightVec.z = dot( localLightVec, a_Normal.xyz );\n\</span>
<a name="l00388"></a>00388 <span class="stringliteral">\n\</span>
<a name="l00390"></a>00390 <span class="stringliteral">        v_ProjTexCoord = u_LightProjMatrix * vec4( a_Position.xyz, 1.0 );\n\</span>
<a name="l00391"></a>00391 <span class="stringliteral">\n\</span>
<a name="l00393"></a>00393 <span class="stringliteral">        v_ShadowTexCoord = u_ShadowMatrix * vec4( a_Position.xyz, 1.0 );\n\</span>
<a name="l00394"></a>00394 <span class="stringliteral">\n\</span>
<a name="l00396"></a>00396 <span class="stringliteral">        v_TexCoord.xy = u_TextureMatrix * vec4( a_TexCoord, 0.0, 1.0 );\n\</span>
<a name="l00397"></a>00397 <span class="stringliteral">}\n\</span>
<a name="l00398"></a>00398 <span class="stringliteral">"</span>;
<a name="l00399"></a>00399 
<a name="l00400"></a><a class="code" href="_gr_material_mgr_8cpp.html#ede6ddd06b37b934a664a624358f6e29">00400</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="_gr_material_mgr_8cpp.html#ede6ddd06b37b934a664a624358f6e29">kDefaultLightFP</a> = <span class="stringliteral">"\</span>
<a name="l00401"></a>00401 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00406"></a>00406 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00407"></a>00407 <span class="stringliteral">\n\</span>
<a name="l00409"></a>00409 <span class="stringliteral">#if B_QUALITY == 0\n\</span>
<a name="l00410"></a>00410 <span class="stringliteral">const int kShadowSampleCount = 32;\n\</span>
<a name="l00411"></a>00411 <span class="stringliteral">#elif B_QUALITY == 1\n\</span>
<a name="l00412"></a>00412 <span class="stringliteral">const int kShadowSampleCount = 16;\n\</span>
<a name="l00413"></a>00413 <span class="stringliteral">#elif B_QUALITY == 2\n\</span>
<a name="l00414"></a>00414 <span class="stringliteral">const int kShadowSampleCount = 8;\n\</span>
<a name="l00415"></a>00415 <span class="stringliteral">#endif\n\</span>
<a name="l00416"></a>00416 <span class="stringliteral">\n\</span>
<a name="l00417"></a>00417 <span class="stringliteral">#if B_QUALITY &lt; 3\n\</span>
<a name="l00418"></a>00418 <span class="stringliteral">const int kShadowSampleCountOver2 = kShadowSampleCount/2;\n\</span>
<a name="l00419"></a>00419 <span class="stringliteral">const half kShadowInvSampleCount = 1.0 / half( kShadowSampleCount );\n\</span>
<a name="l00420"></a>00420 <span class="stringliteral">const vec2 kShadowJitterTexScale = vec2( 0.03125, 0.03125 );                    //! 1 / 32\n\</span>
<a name="l00421"></a>00421 <span class="stringliteral">//const vec3 kShadowJitterTexScale = vec3( 0.0625, 0.0625, 0.0 );               //! 1 / 16\n\</span>
<a name="l00422"></a>00422 <span class="stringliteral">//const vec3 kShadowJitterTexScale = vec3( 0.125, 0.125, 0.0 );                 //! 1 / 8\n\</span>
<a name="l00423"></a>00423 <span class="stringliteral">#endif\n\</span>
<a name="l00424"></a>00424 <span class="stringliteral">\n\</span>
<a name="l00425"></a>00425 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00427"></a>00427 <span class="stringliteral">varying vec3 v_LocalEyeVec;\n\</span>
<a name="l00428"></a>00428 <span class="stringliteral">varying vec3 v_LocalLightVec;\n\</span>
<a name="l00429"></a>00429 <span class="stringliteral">varying vec4 v_ProjTexCoord;\n\</span>
<a name="l00430"></a>00430 <span class="stringliteral">varying vec4 v_ShadowTexCoord;\n\</span>
<a name="l00431"></a>00431 <span class="stringliteral">varying vec2 v_TexCoord;\n\</span>
<a name="l00432"></a>00432 <span class="stringliteral">\n\</span>
<a name="l00433"></a>00433 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00435"></a>00435 <span class="stringliteral">uniform vec4 u_LightColor;                      //! R,G,B,undef\n\</span>
<a name="l00436"></a>00436 <span class="stringliteral">uniform vec4 u_LightRange;                      //! range, range, range, 1/range\n\</span>
<a name="l00437"></a>00437 <span class="stringliteral">uniform vec4 u_LightAtten;                      //! squared atten, linear atten, 0, constant atten\n\</span>
<a name="l00438"></a>00438 <span class="stringliteral">uniform vec4 u_LightWidth;                      //! width, width, 0, 0\n\</span>
<a name="l00439"></a>00439 <span class="stringliteral">uniform vec4 u_LightHaze;                       //! haze, 1.0-haze, 0, 0\n\</span>
<a name="l00440"></a>00440 <span class="stringliteral">uniform vec4 u_UberTexCacheMiss;\n\</span>
<a name="l00441"></a>00441 <span class="stringliteral">uniform vec4 u_BumpMod;\n\</span>
<a name="l00442"></a>00442 <span class="stringliteral">uniform vec4 u_BumpAdd;\n\</span>
<a name="l00443"></a>00443 <span class="stringliteral">uniform vec4 u_DiffuseMod;\n\</span>
<a name="l00444"></a>00444 <span class="stringliteral">uniform vec4 u_DiffuseAdd;\n\</span>
<a name="l00445"></a>00445 <span class="stringliteral">uniform vec4 u_SpecularMod;\n\</span>
<a name="l00446"></a>00446 <span class="stringliteral">uniform vec4 u_SpecularAdd;\n\</span>
<a name="l00447"></a>00447 <span class="stringliteral">uniform vec4 u_ShadowNear;\n\</span>
<a name="l00448"></a>00448 <span class="stringliteral">uniform vec4 u_FogStart;\n\</span>
<a name="l00449"></a>00449 <span class="stringliteral">uniform vec4 u_FogRange;\n\</span>
<a name="l00450"></a>00450 <span class="stringliteral">uniform vec4 u_FogColor;\n\</span>
<a name="l00451"></a>00451 <span class="stringliteral">\n\</span>
<a name="l00452"></a>00452 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00454"></a>00454 <span class="stringliteral">uniform samplerCube s_NormalizeTexCube;\n\</span>
<a name="l00455"></a>00455 <span class="stringliteral">uniform samplerCube s_CubeFaceX;\n\</span>
<a name="l00456"></a>00456 <span class="stringliteral">uniform samplerCube s_CubeFaceY;\n\</span>
<a name="l00457"></a>00457 <span class="stringliteral">uniform sampler3D s_NoiseTableTex3D;\n\</span>
<a name="l00458"></a>00458 <span class="stringliteral">uniform sampler2D s_LightProjTex;\n\</span>
<a name="l00459"></a>00459 <span class="stringliteral">uniform sampler2DShadow s_LightShadowPage;\n\</span>
<a name="l00460"></a>00460 <span class="stringliteral">uniform samplerCube s_LightShadowVSM;\n\</span>
<a name="l00461"></a>00461 <span class="stringliteral">uniform sampler2D s_BumpTex;\n\</span>
<a name="l00462"></a>00462 <span class="stringliteral">uniform sampler2D s_NormalTex;\n\</span>
<a name="l00463"></a>00463 <span class="stringliteral">uniform sampler2D s_DiffuseTex;\n\</span>
<a name="l00464"></a>00464 <span class="stringliteral">uniform sampler2D s_SpecularTex;\n\</span>
<a name="l00465"></a>00465 <span class="stringliteral">\n\</span>
<a name="l00466"></a>00466 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00468"></a>00468 <span class="stringliteral">void main()\n\</span>
<a name="l00469"></a>00469 <span class="stringliteral">{\n\</span>
<a name="l00470"></a>00470 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00472"></a>00472 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00474"></a>00474 <span class="stringliteral">        half3 localEyeVec = 2.0 * textureCube( s_NormalizeTexCube, v_LocalEyeVec ).xyz - 1.0;\n\</span>
<a name="l00475"></a>00475 <span class="stringliteral">\n\</span>
<a name="l00478"></a>00478 <span class="stringliteral">        half localLightDistSqr = dot( v_LocalLightVec, v_LocalLightVec );\n\</span>
<a name="l00479"></a>00479 <span class="stringliteral">        half invLightDist = inversesqrt( localLightDistSqr );\n\</span>
<a name="l00480"></a>00480 <span class="stringliteral">        half localLightDist = invLightDist * localLightDistSqr;\n\</span>
<a name="l00481"></a>00481 <span class="stringliteral">        half3 localLightVec = invLightDist * v_LocalLightVec;\n\</span>
<a name="l00482"></a>00482 <span class="stringliteral">\n\</span>
<a name="l00484"></a>00484 <span class="stringliteral">        half3 localHalfVec = normalize( localLightVec + localEyeVec );\n\</span>
<a name="l00485"></a>00485 <span class="stringliteral">\n\</span>
<a name="l00486"></a>00486 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00489"></a>00489 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00490"></a>00490 <span class="stringliteral">        half3 light = u_LightColor.rgb;\n\</span>
<a name="l00491"></a>00491 <span class="stringliteral">        light *= half3( texture2DProj( s_LightProjTex, v_ProjTexCoord ).rgb );\n\</span>
<a name="l00492"></a>00492 <span class="stringliteral">        light = v_ProjTexCoord.z &lt;= 0.0 ? half3( 0.0, 0.0, 0.0 ) : light;\n\</span>
<a name="l00493"></a>00493 <span class="stringliteral">\n\</span>
<a name="l00495"></a>00495 <span class="stringliteral">        half linAtten = clamp( -localLightDist * u_LightRange.w + 1.0, 0.0, 1.0 );      //! 1-(d/r)\n\</span>
<a name="l00496"></a>00496 <span class="stringliteral">        light *= dot( vec4( linAtten * linAtten, linAtten, linAtten, 1.0 ), u_LightAtten );\n\</span>
<a name="l00497"></a>00497 <span class="stringliteral">\n\</span>
<a name="l00498"></a>00498 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00500"></a>00500 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00501"></a>00501 <span class="stringliteral">        vec3 axisX = textureCube( s_CubeFaceX, v_ShadowTexCoord.xyz ).xyz;\n\</span>
<a name="l00502"></a>00502 <span class="stringliteral">        vec3 axisY = textureCube( s_CubeFaceY, v_ShadowTexCoord.xyz ).xyz;\n\</span>
<a name="l00503"></a>00503 <span class="stringliteral">        vec3 maxAxis = abs( v_ShadowTexCoord.xyz );\n\</span>
<a name="l00504"></a>00504 <span class="stringliteral">        half invMA = 1.0 / max( maxAxis.x, max( maxAxis.y, maxAxis.z ) );\n\</span>
<a name="l00505"></a>00505 <span class="stringliteral">\n\</span>
<a name="l00507"></a>00507 <span class="stringliteral">        vec3 shadowTexCoord;\n\</span>
<a name="l00508"></a>00508 <span class="stringliteral">        shadowTexCoord.x = dot( axisX, v_ShadowTexCoord.xyz );\n\</span>
<a name="l00509"></a>00509 <span class="stringliteral">        shadowTexCoord.y = dot( axisY, v_ShadowTexCoord.xyz );\n\</span>
<a name="l00510"></a>00510 <span class="stringliteral">        shadowTexCoord.z = 0.5 * u_ShadowNear.z;        //! ( z - 0.5 * n ) / z = ( z / z - 0.5 * n / z )\n\</span>
<a name="l00511"></a>00511 <span class="stringliteral">        shadowTexCoord *= invMA;\n\</span>
<a name="l00512"></a>00512 <span class="stringliteral">\n\</span>
<a name="l00514"></a>00514 <span class="stringliteral">        shadowTexCoord.z += 1.0;\n\</span>
<a name="l00515"></a>00515 <span class="stringliteral">        shadowTexCoord.z *= 0.5 * v_ShadowTexCoord.w + 0.5;\n\</span>
<a name="l00516"></a>00516 <span class="stringliteral">\n\</span>
<a name="l00518"></a>00518 <span class="stringliteral">        vec4 shadowMulAdd = textureCube( s_LightShadowVSM, v_ShadowTexCoord.xyz );\n\</span>
<a name="l00519"></a>00519 <span class="stringliteral">        shadowTexCoord.xy = shadowMulAdd.xy * shadowTexCoord.xy + shadowMulAdd.zw;\n\</span>
<a name="l00520"></a>00520 <span class="stringliteral">\n\</span>
<a name="l00521"></a>00521 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00523"></a>00523 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00524"></a>00524 <span class="stringliteral">#if B_QUALITY &lt; 3\n\</span>
<a name="l00525"></a>00525 <span class="stringliteral">        half3 jitterSTQ;\n\</span>
<a name="l00526"></a>00526 <span class="stringliteral">        jitterSTQ.xy = kShadowJitterTexScale.xy * gl_FragCoord.xy;\n\</span>
<a name="l00527"></a>00527 <span class="stringliteral">        jitterSTQ.z = 0.0;\n\</span>
<a name="l00528"></a>00528 <span class="stringliteral">        half center = 0.0;\n\</span>
<a name="l00529"></a>00529 <span class="stringliteral">        vec3 shadowCoord = vec3( 0.0, 0.0, shadowTexCoord.z );\n\</span>
<a name="l00530"></a>00530 <span class="stringliteral">        for ( int i = 0; i &lt; kShadowSampleCountOver2; ++i )\n\</span>
<a name="l00531"></a>00531 <span class="stringliteral">        {\n\</span>
<a name="l00532"></a>00532 <span class="stringliteral">                half4 jitter = shadowMulAdd.xyxy * invMA * ( 2.0 * texture3D( s_NoiseTableTex3D, jitterSTQ ) - 1.0 );\n\</span>
<a name="l00533"></a>00533 <span class="stringliteral">                jitterSTQ.z += kShadowInvSampleCount;\n\</span>
<a name="l00534"></a>00534 <span class="stringliteral">                shadowCoord.xy = u_LightWidth.xx * jitter.xy + shadowTexCoord.xy;\n\</span>
<a name="l00535"></a>00535 <span class="stringliteral">                center += shadow2D( s_LightShadowPage, shadowCoord.xyz ).x;\n\</span>
<a name="l00536"></a>00536 <span class="stringliteral">                shadowCoord.xy = u_LightWidth.xx * jitter.zw + shadowTexCoord.xy;\n\</span>
<a name="l00537"></a>00537 <span class="stringliteral">                center += shadow2D( s_LightShadowPage, shadowCoord.xyz ).x;\n\</span>
<a name="l00538"></a>00538 <span class="stringliteral">        }\n\</span>
<a name="l00539"></a>00539 <span class="stringliteral">\n\</span>
<a name="l00541"></a>00541 <span class="stringliteral">        light *= center * kShadowInvSampleCount;\n\</span>
<a name="l00542"></a>00542 <span class="stringliteral">#else\n\</span>
<a name="l00543"></a>00543 <span class="stringliteral">        light *= shadow2D( s_LightShadowPage, shadowTexCoord ).x;\n\</span>
<a name="l00544"></a>00544 <span class="stringliteral">#endif\n\</span>
<a name="l00545"></a>00545 <span class="stringliteral">\n\</span>
<a name="l00546"></a>00546 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00548"></a>00548 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00549"></a>00549 <span class="stringliteral">        half2 texCoord = v_TexCoord.xy;\n\</span>
<a name="l00550"></a>00550 <span class="stringliteral">\n\</span>
<a name="l00551"></a>00551 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00553"></a>00553 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00554"></a>00554 <span class="stringliteral">        half bump = texture2D( s_BumpTex, texCoord ).r;\n\</span>
<a name="l00555"></a>00555 <span class="stringliteral">        bump = u_BumpMod.x * bump + u_BumpAdd.x;\n\</span>
<a name="l00556"></a>00556 <span class="stringliteral">        half2 uvOffset = bump * localEyeVec.xy;\n\</span>
<a name="l00557"></a>00557 <span class="stringliteral">\n\</span>
<a name="l00558"></a>00558 <span class="stringliteral">        half3 normal = half3( 2.0 ) * texture2D( s_NormalTex, texCoord + uvOffset ).xwz - half3( 1.0 );\n\</span>
<a name="l00559"></a>00559 <span class="stringliteral">        normal = normalize( normal );\n\</span>
<a name="l00560"></a>00560 <span class="stringliteral">\n\</span>
<a name="l00561"></a>00561 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00563"></a>00563 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00564"></a>00564 <span class="stringliteral">        half4 diffuse = texture2D( s_DiffuseTex, texCoord + uvOffset );\n\</span>
<a name="l00565"></a>00565 <span class="stringliteral">        diffuse = u_DiffuseMod * diffuse + u_DiffuseAdd;\n\</span>
<a name="l00566"></a>00566 <span class="stringliteral">        diffuse.rgb *= clamp( dot( localLightVec, normal ), 0.0, 1.0 );\n\</span>
<a name="l00567"></a>00567 <span class="stringliteral">        diffuse.rgb *= light;\n\</span>
<a name="l00568"></a>00568 <span class="stringliteral">\n\</span>
<a name="l00569"></a>00569 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00571"></a>00571 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00572"></a>00572 <span class="stringliteral">        half specularDP = clamp( dot( localHalfVec, normal ), 0.0, 1.0 );\n\</span>
<a name="l00573"></a>00573 <span class="stringliteral">        specularDP = clamp( 4.0 * specularDP - 3.0, 0.0, 1.0 );\n\</span>
<a name="l00574"></a>00574 <span class="stringliteral">        specularDP = pow( specularDP, 20.0 );\n\</span>
<a name="l00575"></a>00575 <span class="stringliteral">\n\</span>
<a name="l00576"></a>00576 <span class="stringliteral">        half3 specular = texture2D( s_SpecularTex, texCoord + uvOffset ).rgb;\n\</span>
<a name="l00577"></a>00577 <span class="stringliteral">        specular = u_SpecularMod.rgb * specular + u_SpecularAdd.rgb;\n\</span>
<a name="l00578"></a>00578 <span class="stringliteral">        specular *= specularDP;\n\</span>
<a name="l00579"></a>00579 <span class="stringliteral">        specular *= light;\n\</span>
<a name="l00580"></a>00580 <span class="stringliteral">        diffuse.rgb += specular;\n\</span>
<a name="l00581"></a>00581 <span class="stringliteral">\n\</span>
<a name="l00582"></a>00582 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00584"></a>00584 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00585"></a>00585 <span class="stringliteral">        diffuse.rgb = mix( diffuse.rgb, light.rgb, u_LightHaze.xxx );\n\</span>
<a name="l00586"></a>00586 <span class="stringliteral">\n\</span>
<a name="l00587"></a>00587 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00589"></a>00589 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00590"></a>00590 <span class="stringliteral">//      diffuse.rgb *= 1.0 - clamp( ( length( v_LocalEyeVec ) - u_FogStart.x ) / u_FogRange.x, 0.0, 1.0 );\n\</span>
<a name="l00591"></a>00591 <span class="stringliteral">\n\</span>
<a name="l00592"></a>00592 <span class="stringliteral">        gl_FragColor = diffuse;\n\</span>
<a name="l00593"></a>00593 <span class="stringliteral">}\n\</span>
<a name="l00594"></a>00594 <span class="stringliteral">"</span>;
<a name="l00595"></a>00595 
<a name="l00596"></a><a class="code" href="_gr_material_mgr_8cpp.html#14206ca591cf45bdf2353e22140e7cd2">00596</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="_gr_material_mgr_8cpp.html#14206ca591cf45bdf2353e22140e7cd2">kDefaultAmbientVP</a> = <span class="stringliteral">"\</span>
<a name="l00597"></a>00597 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00602"></a>00602 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00603"></a>00603 <span class="stringliteral">\n\</span>
<a name="l00604"></a>00604 <span class="stringliteral">invariant gl_Position;\n\</span>
<a name="l00605"></a>00605 <span class="stringliteral">\n\</span>
<a name="l00606"></a>00606 <span class="stringliteral">//==========================================================\n\</span>
<a name="l00608"></a>00608 <span class="stringliteral">//==========================================================\n\</span>
<a name="l00609"></a>00609 <span class="stringliteral">attribute vec3 a_Position;\n\</span>
<a name="l00610"></a>00610 <span class="stringliteral">attribute vec3 a_Tangent;\n\</span>
<a name="l00611"></a>00611 <span class="stringliteral">attribute vec3 a_Binormal;\n\</span>
<a name="l00612"></a>00612 <span class="stringliteral">attribute vec3 a_Normal;\n\</span>
<a name="l00613"></a>00613 <span class="stringliteral">attribute vec2 a_TexCoord;\n\</span>
<a name="l00614"></a>00614 <span class="stringliteral">\n\</span>
<a name="l00615"></a>00615 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00617"></a>00617 <span class="stringliteral">varying vec3 v_LocalEyeVec;\n\</span>
<a name="l00618"></a>00618 <span class="stringliteral">varying vec2 v_TexCoord;\n\</span>
<a name="l00619"></a>00619 <span class="stringliteral">\n\</span>
<a name="l00620"></a>00620 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00622"></a>00622 <span class="stringliteral">uniform mat4 u_ModelViewProjectionMatrix;\n\</span>
<a name="l00623"></a>00623 <span class="stringliteral">uniform vec4 u_ViewPos;                         //! X,Y,Z,undef\n\</span>
<a name="l00624"></a>00624 <span class="stringliteral">uniform mat4x2 u_TextureMatrix;\n\</span>
<a name="l00625"></a>00625 <span class="stringliteral">\n\</span>
<a name="l00626"></a>00626 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00628"></a>00628 <span class="stringliteral">void main()\n\</span>
<a name="l00629"></a>00629 <span class="stringliteral">{\n\</span>
<a name="l00630"></a>00630 <span class="stringliteral">        gl_Position = u_ModelViewProjectionMatrix * vec4( a_Position.xyz, 1.0 );\n\</span>
<a name="l00631"></a>00631 <span class="stringliteral">\n\</span>
<a name="l00633"></a>00633 <span class="stringliteral">        vec3 localEyeVec = u_ViewPos.xyz - a_Position.xyz;\n\</span>
<a name="l00634"></a>00634 <span class="stringliteral">\n\</span>
<a name="l00636"></a>00636 <span class="stringliteral">        v_LocalEyeVec.x = dot( localEyeVec, a_Tangent.xyz );\n\</span>
<a name="l00637"></a>00637 <span class="stringliteral">        v_LocalEyeVec.y = dot( localEyeVec, a_Binormal.xyz );\n\</span>
<a name="l00638"></a>00638 <span class="stringliteral">        v_LocalEyeVec.z = dot( localEyeVec, a_Normal.xyz );\n\</span>
<a name="l00639"></a>00639 <span class="stringliteral">\n\</span>
<a name="l00641"></a>00641 <span class="stringliteral">        v_TexCoord.xy = u_TextureMatrix * vec4( a_TexCoord, 0.0, 1.0 );\n\</span>
<a name="l00642"></a>00642 <span class="stringliteral">}\n\</span>
<a name="l00643"></a>00643 <span class="stringliteral">"</span>;
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="_gr_material_mgr_8cpp.html#03823b9e70ff4d8c9daee92534e51067">00645</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="_gr_material_mgr_8cpp.html#03823b9e70ff4d8c9daee92534e51067">kDefaultAmbientFP</a> = <span class="stringliteral">"\</span>
<a name="l00646"></a>00646 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00651"></a>00651 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00652"></a>00652 <span class="stringliteral">\n\</span>
<a name="l00653"></a>00653 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00655"></a>00655 <span class="stringliteral">varying vec3 v_LocalEyeVec;\n\</span>
<a name="l00656"></a>00656 <span class="stringliteral">varying vec2 v_TexCoord;\n\</span>
<a name="l00657"></a>00657 <span class="stringliteral">\n\</span>
<a name="l00658"></a>00658 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00660"></a>00660 <span class="stringliteral">uniform vec4 u_BumpMod;\n\</span>
<a name="l00661"></a>00661 <span class="stringliteral">uniform vec4 u_BumpAdd;\n\</span>
<a name="l00662"></a>00662 <span class="stringliteral">uniform vec4 u_DiffuseMod;\n\</span>
<a name="l00663"></a>00663 <span class="stringliteral">uniform vec4 u_DiffuseAdd;\n\</span>
<a name="l00664"></a>00664 <span class="stringliteral">uniform vec4 u_AmbientMod;\n\</span>
<a name="l00665"></a>00665 <span class="stringliteral">uniform vec4 u_AmbientAdd;\n\</span>
<a name="l00666"></a>00666 <span class="stringliteral">uniform vec4 u_EmissiveMod;\n\</span>
<a name="l00667"></a>00667 <span class="stringliteral">uniform vec4 u_EmissiveAdd;\n\</span>
<a name="l00668"></a>00668 <span class="stringliteral">uniform vec4 u_AmbientColor;\n\</span>
<a name="l00669"></a>00669 <span class="stringliteral">uniform vec4 u_UberTexCacheMiss;\n\</span>
<a name="l00670"></a>00670 <span class="stringliteral">uniform vec4 u_FogStart;\n\</span>
<a name="l00671"></a>00671 <span class="stringliteral">uniform vec4 u_FogRange;\n\</span>
<a name="l00672"></a>00672 <span class="stringliteral">uniform vec4 u_FogColor;\n\</span>
<a name="l00673"></a>00673 <span class="stringliteral">\n\</span>
<a name="l00674"></a>00674 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00676"></a>00676 <span class="stringliteral">uniform samplerCube s_NormalizeTexCube;\n\</span>
<a name="l00677"></a>00677 <span class="stringliteral">uniform sampler2D s_StippleTex;\n\</span>
<a name="l00678"></a>00678 <span class="stringliteral">uniform sampler2D s_BumpTex;\n\</span>
<a name="l00679"></a>00679 <span class="stringliteral">uniform sampler2D s_DiffuseTex;\n\</span>
<a name="l00680"></a>00680 <span class="stringliteral">uniform sampler2D s_AmbientTex;\n\</span>
<a name="l00681"></a>00681 <span class="stringliteral">uniform sampler2D s_EmissiveTex;\n\</span>
<a name="l00682"></a>00682 <span class="stringliteral">\n\</span>
<a name="l00683"></a>00683 <span class="stringliteral">//----------------------------------------------------------\n\</span>
<a name="l00685"></a>00685 <span class="stringliteral">void main()\n\</span>
<a name="l00686"></a>00686 <span class="stringliteral">{\n\</span>
<a name="l00687"></a>00687 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00689"></a>00689 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00691"></a>00691 <span class="stringliteral">        half3 localEyeVec = 2.0 * textureCube( s_NormalizeTexCube, v_LocalEyeVec ).xyz - 1.0;\n\</span>
<a name="l00692"></a>00692 <span class="stringliteral">\n\</span>
<a name="l00693"></a>00693 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00695"></a>00695 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00696"></a>00696 <span class="stringliteral">        half2 texCoord = v_TexCoord.xy;\n\</span>
<a name="l00697"></a>00697 <span class="stringliteral">\n\</span>
<a name="l00698"></a>00698 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00700"></a>00700 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00701"></a>00701 <span class="stringliteral">        half bump = texture2D( s_BumpTex, texCoord ).r;\n\</span>
<a name="l00702"></a>00702 <span class="stringliteral">        bump = half( u_BumpMod.x ) * bump + half( u_BumpAdd.x );\n\</span>
<a name="l00703"></a>00703 <span class="stringliteral">        vec2 uvOffset = bump * localEyeVec.xy;\n\</span>
<a name="l00704"></a>00704 <span class="stringliteral">\n\</span>
<a name="l00705"></a>00705 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00707"></a>00707 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00708"></a>00708 <span class="stringliteral">        half4 diffuse = texture2D( s_DiffuseTex, texCoord + uvOffset );\n\</span>
<a name="l00709"></a>00709 <span class="stringliteral">        diffuse = u_DiffuseMod * diffuse + u_DiffuseAdd;\n\</span>
<a name="l00710"></a>00710 <span class="stringliteral">\n\</span>
<a name="l00711"></a>00711 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00713"></a>00713 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00714"></a>00714 <span class="stringliteral">        half3 ambient = texture2D( s_AmbientTex, texCoord + uvOffset ).rgb;\n\</span>
<a name="l00715"></a>00715 <span class="stringliteral">        ambient = u_AmbientMod.rgb * ambient + u_AmbientAdd.rgb;\n\</span>
<a name="l00716"></a>00716 <span class="stringliteral">        ambient *= u_AmbientColor.rgb;\n\</span>
<a name="l00717"></a>00717 <span class="stringliteral">        diffuse.rgb *= ambient;\n\</span>
<a name="l00718"></a>00718 <span class="stringliteral">\n\</span>
<a name="l00719"></a>00719 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00721"></a>00721 <span class="stringliteral">        //----------------------------------------------------\n\</span>
<a name="l00722"></a>00722 <span class="stringliteral">        half4 emissive = texture2D( s_EmissiveTex, texCoord + uvOffset );\n\</span>
<a name="l00723"></a>00723 <span class="stringliteral">        diffuse.rgb += u_EmissiveMod.rgb * emissive.rgb + u_EmissiveAdd.rgb;\n\</span>
<a name="l00724"></a>00724 <span class="stringliteral">\n\</span>
<a name="l00726"></a>00726 <span class="stringliteral">        diffuse.a *= texture2D( s_StippleTex, 0.5 * gl_FragCoord.xy ).a;\n\</span>
<a name="l00727"></a>00727 <span class="stringliteral">\n\</span>
<a name="l00729"></a>00729 <span class="stringliteral">        gl_FragColor = diffuse;\n\</span>
<a name="l00730"></a>00730 <span class="stringliteral">}\n\</span>
<a name="l00731"></a>00731 <span class="stringliteral">"</span>;
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Feb 13 17:19:55 2009 for Bootstrap Engine by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
