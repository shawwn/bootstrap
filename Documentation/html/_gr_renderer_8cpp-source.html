<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Bootstrap Engine: C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrRenderer.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrRenderer.cpp</h1><a href="_gr_renderer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//----------------------------------------------------------</span>
<a name="l00006"></a>00006 <span class="comment"></span><span class="comment">//----------------------------------------------------------</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="graphics__afx_8h.html">graphics_afx.h</a>"</span>
<a name="l00008"></a>00008 
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="_gr_renderer_8h.html">GrRenderer.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="_gr_shader_mgr_8h.html">GrShaderMgr.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="_gr_shader_8h.html">GrShader.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="_gr_texture_mgr_8h.html">GrTextureMgr.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="_gr_texture3_d_8h.html">GrTexture3D.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="_gr_texture_cube_8h.html">GrTextureCube.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="_gr_texture_8h.html">GrTexture.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="_gr_mesh_inst_8h.html">GrMeshInst.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "<a class="code" href="_gr_material_8h.html">GrMaterial.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="_gr_material_pass_8h.html">GrMaterialPass.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="_gr_util_8h.html">GrUtil.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "<a class="code" href="_g_l_subsys_8h.html">GLSubsys.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="_gr_camera_8h.html">GrCamera.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="_gr_light_8h.html">GrLight.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="_m_mat3x3_8h.html">MMat3x3.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="_gr_shadow_buffer_8h.html">GrShadowBuffer.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="_gr_mesh_buffer_mgr_8h.html">GrMeshBufferMgr.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="_gr_mesh_i_b_8h.html">GrMeshIB.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include "<a class="code" href="_gr_render_target_8h.html">GrRenderTarget.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="_gr_framebuffer_8h.html">GrFramebuffer.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="_gr_image_8h.html">GrImage.h</a>"</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">//#define __CPU_SHADOW</span>
<a name="l00035"></a>00035 <span class="preprocessor">#ifdef __CPU_SHADOW</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> _shadowMaskGLTex = 0;
<a name="l00037"></a>00037 <span class="preprocessor">#endif</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a><a class="code" href="_gr_renderer_8h.html#d75a49d60d82ab77ad52a21cdeb13ccd">00039</a> <a class="code" href="class_gr_renderer.html" title="class GrRenderer">GrRenderer</a>* <a class="code" href="_gr_renderer_8cpp.html#d75a49d60d82ab77ad52a21cdeb13ccd" title="class header.">gGrRenderer</a> = 0;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="_gr_renderer_8cpp.html#d0de127391c20812d44747b84ead1af8">00042</a> <span class="preprocessor">#define MAX_INDEX_BATCH_SIZE            1048576</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00045"></a><a class="code" href="_gr_renderer_8cpp.html#dcc9f630785c144fc9a2e0b32d540253">00045</a> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>              <a class="code" href="_gr_renderer_8cpp.html#dcc9f630785c144fc9a2e0b32d540253" title="GL support flags.">kDepthBoundsTest</a> = 0x0001;
<a name="l00046"></a>00046 
<a name="l00048"></a>00048 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a> kNoShadowTexgen( 0.0f, 0.0f, 0.0f, 0.0f,
<a name="l00049"></a>00049                                                                           0.0f, 0.0f, 0.0f, 0.0f,
<a name="l00050"></a>00050                                                                           0.0f, 0.0f, 0.0f, 0.0f,
<a name="l00051"></a>00051                                                                           0.0f, 0.0f, 0.0f, 1.0f );
<a name="l00052"></a>00052 
<a name="l00054"></a>00054 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a> kProjBias( 0.5f, 0.0f, 0.0f, 0.5f,
<a name="l00055"></a>00055                                                                 0.0f, 0.5f, 0.0f, 0.5f,
<a name="l00056"></a>00056                                                                 0.0f, 0.0f, 0.5f, 0.5f,
<a name="l00057"></a>00057                                                                 0.0f, 0.0f, 0.0f, 1.0f );
<a name="l00058"></a>00058 
<a name="l00059"></a><a class="code" href="_gr_renderer_8cpp.html#97d2945e308f00140e6f68425c8f29ce">00059</a> <span class="preprocessor">#define POST_PROCESS_VERTEX_COMPONENTS  ( GR_ATTRIB_POSITION_MASK | GR_ATTRIB_TANGENT_MASK | GR_ATTRIB_NORMAL_MASK | \</span>
<a name="l00060"></a>00060 <span class="preprocessor">                                                                                  GR_ATTRIB_BINORMAL_MASK | GR_ATTRIB_TEXCOORD_MASK )</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062 <span class="comment">//**********************************************************</span>
<a name="l00064"></a>00064 <span class="comment"></span><span class="comment">//**********************************************************</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">//==========================================================</span>
<a name="l00068"></a>00068 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">//----------------------------------------------------------</span>
<a name="l00071"></a><a class="code" href="class_gr_renderer.html#73cd9f551be328f0b6bb0548a52603c1">00071</a> <a class="code" href="class_gr_renderer.html#73cd9f551be328f0b6bb0548a52603c1" title="class GrRenderer">GrRenderer::GrRenderer</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> screenWidth, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> screenHeight, <a class="code" href="enums_8h.html#697c1ee1354746841860d5bf9f81c033" title="standard quality enum">EGRQUALITY</a> initQuality )
<a name="l00072"></a>00072 : _streamingIB( 2095152, 524288 )
<a name="l00073"></a>00073 , _gameTime( 0 )
<a name="l00074"></a>00074 , _sysTime( 0 )
<a name="l00075"></a>00075 , _quality( initQuality )
<a name="l00076"></a>00076 , _wireframe( false )
<a name="l00077"></a>00077 , _colorTextureEnable( true )
<a name="l00078"></a>00078 , _renderAmbience( &amp;_streamingIB, <a class="code" href="_gr_renderer_8cpp.html#d0de127391c20812d44747b84ead1af8">MAX_INDEX_BATCH_SIZE</a> )
<a name="l00079"></a>00079 , _renderLight( &amp;_streamingIB, <a class="code" href="_gr_renderer_8cpp.html#d0de127391c20812d44747b84ead1af8">MAX_INDEX_BATCH_SIZE</a> )
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( gGrRenderer == 0 );
<a name="l00082"></a>00082         gGrRenderer = <span class="keyword">this</span>;
<a name="l00083"></a>00083 
<a name="l00085"></a>00085         <a class="code" href="class_gr_texture_base.html" title="class GrTextureBase">GrTextureBase</a>* tex = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#83321c109ae9862b3e9ad6acabd8819d">FindTexture</a>( <a class="code" href="_gr_config_8h.html#5aeee10443a598e0d78d8befc855766c">GR_SYSTEXCUBE_NORMALIZE</a> );
<a name="l00086"></a>00086         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( tex != 0 &amp;&amp; tex-&gt;<a class="code" href="class_gr_texture_base.html#d0b985795ad1856b64d17b8404b2ca08" title="accessors.">GetType</a>() == <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e53085a491542d9caa5f9543b500942b7b5a6">GrTextureBase::ETT_CUBE</a> );
<a name="l00087"></a>00087         _normalizeCube = ( <a class="code" href="class_gr_texture_cube.html" title="class GrTextureCube">GrTextureCube</a>* )tex;
<a name="l00088"></a>00088 }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="comment">//----------------------------------------------------------</span>
<a name="l00091"></a><a class="code" href="class_gr_renderer.html#50282617350b0dd1666b9f7ea59864cb">00091</a> <a class="code" href="class_gr_renderer.html#50282617350b0dd1666b9f7ea59864cb">GrRenderer::~GrRenderer</a>()
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093         gGrRenderer = 0;
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="comment">//==========================================================</span>
<a name="l00099"></a>00099 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="comment">//----------------------------------------------------------</span>
<a name="l00102"></a>00102 <span class="keywordtype">void</span>
<a name="l00103"></a><a class="code" href="class_gr_renderer.html#7fd1313c1e8a5a9899726a18bdcf8e81">00103</a> <a class="code" href="class_gr_renderer.html#7fd1313c1e8a5a9899726a18bdcf8e81" title="updates the renderer&amp;#39;s time.">GrRenderer::Update</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gameTimeDelta, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sysTimeDelta )
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105         _gameTime += gameTimeDelta;
<a name="l00106"></a>00106         _sysTime += sysTimeDelta;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="comment">//----------------------------------------------------------</span>
<a name="l00110"></a>00110 <span class="keywordtype">void</span>
<a name="l00111"></a><a class="code" href="class_gr_renderer.html#b9f9a038981e6e4f3de7069202759fdf">00111</a> <a class="code" href="class_gr_renderer.html#b9f9a038981e6e4f3de7069202759fdf" title="renders lighting data.">GrRenderer::BeginRender</a>()
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="comment">//----------------------------------------------------------</span>
<a name="l00117"></a>00117 <span class="keywordtype">void</span>
<a name="l00118"></a><a class="code" href="class_gr_renderer.html#2ab0a1175b2450e0ed213d7d06b5e18e">00118</a> <a class="code" href="class_gr_renderer.html#2ab0a1175b2450e0ed213d7d06b5e18e">GrRenderer::RenderAmbience</a>( <span class="keyword">const</span> <a class="code" href="class_gr_render_list.html" title="class GrRenderList">GrRenderList</a>&amp; objects, <span class="keyword">const</span> <a class="code" href="class_gr_camera.html" title="class GrCamera">GrCamera</a>&amp; camera, <span class="keyword">const</span> <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>&amp; ambientColor )
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120         _renderAmbience.<a class="code" href="class_gr_render_ambience.html#933fb2f85e7fe005bc9e7fd1e3c75288">SetWireframeEnable</a>( _wireframe );
<a name="l00121"></a>00121         _renderAmbience.<a class="code" href="class_gr_render_ambience.html#ab79d93102ccc766970a4496ee89e48c">SetColorTextureEnable</a>( _colorTextureEnable );
<a name="l00122"></a>00122         _renderAmbience.<a class="code" href="class_gr_render_ambience.html#86bed7518d863b549ea73ae06025f929" title="public methods">RenderAmbience</a>( _postRenderObjects, objects, camera, ambientColor, _gameTime, _quality );
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="comment">//----------------------------------------------------------</span>
<a name="l00126"></a>00126 <span class="keywordtype">void</span>
<a name="l00127"></a><a class="code" href="class_gr_renderer.html#e67d78d01c3f6c8cd69cec7eeeeb8e03">00127</a> <a class="code" href="class_gr_renderer.html#e67d78d01c3f6c8cd69cec7eeeeb8e03">GrRenderer::RenderLight</a>( <span class="keyword">const</span> <a class="code" href="class_gr_render_list.html" title="class GrRenderList">GrRenderList</a>&amp; lightReceivers, <span class="keyword">const</span> <a class="code" href="class_gr_render_list.html" title="class GrRenderList">GrRenderList</a>&amp; shadowCasters, <span class="keyword">const</span> <a class="code" href="class_gr_camera.html" title="class GrCamera">GrCamera</a>&amp; camera, <span class="keyword">const</span> <a class="code" href="class_gr_light.html" title="class GrLight">GrLight</a>&amp; light )
<a name="l00128"></a>00128 {
<a name="l00130"></a>00130         <a class="code" href="_g_l_subsys_8h.html#ab12f88c1ad74a5b4876f37fcf105bda">CHECK_GL</a>();
<a name="l00131"></a>00131 
<a name="l00133"></a>00133         <span class="keywordflow">if</span> ( !lightReceivers.<a class="code" href="class_gr_render_list.html#eb7629d3dfeedc0b4506fe89805626ca" title="renderable accessors.">GetItemCount</a>() )
<a name="l00134"></a>00134                 <span class="keywordflow">return</span>;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136         _renderLight.<a class="code" href="class_gr_render_light.html#ea1e59d002ca4e91abd8a27bbeaf6f4d" title="public methods">RenderLight</a>( lightReceivers, shadowCasters, camera, light, _gameTime, _quality );
<a name="l00137"></a>00137         <a class="code" href="_g_l_subsys_8h.html#ab12f88c1ad74a5b4876f37fcf105bda">CHECK_GL</a>();
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="comment">//----------------------------------------------------------</span>
<a name="l00141"></a>00141 <span class="keywordtype">void</span>
<a name="l00142"></a><a class="code" href="class_gr_renderer.html#3e1dbac87b12049ca2e0341662ebc8a6">00142</a> <a class="code" href="class_gr_renderer.html#3e1dbac87b12049ca2e0341662ebc8a6">GrRenderer::EndRender</a>( <span class="keyword">const</span> <a class="code" href="class_gr_camera.html" title="class GrCamera">GrCamera</a>&amp; camera )
<a name="l00143"></a>00143 {
<a name="l00144"></a>00144         <a class="code" href="_g_l_subsys_8h.html#ab12f88c1ad74a5b4876f37fcf105bda">CHECK_GL</a>();
<a name="l00145"></a>00145 
<a name="l00147"></a>00147         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> postRenderObjCount = _postRenderObjects.<a class="code" href="class_gr_render_list.html#eb7629d3dfeedc0b4506fe89805626ca" title="renderable accessors.">GetItemCount</a>();
<a name="l00148"></a>00148         <span class="keywordflow">if</span> ( !postRenderObjCount )
<a name="l00149"></a>00149         {
<a name="l00150"></a>00150                 _streamingIB.<a class="code" href="class_gr_streaming_i_b.html#e5c7eb6fe055047ab7cba1720c15d67c" title="clear indices and reset the current offset.">Reset</a>();
<a name="l00151"></a>00151                 <span class="keywordflow">return</span>;
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153 
<a name="l00155"></a>00155         <a class="code" href="_gr_util_8cpp.html#da7ea629bb413c26919562c8846d6139">GrSetState</a>( <a class="code" href="_gr_util_8h.html#df38fed29d4a8214bf4a51a0df0a7512" title="render states.">GR_DEPTHTEST</a> | <a class="code" href="_gr_util_8h.html#43f8fbc0073e1858f6bba0a73acfe8a6">GR_CULLFACE</a> );
<a name="l00156"></a>00156         <a class="code" href="_gr_util_8cpp.html#60d9ac55af862efb36a5e95f19c14407">GrSetDepthMode</a>( <a class="code" href="_gr_util_8h.html#987cbe08cd23c0d7a12ae576e9ce098411cf9194e24cc66a0779bd0d6619ce9d">EDM_LESSEQUAL</a> );
<a name="l00157"></a>00157         <a class="code" href="_gr_util_8cpp.html#ecb580f9d96395afa050b6d81c31421c">GrSetCullMode</a>( <a class="code" href="_gr_util_8h.html#ea790ef067767354691d0d60c51542fe5fb45ade8a2def0e22899c5f34497da4">ECM_BACK</a> );
<a name="l00158"></a>00158         <a class="code" href="_gr_util_8cpp.html#7b33558bb79e3c6936f26553c282d081">GrSetWriteEnable</a>( <a class="code" href="_gr_util_8h.html#d091dcc5dafb6944427eb6d9895b25d3">GR_RGBA</a> );
<a name="l00159"></a>00159 
<a name="l00161"></a>00161         <span class="keywordtype">int</span> vpX = 0;
<a name="l00162"></a>00162         <span class="keywordtype">int</span> vpY = 0;
<a name="l00163"></a>00163         <span class="keywordtype">int</span> vpWidth = 0;
<a name="l00164"></a>00164         <span class="keywordtype">int</span> vpHeight = 0;
<a name="l00165"></a>00165         <a class="code" href="_gr_util_8cpp.html#790778867fdcac797860c02a4bd6b1fa">GrGetViewport</a>( vpX, vpY, vpWidth, vpHeight );
<a name="l00166"></a>00166 
<a name="l00168"></a>00168         <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; worldCameraPos = camera.<a class="code" href="class_gr_camera.html#8cda9065741c39d298fe54d5ef0c3705" title="camera info accessors.">GetPos</a>();
<a name="l00169"></a>00169 
<a name="l00171"></a>00171         _normalizeCube-&gt;Bind( <a class="code" href="_gr_config_8h.html#e7ef96b3ca82fe304a8c6c51440a7d4d" title="light pass.">GR_TEX_CUBE_NORMALIZE</a>, <a class="code" href="_g_l_8h.html#7ec02582a9b1c390908a2230c8e26c0b">GL_NEAREST</a>, <a class="code" href="_g_l_8h.html#7ec02582a9b1c390908a2230c8e26c0b">GL_NEAREST</a>, <a class="code" href="glext_8h.html#e90f81f48642444b4ba7fa5cacf40569">GL_CLAMP_TO_EDGE</a>, <a class="code" href="glext_8h.html#e90f81f48642444b4ba7fa5cacf40569">GL_CLAMP_TO_EDGE</a> );
<a name="l00172"></a>00172 
<a name="l00174"></a>00174         <a class="code" href="class_gr_shader.html" title="Purpose: To load and manage a shader.">GrShader</a>* <a class="code" href="glext_8h.html#57b2a96adb1d51204909a82d861e395e">shader</a> = 0;
<a name="l00175"></a>00175         <a class="code" href="class_gr_material.html" title="class GrMaterial">GrMaterial</a>* prevMaterial = 0;
<a name="l00176"></a>00176         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stateMask = ~<a class="code" href="_gr_util_8h.html#3d7aa459899278ffdc2f5d3229b6ec65">GR_WIREFRAME</a>;
<a name="l00177"></a>00177         <span class="keywordtype">bool</span> needNextPass = <span class="keyword">false</span>;
<a name="l00178"></a>00178         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pass = 0;
<a name="l00179"></a>00179         <span class="keywordflow">do</span>
<a name="l00180"></a>00180         {
<a name="l00182"></a>00182                 needNextPass = <span class="keyword">false</span>;
<a name="l00183"></a>00183 
<a name="l00186"></a>00186                 <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase	&gt;</a> curRender = <a class="code" href="_gr_framebuffer_8cpp.html#610596150a7a507d6888f0ee850a5cc6">gGrFramebuffer</a>-&gt;<a class="code" href="class_gr_framebuffer.html#c262b0f70df5aa7c47313b46894ffa7e">CopyCurrentRender</a>( vpX, vpY, vpWidth, vpHeight );
<a name="l00187"></a>00187                 <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase	&gt;</a> curDepth = <a class="code" href="_gr_framebuffer_8cpp.html#610596150a7a507d6888f0ee850a5cc6">gGrFramebuffer</a>-&gt;<a class="code" href="class_gr_framebuffer.html#ba49556b67bae1454a162bc6c1df7bd3">CopyCurrentDepth</a>( vpX, vpY, vpWidth, vpHeight );
<a name="l00188"></a>00188                 curRender-&gt;Bind( <a class="code" href="_gr_config_8h.html#2b8837debcee61e82ce18a7c5a97a7cf" title="misc textures.">GR_TEX_CUR_RENDER</a>, <a class="code" href="_g_l_8h.html#7ec02582a9b1c390908a2230c8e26c0b">GL_NEAREST</a>, <a class="code" href="_g_l_8h.html#7ec02582a9b1c390908a2230c8e26c0b">GL_NEAREST</a>, <a class="code" href="glext_8h.html#e90f81f48642444b4ba7fa5cacf40569">GL_CLAMP_TO_EDGE</a>, <a class="code" href="glext_8h.html#e90f81f48642444b4ba7fa5cacf40569">GL_CLAMP_TO_EDGE</a> );
<a name="l00189"></a>00189                 curDepth-&gt;Bind( <a class="code" href="_gr_config_8h.html#4e082342f05c4e9e8f6cf0b91599e13f">GR_TEX_CUR_DEPTH</a>, <a class="code" href="_g_l_8h.html#7ec02582a9b1c390908a2230c8e26c0b">GL_NEAREST</a>, <a class="code" href="_g_l_8h.html#7ec02582a9b1c390908a2230c8e26c0b">GL_NEAREST</a>, <a class="code" href="glext_8h.html#e90f81f48642444b4ba7fa5cacf40569">GL_CLAMP_TO_EDGE</a>, <a class="code" href="glext_8h.html#e90f81f48642444b4ba7fa5cacf40569">GL_CLAMP_TO_EDGE</a> );
<a name="l00190"></a>00190 
<a name="l00192"></a>00192                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startObj = 0;
<a name="l00193"></a>00193                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> objCount = _postRenderObjects.<a class="code" href="class_gr_render_list.html#eb7629d3dfeedc0b4506fe89805626ca" title="renderable accessors.">GetItemCount</a>();
<a name="l00194"></a>00194                 <span class="keywordflow">while</span> ( startObj &lt; objCount )
<a name="l00195"></a>00195                 {
<a name="l00197"></a>00197                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endObj = 0;
<a name="l00198"></a>00198                         <span class="keyword">const</span> <a class="code" href="class_gr_material.html" title="class GrMaterial">GrMaterial</a>* material = GetMaterialSpan( endObj, _postRenderObjects, startObj );
<a name="l00199"></a>00199 
<a name="l00201"></a>00201                         <span class="keywordflow">if</span> ( pass &lt; material-&gt;GetPostProcessPassCount() )
<a name="l00202"></a>00202                         {
<a name="l00204"></a>00204                                 needNextPass = needNextPass || ( ( material-&gt;<a class="code" href="class_gr_material.html#ec2234608525b1f9b306990871cd984a" title="post processing passes.">GetPostProcessPassCount</a>() - 1 ) &gt; pass );
<a name="l00205"></a>00205 
<a name="l00207"></a>00207                                 <span class="keyword">const</span> <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>* curPass = material-&gt;<a class="code" href="class_gr_material.html#41f016d8810c0dddd346de241ef18a4f">GetPostProcessPass</a>( pass );
<a name="l00208"></a>00208 
<a name="l00210"></a>00210                                 shader = curPass-&gt;<a class="code" href="class_gr_material_pass.html#c03a1be09b50c814be01d535c64c4da3">GetShader</a>();
<a name="l00211"></a>00211                                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( shader );
<a name="l00212"></a>00212 
<a name="l00214"></a>00214                                 shader-&gt;<a class="code" href="class_gr_shader.html#f32a4e5288174733e6460afac22c21c3" title="make the shader current.">Bind</a>( _quality );
<a name="l00215"></a>00215 
<a name="l00217"></a>00217                                 curPass-&gt;<a class="code" href="class_gr_material_pass.html#272b822ee696efb7e967a9565cd79a97">ApplyStates</a>( stateMask, <a class="code" href="_gr_util_8h.html#d091dcc5dafb6944427eb6d9895b25d3">GR_RGBA</a> | <a class="code" href="_gr_util_8h.html#263ecb0b6dc90d2aca7b9291d81a7024">GR_DEPTH</a> );
<a name="l00218"></a>00218                                 curPass-&gt;<a class="code" href="class_gr_material_pass.html#645501d055a4d4cffb0482a8f91448be" title="parameter bindings">ApplyAmbientBlendStates</a>( stateMask );
<a name="l00219"></a>00219                                 curPass-&gt;<a class="code" href="class_gr_material_pass.html#7961e2a4d2fbd45128fa21cac4f32f30" title="user parameters">GetUserParams</a>().<a class="code" href="class_gr_material_user_params.html#8b3930f139352c856d7ed694a3c05de6" title="applies user params/samplers.">ApplyUserParams</a>();
<a name="l00220"></a>00220                                 curPass-&gt;<a class="code" href="class_gr_material_pass.html#7961e2a4d2fbd45128fa21cac4f32f30" title="user parameters">GetUserParams</a>().<a class="code" href="class_gr_material_user_params.html#6aabd7e3eda8be6d4b764d8f4a4a2ce2">ApplyUserSamplers</a>();
<a name="l00221"></a>00221 
<a name="l00223"></a>00223                                 curPass-&gt;<a class="code" href="class_gr_material_pass.html#d4fe8b412fb170dcf48688ba424c7d18">GetTextureSet</a>().<a class="code" href="class_gr_texture_set.html#974058b8d0d8f04b85807f52ae857a63">ApplyGlobalState</a>( shader );
<a name="l00224"></a>00224                                 curPass-&gt;<a class="code" href="class_gr_material_pass.html#d4fe8b412fb170dcf48688ba424c7d18">GetTextureSet</a>().<a class="code" href="class_gr_texture_set.html#e3e1bfc4506ef8333d5ef947f8d7b391">ApplyStageState</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688b1b35286c474a867806a21cea61952b5">ES_BUMP</a>, <a class="code" href="_gr_config_8h.html#4efb41e353cc885eb72be8fb688fc5d4">GR_TEX_BUMP</a>, shader, <a class="code" href="class_gr_shader.html#2f004c603bb97711d05eb68381a5a7ba3f52eed666dad2ab377a721dec7d48c2">GrShader::EP_BUMP_MOD</a>, <a class="code" href="class_gr_shader.html#2f004c603bb97711d05eb68381a5a7baca21fbc32f19ff7f96d197e91fa8241f">GrShader::EP_BUMP_ADD</a> );
<a name="l00225"></a>00225                                 curPass-&gt;<a class="code" href="class_gr_material_pass.html#d4fe8b412fb170dcf48688ba424c7d18">GetTextureSet</a>().<a class="code" href="class_gr_texture_set.html#e3e1bfc4506ef8333d5ef947f8d7b391">ApplyStageState</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688293de1727613be2259dad1827bcfa0d0">ES_NORMAL</a>, <a class="code" href="_gr_config_8h.html#d1a00f490cd31d0c1c9110e7b353c91e">GR_TEX_NORMAL</a> );
<a name="l00226"></a>00226                                 curPass-&gt;<a class="code" href="class_gr_material_pass.html#d4fe8b412fb170dcf48688ba424c7d18">GetTextureSet</a>().<a class="code" href="class_gr_texture_set.html#e3e1bfc4506ef8333d5ef947f8d7b391">ApplyStageState</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606884a3d034db25df349c89094e48978258d">ES_DIFFUSE</a>, <a class="code" href="_gr_config_8h.html#414a361b34dcaaf2c98e12af6d40752c">GR_TEX_DIFFUSE</a>, shader, <a class="code" href="class_gr_shader.html#2f004c603bb97711d05eb68381a5a7babd45973b924f00252c2b0119fe5b3fe5">GrShader::EP_DIFFUSE_MOD</a>, <a class="code" href="class_gr_shader.html#2f004c603bb97711d05eb68381a5a7ba2a9f47816bdefe2925a532af749de481">GrShader::EP_DIFFUSE_ADD</a> );
<a name="l00227"></a>00227                                 curPass-&gt;<a class="code" href="class_gr_material_pass.html#d4fe8b412fb170dcf48688ba424c7d18">GetTextureSet</a>().<a class="code" href="class_gr_texture_set.html#e3e1bfc4506ef8333d5ef947f8d7b391">ApplyStageState</a>( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606885c089af9c447c3ea195ed80458a1a49e">ES_SPECULAR</a>, <a class="code" href="_gr_config_8h.html#479f147a9ef37952111511c0be79e229">GR_TEX_SPECULAR</a>, shader, <a class="code" href="class_gr_shader.html#2f004c603bb97711d05eb68381a5a7ba34e4a46829351d19558379ff1494375d">GrShader::EP_SPECULAR_MOD</a>, <a class="code" href="class_gr_shader.html#2f004c603bb97711d05eb68381a5a7ba92003f10db0b04b9d2230108be48e2e0">GrShader::EP_SPECULAR_ADD</a> );
<a name="l00228"></a>00228 
<a name="l00230"></a>00230                                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#0c0d4701a6c89f4f7f0640715d27ab26">obj</a> = startObj; <a class="code" href="glext_8h.html#0c0d4701a6c89f4f7f0640715d27ab26">obj</a> &lt; endObj; ++<a class="code" href="glext_8h.html#0c0d4701a6c89f4f7f0640715d27ab26">obj</a> )
<a name="l00231"></a>00231                                 {
<a name="l00233"></a>00233                                         <span class="keyword">const</span> <a class="code" href="struct_gr_render_list_1_1_s_item.html">GrRenderList::SItem</a>&amp; renderable = _postRenderObjects[ <a class="code" href="glext_8h.html#0c0d4701a6c89f4f7f0640715d27ab26">obj</a> ];
<a name="l00234"></a>00234 
<a name="l00236"></a>00236 <span class="comment">//                                      URef&lt; GrTextureBase &gt; reflectTex = renderable.meshInst-&gt;GetReflection( renderable.range );</span>
<a name="l00237"></a>00237 <span class="comment">//                                      if ( reflectTex )</span>
<a name="l00238"></a>00238 <span class="comment">//                                              reflectTex-&gt;Bind( GR_TEX_REFLECTION, GL_LINEAR, GL_LINEAR, GL_CLAMP_TO_EDGE, GL_CLAMP_TO_EDGE );</span>
<a name="l00239"></a>00239 
<a name="l00241"></a>00241                                         <span class="keywordflow">if</span> ( renderable.<a class="code" href="struct_gr_render_list_1_1_s_item.html#2e41f93266e69ba59b799dbfebea3575">preTransformed</a> )
<a name="l00242"></a>00242                                         {
<a name="l00243"></a>00243                                                 shader-&gt;<a class="code" href="class_gr_shader.html#c054492b117be764f4fd2440b7bd1020">SetEngineParam4x4fv</a>( <a class="code" href="class_gr_shader.html#2f004c603bb97711d05eb68381a5a7ba30e37abd2fd8b590c15664405e826b85" title="vertex params.">GrShader::EP_MODEL_VIEW_PROJECTION_MATRIX</a>, camera.<a class="code" href="class_gr_camera.html#a9a8ab5d4d339a769d58e0fa4f1bc823">GetViewProjMatrix</a>() );
<a name="l00244"></a>00244                                                 shader-&gt;<a class="code" href="class_gr_shader.html#151b6e0ff7c3e9fa37c5bc2498e752fe" title="renderer driven params.">SetEngineParam4fv</a>( <a class="code" href="class_gr_shader.html#2f004c603bb97711d05eb68381a5a7ba5fb8b055e849e72981bbccd2019bdcd8">GrShader::EP_LOCAL_VIEW_POSITION</a>, worldCameraPos );
<a name="l00245"></a>00245                                                 renderable.<a class="code" href="struct_gr_render_list_1_1_s_item.html#d6ed05f00aea8fb71dfae70328e77bb8">meshInst</a>-&gt;<a class="code" href="class_gr_mesh_inst.html#ca05d2e8e1fbaecd7902301797a1586b" title="render.">RenderRange</a>( renderable.<a class="code" href="struct_gr_render_list_1_1_s_item.html#4585412be0e3084c369d507382bbe941">range</a>, <a class="code" href="_gr_renderer_8cpp.html#97d2945e308f00140e6f68425c8f29ce">POST_PROCESS_VERTEX_COMPONENTS</a>, _gameTime );
<a name="l00246"></a>00246                                         }
<a name="l00247"></a>00247                                         <span class="keywordflow">else</span>
<a name="l00248"></a>00248                                         {
<a name="l00250"></a>00250                                                 <span class="keyword">const</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>&amp; world = renderable.<a class="code" href="struct_gr_render_list_1_1_s_item.html#d6ed05f00aea8fb71dfae70328e77bb8">meshInst</a>-&gt;<a class="code" href="class_gr_mesh_inst.html#bc956297c8b4dc6cae1e16f04f949bf6">GetTransform</a>();
<a name="l00251"></a>00251                                                 <span class="keyword">const</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>&amp; invWorld = renderable.<a class="code" href="struct_gr_render_list_1_1_s_item.html#d6ed05f00aea8fb71dfae70328e77bb8">meshInst</a>-&gt;<a class="code" href="class_gr_mesh_inst.html#34b8224971a8f2756d1eadb4af5e9124">GetInvTransform</a>();
<a name="l00252"></a>00252                                                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> localEyePos = invWorld.<a class="code" href="class_m_mat4x4.html#385cd0e1af4a803cfb38860de8195572">TransformCoord</a>( worldCameraPos );
<a name="l00253"></a>00253 
<a name="l00255"></a>00255                                                 shader-&gt;<a class="code" href="class_gr_shader.html#151b6e0ff7c3e9fa37c5bc2498e752fe" title="renderer driven params.">SetEngineParam4fv</a>( <a class="code" href="class_gr_shader.html#2f004c603bb97711d05eb68381a5a7ba5fb8b055e849e72981bbccd2019bdcd8">GrShader::EP_LOCAL_VIEW_POSITION</a>, localEyePos );
<a name="l00256"></a>00256                                                 shader-&gt;<a class="code" href="class_gr_shader.html#c054492b117be764f4fd2440b7bd1020">SetEngineParam4x4fv</a>( <a class="code" href="class_gr_shader.html#2f004c603bb97711d05eb68381a5a7ba5fb8b055e849e72981bbccd2019bdcd8">GrShader::EP_LOCAL_VIEW_POSITION</a>, camera.<a class="code" href="class_gr_camera.html#a9a8ab5d4d339a769d58e0fa4f1bc823">GetViewProjMatrix</a>() * world );
<a name="l00257"></a>00257 
<a name="l00259"></a>00259                                                 renderable.<a class="code" href="struct_gr_render_list_1_1_s_item.html#d6ed05f00aea8fb71dfae70328e77bb8">meshInst</a>-&gt;<a class="code" href="class_gr_mesh_inst.html#ca05d2e8e1fbaecd7902301797a1586b" title="render.">RenderRange</a>( renderable.<a class="code" href="struct_gr_render_list_1_1_s_item.html#4585412be0e3084c369d507382bbe941">range</a>, <a class="code" href="_gr_renderer_8cpp.html#97d2945e308f00140e6f68425c8f29ce">POST_PROCESS_VERTEX_COMPONENTS</a>, _gameTime );
<a name="l00260"></a>00260                                         }
<a name="l00261"></a>00261                                 }
<a name="l00262"></a>00262                         }
<a name="l00263"></a>00263                         startObj = endObj;
<a name="l00264"></a>00264                 }
<a name="l00265"></a>00265 
<a name="l00267"></a>00267                 ++pass;
<a name="l00268"></a>00268         } <span class="keywordflow">while</span> ( needNextPass );
<a name="l00269"></a>00269 
<a name="l00271"></a>00271         _postRenderObjects.<a class="code" href="class_gr_render_list.html#a7f961a2ec3cfc7bebf4ee7157569081" title="clears the list.">Clear</a>();
<a name="l00272"></a>00272 
<a name="l00274"></a>00274         _streamingIB.<a class="code" href="class_gr_streaming_i_b.html#e5c7eb6fe055047ab7cba1720c15d67c" title="clear indices and reset the current offset.">Reset</a>();
<a name="l00275"></a>00275 }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 <span class="comment">//----------------------------------------------------------</span>
<a name="l00278"></a>00278 <span class="keywordtype">void</span>
<a name="l00279"></a><a class="code" href="class_gr_renderer.html#92f2baaa0b18549e04bc8e5361cfe676">00279</a> <a class="code" href="class_gr_renderer.html#92f2baaa0b18549e04bc8e5361cfe676">GrRenderer::PreContextReset</a>()
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 <span class="comment">//----------------------------------------------------------</span>
<a name="l00285"></a>00285 <span class="keywordtype">void</span>
<a name="l00286"></a><a class="code" href="class_gr_renderer.html#ce226ce944cecd180bc8aa02173cee3b">00286</a> <a class="code" href="class_gr_renderer.html#ce226ce944cecd180bc8aa02173cee3b">GrRenderer::PostContextReset</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> screenWidth, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> screenHeight )
<a name="l00287"></a>00287 {
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 <span class="comment">//==========================================================</span>
<a name="l00294"></a>00294 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 <span class="comment">//----------------------------------------------------------</span>
<a name="l00297"></a>00297 <span class="keyword">const</span> <a class="code" href="class_gr_material.html" title="class GrMaterial">GrMaterial</a>*
<a name="l00298"></a>00298 GrRenderer::GetMaterialSpan( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; spanEnd, <span class="keyword">const</span> <a class="code" href="class_gr_render_list.html" title="class GrRenderList">GrRenderList</a>&amp; list, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startObj )
<a name="l00299"></a>00299 {
<a name="l00300"></a>00300         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( startObj &lt; list.<a class="code" href="class_gr_render_list.html#eb7629d3dfeedc0b4506fe89805626ca" title="renderable accessors.">GetItemCount</a>() );
<a name="l00301"></a>00301         <span class="keyword">const</span> <a class="code" href="class_gr_material.html" title="class GrMaterial">GrMaterial</a>* curMaterial = list[ startObj ].meshInst-&gt;GetMaterial( list[ startObj ].<a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a> );
<a name="l00302"></a>00302         spanEnd = startObj+1;
<a name="l00303"></a>00303         <span class="keywordflow">while</span> ( spanEnd &lt; list.<a class="code" href="class_gr_render_list.html#eb7629d3dfeedc0b4506fe89805626ca" title="renderable accessors.">GetItemCount</a>() &amp;&amp; curMaterial == list[ spanEnd ].meshInst-&gt;GetMaterial( list[ spanEnd ].range ) )
<a name="l00304"></a>00304                 ++spanEnd;
<a name="l00305"></a>00305         <span class="keywordflow">return</span> curMaterial;
<a name="l00306"></a>00306 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Feb 13 17:19:57 2009 for Bootstrap Engine by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
