<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Bootstrap Engine: C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrParse.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrParse.cpp</h1><a href="_gr_parse_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//----------------------------------------------------------</span>
<a name="l00006"></a>00006 <span class="comment"></span><span class="comment">//----------------------------------------------------------</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="graphics__afx_8h.html">graphics_afx.h</a>"</span>
<a name="l00008"></a>00008 
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="_gr_parse_8h.html">GrParse.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="_gr_material_8h.html">GrMaterial.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="_gr_material_pass_8h.html">GrMaterialPass.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="_gr_texture_8h.html">GrTexture.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="_gr_texture_cube_8h.html">GrTextureCube.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="_gr_light_8h.html">GrLight.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="_bsc_lexer_8h.html">BscLexer.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="_bsc_expr_lib_8h.html">BscExprLib.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "<a class="code" href="_u_expr_number_8h.html">UExprNumber.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="_u_expr_8h.html">UExpr.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="_gr_image_8h.html">GrImage.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "<a class="code" href="_r_rsrc_mgr_8h.html">RRsrcMgr.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="_gr_texture_mgr_8h.html">GrTextureMgr.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="_gr_color_8h.html">GrColor.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="_gr_material_mgr_8h.html">GrMaterialMgr.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="_gr_scene_8h.html">GrScene.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="_u_fast_array_8h.html">UFastArray.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="_gr_projection_8h.html">GrProjection.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include "<a class="code" href="_m_mat3x3_8h.html">MMat3x3.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="_m_mat4x4_8h.html">MMat4x4.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="_gr_shader_mgr_8h.html">GrShaderMgr.h</a>"</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include "<a class="code" href="_gr_light_mgr_8h.html">GrLightMgr.h</a>"</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include "<a class="code" href="_gr_deform_wave_8h.html">GrDeformWave.h</a>"</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include "<a class="code" href="_r_file_mgr_8h.html">RFileMgr.h</a>"</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include "<a class="code" href="_r_file_8h.html">RFile.h</a>"</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "<a class="code" href="_gr_b_s_p_tree_8h.html">GrBSPTree.h</a>"</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include "<a class="code" href="_gr_model_mgr_8h.html">GrModelMgr.h</a>"</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include "<a class="code" href="_gr_model_8h.html">GrModel.h</a>"</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include "<a class="code" href="_gr_model_node_8h.html">GrModelNode.h</a>"</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include "<a class="code" href="_gr_mesh_inst_8h.html">GrMeshInst.h</a>"</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include "<a class="code" href="_gr_software_texture_mgr_8h.html">GrSoftwareTextureMgr.h</a>"</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include "<a class="code" href="_u_expr_mgr_8h.html">UExprMgr.h</a>"</span>
<a name="l00044"></a>00044 
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00047"></a>00047 
<a name="l00049"></a>00049 <span class="keyword">static</span> <span class="keywordtype">bool</span> IsTok( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>* tok, <span class="keyword">const</span> <span class="keywordtype">char</span>* str )      {       <span class="keywordflow">return</span> ( _stricmp( tok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>.c_str(), str ) == 0 );     }
<a name="l00050"></a>00050 
<a name="l00051"></a><a class="code" href="struct_s_shader_user_param.html">00051</a> <span class="keyword">struct </span><a class="code" href="struct_s_shader_user_param.html">SShaderUserParam</a>
<a name="l00052"></a>00052 {
<a name="l00053"></a><a class="code" href="struct_s_shader_user_param.html#971f2d4b67996515461b50a0b5a72a39">00053</a>         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> <a class="code" href="struct_s_shader_user_param.html#971f2d4b67996515461b50a0b5a72a39">name</a>;
<a name="l00054"></a><a class="code" href="struct_s_shader_user_param.html#4a4e66ee74f4ecbe1b069d70b9c5615d">00054</a>         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> <a class="code" href="struct_s_shader_user_param.html#4a4e66ee74f4ecbe1b069d70b9c5615d">values</a>[ 4 ];
<a name="l00055"></a>00055 };
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="struct_s_shader_user_sampler.html">00057</a> <span class="keyword">struct </span><a class="code" href="struct_s_shader_user_sampler.html">SShaderUserSampler</a>
<a name="l00058"></a>00058 {
<a name="l00059"></a><a class="code" href="struct_s_shader_user_sampler.html#e92b8711eca7675a2dad845221b8b242">00059</a>         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> <a class="code" href="struct_s_shader_user_sampler.html#e92b8711eca7675a2dad845221b8b242">name</a>;
<a name="l00060"></a><a class="code" href="struct_s_shader_user_sampler.html#bb2d4666215f21d09a50b58044c9b4aa">00060</a>         <a class="code" href="class_gr_texture_stage.html" title="class GrTextureStage">GrTextureStage</a> <a class="code" href="struct_s_shader_user_sampler.html#bb2d4666215f21d09a50b58044c9b4aa">stage</a>;
<a name="l00061"></a>00061 };
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="struct_s_model_node_mesh_range_info.html">00063</a> <span class="keyword">struct </span><a class="code" href="struct_s_model_node_mesh_range_info.html">SModelNodeMeshRangeInfo</a>
<a name="l00064"></a>00064 {
<a name="l00065"></a><a class="code" href="struct_s_model_node_mesh_range_info.html#882bacf79495a4f89280c6cc5f23b815">00065</a>         <a class="code" href="struct_s_model_node_mesh_range_info.html#882bacf79495a4f89280c6cc5f23b815">SModelNodeMeshRangeInfo</a>() : <a class="code" href="struct_s_model_node_mesh_range_info.html#1d4582bb5a63563bbf20adf986fd6d04">rangeIdx</a>( 0 ) { }
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="struct_s_model_node_mesh_range_info.html#1d4582bb5a63563bbf20adf986fd6d04">00067</a>         <span class="keywordtype">int</span> <a class="code" href="struct_s_model_node_mesh_range_info.html#1d4582bb5a63563bbf20adf986fd6d04">rangeIdx</a>;
<a name="l00068"></a><a class="code" href="struct_s_model_node_mesh_range_info.html#bf16f26b74ad08b098ef75563a1eae90">00068</a>         <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a> <a class="code" href="struct_s_model_node_mesh_range_info.html#bf16f26b74ad08b098ef75563a1eae90">materialId</a>;
<a name="l00069"></a>00069 };
<a name="l00070"></a>00070 
<a name="l00072"></a><a class="code" href="struct_s_model_node_mesh_info.html">00072</a> <span class="keyword">struct </span><a class="code" href="struct_s_model_node_mesh_info.html" title="model node material reference.">SModelNodeMeshInfo</a>
<a name="l00073"></a>00073 {
<a name="l00074"></a><a class="code" href="struct_s_model_node_mesh_info.html#c91d4c335ea0874716fb08afaaccfe55">00074</a>         <a class="code" href="struct_s_model_node_mesh_info.html#c91d4c335ea0874716fb08afaaccfe55">SModelNodeMeshInfo</a>() : <a class="code" href="struct_s_model_node_mesh_info.html#9320f806f5614c5b16b0f6bfa49a94f1">meshInstIdx</a>( 0 ) { }
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="struct_s_model_node_mesh_info.html#9320f806f5614c5b16b0f6bfa49a94f1">00076</a>         <span class="keywordtype">int</span> <a class="code" href="struct_s_model_node_mesh_info.html#9320f806f5614c5b16b0f6bfa49a94f1">meshInstIdx</a>;
<a name="l00077"></a><a class="code" href="struct_s_model_node_mesh_info.html#b75268dc7305f850ff82b777f59b61f1">00077</a>         std::vector&lt; SModelNodeMeshRangeInfo &gt; <a class="code" href="struct_s_model_node_mesh_info.html#b75268dc7305f850ff82b777f59b61f1">meshRangeInfoVec</a>;
<a name="l00078"></a>00078 };
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="struct_s_model_node_info.html">00080</a> <span class="keyword">struct </span><a class="code" href="struct_s_model_node_info.html">SModelNodeInfo</a>
<a name="l00081"></a>00081 {
<a name="l00082"></a><a class="code" href="struct_s_model_node_info.html#7eafefb03fe7aaee5d2cd235140b9b89">00082</a>         <a class="code" href="struct_s_model_node_info.html#7eafefb03fe7aaee5d2cd235140b9b89">SModelNodeInfo</a>() : <a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a>( 0 ) { }
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="struct_s_model_node_info.html#3d47c8ef34c6a2936deabb0759c51f01">00084</a>         <a class="code" href="struct_s_model_node_info.html#7eafefb03fe7aaee5d2cd235140b9b89">SModelNodeInfo</a>( <span class="keyword">const</span> <a class="code" href="struct_s_model_node_info.html">SModelNodeInfo</a>&amp; info )
<a name="l00085"></a>00085                 : <a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a>( 0 )
<a name="l00086"></a>00086         {
<a name="l00087"></a>00087                 <span class="keywordflow">if</span> ( info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> )
<a name="l00088"></a>00088                         <a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> = <span class="keyword">new</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>( *info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> );
<a name="l00089"></a>00089                 <a class="code" href="struct_s_model_node_info.html#02679f64cd6fbb25ea3aa422f475161f" title="node name.">nodeName</a> = info.<a class="code" href="struct_s_model_node_info.html#02679f64cd6fbb25ea3aa422f475161f" title="node name.">nodeName</a>;
<a name="l00090"></a>00090                 <a class="code" href="struct_s_model_node_info.html#ca20ee9540ca1d18dc8e7f2a1aa2bdbe">modelNodeMeshInfoVec</a> = info.<a class="code" href="struct_s_model_node_info.html#ca20ee9540ca1d18dc8e7f2a1aa2bdbe">modelNodeMeshInfoVec</a>;
<a name="l00091"></a>00091         }
<a name="l00092"></a><a class="code" href="struct_s_model_node_info.html#b9a91b477ee9cce04d7651b195ab3c34">00092</a>         <a class="code" href="struct_s_model_node_info.html#b9a91b477ee9cce04d7651b195ab3c34">~SModelNodeInfo</a>() { <span class="keyword">delete</span> <a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a>; }
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="struct_s_model_node_info.html#ffc051915ca9fb7eab93269b2504aaac">00094</a>         <a class="code" href="struct_s_model_node_info.html">SModelNodeInfo</a>&amp; <a class="code" href="struct_s_model_node_info.html#ffc051915ca9fb7eab93269b2504aaac">operator = </a>( <span class="keyword">const</span> <a class="code" href="struct_s_model_node_info.html">SModelNodeInfo</a>&amp; info )
<a name="l00095"></a>00095         {
<a name="l00096"></a>00096                 <span class="keywordflow">if</span> ( info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> )
<a name="l00097"></a>00097                 {
<a name="l00098"></a>00098                         <span class="keywordflow">if</span> ( !<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> )
<a name="l00099"></a>00099                                 <a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> = <span class="keyword">new</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>( *info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> );
<a name="l00100"></a>00100                         <span class="keywordflow">else</span>
<a name="l00101"></a>00101                                 *<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> = *info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a>;
<a name="l00102"></a>00102                 }
<a name="l00103"></a>00103                 <a class="code" href="struct_s_model_node_info.html#02679f64cd6fbb25ea3aa422f475161f" title="node name.">nodeName</a> = info.<a class="code" href="struct_s_model_node_info.html#02679f64cd6fbb25ea3aa422f475161f" title="node name.">nodeName</a>;
<a name="l00104"></a>00104                 <a class="code" href="struct_s_model_node_info.html#ca20ee9540ca1d18dc8e7f2a1aa2bdbe">modelNodeMeshInfoVec</a> = info.<a class="code" href="struct_s_model_node_info.html#ca20ee9540ca1d18dc8e7f2a1aa2bdbe">modelNodeMeshInfoVec</a>;
<a name="l00105"></a>00105                 <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00106"></a>00106         }
<a name="l00107"></a>00107 
<a name="l00109"></a><a class="code" href="struct_s_model_node_info.html#02679f64cd6fbb25ea3aa422f475161f">00109</a>         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> <a class="code" href="struct_s_model_node_info.html#02679f64cd6fbb25ea3aa422f475161f" title="node name.">nodeName</a>;
<a name="l00110"></a><a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">00110</a>         <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>* <a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a>;
<a name="l00111"></a><a class="code" href="struct_s_model_node_info.html#ca20ee9540ca1d18dc8e7f2a1aa2bdbe">00111</a>         std::vector&lt; SModelNodeMeshInfo &gt; <a class="code" href="struct_s_model_node_info.html#ca20ee9540ca1d18dc8e7f2a1aa2bdbe">modelNodeMeshInfoVec</a>;
<a name="l00112"></a>00112 };
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="struct_s_model_light_info.html">00114</a> <span class="keyword">struct </span><a class="code" href="struct_s_model_light_info.html">SModelLightInfo</a>
<a name="l00115"></a>00115 {
<a name="l00116"></a><a class="code" href="struct_s_model_light_info.html#a5ffac52c8bd8fa444badb630f54656b">00116</a>         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> <a class="code" href="struct_s_model_light_info.html#a5ffac52c8bd8fa444badb630f54656b">lightName</a>;
<a name="l00117"></a><a class="code" href="struct_s_model_light_info.html#6597fccf77dbc2c8268aab84d783c035">00117</a>         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> <a class="code" href="struct_s_model_light_info.html#6597fccf77dbc2c8268aab84d783c035">parentName</a>;
<a name="l00118"></a>00118 };
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="struct_s_model_info.html">00120</a> <span class="keyword">struct </span><a class="code" href="struct_s_model_info.html">SModelInfo</a>
<a name="l00121"></a>00121 {
<a name="l00122"></a><a class="code" href="struct_s_model_info.html#d590ff26bd110db901f119416d0ecf04">00122</a>         <a class="code" href="struct_s_model_info.html#d590ff26bd110db901f119416d0ecf04">SModelInfo</a>() : <a class="code" href="struct_s_model_info.html#cf9ec13cd56151333419dbcc25661151">clone</a>( true ), <a class="code" href="struct_s_model_info.html#07a5eabdc7679e76a537d055d1263fe8">skybox</a>( false ) { }
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="struct_s_model_info.html#420add05541cbfe326890c918be61265">00124</a>         <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a> <a class="code" href="struct_s_model_info.html#420add05541cbfe326890c918be61265">path</a>;
<a name="l00125"></a><a class="code" href="struct_s_model_info.html#e6ba1ebcc415ac7a794853a0910a32d0">00125</a>         <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a> <a class="code" href="struct_s_model_info.html#e6ba1ebcc415ac7a794853a0910a32d0">instanceName</a>;
<a name="l00126"></a><a class="code" href="struct_s_model_info.html#95660e555e8990625772b3f5744639fd">00126</a>         <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a> <a class="code" href="struct_s_model_info.html#95660e555e8990625772b3f5744639fd">parentInstanceName</a>;
<a name="l00127"></a><a class="code" href="struct_s_model_info.html#4938e01ec384c259e954268a7f4236cc">00127</a>         <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a> <a class="code" href="struct_s_model_info.html#4938e01ec384c259e954268a7f4236cc">xform</a>;
<a name="l00128"></a><a class="code" href="struct_s_model_info.html#cd0eda8de59d6aa049d5afaa851a1d82">00128</a>         std::vector&lt; SModelNodeInfo &gt; <a class="code" href="struct_s_model_info.html#cd0eda8de59d6aa049d5afaa851a1d82">nodeInfoVec</a>;
<a name="l00129"></a><a class="code" href="struct_s_model_info.html#8528cbebf3292b977c3cd481ef32a5ac">00129</a>         std::vector&lt; SModelLightInfo &gt; <a class="code" href="struct_s_model_info.html#8528cbebf3292b977c3cd481ef32a5ac">lightInfoVec</a>;
<a name="l00130"></a><a class="code" href="struct_s_model_info.html#cf9ec13cd56151333419dbcc25661151">00130</a>         <span class="keywordtype">bool</span> <a class="code" href="struct_s_model_info.html#cf9ec13cd56151333419dbcc25661151">clone</a>;
<a name="l00131"></a><a class="code" href="struct_s_model_info.html#07a5eabdc7679e76a537d055d1263fe8">00131</a>         <span class="keywordtype">bool</span> <a class="code" href="struct_s_model_info.html#07a5eabdc7679e76a537d055d1263fe8">skybox</a>;
<a name="l00132"></a>00132 };
<a name="l00133"></a>00133 
<a name="l00134"></a><a class="code" href="struct_s_terrain_info.html">00134</a> <span class="keyword">struct </span><a class="code" href="struct_s_terrain_info.html">STerrainInfo</a>
<a name="l00135"></a>00135 {
<a name="l00136"></a><a class="code" href="struct_s_terrain_info.html#9e7e55094c75e31926126897bfa2a9a7">00136</a>         <a class="code" href="struct_s_terrain_info.html#9e7e55094c75e31926126897bfa2a9a7">STerrainInfo</a>() : <a class="code" href="struct_s_terrain_info.html#02668db2830c7bb2d6afe5875ea182e9">found</a>( false ) { }
<a name="l00137"></a><a class="code" href="struct_s_terrain_info.html#9486e3c92a348c875916be85672b06f2">00137</a>         <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a> <a class="code" href="struct_s_terrain_info.html#9486e3c92a348c875916be85672b06f2">path</a>;
<a name="l00138"></a><a class="code" href="struct_s_terrain_info.html#02668db2830c7bb2d6afe5875ea182e9">00138</a>         <span class="keywordtype">bool</span> <a class="code" href="struct_s_terrain_info.html#02668db2830c7bb2d6afe5875ea182e9">found</a>;
<a name="l00139"></a><a class="code" href="struct_s_terrain_info.html#a372741e19a5bb43394c1fe36e0c55f8">00139</a>         <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a> <a class="code" href="struct_s_terrain_info.html#a372741e19a5bb43394c1fe36e0c55f8">instanceName</a>;
<a name="l00140"></a>00140 };
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">/*</span>
<a name="l00144"></a>00144 <span class="comment">struct STextureCubeData</span>
<a name="l00145"></a>00145 <span class="comment">{</span>
<a name="l00146"></a>00146 <span class="comment">        tstring name;</span>
<a name="l00147"></a>00147 <span class="comment">        URef&lt; GrTextureCube &gt; texCube;</span>
<a name="l00148"></a>00148 <span class="comment">};</span>
<a name="l00149"></a>00149 <span class="comment">*/</span>
<a name="l00150"></a>00150 <span class="comment">//**********************************************************</span>
<a name="l00152"></a>00152 <span class="comment"></span><span class="comment">//**********************************************************</span>
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="comment">//==========================================================</span>
<a name="l00156"></a>00156 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00157"></a>00157 <span class="keywordtype">bool</span>                            <a class="code" href="_gr_parse_8cpp.html#1b6b0e8fc60b88563dd3c79bedcfa10c" title="GrParse forward declarations.">ParseMaterial</a>( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00158"></a>00158 <span class="keywordtype">bool</span>                            <a class="code" href="_gr_parse_8cpp.html#602007210b206fbd2523fdf471214903">ParseLight</a>( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00159"></a>00159 <span class="keywordtype">bool</span>                            <a class="code" href="_gr_parse_8cpp.html#eb7bc71e7eea5ac4bcaf281d3e65a1db">ParseSceneDef</a>( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="comment">//==========================================================</span>
<a name="l00164"></a>00164 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00165"></a>00165 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseModel( <a class="code" href="struct_s_model_info.html">SModelInfo</a>&amp; info, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l00166"></a>00166                                                                                     <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00167"></a>00167 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseModelNodeInfo( <a class="code" href="struct_s_model_node_info.html">SModelNodeInfo</a>&amp; nodeInfo, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l00168"></a>00168                                                                                                         <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00169"></a>00169 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseModelNodeMeshInfo( <a class="code" href="struct_s_model_node_mesh_info.html" title="model node material reference.">SModelNodeMeshInfo</a>&amp; meshInfo, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream,
<a name="l00170"></a>00170                                                                                                            <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00171"></a>00171 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseModelNodeMeshRangeInfo( <a class="code" href="struct_s_model_node_mesh_range_info.html">SModelNodeMeshRangeInfo</a>&amp; rangeInfo, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream,
<a name="l00172"></a>00172                                                                                                                          <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00173"></a>00173 <span class="keyword">static</span> <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>*                  ParseMaterialPass( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l00174"></a>00174                                                                                                    <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> curPassCount, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00175"></a>00175 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseBlendFactor( <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec" title="render state modes">EGRBLENDMODE</a>&amp; glFactor, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00176"></a>00176 <span class="keyword">static</span> <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a>                                    ParseImageRef( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream );
<a name="l00177"></a>00177 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseTextureStage( <a class="code" href="class_gr_texture_stage.html" title="class GrTextureStage">GrTextureStage</a>&amp; stage, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c">GrTextureBase::EFORMAT</a> defTextureFormat,
<a name="l00178"></a>00178                                                                                                    <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00179"></a>00179 <span class="keyword">static</span> <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a>    ParseTextureRef( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c">GrTextureBase::EFORMAT</a> defFormat, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00180"></a>00180 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseGenTextureFlags( <a class="code" href="class_gr_texture_stage.html" title="class GrTextureStage">GrTextureStage</a>&amp; stage, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream );
<a name="l00181"></a>00181 <span class="keyword">static</span> <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a>    ParseTextureCubeRef( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00182"></a>00182 <span class="keyword">static</span> <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a>                ParseExpr( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l00183"></a>00183                                                                                    <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00184"></a>00184 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseInteger( <span class="keywordtype">int</span>&amp; <a class="code" href="glext_8h.html#6a4f8a1a444e9080b297963b3db29fe0">value</a>, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00185"></a>00185 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseVec3( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; <a class="code" href="glext_8h.html#6a4f8a1a444e9080b297963b3db29fe0">value</a>, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l00186"></a>00186                                                                                    <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00187"></a>00187 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseColor( <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>&amp; <a class="code" href="glext_8h.html#6a4f8a1a444e9080b297963b3db29fe0">value</a>, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l00188"></a>00188                                                                                    <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00189"></a>00189 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseVec4Expr( <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a>* <a class="code" href="glext_8h.html#300a8ed5fb9490aa35713406ec0412df">values</a>, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l00190"></a>00190                                                                                    <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00191"></a>00191 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseTextureFlags( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c">GrTextureBase::EFORMAT</a>&amp; <a class="code" href="_g_l_8h.html#e2d3db041c6004a67047659b42f73a44">format</a>,
<a name="l00192"></a>00192                                                                                                   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; <a class="code" href="_u_t_message_8h.html#0a3c0b351ab09281b662a9ff4f900a53">flags</a>, <span class="keywordtype">bool</span>&amp; cache, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 <span class="keyword">static</span> <span class="keywordtype">bool</span>                                             ParseTerrain( <a class="code" href="struct_s_terrain_info.html">STerrainInfo</a>&amp; info, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l00195"></a>00195                                                                                     <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors );
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 <span class="comment">//**********************************************************</span>
<a name="l00199"></a>00199 <span class="comment"></span><span class="comment">//**********************************************************</span>
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="comment">//==========================================================</span>
<a name="l00203"></a>00203 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 <span class="comment">//----------------------------------------------------------</span>
<a name="l00206"></a>00206 <span class="keywordtype">bool</span>
<a name="l00207"></a><a class="code" href="_gr_parse_8cpp.html#1b6b0e8fc60b88563dd3c79bedcfa10c">00207</a> <a class="code" href="_gr_parse_8cpp.html#1b6b0e8fc60b88563dd3c79bedcfa10c" title="GrParse forward declarations.">ParseMaterial</a>( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l00208"></a>00208 {
<a name="l00210"></a>00210         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( <a class="code" href="_gr_material_mgr_8cpp.html#d46df50546f8a390c61c9a93e41ec428" title="class header.">gGrMaterialMgr</a> != 0 );
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         <span class="keyword">typedef</span> <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; SShaderUserParam, 32, 32 &gt;</a> ParamVec;
<a name="l00213"></a>00213         <span class="keyword">typedef</span> <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; SShaderUserSampler, 32, 32 &gt;</a> SamplerVec;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         ParamVec userParams;
<a name="l00216"></a>00216         SamplerVec userSamplers;
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         <a class="code" href="struct_gr_material_1_1_s_info.html" title="this is used to describe how a material should be constructed.">GrMaterial::SInfo</a> matInfo;
<a name="l00219"></a>00219         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#65b4844858083fced789f35b812d43a8">passes</a> = <span class="keyword">new</span> <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>* [ 8 ];     
<a name="l00220"></a>00220         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#d582f630813982a1a364956aa804ca82" title="passes.">passCount</a> = 0;
<a name="l00221"></a>00221         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#d0f2426e55d78a596ef62dd78624a180">postProcessPasses</a> = <span class="keyword">new</span> <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>* [ 8 ];  
<a name="l00222"></a>00222         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#1ce2cf4342c4ca673c726468213833d4" title="passes.">postProcessPassCount</a> = 0;
<a name="l00223"></a>00223         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#26bcefa25e0ad2e18440c4c660fbc6bf" title="sort priority.">sortType</a> = <a class="code" href="class_gr_material.html#0277ae85793f8cce8f8e3939fb5540e9436e9e42d8c25cd09c6c644af3555a9d">GrMaterial::EST_OPAQUE</a>;
<a name="l00224"></a>00224         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#f18b720a0aad7eae7be10f3b0622bd77" title="material info.">castShadow</a> = <span class="keyword">true</span>;
<a name="l00225"></a>00225         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#83ca23e73b506b9bdab98b43ab1bdf6f">receiveShadow</a> = <span class="keyword">true</span>;
<a name="l00226"></a>00226         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#67a1d89836a0e6033e8e65a4a13b6e67">stipple</a> = <span class="keyword">false</span>;
<a name="l00227"></a>00227 
<a name="l00229"></a>00229         <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; <a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l00230"></a>00230         ++curTok;
<a name="l00231"></a>00231 
<a name="l00233"></a>00233         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l00234"></a>00234         {
<a name="l00235"></a>00235                 errors = <span class="stringliteral">"Missing opening brace!"</span>;
<a name="l00236"></a>00236                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238         ++curTok;
<a name="l00239"></a>00239 
<a name="l00241"></a>00241         <span class="keywordflow">while</span> ( !IsTok( curTok, <span class="stringliteral">"}"</span> ) )
<a name="l00242"></a>00242         {
<a name="l00244"></a>00244                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"nocastshadow"</span> ) )
<a name="l00245"></a>00245                         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#f18b720a0aad7eae7be10f3b0622bd77" title="material info.">castShadow</a> = <span class="keyword">false</span>;
<a name="l00246"></a>00246                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"noreceiveshadow"</span> ) )
<a name="l00247"></a>00247                         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#83ca23e73b506b9bdab98b43ab1bdf6f">receiveShadow</a> = <span class="keyword">false</span>;
<a name="l00248"></a>00248                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"stipple"</span> ) )
<a name="l00249"></a>00249                         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#67a1d89836a0e6033e8e65a4a13b6e67">stipple</a> = <span class="keyword">true</span>;
<a name="l00250"></a>00250                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"sort"</span> ) )
<a name="l00251"></a>00251                 {
<a name="l00252"></a>00252                         ++curTok;
<a name="l00253"></a>00253                         <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"none"</span> ) )
<a name="l00254"></a>00254                                 matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#26bcefa25e0ad2e18440c4c660fbc6bf" title="sort priority.">sortType</a> = <a class="code" href="class_gr_material.html#0277ae85793f8cce8f8e3939fb5540e9436e9e42d8c25cd09c6c644af3555a9d">GrMaterial::EST_OPAQUE</a>;
<a name="l00255"></a>00255                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"decal"</span> ) )
<a name="l00256"></a>00256                                 matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#26bcefa25e0ad2e18440c4c660fbc6bf" title="sort priority.">sortType</a> = <a class="code" href="class_gr_material.html#0277ae85793f8cce8f8e3939fb5540e995e2b6a86e1a95f130349230b2617099" title="no special sort required.">GrMaterial::EST_DECAL</a>;
<a name="l00257"></a>00257                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"alpha"</span> ) )
<a name="l00258"></a>00258                                 matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#26bcefa25e0ad2e18440c4c660fbc6bf" title="sort priority.">sortType</a> = <a class="code" href="class_gr_material.html#0277ae85793f8cce8f8e3939fb5540e9039f83ee3083c5992195476daad9cfcf" title="after normal objects, before alpha.">GrMaterial::EST_ALPHA</a>;
<a name="l00259"></a>00259                 }
<a name="l00260"></a>00260                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"deform"</span> ) )
<a name="l00261"></a>00261                 {
<a name="l00263"></a>00263                         ++curTok;
<a name="l00264"></a>00264 
<a name="l00266"></a>00266                         <a class="code" href="class_gr_deformer.html" title="class GrDeformer">GrDeformer</a>* deformer = 0;
<a name="l00267"></a>00267                         <span class="keywordflow">if</span> ( IsTok( curTok, <a class="code" href="class_gr_deform_wave.html#7e10cb2db580dc710dfe3f08ca1904bd" title="parameters.">GrDeformWave::StaticGetName</a>() ) )
<a name="l00268"></a>00268                         {
<a name="l00269"></a>00269                                 deformer = <span class="keyword">new</span> <a class="code" href="class_gr_deform_wave.html" title="Purpose: To displace a mesh by a wave function.">GrDeformWave</a>();
<a name="l00270"></a>00270                                 ++curTok;
<a name="l00271"></a>00271                                 matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#96cb5400adfde62d6b3580ff930012ef" title="deformers.">deformers</a>.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( deformer );
<a name="l00272"></a>00272                                 <span class="keywordflow">continue</span>;
<a name="l00273"></a>00273                         }
<a name="l00274"></a>00274                         <span class="keywordflow">else</span>
<a name="l00275"></a>00275                         {
<a name="l00277"></a>00277                                 errors = <span class="stringliteral">"Unknown deformer type specified."</span>;
<a name="l00278"></a>00278                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00279"></a>00279                         }
<a name="l00280"></a>00280                 }<span class="comment">/*</span>
<a name="l00281"></a>00281 <span class="comment">                else if ( IsTok( curTok, "postrendershader" ) )</span>
<a name="l00282"></a>00282 <span class="comment">                {</span>
<a name="l00283"></a>00283 <span class="comment">                        ++curTok;</span>
<a name="l00284"></a>00284 <span class="comment"></span>
<a name="l00285"></a>00285 <span class="comment">                        if ( matInfo.postRenderShader != 0 )</span>
<a name="l00286"></a>00286 <span class="comment">                        {</span>
<a name="l00287"></a>00287 <span class="comment">                                errors = "Shader already specified.";</span>
<a name="l00288"></a>00288 <span class="comment">                                return 0;</span>
<a name="l00289"></a>00289 <span class="comment">                        }</span>
<a name="l00290"></a>00290 <span class="comment"></span>
<a name="l00292"></a>00292 <span class="comment">                        matInfo.postRenderShader = gGrShaderMgr-&gt;GetShader( curTok-&gt;text );</span>
<a name="l00293"></a>00293 <span class="comment">                }</span>
<a name="l00294"></a>00294 <span class="comment">                else if ( IsTok( curTok, "postrenderparam" ) )</span>
<a name="l00295"></a>00295 <span class="comment">                {</span>
<a name="l00296"></a>00296 <span class="comment">                        ++curTok;</span>
<a name="l00297"></a>00297 <span class="comment"></span>
<a name="l00298"></a>00298 <span class="comment">                        SShaderUserParam param;</span>
<a name="l00299"></a>00299 <span class="comment">                        param.name = curTok-&gt;text.c_str();</span>
<a name="l00300"></a>00300 <span class="comment">                        ++curTok;</span>
<a name="l00301"></a>00301 <span class="comment"></span>
<a name="l00302"></a>00302 <span class="comment">                        if ( !ParseVec4Expr( param.values, curTok, arrayTable, varTable, errors ) )</span>
<a name="l00303"></a>00303 <span class="comment">                                return 0;</span>
<a name="l00304"></a>00304 <span class="comment"></span>
<a name="l00305"></a>00305 <span class="comment">                        userParams.Push( param );</span>
<a name="l00306"></a>00306 <span class="comment">                        continue;</span>
<a name="l00307"></a>00307 <span class="comment">                }</span>
<a name="l00308"></a>00308 <span class="comment">                else if ( IsTok( curTok, "postrendersampler" ) )</span>
<a name="l00309"></a>00309 <span class="comment">                {</span>
<a name="l00310"></a>00310 <span class="comment">                        ++curTok;</span>
<a name="l00311"></a>00311 <span class="comment"></span>
<a name="l00312"></a>00312 <span class="comment">                        SShaderUserSampler sampler;</span>
<a name="l00313"></a>00313 <span class="comment">                        sampler.name = curTok-&gt;text.c_str();</span>
<a name="l00314"></a>00314 <span class="comment">                        ++curTok;</span>
<a name="l00315"></a>00315 <span class="comment"></span>
<a name="l00316"></a>00316 <span class="comment">                        ParseTextureStage( sampler.stage, curTok, arrayTable, varTable, errors );</span>
<a name="l00317"></a>00317 <span class="comment"></span>
<a name="l00318"></a>00318 <span class="comment">                        userSamplers.Push( sampler );</span>
<a name="l00319"></a>00319 <span class="comment">                        continue;</span>
<a name="l00320"></a>00320 <span class="comment">                }*/</span>
<a name="l00321"></a>00321                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"postprocess"</span> ) )
<a name="l00322"></a>00322                 {
<a name="l00323"></a>00323                         ++curTok;
<a name="l00324"></a>00324 
<a name="l00326"></a>00326                         <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>* newPass = ParseMaterialPass( curTok, arrayTable, varTable, matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#d582f630813982a1a364956aa804ca82" title="passes.">passCount</a>, errors );
<a name="l00327"></a>00327                         <span class="keywordflow">if</span> ( !newPass )
<a name="l00328"></a>00328                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330                         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#d0f2426e55d78a596ef62dd78624a180">postProcessPasses</a>[ matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#1ce2cf4342c4ca673c726468213833d4" title="passes.">postProcessPassCount</a>++ ] = newPass;
<a name="l00331"></a>00331 
<a name="l00333"></a>00333                         <span class="keywordflow">continue</span>;
<a name="l00334"></a>00334                 }
<a name="l00335"></a>00335                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l00336"></a>00336                 {
<a name="l00338"></a>00338                         <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>* newPass = ParseMaterialPass( curTok, arrayTable, varTable, matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#d582f630813982a1a364956aa804ca82" title="passes.">passCount</a>, errors );
<a name="l00339"></a>00339                         <span class="keywordflow">if</span> ( !newPass )
<a name="l00340"></a>00340                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342                         matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#65b4844858083fced789f35b812d43a8">passes</a>[ matInfo.<a class="code" href="struct_gr_material_1_1_s_info.html#d582f630813982a1a364956aa804ca82" title="passes.">passCount</a>++ ] = newPass;
<a name="l00343"></a>00343 
<a name="l00345"></a>00345                         <span class="keywordflow">continue</span>;
<a name="l00346"></a>00346                 }
<a name="l00347"></a>00347                 <span class="keywordflow">else</span>
<a name="l00348"></a>00348                 {
<a name="l00350"></a>00350                         errors = <span class="stringliteral">"Unknown expression in material."</span>;
<a name="l00351"></a>00351                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00352"></a>00352                 }
<a name="l00353"></a>00353 
<a name="l00355"></a>00355                 ++curTok;
<a name="l00356"></a>00356         }
<a name="l00357"></a>00357 
<a name="l00359"></a>00359         ++curTok;
<a name="l00360"></a>00360 
<a name="l00362"></a>00362         <a class="code" href="class_gr_material.html" title="class GrMaterial">GrMaterial</a>* material = <a class="code" href="_gr_material_mgr_8cpp.html#d46df50546f8a390c61c9a93e41ec428" title="class header.">gGrMaterialMgr</a>-&gt;<a class="code" href="class_gr_material_mgr.html#7134ce45c3dc3b873ea2c5deb896ba08" title="registers a material. This is usually called when a material is specified in a script...">SetMaterial</a>( name, matInfo );
<a name="l00363"></a>00363 
<a name="l00365"></a>00365         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="comment">//----------------------------------------------------------</span>
<a name="l00369"></a>00369 <span class="keywordtype">bool</span>
<a name="l00370"></a><a class="code" href="_gr_parse_8cpp.html#602007210b206fbd2523fdf471214903">00370</a> <a class="code" href="_gr_parse_8cpp.html#602007210b206fbd2523fdf471214903">ParseLight</a>( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l00371"></a>00371 {
<a name="l00373"></a>00373         <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; <span class="keywordtype">id</span> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l00374"></a>00374         ++curTok;
<a name="l00375"></a>00375 
<a name="l00377"></a>00377         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l00378"></a>00378         {
<a name="l00379"></a>00379                 errors = <span class="stringliteral">"Missing opening brace!"</span>;
<a name="l00380"></a>00380                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00381"></a>00381         }
<a name="l00382"></a>00382         ++curTok;
<a name="l00383"></a>00383 
<a name="l00385"></a>00385         <a class="code" href="struct_s_light_info.html">SLightInfo</a> lightInfo;
<a name="l00386"></a>00386         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> bvCenter;
<a name="l00387"></a>00387         <span class="keywordtype">float</span> bvRadius = 0.0f;
<a name="l00388"></a>00388         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> position;
<a name="l00389"></a>00389         <a class="code" href="class_m_mat3x3.html" title="class MMat3x3">MMat3x3</a> rotation;
<a name="l00390"></a>00390 
<a name="l00392"></a>00392         lightInfo.<a class="code" href="struct_s_light_info.html#7af3604ff1142b810497a8c5260e6cfb">name</a> = id;
<a name="l00393"></a>00393 
<a name="l00395"></a>00395         <span class="keywordflow">while</span> ( !IsTok( curTok, <span class="stringliteral">"}"</span> ) )
<a name="l00396"></a>00396         {
<a name="l00397"></a>00397                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"name"</span> ) )
<a name="l00398"></a>00398                 {
<a name="l00399"></a>00399                         ++curTok;
<a name="l00400"></a>00400                         lightInfo.<a class="code" href="struct_s_light_info.html#7af3604ff1142b810497a8c5260e6cfb">name</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l00401"></a>00401                         ++curTok;
<a name="l00402"></a>00402                 }
<a name="l00403"></a>00403                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"parallel"</span> ) )
<a name="l00404"></a>00404                 {
<a name="l00405"></a>00405                         ++curTok;
<a name="l00406"></a>00406                         lightInfo.<a class="code" href="struct_s_light_info.html#ecbb1cd068a1abd41dfdd9b0da62b7c5">parallel</a> = <span class="keyword">true</span>;
<a name="l00407"></a>00407                 }
<a name="l00408"></a>00408                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"global"</span> ) )
<a name="l00409"></a>00409                 {
<a name="l00410"></a>00410                         ++curTok;
<a name="l00411"></a>00411                         lightInfo.<a class="code" href="struct_s_light_info.html#6fd689b605dab56da126d26a09bba6c9">global</a> = <span class="keyword">true</span>;
<a name="l00412"></a>00412                 }
<a name="l00413"></a>00413                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"position"</span> ) )
<a name="l00414"></a>00414                 {
<a name="l00415"></a>00415                         ++curTok;
<a name="l00416"></a>00416                         <span class="keywordflow">if</span> ( !ParseVec3( position, curTok, arrayTable, varTable, errors ) )
<a name="l00417"></a>00417                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00418"></a>00418                 }
<a name="l00419"></a>00419                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"color"</span> ) )
<a name="l00420"></a>00420                 {
<a name="l00421"></a>00421                         ++curTok;
<a name="l00422"></a>00422                         <span class="keywordflow">if</span> ( !ParseColor( lightInfo.<a class="code" href="struct_s_light_info.html#dd473b66bc8d906709a0b6cac00b1cf5">color</a>, curTok, arrayTable, varTable, errors ) )
<a name="l00423"></a>00423                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00424"></a>00424                 }
<a name="l00425"></a>00425                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"atten"</span> ) )
<a name="l00426"></a>00426                 {
<a name="l00427"></a>00427                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> atten( 1.0f, 0.0f, 0.0f );
<a name="l00428"></a>00428                         ++curTok;
<a name="l00429"></a>00429                         <span class="keywordflow">if</span> ( !ParseVec3( atten, curTok, arrayTable, varTable, errors ) )
<a name="l00430"></a>00430                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432                         lightInfo.<a class="code" href="struct_s_light_info.html#2d5f5d37ba45e45ca2e311e4d4c04491">sqrAtten</a> = atten.<a class="code" href="class_m_vec3.html#8b834219441d8d65b3e4df28fe03f60f">GetX</a>();
<a name="l00433"></a>00433                         lightInfo.<a class="code" href="struct_s_light_info.html#1bd8a695b7e702cb94afb98baa608491">linAtten</a> = atten.<a class="code" href="class_m_vec3.html#dfadf4adb521222d91980376a7679dc8">GetY</a>();
<a name="l00434"></a>00434                         lightInfo.<a class="code" href="struct_s_light_info.html#926cc2b70cbc204a58b7eedc7c6d323e">constAtten</a> = atten.<a class="code" href="class_m_vec3.html#8b29390479c105bbb9926188b9742329">GetZ</a>();
<a name="l00435"></a>00435                 }
<a name="l00436"></a>00436                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"haziness"</span> ) )
<a name="l00437"></a>00437                 {
<a name="l00438"></a>00438                         ++curTok;
<a name="l00439"></a>00439                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> temp = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l00440"></a>00440                         <span class="keywordflow">if</span> ( temp == 0 )
<a name="l00441"></a>00441                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00442"></a>00442                         lightInfo.<a class="code" href="struct_s_light_info.html#df2fa81977b29ac3e37450ffaedf965c">haziness</a> = <a class="code" href="common__afx_8h.html#7d665224bfbd26fbf37dab8360bdf352">Clamp</a>( temp-&gt;GetValue(), 0.0f, 1.0f );
<a name="l00443"></a>00443                 }
<a name="l00444"></a>00444                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"spottexture"</span> ) )
<a name="l00445"></a>00445                 {
<a name="l00446"></a>00446                         ++curTok;
<a name="l00447"></a>00447                         <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"_spotLinear"</span> ) )
<a name="l00448"></a>00448                         {
<a name="l00449"></a>00449                                 <a class="code" href="class_gr_texture_base.html" title="class GrTextureBase">GrTextureBase</a>* tex = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#83321c109ae9862b3e9ad6acabd8819d">FindTexture</a>( <a class="code" href="_gr_config_8h.html#c6cdbadc247b8ac1c9e8ef71f21b7459">GR_SYSTEX_SPOT_LINEAR</a> );
<a name="l00450"></a>00450                                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( tex &amp;&amp; tex-&gt;<a class="code" href="class_gr_texture_base.html#d0b985795ad1856b64d17b8404b2ca08" title="accessors.">GetType</a>() == <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e5308d02dc086ce7c780adab8a7bb57a1bb19">GrTextureBase::ETT_2D</a> );
<a name="l00451"></a>00451                                 <span class="keywordflow">if</span> ( tex &amp;&amp; tex-&gt;<a class="code" href="class_gr_texture_base.html#d0b985795ad1856b64d17b8404b2ca08" title="accessors.">GetType</a>() == <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e5308d02dc086ce7c780adab8a7bb57a1bb19">GrTextureBase::ETT_2D</a> )
<a name="l00452"></a>00452                                         lightInfo.<a class="code" href="struct_s_light_info.html#642dfd4d0aa9dd701ace805d95e5449b">projTex</a> = ( <a class="code" href="class_gr_texture.html" title="class GrTexture">GrTexture</a>* )tex;
<a name="l00453"></a>00453                                 ++curTok;
<a name="l00454"></a>00454                         }
<a name="l00455"></a>00455                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"_spotQuadratic"</span> ) )
<a name="l00456"></a>00456                         {
<a name="l00457"></a>00457                                 <a class="code" href="class_gr_texture_base.html" title="class GrTextureBase">GrTextureBase</a>* tex = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#83321c109ae9862b3e9ad6acabd8819d">FindTexture</a>( <a class="code" href="_gr_config_8h.html#41fae6e76957d8d99b1eff3e7409e425">GR_SYSTEX_SPOT_QUADRATIC</a> );
<a name="l00458"></a>00458                                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( tex &amp;&amp; tex-&gt;<a class="code" href="class_gr_texture_base.html#d0b985795ad1856b64d17b8404b2ca08" title="accessors.">GetType</a>() == <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e5308d02dc086ce7c780adab8a7bb57a1bb19">GrTextureBase::ETT_2D</a> );
<a name="l00459"></a>00459                                 <span class="keywordflow">if</span> ( tex &amp;&amp; tex-&gt;<a class="code" href="class_gr_texture_base.html#d0b985795ad1856b64d17b8404b2ca08" title="accessors.">GetType</a>() == <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e5308d02dc086ce7c780adab8a7bb57a1bb19">GrTextureBase::ETT_2D</a> )
<a name="l00460"></a>00460                                         lightInfo.<a class="code" href="struct_s_light_info.html#642dfd4d0aa9dd701ace805d95e5449b">projTex</a> = ( <a class="code" href="class_gr_texture.html" title="class GrTexture">GrTexture</a>* )tex;
<a name="l00461"></a>00461                                 ++curTok;
<a name="l00462"></a>00462                         }
<a name="l00463"></a>00463                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"_spotConstant"</span> ) )
<a name="l00464"></a>00464                         {
<a name="l00465"></a>00465                                 <a class="code" href="class_gr_texture_base.html" title="class GrTextureBase">GrTextureBase</a>* tex = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#83321c109ae9862b3e9ad6acabd8819d">FindTexture</a>( <a class="code" href="_gr_config_8h.html#b6bb24e68b5c469e1ecae2147b587438">GR_SYSTEX_SPOT_CONSTANT</a> );
<a name="l00466"></a>00466                                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( tex &amp;&amp; tex-&gt;<a class="code" href="class_gr_texture_base.html#d0b985795ad1856b64d17b8404b2ca08" title="accessors.">GetType</a>() == <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e5308d02dc086ce7c780adab8a7bb57a1bb19">GrTextureBase::ETT_2D</a> );
<a name="l00467"></a>00467                                 <span class="keywordflow">if</span> ( tex &amp;&amp; tex-&gt;<a class="code" href="class_gr_texture_base.html#d0b985795ad1856b64d17b8404b2ca08" title="accessors.">GetType</a>() == <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e5308d02dc086ce7c780adab8a7bb57a1bb19">GrTextureBase::ETT_2D</a> )
<a name="l00468"></a>00468                                         lightInfo.<a class="code" href="struct_s_light_info.html#642dfd4d0aa9dd701ace805d95e5449b">projTex</a> = ( <a class="code" href="class_gr_texture.html" title="class GrTexture">GrTexture</a>* )tex;
<a name="l00469"></a>00469                                 ++curTok;
<a name="l00470"></a>00470                         }
<a name="l00471"></a>00471                         <span class="keywordflow">else</span>
<a name="l00472"></a>00472                         {
<a name="l00473"></a>00473                                 <a class="code" href="class_gr_texture_base.html" title="class GrTextureBase">GrTextureBase</a>* tex = ParseTextureRef( curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c983e954e5c478c1cd15fff916318eeb7">GrTextureBase::EF_GUESS</a>, errors );
<a name="l00474"></a>00474                                 <span class="keywordflow">if</span> ( !tex || tex-&gt;<a class="code" href="class_gr_texture_base.html#d0b985795ad1856b64d17b8404b2ca08" title="accessors.">GetType</a>() != <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e5308d02dc086ce7c780adab8a7bb57a1bb19">GrTextureBase::ETT_2D</a> )
<a name="l00475"></a>00475                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00476"></a>00476                                 lightInfo.<a class="code" href="struct_s_light_info.html#642dfd4d0aa9dd701ace805d95e5449b">projTex</a> = ( <a class="code" href="class_gr_texture.html" title="class GrTexture">GrTexture</a>* )tex;
<a name="l00477"></a>00477                         }
<a name="l00478"></a>00478                 }
<a name="l00479"></a>00479                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"intensity"</span> ) )
<a name="l00480"></a>00480                 {
<a name="l00481"></a>00481                         ++curTok;
<a name="l00482"></a>00482                         lightInfo.<a class="code" href="struct_s_light_info.html#086fba67bb218313e6fb4d847fca2c7b">intensity</a> = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l00483"></a>00483                         <span class="keywordflow">if</span> ( lightInfo.<a class="code" href="struct_s_light_info.html#086fba67bb218313e6fb4d847fca2c7b">intensity</a> == 0 )
<a name="l00484"></a>00484                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00485"></a>00485                 }
<a name="l00486"></a>00486                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"range"</span> ) )
<a name="l00487"></a>00487                 {
<a name="l00488"></a>00488                         ++curTok;
<a name="l00489"></a>00489                         lightInfo.<a class="code" href="struct_s_light_info.html#6e6773eee19ee9da44997768f8d77566">range</a> = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l00490"></a>00490                         <span class="keywordflow">if</span> ( lightInfo.<a class="code" href="struct_s_light_info.html#6e6773eee19ee9da44997768f8d77566">range</a> == 0 )
<a name="l00491"></a>00491                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00492"></a>00492                         lightInfo.<a class="code" href="struct_s_light_info.html#f22ba7c3f8c8ca55f5da12d61aafb81a">projection</a>.<a class="code" href="class_gr_projection.html#3671a2d19ad8e30a24968fbe105563ee">SetFarDist</a>( <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( lightInfo.<a class="code" href="struct_s_light_info.html#6e6773eee19ee9da44997768f8d77566">range</a>-&gt;GetValue(), 1.0f ) );
<a name="l00493"></a>00493                 }
<a name="l00494"></a>00494                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"width"</span> ) )
<a name="l00495"></a>00495                 {
<a name="l00496"></a>00496                         ++curTok;
<a name="l00497"></a>00497                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l00498"></a>00498                         <span class="keywordflow">if</span> ( expr == 0 )
<a name="l00499"></a>00499                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00500"></a>00500                         lightInfo.<a class="code" href="struct_s_light_info.html#0b94e57ebcf7a284530d822145cd62e1">width</a> = expr-&gt;GetValue();
<a name="l00501"></a>00501                 }
<a name="l00502"></a>00502                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"nocastshadow"</span> ) )
<a name="l00503"></a>00503                 {
<a name="l00504"></a>00504                         ++curTok;
<a name="l00505"></a>00505                         lightInfo.<a class="code" href="struct_s_light_info.html#1751091736d0b2681bdcb93e78ed9441">castShadow</a> = <span class="keyword">false</span>;
<a name="l00506"></a>00506                 }
<a name="l00507"></a>00507                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"projection"</span> ) )
<a name="l00508"></a>00508                 {
<a name="l00509"></a>00509                         ++curTok;
<a name="l00510"></a>00510                         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l00511"></a>00511                         {
<a name="l00512"></a>00512                                 errors = <span class="stringliteral">"Expected opening brace."</span>;
<a name="l00513"></a>00513                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00514"></a>00514                         }
<a name="l00515"></a>00515                         ++curTok;
<a name="l00516"></a>00516 
<a name="l00517"></a>00517                         <span class="keywordflow">while</span> ( !IsTok( curTok, <span class="stringliteral">"}"</span> ) )
<a name="l00518"></a>00518                         {
<a name="l00519"></a>00519                                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"fov"</span> ) )
<a name="l00520"></a>00520                                 {
<a name="l00521"></a>00521                                         ++curTok;
<a name="l00522"></a>00522                                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l00523"></a>00523                                         <span class="keywordflow">if</span> ( !expr )
<a name="l00524"></a>00524                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00525"></a>00525                                         lightInfo.<a class="code" href="struct_s_light_info.html#f22ba7c3f8c8ca55f5da12d61aafb81a">projection</a>.<a class="code" href="class_gr_projection.html#f4b558c458d3a59acd574af5d7f84850">SetFOV</a>( <a class="code" href="common__afx_8h.html#116293816763dfdfd39b4bc70c38b465" title="math functions.">DegToRad</a>( expr-&gt;GetValue() ) );
<a name="l00526"></a>00526                                 }
<a name="l00527"></a>00527                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"width"</span> ) )
<a name="l00528"></a>00528                                 {
<a name="l00529"></a>00529                                         ++curTok;
<a name="l00530"></a>00530                                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l00531"></a>00531                                         <span class="keywordflow">if</span> ( !expr )
<a name="l00532"></a>00532                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00533"></a>00533                                         lightInfo.<a class="code" href="struct_s_light_info.html#f22ba7c3f8c8ca55f5da12d61aafb81a">projection</a>.<a class="code" href="class_gr_projection.html#142d79699a01bc461466dccfcc3782ae">SetLeft</a>( -0.5f * expr-&gt;GetValue() );
<a name="l00534"></a>00534                                         lightInfo.<a class="code" href="struct_s_light_info.html#f22ba7c3f8c8ca55f5da12d61aafb81a">projection</a>.<a class="code" href="class_gr_projection.html#5173c72eefb3030bbd7cf65be54aabcc">SetRight</a>( 0.5f * expr-&gt;GetValue() );
<a name="l00535"></a>00535                                 }
<a name="l00536"></a>00536                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"height"</span> ) )
<a name="l00537"></a>00537                                 {
<a name="l00538"></a>00538                                         ++curTok;
<a name="l00539"></a>00539                                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l00540"></a>00540                                         <span class="keywordflow">if</span> ( !expr )
<a name="l00541"></a>00541                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00542"></a>00542                                         lightInfo.<a class="code" href="struct_s_light_info.html#f22ba7c3f8c8ca55f5da12d61aafb81a">projection</a>.<a class="code" href="class_gr_projection.html#f2103c25c9b29dccb2630e671b486147">SetBottom</a>( -0.5f * expr-&gt;GetValue() );
<a name="l00543"></a>00543                                         lightInfo.<a class="code" href="struct_s_light_info.html#f22ba7c3f8c8ca55f5da12d61aafb81a">projection</a>.<a class="code" href="class_gr_projection.html#6d503181e9a11c369200bc57226aa6e5">SetTop</a>( 0.5f * expr-&gt;GetValue() );
<a name="l00544"></a>00544                                 }
<a name="l00545"></a>00545                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"aspect"</span> ) )
<a name="l00546"></a>00546                                 {
<a name="l00547"></a>00547                                         ++curTok;
<a name="l00548"></a>00548                                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l00549"></a>00549                                         <span class="keywordflow">if</span> ( !expr )
<a name="l00550"></a>00550                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00551"></a>00551                                         <span class="keywordtype">float</span> aspect = expr-&gt;GetValue();
<a name="l00552"></a>00552                                         <span class="keywordflow">if</span> ( aspect &lt; 0.1 )
<a name="l00553"></a>00553                                                 aspect = 1.0f;
<a name="l00554"></a>00554                                         lightInfo.<a class="code" href="struct_s_light_info.html#f22ba7c3f8c8ca55f5da12d61aafb81a">projection</a>.<a class="code" href="class_gr_projection.html#ecaec8627848803b87a11bd3638c2664">SetAspect</a>( aspect );
<a name="l00555"></a>00555                                 }
<a name="l00556"></a>00556                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"rotationmatrix"</span> ) )
<a name="l00557"></a>00557                                 {
<a name="l00558"></a>00558                                         ++curTok;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560                                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#5ffadbbacc6b89cf6218bc43b384d3fe">right</a>;
<a name="l00561"></a>00561                                         <span class="keywordflow">if</span> ( !ParseVec3( right, curTok, arrayTable, varTable, errors ) )
<a name="l00562"></a>00562                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00563"></a>00563                                         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">","</span> ) )
<a name="l00564"></a>00564                                         {
<a name="l00565"></a>00565                                                 errors = <span class="stringliteral">"Missing comma!"</span>;
<a name="l00566"></a>00566                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00567"></a>00567                                         }
<a name="l00568"></a>00568                                         ++curTok;
<a name="l00569"></a>00569 
<a name="l00570"></a>00570                                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> up;
<a name="l00571"></a>00571                                         <span class="keywordflow">if</span> ( !ParseVec3( up, curTok, arrayTable, varTable, errors ) )
<a name="l00572"></a>00572                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00573"></a>00573                                         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">","</span> ) )
<a name="l00574"></a>00574                                         {
<a name="l00575"></a>00575                                                 errors = <span class="stringliteral">"Missing comma!"</span>;
<a name="l00576"></a>00576                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00577"></a>00577                                         }
<a name="l00578"></a>00578                                         ++curTok;
<a name="l00579"></a>00579 
<a name="l00580"></a>00580                                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> dir;
<a name="l00581"></a>00581                                         <span class="keywordflow">if</span> ( !ParseVec3( dir, curTok, arrayTable, varTable, errors ) )
<a name="l00582"></a>00582                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00583"></a>00583 
<a name="l00585"></a>00585                                         rotation.<a class="code" href="class_m_mat3x3.html#1cd3b344fa0732e7be859ce95f35f063">SetRow</a>( 0, right );
<a name="l00586"></a>00586                                         rotation.<a class="code" href="class_m_mat3x3.html#1cd3b344fa0732e7be859ce95f35f063">SetRow</a>( 1, up );
<a name="l00587"></a>00587                                         rotation.<a class="code" href="class_m_mat3x3.html#1cd3b344fa0732e7be859ce95f35f063">SetRow</a>( 2, dir );
<a name="l00588"></a>00588                                 }
<a name="l00589"></a>00589                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"rotation"</span> ) )
<a name="l00590"></a>00590                                 {
<a name="l00591"></a>00591                                         ++curTok;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593                                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> angles;
<a name="l00594"></a>00594                                         <span class="keywordflow">if</span> ( !ParseVec3( angles, curTok, arrayTable, varTable, errors ) )
<a name="l00595"></a>00595                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00596"></a>00596 
<a name="l00598"></a>00598                                         rotation.<a class="code" href="class_m_mat3x3.html#b28ee4ae5b4e8278bdad52dfc62d70d7">FromEulerYXZ</a>( <a class="code" href="common__afx_8h.html#116293816763dfdfd39b4bc70c38b465" title="math functions.">DegToRad</a>( angles.<a class="code" href="class_m_vec3.html#8b834219441d8d65b3e4df28fe03f60f">GetX</a>() ), <a class="code" href="common__afx_8h.html#116293816763dfdfd39b4bc70c38b465" title="math functions.">DegToRad</a>( angles.<a class="code" href="class_m_vec3.html#dfadf4adb521222d91980376a7679dc8">GetY</a>() ), <a class="code" href="common__afx_8h.html#116293816763dfdfd39b4bc70c38b465" title="math functions.">DegToRad</a>( angles.<a class="code" href="class_m_vec3.html#8b29390479c105bbb9926188b9742329">GetZ</a>() ) );
<a name="l00599"></a>00599                                 }
<a name="l00600"></a>00600                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"near"</span> ) )
<a name="l00601"></a>00601                                 {
<a name="l00602"></a>00602                                         ++curTok;
<a name="l00603"></a>00603                                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l00604"></a>00604                                         <span class="keywordflow">if</span> ( !expr )
<a name="l00605"></a>00605                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00606"></a>00606                                         <span class="keywordtype">float</span> nearDist = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( expr-&gt;GetValue(), 0.05f );
<a name="l00607"></a>00607                                         lightInfo.<a class="code" href="struct_s_light_info.html#f22ba7c3f8c8ca55f5da12d61aafb81a">projection</a>.<a class="code" href="class_gr_projection.html#a411d73393ffd79ae827bcad8de91090">SetNearClip</a>( <a class="code" href="class_m_plane.html" title="class MPlane">MPlane</a>( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, -1.0f ), <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, -nearDist ) ) );
<a name="l00608"></a>00608                                 }
<a name="l00609"></a>00609                                 <span class="keywordflow">else</span>
<a name="l00610"></a>00610                                 {
<a name="l00611"></a>00611                                         errors = <span class="stringliteral">"Unrecognized expression in light projection."</span>;
<a name="l00612"></a>00612                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00613"></a>00613                                 }
<a name="l00614"></a>00614                         }
<a name="l00616"></a>00616                         ++curTok;
<a name="l00617"></a>00617                 }
<a name="l00618"></a>00618                 <span class="keywordflow">else</span>
<a name="l00619"></a>00619                 {
<a name="l00620"></a>00620                         errors = <span class="stringliteral">"Unrecognized expression in light definition."</span>;
<a name="l00621"></a>00621                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00622"></a>00622                 }
<a name="l00623"></a>00623         }
<a name="l00624"></a>00624 
<a name="l00626"></a>00626         ++curTok;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628         <span class="keywordflow">if</span> ( !lightInfo.<a class="code" href="struct_s_light_info.html#6e6773eee19ee9da44997768f8d77566">range</a> )
<a name="l00629"></a>00629                 lightInfo.<a class="code" href="struct_s_light_info.html#6e6773eee19ee9da44997768f8d77566">range</a> = <a class="code" href="_u_expr_mgr_8cpp.html#cdd5fc42d72fbe66d56686d969971ea0" title="class header.">gUExprMgr</a>-&gt;<a class="code" href="class_u_expr_mgr.html#a69ed663f2ce4467182f40877cff51fe" title="simple types.">CreateNumber</a>( 100.0f );
<a name="l00630"></a>00630 
<a name="l00631"></a>00631         <span class="keywordflow">if</span> ( !lightInfo.<a class="code" href="struct_s_light_info.html#086fba67bb218313e6fb4d847fca2c7b">intensity</a> )
<a name="l00632"></a>00632                 lightInfo.<a class="code" href="struct_s_light_info.html#086fba67bb218313e6fb4d847fca2c7b">intensity</a> = <a class="code" href="_u_expr_mgr_8cpp.html#cdd5fc42d72fbe66d56686d969971ea0" title="class header.">gUExprMgr</a>-&gt;<a class="code" href="class_u_expr_mgr.html#a69ed663f2ce4467182f40877cff51fe" title="simple types.">CreateNumber</a>( 1.0f );
<a name="l00633"></a>00633 
<a name="l00634"></a>00634         <span class="keywordflow">if</span> ( bvRadius &lt;= 0.0f )
<a name="l00635"></a>00635                 bvRadius = lightInfo.<a class="code" href="struct_s_light_info.html#6e6773eee19ee9da44997768f8d77566">range</a>-&gt;GetValue();
<a name="l00636"></a>00636 
<a name="l00637"></a>00637         lightInfo.<a class="code" href="struct_s_light_info.html#7c2667c93e4ec8b5bda44f39f97fb629">transform</a> = <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>( rotation, position );
<a name="l00638"></a>00638         lightInfo.<a class="code" href="struct_s_light_info.html#78ee5f1900b538a2ab102f3db65a9b46">mode</a> = <a class="code" href="_gr_light_8h.html#8874b04c94d261f583fc693b4d7c866ea750c4f4687a4b3d8e688b83cc4223f5">ELM_ADD</a>;
<a name="l00639"></a>00639 
<a name="l00641"></a>00641         <a class="code" href="_gr_light_mgr_8cpp.html#d2e92e9386149b1b99f9d2e6179019f7" title="class header.">gGrLightMgr</a>-&gt;<a class="code" href="class_gr_light_mgr.html#aa93ff46c80e5fdbc8cecdfce13d5a99" title="set light is usually called when a script is loaded.">SetLight</a>( <span class="keywordtype">id</span>, lightInfo );
<a name="l00642"></a>00642 
<a name="l00644"></a>00644         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00645"></a>00645 }
<a name="l00646"></a>00646 
<a name="l00647"></a>00647 <span class="comment">//----------------------------------------------------------</span>
<a name="l00648"></a>00648 <span class="keywordtype">bool</span>
<a name="l00649"></a><a class="code" href="_gr_parse_8cpp.html#eb7bc71e7eea5ac4bcaf281d3e65a1db">00649</a> <a class="code" href="_gr_parse_8cpp.html#eb7bc71e7eea5ac4bcaf281d3e65a1db">ParseSceneDef</a>( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l00650"></a>00650 {
<a name="l00652"></a>00652         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( <a class="code" href="_gr_scene_8cpp.html#61317b03beb338f79e32ea73a3e8276b">gGrScene</a> != 0 );
<a name="l00653"></a>00653 
<a name="l00656"></a>00656         <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a> scriptFileName = <a class="code" href="_r_rsrc_mgr_8cpp.html#619efa543e7eb2088397c02f921dff1b" title="class header.">gRRsrcMgr</a>-&gt;<a class="code" href="class_r_rsrc_mgr.html#a85d4b83e5e1fdbd0ced9f1299e93cdc">GetRecentScriptName</a>();
<a name="l00657"></a>00657 
<a name="l00659"></a>00659         <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; <a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l00660"></a>00660         ++curTok;
<a name="l00661"></a>00661 
<a name="l00664"></a>00664         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l00665"></a>00665         {
<a name="l00666"></a>00666                 errors = <span class="stringliteral">"Missing opening brace!"</span>;
<a name="l00667"></a>00667                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00668"></a>00668         }
<a name="l00669"></a>00669         ++curTok;
<a name="l00670"></a>00670 
<a name="l00672"></a>00672         std::vector&lt; SModelInfo &gt; modelInfoVec;
<a name="l00673"></a>00673 
<a name="l00675"></a>00675         <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a> ambience( 1.0f );
<a name="l00676"></a>00676         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> bspPath;
<a name="l00677"></a>00677         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> modelPath;
<a name="l00678"></a>00678         <span class="keywordtype">bool</span> zUp = <span class="keyword">false</span>;
<a name="l00679"></a>00679         <a class="code" href="struct_s_terrain_info.html">STerrainInfo</a> terrainInfo;
<a name="l00680"></a>00680 
<a name="l00682"></a>00682         <span class="keywordflow">while</span> ( !IsTok( curTok, <span class="stringliteral">"}"</span> ) )
<a name="l00683"></a>00683         {
<a name="l00684"></a>00684                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"bsppath"</span> ) )
<a name="l00685"></a>00685                 {
<a name="l00687"></a>00687                         ++curTok;
<a name="l00688"></a>00688 
<a name="l00690"></a>00690                         bspPath = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l00691"></a>00691                         ++curTok;
<a name="l00692"></a>00692                 }
<a name="l00693"></a>00693                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"modelpath"</span> ) )
<a name="l00694"></a>00694                 {
<a name="l00697"></a>00697                         ++curTok;
<a name="l00698"></a>00698 
<a name="l00700"></a>00700                         modelPath = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l00701"></a>00701                         ++curTok;
<a name="l00702"></a>00702                 }
<a name="l00703"></a>00703                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"model"</span> ) )
<a name="l00704"></a>00704                 {
<a name="l00706"></a>00706                         ++curTok;
<a name="l00707"></a>00707 
<a name="l00709"></a>00709                         <a class="code" href="struct_s_model_info.html">SModelInfo</a> modelInfo;
<a name="l00710"></a>00710                         <span class="keywordflow">if</span> ( !ParseModel( modelInfo, curTok, arrayTable, varTable, errors ) )
<a name="l00711"></a>00711                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00712"></a>00712 
<a name="l00714"></a>00714                         modelInfoVec.push_back( modelInfo );
<a name="l00715"></a>00715                 }
<a name="l00716"></a>00716                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"globalambience"</span> ) )
<a name="l00717"></a>00717                 {
<a name="l00719"></a>00719                         ++curTok;
<a name="l00720"></a>00720 
<a name="l00723"></a>00723                         <span class="keywordflow">if</span> ( !ParseColor( ambience, curTok, arrayTable, varTable, errors ) )
<a name="l00724"></a>00724                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00725"></a>00725                 }
<a name="l00726"></a>00726                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"upaxis"</span> ) )
<a name="l00727"></a>00727                 {
<a name="l00729"></a>00729                         ++curTok;
<a name="l00730"></a>00730 
<a name="l00732"></a>00732                         <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"z"</span> ) )
<a name="l00733"></a>00733                         {
<a name="l00734"></a>00734                                 zUp = <span class="keyword">true</span>;
<a name="l00735"></a>00735                         }
<a name="l00736"></a>00736                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"y"</span> ) )
<a name="l00737"></a>00737                         {
<a name="l00738"></a>00738                                 zUp = <span class="keyword">false</span>;
<a name="l00739"></a>00739                         }
<a name="l00740"></a>00740                         <span class="keywordflow">else</span>
<a name="l00741"></a>00741                         {
<a name="l00742"></a>00742                                 errors = <span class="stringliteral">"Invalid up axis specified!  Only Y or Z are valid options."</span>;
<a name="l00743"></a>00743                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00744"></a>00744                         }
<a name="l00745"></a>00745                         ++curTok;
<a name="l00746"></a>00746                 }
<a name="l00747"></a>00747                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"terrain"</span> ) )
<a name="l00748"></a>00748                 {
<a name="l00750"></a>00750                         ++curTok;
<a name="l00751"></a>00751 
<a name="l00752"></a>00752                         <span class="keywordflow">if</span> ( !ParseTerrain( terrainInfo, curTok, arrayTable, varTable, errors ) )
<a name="l00753"></a>00753                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00754"></a>00754                         terrainInfo.<a class="code" href="struct_s_terrain_info.html#02668db2830c7bb2d6afe5875ea182e9">found</a> = <span class="keyword">true</span>;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756                 }
<a name="l00757"></a>00757                 <span class="keywordflow">else</span>
<a name="l00758"></a>00758                 {
<a name="l00759"></a>00759                         errors = <span class="stringliteral">"Unrecognized expression in scene definition."</span>;
<a name="l00760"></a>00760                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00761"></a>00761                 }
<a name="l00762"></a>00762 
<a name="l00763"></a>00763         }
<a name="l00764"></a>00764 
<a name="l00766"></a>00766         ++curTok;
<a name="l00767"></a>00767 
<a name="l00769"></a>00769         <a class="code" href="class_u_ref.html">URef&lt; RFile &gt;</a> file = <a class="code" href="_r_file_mgr_8cpp.html#b27cd6d5cc5b23b502509e7fdab9c32e">gRFileMgr</a>-&gt;<a class="code" href="class_r_file_mgr.html#d7f101aeebcb703282cfcb6c8eba67f9" title="get a file.">GetFile</a>( bspPath, <a class="code" href="class_r_file_mgr.html#cf4103da9315f00f0ca524c2f263a1b4">RFileMgr::kFlagRead</a> );
<a name="l00770"></a>00770         <span class="keywordflow">if</span> ( !file )
<a name="l00771"></a>00771         {
<a name="l00772"></a>00772                 errors = <span class="stringliteral">"Invalid BSP path \""</span>;
<a name="l00773"></a>00773                 errors += bspPath;
<a name="l00774"></a>00774                 errors += <span class="stringliteral">"\" specified in scene definition."</span>;
<a name="l00775"></a>00775                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00776"></a>00776         }
<a name="l00777"></a>00777 
<a name="l00779"></a>00779         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bspSize = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )file-&gt;GetSize();
<a name="l00780"></a>00780         <span class="keyword">const</span> <span class="keywordtype">void</span>* bspBuffer = file-&gt;GetData();
<a name="l00781"></a>00781 
<a name="l00784"></a>00784         <a class="code" href="class_u_reader.html" title="Purpose: To wrap and simplify pointer read operations.">UReader</a> bspReader( bspBuffer, bspSize, <span class="keyword">false</span> );
<a name="l00785"></a>00785         <a class="code" href="class_gr_b_s_p_tree.html" title="class GrBSPTree">GrBSPTree</a>* bspTree = <span class="keyword">new</span> <a class="code" href="class_gr_b_s_p_tree.html" title="class GrBSPTree">GrBSPTree</a>( bspPath, bspReader );
<a name="l00786"></a>00786 
<a name="l00788"></a>00788         file-&gt;Purge();
<a name="l00789"></a>00789 
<a name="l00791"></a>00791         <a class="code" href="_gr_scene_8cpp.html#61317b03beb338f79e32ea73a3e8276b">gGrScene</a>-&gt;<a class="code" href="class_gr_scene.html#b95fdcbb9647160d1491e8de740122a7" title="resets the scene.">Reset</a>( scriptFileName, name, bspTree, zUp );
<a name="l00792"></a>00792 
<a name="l00794"></a>00794         <span class="keywordflow">if</span> ( modelPath.length() &gt; 0 )
<a name="l00795"></a>00795         {
<a name="l00796"></a>00796                 <a class="code" href="class_u_ref.html">URef&lt; GrModel &gt;</a> model = <a class="code" href="_gr_model_mgr_8cpp.html#fbcece7dd2c93af667a693fcaead872a">gGrModelMgr</a>-&gt;<a class="code" href="class_gr_model_mgr.html#1d0072cee000d7eb33cf894f801cb83f" title="gets a model or it&amp;#39;s clone.">GetModel</a>( modelPath, <a class="code" href="_gr_config_8h.html#197541100810faabefd4a5c52785b143">GR_SCENE_MODEL_INST_NAME</a>, <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l00797"></a>00797                 <span class="keywordflow">if</span> ( !model )
<a name="l00798"></a>00798                 {
<a name="l00799"></a>00799                         errors = <span class="stringliteral">"Invalid model path \""</span>;
<a name="l00800"></a>00800                         errors += modelPath;
<a name="l00801"></a>00801                         errors += <span class="stringliteral">"\" specified in scene definition."</span>;
<a name="l00802"></a>00802                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00803"></a>00803                 }
<a name="l00804"></a>00804                 <a class="code" href="_gr_scene_8cpp.html#61317b03beb338f79e32ea73a3e8276b">gGrScene</a>-&gt;<a class="code" href="class_gr_scene.html#77053ce45ce06b5253e28c63660bbe20">GetRootModel</a>()-&gt;<a class="code" href="class_gr_model.html#c232d8ab1c8c5e6349acd53eebc9db61" title="child models.">AddChild</a>( model );
<a name="l00805"></a>00805         }
<a name="l00806"></a>00806 
<a name="l00808"></a>00808         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> modelCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )modelInfoVec.size();
<a name="l00809"></a>00809         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; modelCount; ++i )
<a name="l00810"></a>00810         {
<a name="l00812"></a>00812                 <a class="code" href="struct_s_model_info.html">SModelInfo</a>&amp; curModelInfo = modelInfoVec[ i ];
<a name="l00813"></a>00813 
<a name="l00815"></a>00815                 <a class="code" href="class_u_ref.html">URef&lt; GrModel &gt;</a> curModel = <a class="code" href="_gr_model_mgr_8cpp.html#fbcece7dd2c93af667a693fcaead872a">gGrModelMgr</a>-&gt;<a class="code" href="class_gr_model_mgr.html#1d0072cee000d7eb33cf894f801cb83f" title="gets a model or it&amp;#39;s clone.">GetModel</a>( curModelInfo.<a class="code" href="struct_s_model_info.html#420add05541cbfe326890c918be61265">path</a>, curModelInfo.<a class="code" href="struct_s_model_info.html#e6ba1ebcc415ac7a794853a0910a32d0">instanceName</a>, curModelInfo.<a class="code" href="struct_s_model_info.html#cf9ec13cd56151333419dbcc25661151">clone</a>, <span class="keyword">false</span> );
<a name="l00816"></a>00816                 <span class="keywordflow">if</span> ( !curModel )
<a name="l00817"></a>00817                 {
<a name="l00818"></a>00818                         <a class="code" href="common__afx_8cpp.html#f1a1e0f08b49000974368246e5b97f84" title="debug output/console output function.">PrintF</a>( <span class="stringliteral">"Warning: model \"%s\" not found!\n"</span>, curModelInfo.<a class="code" href="struct_s_model_info.html#420add05541cbfe326890c918be61265">path</a>.<a class="code" href="class_u_path.html#970648bc09145c6da1712022d84ad3b7" title="returns the path string.">GetPathString</a>().c_str() );
<a name="l00819"></a>00819                         <span class="keywordflow">continue</span>;
<a name="l00820"></a>00820                 }
<a name="l00821"></a>00821 
<a name="l00823"></a>00823                 curModel-&gt;SetLocal( curModelInfo.<a class="code" href="struct_s_model_info.html#4938e01ec384c259e954268a7f4236cc">xform</a> );
<a name="l00824"></a>00824 
<a name="l00826"></a>00826                 std::vector&lt; SModelNodeInfo &gt;::iterator iter = curModelInfo.<a class="code" href="struct_s_model_info.html#cd0eda8de59d6aa049d5afaa851a1d82">nodeInfoVec</a>.begin();
<a name="l00827"></a>00827                 <span class="keyword">const</span> std::vector&lt; SModelNodeInfo &gt;::iterator <a class="code" href="_g_l_8h.html#432111147038972f06e049e18a837002">end</a> = curModelInfo.<a class="code" href="struct_s_model_info.html#cd0eda8de59d6aa049d5afaa851a1d82">nodeInfoVec</a>.end();
<a name="l00828"></a>00828                 <span class="keywordflow">for</span> ( ; iter != end; ++iter )
<a name="l00829"></a>00829                 {
<a name="l00831"></a>00831                         <a class="code" href="struct_s_model_node_info.html">SModelNodeInfo</a>&amp; curModelNodeInfo = *iter;
<a name="l00832"></a>00832 
<a name="l00834"></a>00834                         <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>* root = curModel-&gt;GetRootNode();
<a name="l00835"></a>00835                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( root != 0 );
<a name="l00836"></a>00836 
<a name="l00839"></a>00839                         <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>* node = root-&gt;<a class="code" href="class_gr_model_node.html#ea35f9469b11a8a8033f8ad1c7a54c24">FindNode</a>( curModelNodeInfo.<a class="code" href="struct_s_model_node_info.html#02679f64cd6fbb25ea3aa422f475161f" title="node name.">nodeName</a>.c_str(), true );
<a name="l00840"></a>00840                         <span class="keywordflow">if</span> ( iter-&gt;xform )
<a name="l00841"></a>00841                                 node-&gt;<a class="code" href="class_gr_model_node.html#1de0741bd0fbf78cb7ef6802948b6080" title="transform management.">SetLocal</a>( *curModelNodeInfo.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> );
<a name="l00842"></a>00842 
<a name="l00844"></a>00844                         std::vector&lt; SModelNodeMeshInfo &gt;::iterator meshIter = curModelNodeInfo.<a class="code" href="struct_s_model_node_info.html#ca20ee9540ca1d18dc8e7f2a1aa2bdbe">modelNodeMeshInfoVec</a>.begin();
<a name="l00845"></a>00845                         <span class="keyword">const</span> std::vector&lt; SModelNodeMeshInfo &gt;::iterator meshEnd = curModelNodeInfo.<a class="code" href="struct_s_model_node_info.html#ca20ee9540ca1d18dc8e7f2a1aa2bdbe">modelNodeMeshInfoVec</a>.end();
<a name="l00846"></a>00846                         <span class="keywordflow">for</span> ( ; meshIter != meshEnd; ++meshIter )
<a name="l00847"></a>00847                         {
<a name="l00849"></a>00849                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> unsignedMeshIdx = 0;
<a name="l00850"></a>00850                                 <span class="keywordtype">int</span> meshIdx = meshIter-&gt;meshInstIdx;
<a name="l00851"></a>00851                                 <span class="keywordflow">if</span> ( meshIdx &lt; 0 )
<a name="l00852"></a>00852                                         unsignedMeshIdx = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )( meshIdx + node-&gt;<a class="code" href="class_gr_model_node.html#34fb55f7a4af15a5d6f241117f62012f" title="mesh instance management.">GetMeshInstCount</a>() );
<a name="l00853"></a>00853                                 <span class="keywordflow">else</span>
<a name="l00854"></a>00854                                         unsignedMeshIdx = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )meshIdx;
<a name="l00855"></a>00855 
<a name="l00857"></a>00857                                 <span class="keywordflow">if</span> ( unsignedMeshIdx &gt; node-&gt;<a class="code" href="class_gr_model_node.html#34fb55f7a4af15a5d6f241117f62012f" title="mesh instance management.">GetMeshInstCount</a>() )
<a name="l00858"></a>00858                                 {
<a name="l00859"></a>00859                                         <a class="code" href="common__afx_8cpp.html#f1a1e0f08b49000974368246e5b97f84" title="debug output/console output function.">PrintF</a>( <span class="stringliteral">"Warning: invalid mesh index %d specified!"</span>, meshIdx );
<a name="l00860"></a>00860                                         <span class="keywordflow">continue</span>;
<a name="l00861"></a>00861                                 }
<a name="l00862"></a>00862 
<a name="l00864"></a>00864                                 <a class="code" href="class_gr_mesh_inst.html" title="class GrMeshInst">GrMeshInst</a>* meshInst = node-&gt;<a class="code" href="class_gr_model_node.html#f5340d3bc303ba7f9211f89e791b013d">GetMeshInst</a>( unsignedMeshIdx );
<a name="l00865"></a>00865 
<a name="l00867"></a>00867                                 std::vector&lt; SModelNodeMeshRangeInfo &gt;::iterator rangeIter = meshIter-&gt;meshRangeInfoVec.begin();
<a name="l00868"></a>00868                                 <span class="keyword">const</span> std::vector&lt; SModelNodeMeshRangeInfo &gt;::iterator rangeEnd = meshIter-&gt;meshRangeInfoVec.end();
<a name="l00869"></a>00869                                 <span class="keywordflow">for</span> ( ; rangeIter != rangeEnd; ++rangeIter )
<a name="l00870"></a>00870                                 {
<a name="l00872"></a>00872                                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> unsignedRangeIdx = 0;
<a name="l00873"></a>00873                                         <span class="keywordtype">int</span> rangeIdx = rangeIter-&gt;rangeIdx;
<a name="l00874"></a>00874                                         <span class="keywordflow">if</span> ( rangeIdx &lt; 0 )
<a name="l00875"></a>00875                                                 unsignedRangeIdx = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )( rangeIdx + meshInst-&gt;<a class="code" href="class_gr_mesh_inst.html#cbd495c05b5c83745059b6d842470607" title="accessors">GetRangeCount</a>() );
<a name="l00876"></a>00876                                         <span class="keywordflow">else</span>
<a name="l00877"></a>00877                                                 unsignedRangeIdx = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )rangeIdx;
<a name="l00878"></a>00878 
<a name="l00880"></a>00880                                         <span class="keywordflow">if</span> ( unsignedRangeIdx &gt; meshInst-&gt;<a class="code" href="class_gr_mesh_inst.html#cbd495c05b5c83745059b6d842470607" title="accessors">GetRangeCount</a>() )
<a name="l00881"></a>00881                                         {
<a name="l00882"></a>00882                                                 <a class="code" href="common__afx_8cpp.html#f1a1e0f08b49000974368246e5b97f84" title="debug output/console output function.">PrintF</a>( <span class="stringliteral">"Warning: invalid range index %d specified!"</span>, rangeIdx );
<a name="l00883"></a>00883                                                 <span class="keywordflow">continue</span>;
<a name="l00884"></a>00884                                         }
<a name="l00885"></a>00885 
<a name="l00887"></a>00887                                         <span class="keywordflow">if</span> ( rangeIter-&gt;materialId.GetPathString().length() &gt; 0 )
<a name="l00888"></a>00888                                         {
<a name="l00890"></a>00890                                                 <a class="code" href="class_u_ref.html">URef&lt; GrMaterial &gt;</a> material = <a class="code" href="_gr_material_mgr_8cpp.html#d46df50546f8a390c61c9a93e41ec428" title="class header.">gGrMaterialMgr</a>-&gt;<a class="code" href="class_gr_material_mgr.html#5cd1ffc48f5700668491231502af7be9">GetMaterial</a>( rangeIter-&gt;materialId, errors );
<a name="l00891"></a>00891                                                 <span class="keywordflow">if</span> ( material != 0 )
<a name="l00892"></a>00892                                                 {
<a name="l00894"></a>00894                                                         meshInst-&gt;<a class="code" href="class_gr_mesh_inst.html#2707fa3259b8562e464c9f538a3b54ff">SetMaterial</a>( unsignedRangeIdx, material );
<a name="l00895"></a>00895                                                 }
<a name="l00896"></a>00896                                                 <span class="keywordflow">else</span>
<a name="l00897"></a>00897                                                 {
<a name="l00898"></a>00898                                                         <a class="code" href="common__afx_8cpp.html#f1a1e0f08b49000974368246e5b97f84" title="debug output/console output function.">PrintF</a>( <span class="stringliteral">"Warning: invalid material \"%s\" specified!"</span>, rangeIter-&gt;materialId.GetPathString().c_str() );
<a name="l00899"></a>00899                                                         <span class="keywordflow">continue</span>;
<a name="l00900"></a>00900                                                 }
<a name="l00901"></a>00901                                         }
<a name="l00902"></a>00902                                 }
<a name="l00903"></a>00903                         }
<a name="l00904"></a>00904                 }
<a name="l00905"></a>00905 
<a name="l00907"></a>00907                 std::vector&lt; SModelLightInfo &gt;::iterator lightIter = curModelInfo.<a class="code" href="struct_s_model_info.html#8528cbebf3292b977c3cd481ef32a5ac">lightInfoVec</a>.begin();
<a name="l00908"></a>00908                 <span class="keyword">const</span> std::vector&lt; SModelLightInfo &gt;::iterator lightEnd = curModelInfo.<a class="code" href="struct_s_model_info.html#8528cbebf3292b977c3cd481ef32a5ac">lightInfoVec</a>.end();
<a name="l00909"></a>00909                 <span class="keywordflow">for</span> ( ; lightIter != lightEnd; ++lightIter )
<a name="l00910"></a>00910                 {
<a name="l00912"></a>00912                         <a class="code" href="class_u_ref.html">URef&lt; GrLight &gt;</a> light = <a class="code" href="_gr_light_mgr_8cpp.html#d2e92e9386149b1b99f9d2e6179019f7" title="class header.">gGrLightMgr</a>-&gt;<a class="code" href="class_gr_light_mgr.html#6e2d2113c8d6092935f4f39ad9e1388d">GetLight</a>( lightIter-&gt;lightName, errors );
<a name="l00913"></a>00913                         <span class="keywordflow">if</span> ( !light )
<a name="l00914"></a>00914                                 <span class="keywordflow">continue</span>;
<a name="l00915"></a>00915 
<a name="l00917"></a>00917                         <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>* parentNode = 0;
<a name="l00918"></a>00918                         <span class="keywordflow">if</span> ( lightIter-&gt;parentName.length() &gt; 0 )
<a name="l00919"></a>00919                                 parentNode = curModel-&gt;GetRootNode()-&gt;FindNode( lightIter-&gt;parentName.c_str(), true );
<a name="l00920"></a>00920 
<a name="l00922"></a>00922                         curModel-&gt;AddLight( light, parentNode );
<a name="l00923"></a>00923                 }
<a name="l00924"></a>00924 
<a name="l00925"></a>00925                 <a class="code" href="class_gr_model.html" title="class GrModel">GrModel</a>* root = <a class="code" href="_gr_scene_8cpp.html#61317b03beb338f79e32ea73a3e8276b">gGrScene</a>-&gt;<a class="code" href="class_gr_scene.html#77053ce45ce06b5253e28c63660bbe20">GetRootModel</a>();
<a name="l00926"></a>00926                 <span class="keywordflow">if</span> ( curModelInfo.<a class="code" href="struct_s_model_info.html#07a5eabdc7679e76a537d055d1263fe8">skybox</a> )
<a name="l00927"></a>00927                         root = <a class="code" href="_gr_scene_8cpp.html#61317b03beb338f79e32ea73a3e8276b">gGrScene</a>-&gt;<a class="code" href="class_gr_scene.html#b6bba978374af9a4e07fc144d7aaee4d">GetSkyboxModel</a>();
<a name="l00928"></a>00928 
<a name="l00930"></a>00930                 <span class="keywordflow">if</span> ( curModelInfo.<a class="code" href="struct_s_model_info.html#95660e555e8990625772b3f5744639fd">parentInstanceName</a>.<a class="code" href="class_u_path.html#970648bc09145c6da1712022d84ad3b7" title="returns the path string.">GetPathString</a>().length() &gt; 0 )
<a name="l00931"></a>00931                 {
<a name="l00933"></a>00933                         <a class="code" href="class_u_ref.html">URef&lt; GrModel &gt;</a> parent = root-&gt;<a class="code" href="class_gr_model.html#edeff0285708b660e0c21e2cb65da360" title="recursively finds a model by its instance name or its file name.">FindModelByInstName</a>( curModelInfo.<a class="code" href="struct_s_model_info.html#95660e555e8990625772b3f5744639fd">parentInstanceName</a> );
<a name="l00934"></a>00934                         <span class="keywordflow">if</span> ( !parent )
<a name="l00935"></a>00935                         {
<a name="l00936"></a>00936                                 <a class="code" href="common__afx_8cpp.html#f1a1e0f08b49000974368246e5b97f84" title="debug output/console output function.">PrintF</a>( <span class="stringliteral">"Warning: invalid parent model specified!\n"</span> );
<a name="l00937"></a>00937                         }
<a name="l00938"></a>00938                         <span class="keywordflow">else</span>
<a name="l00939"></a>00939                         {
<a name="l00940"></a>00940                                 parent-&gt;AddChild( curModel );
<a name="l00941"></a>00941                         }
<a name="l00942"></a>00942                 }
<a name="l00943"></a>00943                 <span class="keywordflow">else</span>
<a name="l00944"></a>00944                         root-&gt;<a class="code" href="class_gr_model.html#c232d8ab1c8c5e6349acd53eebc9db61" title="child models.">AddChild</a>( curModel );
<a name="l00945"></a>00945         }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947         <a class="code" href="_gr_scene_8cpp.html#61317b03beb338f79e32ea73a3e8276b">gGrScene</a>-&gt;<a class="code" href="class_gr_scene.html#d8cf055496150d2f331ef24cf74dc0b6" title="ambient lighting">SetGlobalAmbience</a>( ambience );
<a name="l00948"></a>00948         <a class="code" href="_gr_scene_8cpp.html#61317b03beb338f79e32ea73a3e8276b">gGrScene</a>-&gt;<a class="code" href="class_gr_scene.html#d0b2a12e012faf97823cab5067eb4fb0" title="show scene elements affected by the light.">Cache</a>();
<a name="l00949"></a>00949 
<a name="l00951"></a>00951         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00952"></a>00952 }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954 
<a name="l00955"></a>00955 <span class="comment">//==========================================================</span>
<a name="l00957"></a>00957 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00958"></a>00958 
<a name="l00959"></a>00959 <span class="comment">//----------------------------------------------------------</span>
<a name="l00960"></a>00960 <span class="keywordtype">bool</span>
<a name="l00961"></a>00961 ParseModel( <a class="code" href="struct_s_model_info.html">SModelInfo</a>&amp; info, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l00962"></a>00962 {
<a name="l00964"></a>00964         info.<a class="code" href="struct_s_model_info.html#e6ba1ebcc415ac7a794853a0910a32d0">instanceName</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l00965"></a>00965         ++curTok;
<a name="l00966"></a>00966 
<a name="l00967"></a>00967         info.<a class="code" href="struct_s_model_info.html#cf9ec13cd56151333419dbcc25661151">clone</a> = <span class="keyword">true</span>;
<a name="l00968"></a>00968         info.<a class="code" href="struct_s_model_info.html#4938e01ec384c259e954268a7f4236cc">xform</a> = <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>();
<a name="l00969"></a>00969 
<a name="l00972"></a>00972         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l00973"></a>00973         {
<a name="l00974"></a>00974                 errors = <span class="stringliteral">"Missing opening brace!"</span>;
<a name="l00975"></a>00975                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00976"></a>00976         }
<a name="l00977"></a>00977         ++curTok;
<a name="l00978"></a>00978 
<a name="l00980"></a>00980         <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a> ambience( 1.0f );
<a name="l00981"></a>00981         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> bspPath;
<a name="l00982"></a>00982         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> modelPath;
<a name="l00983"></a>00983         <span class="keywordtype">bool</span> zUp = <span class="keyword">false</span>;
<a name="l00984"></a>00984 
<a name="l00986"></a>00986         <span class="keywordflow">while</span> ( !IsTok( curTok, <span class="stringliteral">"}"</span> ) )
<a name="l00987"></a>00987         {
<a name="l00988"></a>00988                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"position"</span> ) )
<a name="l00989"></a>00989                 {
<a name="l00991"></a>00991                         ++curTok;
<a name="l00992"></a>00992 
<a name="l00994"></a>00994                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> position;
<a name="l00995"></a>00995                         <span class="keywordflow">if</span> ( !ParseVec3( position, curTok, arrayTable, varTable, errors ) )
<a name="l00996"></a>00996                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00997"></a>00997 
<a name="l00999"></a>00999                         info.<a class="code" href="struct_s_model_info.html#4938e01ec384c259e954268a7f4236cc">xform</a>.<a class="code" href="class_m_mat4x4.html#ac06f72b0de0177bf7a98ccf4ddc5ed2">SetTranslate</a>( position );
<a name="l01000"></a>01000                 }
<a name="l01001"></a>01001                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"rotation"</span> ) )
<a name="l01002"></a>01002                 {
<a name="l01004"></a>01004                         ++curTok;
<a name="l01005"></a>01005 
<a name="l01007"></a>01007                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> yxzRot;
<a name="l01008"></a>01008                         <span class="keywordflow">if</span> ( !ParseVec3( yxzRot, curTok, arrayTable, varTable, errors ) )
<a name="l01009"></a>01009                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01010"></a>01010 
<a name="l01012"></a>01012                         <a class="code" href="class_m_mat3x3.html" title="class MMat3x3">MMat3x3</a> newRot( <a class="code" href="common__afx_8h.html#116293816763dfdfd39b4bc70c38b465" title="math functions.">DegToRad</a>( yxzRot.<a class="code" href="class_m_vec3.html#8b834219441d8d65b3e4df28fe03f60f">GetX</a>() ), <a class="code" href="common__afx_8h.html#116293816763dfdfd39b4bc70c38b465" title="math functions.">DegToRad</a>( yxzRot.<a class="code" href="class_m_vec3.html#dfadf4adb521222d91980376a7679dc8">GetY</a>() ), <a class="code" href="common__afx_8h.html#116293816763dfdfd39b4bc70c38b465" title="math functions.">DegToRad</a>( yxzRot.<a class="code" href="class_m_vec3.html#8b29390479c105bbb9926188b9742329">GetZ</a>() ) );
<a name="l01013"></a>01013                         info.<a class="code" href="struct_s_model_info.html#4938e01ec384c259e954268a7f4236cc">xform</a>.<a class="code" href="class_m_mat4x4.html#37d2e5026e682b64a60ee7343cd814e9">SetRotate</a>( newRot );
<a name="l01014"></a>01014                 }
<a name="l01015"></a>01015                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"scale"</span> ) )
<a name="l01016"></a>01016                 {
<a name="l01018"></a>01018                         ++curTok;
<a name="l01019"></a>01019 
<a name="l01021"></a>01021                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l01022"></a>01022                         <span class="keywordflow">if</span> ( !expr )
<a name="l01023"></a>01023                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01024"></a>01024 
<a name="l01026"></a>01026                         <span class="keywordtype">float</span> <a class="code" href="glext_8h.html#281421b881aa7a1266842b73a3bc7655">scale</a> = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( expr-&gt;GetValue(), 0.05f );
<a name="l01027"></a>01027                         info.<a class="code" href="struct_s_model_info.html#4938e01ec384c259e954268a7f4236cc">xform</a>.<a class="code" href="class_m_mat4x4.html#8ed6ef9ec48dacf59eda26bb8e3b721d">SetScale</a>( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( scale, scale, scale ) );
<a name="l01028"></a>01028                 }
<a name="l01029"></a>01029                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"path"</span> ) )
<a name="l01030"></a>01030                 {
<a name="l01032"></a>01032                         ++curTok;
<a name="l01033"></a>01033 
<a name="l01035"></a>01035                         info.<a class="code" href="struct_s_model_info.html#420add05541cbfe326890c918be61265">path</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l01036"></a>01036                         ++curTok;
<a name="l01037"></a>01037                 }
<a name="l01038"></a>01038                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"parent"</span> ) )
<a name="l01039"></a>01039                 {
<a name="l01041"></a>01041                         ++curTok;
<a name="l01042"></a>01042 
<a name="l01044"></a>01044                         info.<a class="code" href="struct_s_model_info.html#95660e555e8990625772b3f5744639fd">parentInstanceName</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l01045"></a>01045                 }
<a name="l01046"></a>01046                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"noclone"</span> ) )
<a name="l01047"></a>01047                 {
<a name="l01049"></a>01049                         ++curTok;
<a name="l01050"></a>01050 
<a name="l01052"></a>01052                         info.<a class="code" href="struct_s_model_info.html#cf9ec13cd56151333419dbcc25661151">clone</a> = <span class="keyword">false</span>;
<a name="l01053"></a>01053                 }
<a name="l01054"></a>01054                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"skybox"</span> ) )
<a name="l01055"></a>01055                 {
<a name="l01057"></a>01057                         ++curTok;
<a name="l01058"></a>01058 
<a name="l01060"></a>01060                         info.<a class="code" href="struct_s_model_info.html#07a5eabdc7679e76a537d055d1263fe8">skybox</a> = <span class="keyword">true</span>;
<a name="l01061"></a>01061                 }
<a name="l01062"></a>01062                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"node"</span> ) )
<a name="l01063"></a>01063                 {
<a name="l01065"></a>01065                         ++curTok;
<a name="l01066"></a>01066 
<a name="l01068"></a>01068                         <a class="code" href="struct_s_model_node_info.html">SModelNodeInfo</a> nodeInfo;
<a name="l01069"></a>01069                         <span class="keywordflow">if</span> ( !ParseModelNodeInfo( nodeInfo, curTok, arrayTable, varTable, errors ) )
<a name="l01070"></a>01070             {
<a name="l01071"></a>01071                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( <span class="keyword">false</span> );
<a name="l01072"></a>01072                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01073"></a>01073             }
<a name="l01074"></a>01074 
<a name="l01076"></a>01076                         info.<a class="code" href="struct_s_model_info.html#cd0eda8de59d6aa049d5afaa851a1d82">nodeInfoVec</a>.push_back( nodeInfo );
<a name="l01077"></a>01077                 }
<a name="l01078"></a>01078                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"light"</span> ) )
<a name="l01079"></a>01079                 {
<a name="l01081"></a>01081                         ++curTok;
<a name="l01082"></a>01082 
<a name="l01084"></a>01084                         <a class="code" href="struct_s_model_light_info.html">SModelLightInfo</a> lightInfo;
<a name="l01085"></a>01085                         lightInfo.<a class="code" href="struct_s_model_light_info.html#a5ffac52c8bd8fa444badb630f54656b">lightName</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l01086"></a>01086                         ++curTok;
<a name="l01087"></a>01087 
<a name="l01089"></a>01089                         <span class="keywordflow">if</span> ( curTok-&gt;<a class="code" href="struct_s_bsc_token.html#0c4dfdfcd3c3fcbffd6bb515b7e7a1c4" title="data members.">tokenId</a> == <a class="code" href="_bsc_lexer_8h.html#17a3930578ac82e27dc6cc22b9663614" title="punctuation">BL_COMMA</a> )
<a name="l01090"></a>01090                         {
<a name="l01092"></a>01092                                 ++curTok;
<a name="l01093"></a>01093 
<a name="l01095"></a>01095                                 lightInfo.<a class="code" href="struct_s_model_light_info.html#6597fccf77dbc2c8268aab84d783c035">parentName</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l01096"></a>01096                                 ++curTok;
<a name="l01097"></a>01097                         }
<a name="l01098"></a>01098 
<a name="l01100"></a>01100                         info.<a class="code" href="struct_s_model_info.html#8528cbebf3292b977c3cd481ef32a5ac">lightInfoVec</a>.push_back( lightInfo );
<a name="l01101"></a>01101                 }
<a name="l01102"></a>01102                 <span class="keywordflow">else</span>
<a name="l01103"></a>01103                 {
<a name="l01104"></a>01104                         errors = <span class="stringliteral">"Unrecognized expression in model declaration."</span>;
<a name="l01105"></a>01105                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01106"></a>01106                 }
<a name="l01107"></a>01107         }
<a name="l01108"></a>01108 
<a name="l01110"></a>01110         ++curTok;
<a name="l01111"></a>01111 
<a name="l01113"></a>01113         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01114"></a>01114 }
<a name="l01115"></a>01115 
<a name="l01116"></a>01116 <span class="comment">//----------------------------------------------------------</span>
<a name="l01117"></a>01117 <span class="keywordtype">bool</span>
<a name="l01118"></a>01118 ParseModelNodeInfo( <a class="code" href="struct_s_model_node_info.html">SModelNodeInfo</a>&amp; info, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l01119"></a>01119                                         <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l01120"></a>01120 {
<a name="l01122"></a>01122         info.<a class="code" href="struct_s_model_node_info.html#02679f64cd6fbb25ea3aa422f475161f" title="node name.">nodeName</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l01123"></a>01123         ++curTok;
<a name="l01124"></a>01124 
<a name="l01126"></a>01126         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l01127"></a>01127         {
<a name="l01128"></a>01128                 errors = <span class="stringliteral">"Missing opening brace!"</span>;
<a name="l01129"></a>01129                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01130"></a>01130         }
<a name="l01131"></a>01131         ++curTok;
<a name="l01132"></a>01132 
<a name="l01134"></a>01134         <span class="keywordflow">while</span> ( !IsTok( curTok, <span class="stringliteral">"}"</span> ) )
<a name="l01135"></a>01135         {
<a name="l01136"></a>01136                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"mesh"</span> ) )
<a name="l01137"></a>01137                 {
<a name="l01139"></a>01139                         ++curTok;
<a name="l01140"></a>01140 
<a name="l01142"></a>01142                         <a class="code" href="struct_s_model_node_mesh_info.html" title="model node material reference.">SModelNodeMeshInfo</a> meshInfo;
<a name="l01143"></a>01143                         <span class="keywordflow">if</span> ( !ParseModelNodeMeshInfo( meshInfo, curTok, arrayTable, varTable, errors ) )
<a name="l01144"></a>01144                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01145"></a>01145 
<a name="l01147"></a>01147                         info.<a class="code" href="struct_s_model_node_info.html#ca20ee9540ca1d18dc8e7f2a1aa2bdbe">modelNodeMeshInfoVec</a>.push_back( meshInfo );
<a name="l01148"></a>01148                 }
<a name="l01149"></a>01149                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"position"</span> ) )
<a name="l01150"></a>01150                 {
<a name="l01152"></a>01152                         ++curTok;
<a name="l01153"></a>01153 
<a name="l01155"></a>01155                         <span class="keywordflow">if</span> ( !info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> )
<a name="l01156"></a>01156                                 info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> = <span class="keyword">new</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>();
<a name="l01157"></a>01157 
<a name="l01159"></a>01159                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> position;
<a name="l01160"></a>01160                         <span class="keywordflow">if</span> ( !ParseVec3( position, curTok, arrayTable, varTable, errors ) )
<a name="l01161"></a>01161                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01162"></a>01162 
<a name="l01164"></a>01164                         info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a>-&gt;<a class="code" href="class_m_mat4x4.html#ac06f72b0de0177bf7a98ccf4ddc5ed2">SetTranslate</a>( position );
<a name="l01165"></a>01165                 }
<a name="l01166"></a>01166                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"rotation"</span> ) )
<a name="l01167"></a>01167                 {
<a name="l01169"></a>01169                         ++curTok;
<a name="l01170"></a>01170 
<a name="l01172"></a>01172                         <span class="keywordflow">if</span> ( !info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> )
<a name="l01173"></a>01173                                 info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> = <span class="keyword">new</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>();
<a name="l01174"></a>01174 
<a name="l01177"></a>01177                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> angles;
<a name="l01178"></a>01178                         <span class="keywordflow">if</span> ( !ParseVec3( angles, curTok, arrayTable, varTable, errors ) )
<a name="l01179"></a>01179                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01180"></a>01180 
<a name="l01182"></a>01182                         <a class="code" href="class_m_mat3x3.html" title="class MMat3x3">MMat3x3</a> rot( <a class="code" href="common__afx_8h.html#116293816763dfdfd39b4bc70c38b465" title="math functions.">DegToRad</a>( angles.<a class="code" href="class_m_vec3.html#8b834219441d8d65b3e4df28fe03f60f">GetX</a>() ), <a class="code" href="common__afx_8h.html#116293816763dfdfd39b4bc70c38b465" title="math functions.">DegToRad</a>( angles.<a class="code" href="class_m_vec3.html#dfadf4adb521222d91980376a7679dc8">GetY</a>() ), <a class="code" href="common__afx_8h.html#116293816763dfdfd39b4bc70c38b465" title="math functions.">DegToRad</a>( angles.<a class="code" href="class_m_vec3.html#8b29390479c105bbb9926188b9742329">GetZ</a>() ) );
<a name="l01183"></a>01183                         info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a>-&gt;<a class="code" href="class_m_mat4x4.html#37d2e5026e682b64a60ee7343cd814e9">SetRotate</a>( rot );
<a name="l01184"></a>01184                 }
<a name="l01185"></a>01185                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"scale"</span> ) )
<a name="l01186"></a>01186                 {
<a name="l01188"></a>01188                         ++curTok;
<a name="l01189"></a>01189 
<a name="l01191"></a>01191                         <span class="keywordflow">if</span> ( !info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> )
<a name="l01192"></a>01192                                 info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a> = <span class="keyword">new</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>();
<a name="l01193"></a>01193 
<a name="l01195"></a>01195                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l01196"></a>01196                         <span class="keywordflow">if</span> ( !expr )
<a name="l01197"></a>01197                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01198"></a>01198 
<a name="l01200"></a>01200                         <span class="keywordtype">float</span> scale = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( expr-&gt;GetValue(), 0.05f );
<a name="l01201"></a>01201                         info.<a class="code" href="struct_s_model_node_info.html#3d23e4e63314a9d0115a4fd1c84a14a1">xform</a>-&gt;<a class="code" href="class_m_mat4x4.html#8ed6ef9ec48dacf59eda26bb8e3b721d">SetScale</a>( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( scale, scale, scale ) );
<a name="l01202"></a>01202                 }
<a name="l01203"></a>01203                 <span class="keywordflow">else</span>
<a name="l01204"></a>01204                 {
<a name="l01206"></a>01206                         errors = <span class="stringliteral">"Unrecognized expression in model material declaration."</span>;
<a name="l01207"></a>01207                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01208"></a>01208                 }
<a name="l01209"></a>01209         }
<a name="l01210"></a>01210 
<a name="l01212"></a>01212         ++curTok;
<a name="l01213"></a>01213 
<a name="l01215"></a>01215         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01216"></a>01216 }
<a name="l01217"></a>01217 
<a name="l01218"></a>01218 <span class="comment">//----------------------------------------------------------</span>
<a name="l01219"></a>01219 <span class="keywordtype">bool</span>
<a name="l01220"></a>01220 ParseModelNodeMeshInfo( <a class="code" href="struct_s_model_node_mesh_info.html" title="model node material reference.">SModelNodeMeshInfo</a>&amp; meshInfo, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok,
<a name="l01221"></a>01221                                                 <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l01222"></a>01222 {
<a name="l01224"></a>01224         <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#6a4f8a1a444e9080b297963b3db29fe0">value</a> = 0;
<a name="l01225"></a>01225         <span class="keywordflow">if</span> ( !ParseInteger( value, curTok, errors ) )
<a name="l01226"></a>01226                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01227"></a>01227 
<a name="l01230"></a>01230         meshInfo.<a class="code" href="struct_s_model_node_mesh_info.html#9320f806f5614c5b16b0f6bfa49a94f1">meshInstIdx</a> = value;
<a name="l01231"></a>01231 
<a name="l01233"></a>01233         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l01234"></a>01234         {
<a name="l01235"></a>01235                 errors = <span class="stringliteral">"Missing opening brace!"</span>;
<a name="l01236"></a>01236                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01237"></a>01237         }
<a name="l01238"></a>01238         ++curTok;
<a name="l01239"></a>01239 
<a name="l01241"></a>01241         <span class="keywordflow">while</span> ( !IsTok( curTok, <span class="stringliteral">"}"</span> ) )
<a name="l01242"></a>01242         {
<a name="l01243"></a>01243                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"range"</span> ) )
<a name="l01244"></a>01244                 {
<a name="l01246"></a>01246                         ++curTok;
<a name="l01247"></a>01247 
<a name="l01249"></a>01249                         <a class="code" href="struct_s_model_node_mesh_range_info.html">SModelNodeMeshRangeInfo</a> rangeInfo;
<a name="l01250"></a>01250                         <span class="keywordflow">if</span> ( !ParseModelNodeMeshRangeInfo( rangeInfo, curTok, arrayTable, varTable, errors ) )
<a name="l01251"></a>01251                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01252"></a>01252 
<a name="l01254"></a>01254                         meshInfo.<a class="code" href="struct_s_model_node_mesh_info.html#b75268dc7305f850ff82b777f59b61f1">meshRangeInfoVec</a>.push_back( rangeInfo );
<a name="l01255"></a>01255                 }
<a name="l01256"></a>01256                 <span class="keywordflow">else</span>
<a name="l01257"></a>01257                 {
<a name="l01258"></a>01258                         errors = <span class="stringliteral">"Unrecognized expression in mesh declaration."</span>;
<a name="l01259"></a>01259                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01260"></a>01260                 }
<a name="l01261"></a>01261         }
<a name="l01262"></a>01262 
<a name="l01264"></a>01264         ++curTok;
<a name="l01265"></a>01265 
<a name="l01267"></a>01267         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01268"></a>01268 }
<a name="l01269"></a>01269 
<a name="l01270"></a>01270 <span class="comment">//----------------------------------------------------------</span>
<a name="l01271"></a>01271 <span class="keywordtype">bool</span>
<a name="l01272"></a>01272 ParseModelNodeMeshRangeInfo( <a class="code" href="struct_s_model_node_mesh_range_info.html">SModelNodeMeshRangeInfo</a>&amp; rangeRef, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok,
<a name="l01273"></a>01273                                                          <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l01274"></a>01274 {
<a name="l01276"></a>01276         <span class="keywordflow">if</span> ( !ParseInteger( rangeRef.<a class="code" href="struct_s_model_node_mesh_range_info.html#1d4582bb5a63563bbf20adf986fd6d04">rangeIdx</a>, curTok, errors ) )
<a name="l01277"></a>01277                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01278"></a>01278 
<a name="l01280"></a>01280         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l01281"></a>01281         {
<a name="l01282"></a>01282                 errors = <span class="stringliteral">"Missing opening brace!"</span>;
<a name="l01283"></a>01283                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01284"></a>01284         }
<a name="l01285"></a>01285         ++curTok;
<a name="l01286"></a>01286 
<a name="l01288"></a>01288         <span class="keywordflow">while</span> ( !IsTok( curTok, <span class="stringliteral">"}"</span> ) )
<a name="l01289"></a>01289         {
<a name="l01290"></a>01290                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"materialid"</span> ) )
<a name="l01291"></a>01291                 {
<a name="l01293"></a>01293                         ++curTok;
<a name="l01294"></a>01294 
<a name="l01296"></a>01296                         rangeRef.<a class="code" href="struct_s_model_node_mesh_range_info.html#bf16f26b74ad08b098ef75563a1eae90">materialId</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l01297"></a>01297                         ++curTok;
<a name="l01298"></a>01298                 }
<a name="l01299"></a>01299                 <span class="keywordflow">else</span>
<a name="l01300"></a>01300                 {
<a name="l01301"></a>01301                         errors = <span class="stringliteral">"Unrecognized expression in range declaration."</span>;
<a name="l01302"></a>01302                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01303"></a>01303                 }
<a name="l01304"></a>01304         }
<a name="l01305"></a>01305 
<a name="l01307"></a>01307         ++curTok;
<a name="l01308"></a>01308 
<a name="l01310"></a>01310         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01311"></a>01311 }
<a name="l01312"></a>01312 
<a name="l01313"></a>01313 <span class="comment">//----------------------------------------------------------</span>
<a name="l01314"></a>01314 <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>*
<a name="l01315"></a>01315 ParseMaterialPass( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> curPassCount,
<a name="l01316"></a>01316                                   <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l01317"></a>01317 {
<a name="l01319"></a>01319         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( <a class="code" href="_gr_material_mgr_8cpp.html#d46df50546f8a390c61c9a93e41ec428" title="class header.">gGrMaterialMgr</a> != 0 );
<a name="l01320"></a>01320 
<a name="l01321"></a>01321         <span class="keyword">typedef</span> <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; SShaderUserParam, 32, 32 &gt;</a> ParamVec;
<a name="l01322"></a>01322         <span class="keyword">typedef</span> <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; SShaderUserSampler, 32, 32 &gt;</a> SamplerVec;
<a name="l01323"></a>01323 
<a name="l01324"></a>01324         ParamVec userParams;
<a name="l01325"></a>01325         SamplerVec userSamplers;
<a name="l01326"></a>01326 
<a name="l01327"></a>01327         <a class="code" href="struct_s_material_pass_info.html">SMaterialPassInfo</a> matPass;
<a name="l01328"></a>01328         matPass.<a class="code" href="struct_s_material_pass_info.html#88f257e5b6e6b9e21392219be74df05c" title="primary shader for the pass.">shader</a> = <a class="code" href="_gr_shader_mgr_8cpp.html#72561a5bdde97bf632da40c53beaf8e9" title="Purpose: To manage OpenGL vertex/fragment programs.">gGrShaderMgr</a>-&gt;<a class="code" href="class_gr_shader_mgr.html#995feafb4bceced19755f92e010c002c" title="finds an already created shader.">FindShader</a>( <a class="code" href="_gr_config_8h.html#676bc242b717e392367e68833a9a22a3" title="System shaders.">GR_SHADER_DEFAULT_LIGHT</a> );
<a name="l01329"></a>01329         matPass.<a class="code" href="struct_s_material_pass_info.html#b355f2664fb9a12aaf019c80a5b54a03">ambientShader</a> = <a class="code" href="_gr_shader_mgr_8cpp.html#72561a5bdde97bf632da40c53beaf8e9" title="Purpose: To manage OpenGL vertex/fragment programs.">gGrShaderMgr</a>-&gt;<a class="code" href="class_gr_shader_mgr.html#995feafb4bceced19755f92e010c002c" title="finds an already created shader.">FindShader</a>( <a class="code" href="_gr_config_8h.html#2f519bb21e5fcca2bcd1756aecb37d2e">GR_SHADER_DEFAULT_AMBIENT</a> );
<a name="l01330"></a>01330         matPass.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#26219f41c410a0c020e84c2a7bc32eab">srcAlphaBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l01331"></a>01331         matPass.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#8c63ffc9017a3e850dbba2ecf9d55636">dstAlphaBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ecc9c0a06efec84a35b4d9586676fa3815">EBM_ZERO</a>;
<a name="l01332"></a>01332         matPass.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#fb1134ab25291932ab686cf72156a571" title="states specific to various passes.">srcColorBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l01333"></a>01333         matPass.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#5e75b2942d23722d7886bccc5612d1b6">dstColorBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ecc9c0a06efec84a35b4d9586676fa3815">EBM_ZERO</a>;
<a name="l01334"></a>01334         matPass.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#26219f41c410a0c020e84c2a7bc32eab">srcAlphaBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ecc9c0a06efec84a35b4d9586676fa3815">EBM_ZERO</a>;
<a name="l01335"></a>01335         matPass.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#8c63ffc9017a3e850dbba2ecf9d55636">dstAlphaBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l01336"></a>01336         matPass.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#fb1134ab25291932ab686cf72156a571" title="states specific to various passes.">srcColorBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l01337"></a>01337         matPass.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#5e75b2942d23722d7886bccc5612d1b6">dstColorBlendFactor</a> = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l01338"></a>01338         matPass.<a class="code" href="struct_s_material_pass_info.html#1c5a2ded6a57901feed193d620db014e" title="culling mode.">cullMode</a> = <a class="code" href="_gr_util_8h.html#ea790ef067767354691d0d60c51542fe5fb45ade8a2def0e22899c5f34497da4">ECM_BACK</a>;
<a name="l01339"></a>01339         matPass.<a class="code" href="struct_s_material_pass_info.html#8c047353d3e838c5a3d11ba448847d23" title="alpha test reference value.">alphaTestMode</a> = <a class="code" href="_gr_util_8h.html#abff98128b1f220d1ceff538f4abdef3fe705b2d83e29a130a97914af12ef178">EAM_LESSEQUAL</a>;
<a name="l01340"></a>01340         matPass.<a class="code" href="struct_s_material_pass_info.html#9209733df2e6a655d595dfc1d810b28f">alphaTestRef</a> = <a class="code" href="_u_expr_mgr_8cpp.html#cdd5fc42d72fbe66d56686d969971ea0" title="class header.">gUExprMgr</a>-&gt;<a class="code" href="class_u_expr_mgr.html#a69ed663f2ce4467182f40877cff51fe" title="simple types.">CreateNumber</a>( 0.5f );
<a name="l01341"></a>01341         matPass.<a class="code" href="struct_s_material_pass_info.html#47066b32f4d65c956ec8789a7ec14fb2" title="pass enable.">passEnable</a> = <a class="code" href="_u_expr_mgr_8cpp.html#cdd5fc42d72fbe66d56686d969971ea0" title="class header.">gUExprMgr</a>-&gt;<a class="code" href="class_u_expr_mgr.html#a69ed663f2ce4467182f40877cff51fe" title="simple types.">CreateNumber</a>( 1.0f );
<a name="l01342"></a>01342         matPass.<a class="code" href="struct_s_material_pass_info.html#47b874b3efb05afc0ccbecc01ebf62bc" title="various flags.">receiveShadow</a> = <span class="keyword">true</span>;
<a name="l01343"></a>01343         matPass.<a class="code" href="struct_s_material_pass_info.html#b4f60776995332748e40270d6c2dc318" title="states.">enableState</a> = <a class="code" href="_gr_util_8h.html#df38fed29d4a8214bf4a51a0df0a7512" title="render states.">GR_DEPTHTEST</a> | <a class="code" href="_gr_util_8h.html#43f8fbc0073e1858f6bba0a73acfe8a6">GR_CULLFACE</a> | <a class="code" href="_gr_util_8h.html#ce93b9dc4bae65a0e96164bc2dcb2688">GR_BLEND</a>;
<a name="l01344"></a>01344         matPass.<a class="code" href="struct_s_material_pass_info.html#06ba69d3100e1ce0a27d8da74c1f342d">writeMask</a> = <a class="code" href="_gr_util_8h.html#d091dcc5dafb6944427eb6d9895b25d3">GR_RGBA</a> | <a class="code" href="_gr_util_8h.html#263ecb0b6dc90d2aca7b9291d81a7024">GR_DEPTH</a>;
<a name="l01345"></a>01345         matPass.<a class="code" href="struct_s_material_pass_info.html#148b9b02c76e38c6be30dc599ad35dad">castShadow</a> = <span class="keyword">true</span>;
<a name="l01346"></a>01346         matPass.<a class="code" href="struct_s_material_pass_info.html#a129865ee753ac3056cd69490330f782" title="vertex parameters.">vertexColorMod</a> = <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>( 0.0f, 0.0f, 0.0f, 0.0f );
<a name="l01347"></a>01347         matPass.<a class="code" href="struct_s_material_pass_info.html#8d6e08ed3afd1c51ea0320bd485dadf5">vertexColorAdd</a> = <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>( 1.0f, 1.0f, 1.0f, 1.0f );
<a name="l01348"></a>01348         matPass.<a class="code" href="struct_s_material_pass_info.html#ac97ff420977ef457316e478e8827cda" title="light response range.">minLightResponse</a> = <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>( 0.0f, 0.0f, 0.0f, 0.0f );
<a name="l01349"></a>01349         matPass.<a class="code" href="struct_s_material_pass_info.html#5ee16644b6f677c6eae42bf410a43dfd">maxLightResponse</a> = <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>( 4.0f, 4.0f, 4.0f, 4.0f );
<a name="l01350"></a>01350         matPass.<a class="code" href="struct_s_material_pass_info.html#43b0b16486a5a825210158b5c55db342" title="depth bias.">slopeBias</a> = 0.0f;
<a name="l01351"></a>01351         matPass.<a class="code" href="struct_s_material_pass_info.html#e2071f6643a25e1f3866adb9b33c5079">constBias</a> = 0.0f;
<a name="l01352"></a>01352 
<a name="l01353"></a>01353         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> white = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#83321c109ae9862b3e9ad6acabd8819d">FindTexture</a>( <a class="code" href="_gr_config_8h.html#0bc42af43d2149756d12e05ee44e1e05">GR_SYSTEX_WHITE</a> );
<a name="l01354"></a>01354         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> gray = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#83321c109ae9862b3e9ad6acabd8819d">FindTexture</a>( <a class="code" href="_gr_config_8h.html#63736ab4111bb29343c1bbb94464429f">GR_SYSTEX_GRAY</a> );
<a name="l01355"></a>01355         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> black = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#83321c109ae9862b3e9ad6acabd8819d">FindTexture</a>( <a class="code" href="_gr_config_8h.html#87d5c3c8045b8fca2ecc24fc60efcfd5" title="System texture names.">GR_SYSTEX_BLACK</a> );
<a name="l01356"></a>01356         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> normal = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#83321c109ae9862b3e9ad6acabd8819d">FindTexture</a>( <a class="code" href="_gr_config_8h.html#102570f15de72ca56ff40df90b10d880">GR_SYSTEX_NORMAL</a> );
<a name="l01357"></a>01357 
<a name="l01358"></a>01358         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> sScaleExpr;
<a name="l01359"></a>01359         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> tScaleExpr;
<a name="l01360"></a>01360         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> sTranslateExpr;
<a name="l01361"></a>01361         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> tTranslateExpr;
<a name="l01362"></a>01362         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> stRotateExpr;
<a name="l01363"></a>01363 
<a name="l01365"></a>01365         <a class="code" href="class_gr_texture_stage.html" title="class GrTextureStage">GrTextureStage</a> stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606880eae637bafc33d1caaebc904fda58e2b">ES_COUNT</a> ];
<a name="l01366"></a>01366         
<a name="l01367"></a>01367         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688d0fafee9d454a53ad1398707987e5c8e">ES_AMBIENT</a>      ].<a class="code" href="class_gr_texture_stage.html#f2d25544ef1026d7f705074db5c88902">SetFilterMode</a>(        <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f048501ac6f236392708f83174094dfa9f7b">GrTextureStage::EFM_BILINEAR</a>    );
<a name="l01368"></a>01368         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688d0fafee9d454a53ad1398707987e5c8e">ES_AMBIENT</a>      ].<a class="code" href="class_gr_texture_stage.html#1803888bbf5d820f060465bd63bf88bd">SetTexColorMod</a>(       <a class="code" href="_gr_parse_8h.html#489218b58bb56e2a580c851e3002600d" title="default value constants...">GR_PARSE_AMBIENT_MOD_DEF</a>                );
<a name="l01369"></a>01369         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688d0fafee9d454a53ad1398707987e5c8e">ES_AMBIENT</a>      ].<a class="code" href="class_gr_texture_stage.html#6dc007a985aac8227b9e445829d42756">SetTexColorAdd</a>(       <a class="code" href="_gr_parse_8h.html#d7e41c1c0621298d21d32229686460ce">GR_PARSE_AMBIENT_ADD_DEF</a>                );
<a name="l01370"></a>01370         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f96816068812f1980d8a826e26b4418064956f0d97">ES_EMISSIVE</a>     ].<a class="code" href="class_gr_texture_stage.html#f2d25544ef1026d7f705074db5c88902">SetFilterMode</a>(        <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f048501ac6f236392708f83174094dfa9f7b">GrTextureStage::EFM_BILINEAR</a>    );
<a name="l01371"></a>01371         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f96816068812f1980d8a826e26b4418064956f0d97">ES_EMISSIVE</a>     ].<a class="code" href="class_gr_texture_stage.html#1803888bbf5d820f060465bd63bf88bd">SetTexColorMod</a>(       <a class="code" href="_gr_parse_8h.html#aabb472cdeff98d416165ff8f10b5a05">GR_PARSE_EMISSIVE_MOD_DEF</a>               );
<a name="l01372"></a>01372         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f96816068812f1980d8a826e26b4418064956f0d97">ES_EMISSIVE</a>     ].<a class="code" href="class_gr_texture_stage.html#6dc007a985aac8227b9e445829d42756">SetTexColorAdd</a>(       <a class="code" href="_gr_parse_8h.html#26f52dc4f6294f5f0754b9799f3ab117">GR_PARSE_EMISSIVE_ADD_DEF</a>               );
<a name="l01373"></a>01373         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688b1b35286c474a867806a21cea61952b5">ES_BUMP</a>         ].<a class="code" href="class_gr_texture_stage.html#f2d25544ef1026d7f705074db5c88902">SetFilterMode</a>(        <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f048501ac6f236392708f83174094dfa9f7b">GrTextureStage::EFM_BILINEAR</a>    );
<a name="l01374"></a>01374         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688b1b35286c474a867806a21cea61952b5">ES_BUMP</a>         ].<a class="code" href="class_gr_texture_stage.html#1803888bbf5d820f060465bd63bf88bd">SetTexColorMod</a>(       <a class="code" href="_gr_parse_8h.html#4604e121d0ed177271162a1190ab10de">GR_PARSE_BUMP_MOD_DEF</a>                   );
<a name="l01375"></a>01375         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688b1b35286c474a867806a21cea61952b5">ES_BUMP</a>         ].<a class="code" href="class_gr_texture_stage.html#6dc007a985aac8227b9e445829d42756">SetTexColorAdd</a>(       <a class="code" href="_gr_parse_8h.html#7de9f57b571ba22c829f54c82493edb6">GR_PARSE_BUMP_ADD_DEF</a>                   );
<a name="l01376"></a>01376         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688293de1727613be2259dad1827bcfa0d0">ES_NORMAL</a>       ].<a class="code" href="class_gr_texture_stage.html#f2d25544ef1026d7f705074db5c88902">SetFilterMode</a>(        <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f048501ac6f236392708f83174094dfa9f7b">GrTextureStage::EFM_BILINEAR</a>    );
<a name="l01377"></a>01377         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606884a3d034db25df349c89094e48978258d">ES_DIFFUSE</a>      ].<a class="code" href="class_gr_texture_stage.html#f2d25544ef1026d7f705074db5c88902">SetFilterMode</a>(        <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f048501ac6f236392708f83174094dfa9f7b">GrTextureStage::EFM_BILINEAR</a>    );
<a name="l01378"></a>01378         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606884a3d034db25df349c89094e48978258d">ES_DIFFUSE</a>      ].<a class="code" href="class_gr_texture_stage.html#1803888bbf5d820f060465bd63bf88bd">SetTexColorMod</a>(       <a class="code" href="_gr_parse_8h.html#94e850a18df7cfb7665986119a8c469b">GR_PARSE_DIFFUSE_MOD_DEF</a>                );
<a name="l01379"></a>01379         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606884a3d034db25df349c89094e48978258d">ES_DIFFUSE</a>      ].<a class="code" href="class_gr_texture_stage.html#6dc007a985aac8227b9e445829d42756">SetTexColorAdd</a>(       <a class="code" href="_gr_parse_8h.html#dc5274853a84bd9b4d183c2f940a554a">GR_PARSE_DIFFUSE_ADD_DEF</a>                );
<a name="l01380"></a>01380         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606885c089af9c447c3ea195ed80458a1a49e">ES_SPECULAR</a>     ].<a class="code" href="class_gr_texture_stage.html#f2d25544ef1026d7f705074db5c88902">SetFilterMode</a>(        <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f048501ac6f236392708f83174094dfa9f7b">GrTextureStage::EFM_BILINEAR</a>    );
<a name="l01381"></a>01381         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606885c089af9c447c3ea195ed80458a1a49e">ES_SPECULAR</a>     ].<a class="code" href="class_gr_texture_stage.html#1803888bbf5d820f060465bd63bf88bd">SetTexColorMod</a>(       <a class="code" href="_gr_parse_8h.html#c37cfa9afb79d6e43effffa0616913bb">GR_PARSE_SPECULAR_MOD_DEF</a>               );
<a name="l01382"></a>01382         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606885c089af9c447c3ea195ed80458a1a49e">ES_SPECULAR</a>     ].<a class="code" href="class_gr_texture_stage.html#6dc007a985aac8227b9e445829d42756">SetTexColorAdd</a>(       <a class="code" href="_gr_parse_8h.html#3616728c5c82cfc45485749cefabf932">GR_PARSE_SPECULAR_ADD_DEF</a>               );
<a name="l01383"></a>01383 
<a name="l01385"></a>01385         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688b1b35286c474a867806a21cea61952b5">ES_BUMP</a>         ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( gray );
<a name="l01386"></a>01386         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688293de1727613be2259dad1827bcfa0d0">ES_NORMAL</a>       ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( normal );
<a name="l01387"></a>01387         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606884a3d034db25df349c89094e48978258d">ES_DIFFUSE</a>      ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( white );
<a name="l01388"></a>01388         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606885c089af9c447c3ea195ed80458a1a49e">ES_SPECULAR</a> ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( black );
<a name="l01389"></a>01389         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f96816068812f1980d8a826e26b4418064956f0d97">ES_EMISSIVE</a> ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( black );
<a name="l01390"></a>01390         stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688d0fafee9d454a53ad1398707987e5c8e">ES_AMBIENT</a>      ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( white );
<a name="l01391"></a>01391 
<a name="l01392"></a>01392         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l01393"></a>01393         {
<a name="l01394"></a>01394                 errors = <span class="stringliteral">"Missing opening brace!"</span>;
<a name="l01395"></a>01395                 <span class="keywordflow">return</span> 0;
<a name="l01396"></a>01396         }
<a name="l01397"></a>01397         ++curTok;
<a name="l01398"></a>01398 
<a name="l01399"></a>01399         <span class="keywordflow">while</span> ( !IsTok( curTok, <span class="stringliteral">"}"</span> ) )
<a name="l01400"></a>01400         {
<a name="l01402"></a>01402                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"noreceiveshadow"</span> ) )
<a name="l01403"></a>01403                         matPass.<a class="code" href="struct_s_material_pass_info.html#47b874b3efb05afc0ccbecc01ebf62bc" title="various flags.">receiveShadow</a> = <span class="keyword">false</span>;
<a name="l01404"></a>01404                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"nocastshadow"</span> ) )
<a name="l01405"></a>01405                         matPass.<a class="code" href="struct_s_material_pass_info.html#148b9b02c76e38c6be30dc599ad35dad">castShadow</a> = <span class="keyword">false</span>;
<a name="l01406"></a>01406                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"alphatest"</span> ) )
<a name="l01407"></a>01407                         matPass.<a class="code" href="struct_s_material_pass_info.html#b4f60776995332748e40270d6c2dc318" title="states.">enableState</a> |= <a class="code" href="_gr_util_8h.html#20b24dfbb3798202873d51b43f75082d">GR_ALPHATEST</a>;
<a name="l01408"></a>01408                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"depthbias"</span> ) )
<a name="l01409"></a>01409                         matPass.<a class="code" href="struct_s_material_pass_info.html#b4f60776995332748e40270d6c2dc318" title="states.">enableState</a> |= <a class="code" href="_gr_util_8h.html#54096622979773e2eb626dbf956e7145">GR_DEPTHBIAS</a>;
<a name="l01410"></a>01410                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"nodepthtest"</span> ) )
<a name="l01411"></a>01411                         matPass.<a class="code" href="struct_s_material_pass_info.html#b4f60776995332748e40270d6c2dc318" title="states.">enableState</a> &amp;= ~<a class="code" href="_gr_util_8h.html#df38fed29d4a8214bf4a51a0df0a7512" title="render states.">GR_DEPTHTEST</a>;
<a name="l01412"></a>01412                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"nocull"</span> ) )
<a name="l01413"></a>01413                         matPass.<a class="code" href="struct_s_material_pass_info.html#b4f60776995332748e40270d6c2dc318" title="states.">enableState</a> &amp;= ~<a class="code" href="_gr_util_8h.html#43f8fbc0073e1858f6bba0a73acfe8a6">GR_CULLFACE</a>;
<a name="l01414"></a>01414                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"nodepthwrite"</span> ) )
<a name="l01415"></a>01415                         matPass.<a class="code" href="struct_s_material_pass_info.html#06ba69d3100e1ce0a27d8da74c1f342d">writeMask</a> &amp;= ~<a class="code" href="_gr_util_8h.html#263ecb0b6dc90d2aca7b9291d81a7024">GR_DEPTH</a>;
<a name="l01417"></a>01417                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"ambientsrcblend"</span> ) )
<a name="l01418"></a>01418                 {
<a name="l01420"></a>01420                         <span class="keywordflow">if</span> ( !ParseBlendFactor( matPass.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#fb1134ab25291932ab686cf72156a571" title="states specific to various passes.">srcColorBlendFactor</a>, ++curTok, errors ) )
<a name="l01421"></a>01421                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01422"></a>01422                         <span class="keywordflow">continue</span>;
<a name="l01423"></a>01423                 }
<a name="l01424"></a>01424                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"ambientdstblend"</span> ) )
<a name="l01425"></a>01425                 {
<a name="l01427"></a>01427                         <span class="keywordflow">if</span> ( !ParseBlendFactor( matPass.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#5e75b2942d23722d7886bccc5612d1b6">dstColorBlendFactor</a>, ++curTok, errors ) )
<a name="l01428"></a>01428                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01429"></a>01429                         <span class="keywordflow">continue</span>;
<a name="l01430"></a>01430                 }
<a name="l01431"></a>01431                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"ambientsrcblendalpha"</span> ) )
<a name="l01432"></a>01432                 {
<a name="l01434"></a>01434                         <span class="keywordflow">if</span> ( !ParseBlendFactor( matPass.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#26219f41c410a0c020e84c2a7bc32eab">srcAlphaBlendFactor</a>, ++curTok, errors ) )
<a name="l01435"></a>01435                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01436"></a>01436                         <span class="keywordflow">continue</span>;
<a name="l01437"></a>01437                 }
<a name="l01438"></a>01438                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"ambientdstblendalpha"</span> ) )
<a name="l01439"></a>01439                 {
<a name="l01441"></a>01441                         <span class="keywordflow">if</span> ( !ParseBlendFactor( matPass.<a class="code" href="struct_s_material_pass_info.html#855f746e614b3eb8146603d2efe46663" title="GL enums.">ambBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#8c63ffc9017a3e850dbba2ecf9d55636">dstAlphaBlendFactor</a>, ++curTok, errors ) )
<a name="l01442"></a>01442                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01443"></a>01443                         <span class="keywordflow">continue</span>;
<a name="l01444"></a>01444                 }
<a name="l01446"></a>01446                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"lightsrcblend"</span> ) )
<a name="l01447"></a>01447                 {
<a name="l01449"></a>01449                         <span class="keywordflow">if</span> ( !ParseBlendFactor( matPass.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#fb1134ab25291932ab686cf72156a571" title="states specific to various passes.">srcColorBlendFactor</a>, ++curTok, errors ) )
<a name="l01450"></a>01450                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01451"></a>01451                         <span class="keywordflow">continue</span>;
<a name="l01452"></a>01452                 }
<a name="l01453"></a>01453                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"lightdstblend"</span> ) )
<a name="l01454"></a>01454                 {
<a name="l01456"></a>01456                         <span class="keywordflow">if</span> ( !ParseBlendFactor( matPass.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#5e75b2942d23722d7886bccc5612d1b6">dstColorBlendFactor</a>, ++curTok, errors ) )
<a name="l01457"></a>01457                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01458"></a>01458                         <span class="keywordflow">continue</span>;
<a name="l01459"></a>01459                 }
<a name="l01460"></a>01460                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"lightsrcblendalpha"</span> ) )
<a name="l01461"></a>01461                 {
<a name="l01463"></a>01463                         <span class="keywordflow">if</span> ( !ParseBlendFactor( matPass.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#26219f41c410a0c020e84c2a7bc32eab">srcAlphaBlendFactor</a>, ++curTok, errors ) )
<a name="l01464"></a>01464                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01465"></a>01465                         <span class="keywordflow">continue</span>;
<a name="l01466"></a>01466                 }
<a name="l01467"></a>01467                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"lightdstblendalpha"</span> ) )
<a name="l01468"></a>01468                 {
<a name="l01470"></a>01470                         <span class="keywordflow">if</span> ( !ParseBlendFactor( matPass.<a class="code" href="struct_s_material_pass_info.html#1bb1369eafd762e7b2adc9b456fae885">lightBlendStates</a>.<a class="code" href="struct_s_material_pass_blend_states.html#8c63ffc9017a3e850dbba2ecf9d55636">dstAlphaBlendFactor</a>, ++curTok, errors ) )
<a name="l01471"></a>01471                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01472"></a>01472                         <span class="keywordflow">continue</span>;
<a name="l01473"></a>01473                 }
<a name="l01474"></a>01474                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"cull"</span> ) )
<a name="l01475"></a>01475                 {
<a name="l01476"></a>01476                         ++curTok;
<a name="l01477"></a>01477                         <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"front"</span> ) )
<a name="l01478"></a>01478                                 matPass.<a class="code" href="struct_s_material_pass_info.html#1c5a2ded6a57901feed193d620db014e" title="culling mode.">cullMode</a> = <a class="code" href="_gr_util_8h.html#ea790ef067767354691d0d60c51542fe13bc00176eb32b77f64dcdf85484a663">ECM_FRONT</a>;
<a name="l01479"></a>01479                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"back"</span> ) )
<a name="l01480"></a>01480                                 matPass.<a class="code" href="struct_s_material_pass_info.html#1c5a2ded6a57901feed193d620db014e" title="culling mode.">cullMode</a> = <a class="code" href="_gr_util_8h.html#ea790ef067767354691d0d60c51542fe5fb45ade8a2def0e22899c5f34497da4">ECM_BACK</a>;
<a name="l01481"></a>01481                         <span class="keywordflow">else</span>
<a name="l01482"></a>01482                         {
<a name="l01483"></a>01483                                 errors = <span class="stringliteral">"Invalid cull face specified."</span>;
<a name="l01484"></a>01484                                 <span class="keywordflow">return</span> 0;
<a name="l01485"></a>01485                         }
<a name="l01486"></a>01486                 }
<a name="l01487"></a>01487                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"alphatestref"</span> ) )
<a name="l01488"></a>01488                 {
<a name="l01489"></a>01489                         ++curTok;
<a name="l01492"></a>01492                         <span class="keywordflow">if</span> ( !<a class="code" href="_bsc_expr_lib_8cpp.html#76e0394cb2c80623f6b74099001f7b03" title="expression parser">BscIsExpr</a>( curTok, arrayTable, varTable ) )
<a name="l01493"></a>01493                         {
<a name="l01494"></a>01494                                 errors = <span class="stringliteral">"Expected expression for AlphaTestRef."</span>;
<a name="l01495"></a>01495                                 <span class="keywordflow">return</span> 0;
<a name="l01496"></a>01496                         }
<a name="l01497"></a>01497                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr;
<a name="l01498"></a>01498                         curTok += <a class="code" href="_bsc_expr_lib_8cpp.html#50274692a7d2e36f3df9b8e6d330f0dc">BscParseExpr</a>( &amp;expr, curTok, arrayTable, varTable );
<a name="l01499"></a>01499                         matPass.<a class="code" href="struct_s_material_pass_info.html#9209733df2e6a655d595dfc1d810b28f">alphaTestRef</a> = expr;
<a name="l01500"></a>01500                         <span class="keywordflow">continue</span>;
<a name="l01501"></a>01501                 }
<a name="l01502"></a>01502                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"slopeDepthBias"</span> ) )
<a name="l01503"></a>01503                 {
<a name="l01504"></a>01504                         ++curTok;
<a name="l01507"></a>01507                         <span class="keywordflow">if</span> ( !<a class="code" href="_bsc_expr_lib_8cpp.html#76e0394cb2c80623f6b74099001f7b03" title="expression parser">BscIsExpr</a>( curTok, arrayTable, varTable ) )
<a name="l01508"></a>01508                         {
<a name="l01509"></a>01509                                 errors = <span class="stringliteral">"Expected expression for SlopeDepthBias."</span>;
<a name="l01510"></a>01510                                 <span class="keywordflow">return</span> 0;
<a name="l01511"></a>01511                         }
<a name="l01512"></a>01512                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr;
<a name="l01513"></a>01513                         curTok += <a class="code" href="_bsc_expr_lib_8cpp.html#50274692a7d2e36f3df9b8e6d330f0dc">BscParseExpr</a>( &amp;expr, curTok, arrayTable, varTable );
<a name="l01514"></a>01514                         matPass.<a class="code" href="struct_s_material_pass_info.html#43b0b16486a5a825210158b5c55db342" title="depth bias.">slopeBias</a> = expr-&gt;GetValue();
<a name="l01515"></a>01515                         <span class="keywordflow">continue</span>;
<a name="l01516"></a>01516                 }
<a name="l01517"></a>01517                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"constDepthBias"</span> ) )
<a name="l01518"></a>01518                 {
<a name="l01519"></a>01519                         ++curTok;
<a name="l01522"></a>01522                         <span class="keywordflow">if</span> ( !<a class="code" href="_bsc_expr_lib_8cpp.html#76e0394cb2c80623f6b74099001f7b03" title="expression parser">BscIsExpr</a>( curTok, arrayTable, varTable ) )
<a name="l01523"></a>01523                         {
<a name="l01524"></a>01524                                 errors = <span class="stringliteral">"Expected expression for ConstDepthBias."</span>;
<a name="l01525"></a>01525                                 <span class="keywordflow">return</span> 0;
<a name="l01526"></a>01526                         }
<a name="l01527"></a>01527                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr;
<a name="l01528"></a>01528                         curTok += <a class="code" href="_bsc_expr_lib_8cpp.html#50274692a7d2e36f3df9b8e6d330f0dc">BscParseExpr</a>( &amp;expr, curTok, arrayTable, varTable );
<a name="l01529"></a>01529                         matPass.<a class="code" href="struct_s_material_pass_info.html#e2071f6643a25e1f3866adb9b33c5079">constBias</a> = expr-&gt;GetValue();
<a name="l01530"></a>01530                         <span class="keywordflow">continue</span>;
<a name="l01531"></a>01531                 }
<a name="l01532"></a>01532                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"passenable"</span> ) )
<a name="l01533"></a>01533                 {
<a name="l01534"></a>01534                         ++curTok;
<a name="l01537"></a>01537                         <span class="keywordflow">if</span> ( !<a class="code" href="_bsc_expr_lib_8cpp.html#76e0394cb2c80623f6b74099001f7b03" title="expression parser">BscIsExpr</a>( curTok, arrayTable, varTable ) )
<a name="l01538"></a>01538                         {
<a name="l01539"></a>01539                                 errors = <span class="stringliteral">"Expected expression for PassEnable."</span>;
<a name="l01540"></a>01540                                 <span class="keywordflow">return</span> 0;
<a name="l01541"></a>01541                         }
<a name="l01542"></a>01542                         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr;
<a name="l01543"></a>01543                         curTok += <a class="code" href="_bsc_expr_lib_8cpp.html#50274692a7d2e36f3df9b8e6d330f0dc">BscParseExpr</a>( &amp;expr, curTok, arrayTable, varTable );
<a name="l01544"></a>01544                         matPass.<a class="code" href="struct_s_material_pass_info.html#47066b32f4d65c956ec8789a7ec14fb2" title="pass enable.">passEnable</a> = expr;
<a name="l01545"></a>01545                         <span class="keywordflow">continue</span>;
<a name="l01546"></a>01546                 }
<a name="l01547"></a>01547                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"vertexColorMod"</span> ) )
<a name="l01548"></a>01548                 {
<a name="l01549"></a>01549                         ++curTok;
<a name="l01550"></a>01550                         <span class="keywordflow">if</span> ( !ParseColor( matPass.<a class="code" href="struct_s_material_pass_info.html#a129865ee753ac3056cd69490330f782" title="vertex parameters.">vertexColorMod</a>, curTok, arrayTable, varTable, errors ) )
<a name="l01551"></a>01551                                 <span class="keywordflow">return</span> 0;
<a name="l01552"></a>01552                         <span class="keywordflow">continue</span>;
<a name="l01553"></a>01553                 }
<a name="l01554"></a>01554                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"vertexColorAdd"</span> ) )
<a name="l01555"></a>01555                 {
<a name="l01556"></a>01556                         ++curTok;
<a name="l01557"></a>01557                         <span class="keywordflow">if</span> ( !ParseColor( matPass.<a class="code" href="struct_s_material_pass_info.html#8d6e08ed3afd1c51ea0320bd485dadf5">vertexColorAdd</a>, curTok, arrayTable, varTable, errors ) )
<a name="l01558"></a>01558                                 <span class="keywordflow">return</span> 0;
<a name="l01559"></a>01559                         <span class="keywordflow">continue</span>;
<a name="l01560"></a>01560                 }
<a name="l01561"></a>01561                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"minLightResponse"</span> ) )
<a name="l01562"></a>01562                 {
<a name="l01563"></a>01563                         ++curTok;
<a name="l01564"></a>01564                         <span class="keywordflow">if</span> ( !ParseColor( matPass.<a class="code" href="struct_s_material_pass_info.html#ac97ff420977ef457316e478e8827cda" title="light response range.">minLightResponse</a>, curTok, arrayTable, varTable, errors ) )
<a name="l01565"></a>01565                                 <span class="keywordflow">return</span> 0;
<a name="l01566"></a>01566                         <span class="keywordflow">continue</span>;
<a name="l01567"></a>01567                 }
<a name="l01568"></a>01568                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"maxLightResponse"</span> ) )
<a name="l01569"></a>01569                 {
<a name="l01570"></a>01570                         ++curTok;
<a name="l01571"></a>01571                         <span class="keywordflow">if</span> ( !ParseColor( matPass.<a class="code" href="struct_s_material_pass_info.html#5ee16644b6f677c6eae42bf410a43dfd">maxLightResponse</a>, curTok, arrayTable, varTable, errors ) )
<a name="l01572"></a>01572                                 <span class="keywordflow">return</span> 0;
<a name="l01573"></a>01573                         <span class="keywordflow">continue</span>;
<a name="l01574"></a>01574                 }
<a name="l01575"></a>01575                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"shader"</span> ) )
<a name="l01576"></a>01576                 {
<a name="l01577"></a>01577                         ++curTok;
<a name="l01578"></a>01578 
<a name="l01580"></a>01580                         matPass.<a class="code" href="struct_s_material_pass_info.html#88f257e5b6e6b9e21392219be74df05c" title="primary shader for the pass.">shader</a> = <a class="code" href="_gr_shader_mgr_8cpp.html#72561a5bdde97bf632da40c53beaf8e9" title="Purpose: To manage OpenGL vertex/fragment programs.">gGrShaderMgr</a>-&gt;<a class="code" href="class_gr_shader_mgr.html#808c8e1152500a452398977b1b1ff650" title="public methods">GetShader</a>( curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a> );
<a name="l01581"></a>01581                         <span class="keywordflow">if</span> ( matPass.<a class="code" href="struct_s_material_pass_info.html#88f257e5b6e6b9e21392219be74df05c" title="primary shader for the pass.">shader</a> == 0 )
<a name="l01582"></a>01582                         {
<a name="l01583"></a>01583                                 errors = <span class="stringliteral">"Unable to find shader specified!"</span>;
<a name="l01584"></a>01584                                 <span class="keywordflow">return</span> 0;
<a name="l01585"></a>01585                         }
<a name="l01586"></a>01586                 }
<a name="l01587"></a>01587                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"ambientshader"</span> ) )
<a name="l01588"></a>01588                 {
<a name="l01589"></a>01589                         ++curTok;
<a name="l01590"></a>01590 
<a name="l01592"></a>01592                         matPass.<a class="code" href="struct_s_material_pass_info.html#b355f2664fb9a12aaf019c80a5b54a03">ambientShader</a> = <a class="code" href="_gr_shader_mgr_8cpp.html#72561a5bdde97bf632da40c53beaf8e9" title="Purpose: To manage OpenGL vertex/fragment programs.">gGrShaderMgr</a>-&gt;<a class="code" href="class_gr_shader_mgr.html#808c8e1152500a452398977b1b1ff650" title="public methods">GetShader</a>( curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a> );
<a name="l01593"></a>01593                         <span class="keywordflow">if</span> ( matPass.<a class="code" href="struct_s_material_pass_info.html#b355f2664fb9a12aaf019c80a5b54a03">ambientShader</a> == 0 )
<a name="l01594"></a>01594                         {
<a name="l01595"></a>01595                                 errors = <span class="stringliteral">"Unable to find shader specified!"</span>;
<a name="l01596"></a>01596                                 <span class="keywordflow">return</span> 0;
<a name="l01597"></a>01597                         }
<a name="l01598"></a>01598                 }
<a name="l01600"></a>01600                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"bumpmap"</span> ) )
<a name="l01601"></a>01601                 {
<a name="l01602"></a>01602                         ++curTok;
<a name="l01603"></a>01603                         <span class="keywordflow">if</span> ( ParseGenTextureFlags( stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688b1b35286c474a867806a21cea61952b5">ES_BUMP</a> ], curTok ) )
<a name="l01604"></a>01604                                 <span class="keywordflow">continue</span>;
<a name="l01605"></a>01605 
<a name="l01606"></a>01606                         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> bumpMap = ParseTextureRef( curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c53ac3129a7a6b0fffa12a2f590c7175f">GrTextureBase::EF_I8</a>, errors );
<a name="l01607"></a>01607                         <span class="keywordflow">if</span> ( bumpMap != 0 )
<a name="l01608"></a>01608                                 stages[ ES_BUMP ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( bumpMap );
<a name="l01609"></a>01609                         <span class="keywordflow">continue</span>;
<a name="l01610"></a>01610                 }
<a name="l01611"></a>01611                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"bump"</span> ) )
<a name="l01612"></a>01612                 {
<a name="l01613"></a>01613                         ++curTok;
<a name="l01614"></a>01614                         ParseTextureStage( stages[ ES_BUMP ], curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c53ac3129a7a6b0fffa12a2f590c7175f">GrTextureBase::EF_I8</a>, arrayTable, varTable, errors );
<a name="l01615"></a>01615                         <span class="keywordflow">continue</span>;
<a name="l01616"></a>01616                 }
<a name="l01617"></a>01617                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"normalmap"</span> ) )
<a name="l01618"></a>01618                 {
<a name="l01619"></a>01619                         ++curTok;
<a name="l01620"></a>01620                         <span class="keywordflow">if</span> ( ParseGenTextureFlags( stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688293de1727613be2259dad1827bcfa0d0">ES_NORMAL</a> ], curTok ) )
<a name="l01621"></a>01621                                 <span class="keywordflow">continue</span>;
<a name="l01622"></a>01622 
<a name="l01623"></a>01623                         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> normalMap = ParseTextureRef( curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c1775e1ba3426990f650c54815621c86d">GrTextureBase::EF_NORMALMAP</a>, errors );
<a name="l01624"></a>01624                         <span class="keywordflow">if</span> ( normalMap != 0 )
<a name="l01625"></a>01625                                 stages[ ES_NORMAL ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( normalMap );
<a name="l01626"></a>01626                         <span class="keywordflow">continue</span>;
<a name="l01627"></a>01627                 }
<a name="l01628"></a>01628                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"normal"</span> ) )
<a name="l01629"></a>01629                 {
<a name="l01630"></a>01630                         ++curTok;
<a name="l01631"></a>01631                         ParseTextureStage( stages[ ES_NORMAL ], curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c1775e1ba3426990f650c54815621c86d">GrTextureBase::EF_NORMALMAP</a>, arrayTable, varTable, errors );
<a name="l01632"></a>01632                         <span class="keywordflow">continue</span>;
<a name="l01633"></a>01633                 }
<a name="l01634"></a>01634                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"diffusemap"</span> ) )
<a name="l01635"></a>01635                 {
<a name="l01636"></a>01636                         ++curTok;
<a name="l01637"></a>01637                         <span class="keywordflow">if</span> ( ParseGenTextureFlags( stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606884a3d034db25df349c89094e48978258d">ES_DIFFUSE</a> ], curTok ) )
<a name="l01638"></a>01638                                 <span class="keywordflow">continue</span>;
<a name="l01639"></a>01639 
<a name="l01640"></a>01640                         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> diffuseMap = ParseTextureRef( curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c983e954e5c478c1cd15fff916318eeb7">GrTextureBase::EF_GUESS</a>, errors );
<a name="l01641"></a>01641                         <span class="keywordflow">if</span> ( diffuseMap != 0 )
<a name="l01642"></a>01642                                 stages[ ES_DIFFUSE ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( diffuseMap );
<a name="l01643"></a>01643                         <span class="keywordflow">continue</span>;
<a name="l01644"></a>01644                 }
<a name="l01645"></a>01645                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"diffuse"</span> ) )
<a name="l01646"></a>01646                 {
<a name="l01647"></a>01647                         ++curTok;
<a name="l01648"></a>01648                         ParseTextureStage( stages[ ES_DIFFUSE ], curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c983e954e5c478c1cd15fff916318eeb7">GrTextureBase::EF_GUESS</a>, arrayTable, varTable, errors );
<a name="l01649"></a>01649                         <span class="keywordflow">continue</span>;
<a name="l01650"></a>01650                 }
<a name="l01651"></a>01651                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"specularmap"</span> ) )
<a name="l01652"></a>01652                 {
<a name="l01653"></a>01653                         ++curTok;
<a name="l01654"></a>01654                         <span class="keywordflow">if</span> ( ParseGenTextureFlags( stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606885c089af9c447c3ea195ed80458a1a49e">ES_SPECULAR</a> ], curTok ) )
<a name="l01655"></a>01655                                 <span class="keywordflow">continue</span>;
<a name="l01656"></a>01656 
<a name="l01657"></a>01657                         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> specularMap = ParseTextureRef( curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c983e954e5c478c1cd15fff916318eeb7">GrTextureBase::EF_GUESS</a>, errors );
<a name="l01658"></a>01658                         <span class="keywordflow">if</span> ( specularMap != 0 )
<a name="l01659"></a>01659                                 stages[ ES_SPECULAR ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( specularMap );
<a name="l01660"></a>01660                         <span class="keywordflow">continue</span>;
<a name="l01661"></a>01661                 }
<a name="l01662"></a>01662                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"specular"</span> ) )
<a name="l01663"></a>01663                 {
<a name="l01664"></a>01664                         ++curTok;
<a name="l01665"></a>01665                         ParseTextureStage( stages[ ES_SPECULAR ], curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c983e954e5c478c1cd15fff916318eeb7">GrTextureBase::EF_GUESS</a>, arrayTable, varTable, errors );
<a name="l01666"></a>01666                         <span class="keywordflow">continue</span>;
<a name="l01667"></a>01667                 }
<a name="l01668"></a>01668                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"ambientmap"</span> ) )
<a name="l01669"></a>01669                 {
<a name="l01670"></a>01670                         ++curTok;
<a name="l01671"></a>01671                         <span class="keywordflow">if</span> ( ParseGenTextureFlags( stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688d0fafee9d454a53ad1398707987e5c8e">ES_AMBIENT</a> ], curTok ) )
<a name="l01672"></a>01672                                 <span class="keywordflow">continue</span>;
<a name="l01673"></a>01673 
<a name="l01674"></a>01674                         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> ambientMap = ParseTextureRef( curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c983e954e5c478c1cd15fff916318eeb7">GrTextureBase::EF_GUESS</a>, errors );
<a name="l01675"></a>01675                         <span class="keywordflow">if</span> ( ambientMap != 0 )
<a name="l01676"></a>01676                                 stages[ ES_AMBIENT ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( ambientMap );
<a name="l01677"></a>01677                         <span class="keywordflow">continue</span>;
<a name="l01678"></a>01678                 }
<a name="l01679"></a>01679                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"ambient"</span> ) )
<a name="l01680"></a>01680                 {
<a name="l01681"></a>01681                         ++curTok;
<a name="l01682"></a>01682                         ParseTextureStage( stages[ ES_AMBIENT ], curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c983e954e5c478c1cd15fff916318eeb7">GrTextureBase::EF_GUESS</a>, arrayTable, varTable, errors );
<a name="l01683"></a>01683                         <span class="keywordflow">continue</span>;
<a name="l01684"></a>01684                 }
<a name="l01685"></a>01685                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"emissivemap"</span> ) )
<a name="l01686"></a>01686                 {
<a name="l01687"></a>01687                         ++curTok;
<a name="l01688"></a>01688                         <span class="keywordflow">if</span> ( ParseGenTextureFlags( stages[ <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f96816068812f1980d8a826e26b4418064956f0d97">ES_EMISSIVE</a> ], curTok ) )
<a name="l01689"></a>01689                                 <span class="keywordflow">continue</span>;
<a name="l01690"></a>01690 
<a name="l01691"></a>01691                         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> emissiveMap = ParseTextureRef( curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c983e954e5c478c1cd15fff916318eeb7">GrTextureBase::EF_GUESS</a>, errors );
<a name="l01692"></a>01692                         <span class="keywordflow">if</span> ( emissiveMap != 0 )
<a name="l01693"></a>01693                                 stages[ ES_EMISSIVE ].<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( emissiveMap );
<a name="l01694"></a>01694                         <span class="keywordflow">continue</span>;
<a name="l01695"></a>01695                 }
<a name="l01696"></a>01696                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"emissive"</span> ) )
<a name="l01697"></a>01697                 {
<a name="l01698"></a>01698                         ++curTok;
<a name="l01699"></a>01699                         ParseTextureStage( stages[ ES_EMISSIVE ], curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c983e954e5c478c1cd15fff916318eeb7">GrTextureBase::EF_GUESS</a>, arrayTable, varTable, errors );
<a name="l01700"></a>01700                         <span class="keywordflow">continue</span>;
<a name="l01701"></a>01701                 }
<a name="l01703"></a>01703                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"scaleS"</span> ) )
<a name="l01704"></a>01704                 {
<a name="l01705"></a>01705                         ++curTok;
<a name="l01706"></a>01706                         sScaleExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l01707"></a>01707                         <span class="keywordflow">continue</span>;
<a name="l01708"></a>01708                 }
<a name="l01709"></a>01709                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"scaleT"</span> ) )
<a name="l01710"></a>01710                 {
<a name="l01711"></a>01711                         ++curTok;
<a name="l01712"></a>01712                         tScaleExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l01713"></a>01713                         <span class="keywordflow">continue</span>;
<a name="l01714"></a>01714                 }
<a name="l01715"></a>01715                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"translateS"</span> ) )
<a name="l01716"></a>01716                 {
<a name="l01717"></a>01717                         ++curTok;
<a name="l01718"></a>01718                         sTranslateExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l01719"></a>01719                         <span class="keywordflow">continue</span>;
<a name="l01720"></a>01720                 }
<a name="l01721"></a>01721                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"translateT"</span> ) )
<a name="l01722"></a>01722                 {
<a name="l01723"></a>01723                         ++curTok;
<a name="l01724"></a>01724                         tTranslateExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l01725"></a>01725                         <span class="keywordflow">continue</span>;
<a name="l01726"></a>01726                 }
<a name="l01727"></a>01727                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"rotate"</span> ) )
<a name="l01728"></a>01728                 {
<a name="l01729"></a>01729                         ++curTok;
<a name="l01730"></a>01730                         stRotateExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l01731"></a>01731                 }
<a name="l01733"></a>01733                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"userparam"</span> ) )
<a name="l01734"></a>01734                 {
<a name="l01735"></a>01735                         ++curTok;
<a name="l01736"></a>01736 
<a name="l01737"></a>01737                         <a class="code" href="struct_s_shader_user_param.html">SShaderUserParam</a> <a class="code" href="glext_8h.html#c7c896d55e93a6cf7ff8524005b4e7b4">param</a>;
<a name="l01738"></a>01738                         param.<a class="code" href="struct_s_shader_user_param.html#971f2d4b67996515461b50a0b5a72a39">name</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>.c_str();
<a name="l01739"></a>01739                         ++curTok;
<a name="l01740"></a>01740 
<a name="l01741"></a>01741                         <span class="keywordflow">if</span> ( !ParseVec4Expr( param.<a class="code" href="struct_s_shader_user_param.html#4a4e66ee74f4ecbe1b069d70b9c5615d">values</a>, curTok, arrayTable, varTable, errors ) )
<a name="l01742"></a>01742                                 <span class="keywordflow">return</span> 0;
<a name="l01743"></a>01743 
<a name="l01744"></a>01744                         userParams.Push( param );
<a name="l01745"></a>01745                         <span class="keywordflow">continue</span>;
<a name="l01746"></a>01746                 }
<a name="l01747"></a>01747                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"usersampler"</span> ) )
<a name="l01748"></a>01748                 {
<a name="l01749"></a>01749                         ++curTok;
<a name="l01750"></a>01750 
<a name="l01751"></a>01751                         <a class="code" href="struct_s_shader_user_sampler.html">SShaderUserSampler</a> sampler;
<a name="l01752"></a>01752                         sampler.<a class="code" href="struct_s_shader_user_sampler.html#e92b8711eca7675a2dad845221b8b242">name</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>.c_str();
<a name="l01753"></a>01753                         ++curTok;
<a name="l01754"></a>01754 
<a name="l01755"></a>01755                         ParseTextureStage( sampler.<a class="code" href="struct_s_shader_user_sampler.html#bb2d4666215f21d09a50b58044c9b4aa">stage</a>, curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c983e954e5c478c1cd15fff916318eeb7">GrTextureBase::EF_GUESS</a>, arrayTable, varTable, errors );
<a name="l01756"></a>01756 
<a name="l01757"></a>01757                         userSamplers.Push( sampler );
<a name="l01758"></a>01758                         <span class="keywordflow">continue</span>;
<a name="l01759"></a>01759                 }
<a name="l01760"></a>01760                 <span class="keywordflow">else</span>
<a name="l01761"></a>01761                 {
<a name="l01762"></a>01762                         errors = <span class="stringliteral">"Unrecognized material pass command!"</span>;
<a name="l01763"></a>01763                         <span class="keywordflow">return</span> 0;
<a name="l01764"></a>01764                 }
<a name="l01765"></a>01765 
<a name="l01767"></a>01767                 ++curTok;
<a name="l01768"></a>01768         }
<a name="l01769"></a>01769 
<a name="l01771"></a>01771         ++curTok;
<a name="l01772"></a>01772 
<a name="l01773"></a>01773         <span class="keywordflow">if</span> ( matPass.<a class="code" href="struct_s_material_pass_info.html#88f257e5b6e6b9e21392219be74df05c" title="primary shader for the pass.">shader</a> == 0 )
<a name="l01774"></a>01774                 errors = <span class="stringliteral">"Material pass does not specify a shader!"</span>;
<a name="l01775"></a>01775 
<a name="l01777"></a>01777         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f9681606880eae637bafc33d1caaebc904fda58e2b">ES_COUNT</a>; ++i )
<a name="l01778"></a>01778                 matPass.<a class="code" href="struct_s_material_pass_info.html#3696de9c4421b3ff40036e84bde3e630">textures</a>.<a class="code" href="class_gr_texture_set.html#08cc84ed0a2ec34df478d22f1176525f">SetStage</a>( ( <a class="code" href="_gr_config_8h.html#6df36e6af6bdeed00ff250f968160688" title="Purpose: To define constants that are used throughout the.">ESTAGE</a> )i, stages[ i ] );
<a name="l01779"></a>01779 
<a name="l01781"></a>01781         <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>* newPass = <span class="keyword">new</span> <a class="code" href="class_gr_material_pass.html" title="class GrMaterialPass">GrMaterialPass</a>( curPassCount, matPass );
<a name="l01782"></a>01782         newPass-&gt;<a class="code" href="class_gr_material_pass.html#3cc6f6c62fe2f2e23a24069c20e5941c">SetTextureTranslateS</a>( sTranslateExpr );
<a name="l01783"></a>01783         newPass-&gt;<a class="code" href="class_gr_material_pass.html#b53e9d97ea01a7b4de5cd8c47d14235e">SetTextureTranslateT</a>( tTranslateExpr );
<a name="l01784"></a>01784         newPass-&gt;<a class="code" href="class_gr_material_pass.html#a1a69dfaf67a8d54d6874e345398fda4">SetTextureScaleS</a>( sScaleExpr );
<a name="l01785"></a>01785         newPass-&gt;<a class="code" href="class_gr_material_pass.html#d3e27ebf2fdecfcb84127dc777b41f71">SetTextureScaleT</a>( tScaleExpr );
<a name="l01786"></a>01786         newPass-&gt;<a class="code" href="class_gr_material_pass.html#a9ad26db402f4f8e52caf3feb36b4749">SetTextureRotate</a>( stRotateExpr );
<a name="l01787"></a>01787 
<a name="l01789"></a>01789         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )( userParams.GetElemCount() ); ++i )
<a name="l01790"></a>01790                 newPass-&gt;<a class="code" href="class_gr_material_pass.html#7961e2a4d2fbd45128fa21cac4f32f30" title="user parameters">GetUserParams</a>().<a class="code" href="class_gr_material_user_params.html#dc63d586a7e83e6f113bf386f60d47d4" title="adds user parameters.">AddUserParam</a>( userParams[ i ].<a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a>.c_str(), userParams[ i ].values );
<a name="l01791"></a>01791 
<a name="l01793"></a>01793         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )( userSamplers.GetElemCount() ); ++i )
<a name="l01794"></a>01794                 newPass-&gt;<a class="code" href="class_gr_material_pass.html#7961e2a4d2fbd45128fa21cac4f32f30" title="user parameters">GetUserParams</a>().<a class="code" href="class_gr_material_user_params.html#5270ccaad9a2fb6b0a00e6bb1d4a6377" title="adds user samplers.">AddUserSampler</a>( userSamplers[ i ].<a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a>.c_str(), userSamplers[ i ].stage );
<a name="l01795"></a>01795 
<a name="l01797"></a>01797         <span class="keywordflow">return</span> newPass;
<a name="l01798"></a>01798 }
<a name="l01799"></a>01799 
<a name="l01800"></a>01800 <span class="comment">//----------------------------------------------------------</span>
<a name="l01801"></a>01801 <span class="keywordtype">bool</span>
<a name="l01802"></a>01802 ParseBlendFactor( <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec" title="render state modes">EGRBLENDMODE</a>&amp; glFactor, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l01803"></a>01803 {
<a name="l01805"></a>01805         <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"gl_one"</span> ) )
<a name="l01806"></a>01806                 glFactor = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec942b36475feda6ffc68e80e67fb1b79d">EBM_ONE</a>;
<a name="l01807"></a>01807         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"gl_zero"</span> ) )
<a name="l01808"></a>01808                 glFactor = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ecc9c0a06efec84a35b4d9586676fa3815">EBM_ZERO</a>;
<a name="l01810"></a>01810         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"gl_src_alpha"</span> ) )
<a name="l01811"></a>01811                 glFactor = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec7579af57e6c60e197bc9032372290ecd">EBM_SRC_ALPHA</a>;
<a name="l01812"></a>01812         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"gl_one_minus_src_alpha"</span> ) )
<a name="l01813"></a>01813                 glFactor = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ece3b33f0049d970c9ed05c9e86c1a4417">EBM_ONE_MINUS_SRC_ALPHA</a>;
<a name="l01814"></a>01814         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"gl_src_color"</span> ) )
<a name="l01815"></a>01815                 glFactor = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961eca950776b9b46bd7912aa0276e2050e83">EBM_SRC_COLOR</a>;
<a name="l01816"></a>01816         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"gl_one_minus_src_color"</span> ) )
<a name="l01817"></a>01817                 glFactor = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961eccd1efcb33fbd56aac98b8dd6c53ce442">EBM_ONE_MINUS_SRC_COLOR</a>;
<a name="l01819"></a>01819         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"gl_dst_alpha"</span> ) )
<a name="l01820"></a>01820                 glFactor = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec999ca5c92185b5ab96ae5b470f9f0f31">EBM_DST_ALPHA</a>;
<a name="l01821"></a>01821         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"gl_one_minus_dst_alpha"</span> ) )
<a name="l01822"></a>01822                 glFactor = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec822e58567993c569e0b515e92e3defbb">EBM_ONE_MINUS_DST_ALPHA</a>;
<a name="l01823"></a>01823         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"gl_dst_color"</span> ) )
<a name="l01824"></a>01824                 glFactor = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ec3ee6bf228d2d9a172c899f4c8dba78f5">EBM_DST_COLOR</a>;
<a name="l01825"></a>01825         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"gl_one_minus_dst_color"</span> ) )
<a name="l01826"></a>01826                 glFactor = <a class="code" href="_gr_util_8h.html#48d90fb7bec7d5ebb8c2bf20318961ecc70227a3b0b6e1f9361d25ed7e698cb3">EBM_ONE_MINUS_DST_COLOR</a>;
<a name="l01827"></a>01827         <span class="keywordflow">else</span>
<a name="l01828"></a>01828         {
<a name="l01829"></a>01829                 errors = <span class="stringliteral">"Invalid blend factor specified."</span>;
<a name="l01830"></a>01830                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01831"></a>01831         }
<a name="l01832"></a>01832 
<a name="l01834"></a>01834         ++curTok;
<a name="l01835"></a>01835         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01836"></a>01836 }
<a name="l01837"></a>01837 
<a name="l01838"></a>01838 <span class="comment">//----------------------------------------------------------</span>
<a name="l01839"></a>01839 <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a>
<a name="l01840"></a>01840 ParseImageRef( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok )
<a name="l01841"></a>01841 {
<a name="l01843"></a>01843         <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>* refTok = curTok++;
<a name="l01844"></a>01844         <span class="keywordflow">return</span> refTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l01845"></a>01845 }
<a name="l01846"></a>01846 
<a name="l01847"></a>01847 <span class="comment">//----------------------------------------------------------</span>
<a name="l01848"></a>01848 <span class="keywordtype">bool</span>
<a name="l01849"></a>01849 ParseTextureStage( <a class="code" href="class_gr_texture_stage.html" title="class GrTextureStage">GrTextureStage</a>&amp; stage, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c">GrTextureBase::EFORMAT</a> defTextureFormat,
<a name="l01850"></a>01850                                    <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l01851"></a>01851 {
<a name="l01853"></a>01853         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l01854"></a>01854         {
<a name="l01855"></a>01855                 errors = <span class="stringliteral">"Expected {"</span>;
<a name="l01856"></a>01856                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01857"></a>01857         }
<a name="l01858"></a>01858         ++curTok;
<a name="l01859"></a>01859 
<a name="l01860"></a>01860         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> <a class="code" href="glext_8h.html#8f486379aef534669f4f06f515e7ce6c">texture</a>;
<a name="l01861"></a>01861         <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f048">GrTextureStage::EFILTERMODE</a> filterMode = <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f048501ac6f236392708f83174094dfa9f7b">GrTextureStage::EFM_BILINEAR</a>;
<a name="l01862"></a>01862         <a class="code" href="class_gr_texture_stage.html#dea63364bc3369d0cf5ef74b76268d0e">GrTextureStage::EADDRESSMODE</a> addressModeS = <a class="code" href="class_gr_texture_stage.html#dea63364bc3369d0cf5ef74b76268d0e74df555bc49f7e73a5892485ae1e8cc7">GrTextureStage::EAM_REPEAT</a>;
<a name="l01863"></a>01863         <a class="code" href="class_gr_texture_stage.html#dea63364bc3369d0cf5ef74b76268d0e">GrTextureStage::EADDRESSMODE</a> addressModeT = <a class="code" href="class_gr_texture_stage.html#dea63364bc3369d0cf5ef74b76268d0e74df555bc49f7e73a5892485ae1e8cc7">GrTextureStage::EAM_REPEAT</a>;
<a name="l01864"></a>01864         <span class="keywordtype">bool</span> mipmapEnable = <span class="keyword">true</span>;
<a name="l01865"></a>01865         <span class="keywordflow">while</span> ( !IsTok( curTok, <span class="stringliteral">"}"</span> ) )
<a name="l01866"></a>01866         {
<a name="l01868"></a>01868                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"map"</span> ) )
<a name="l01869"></a>01869                 {
<a name="l01870"></a>01870                         ++curTok;
<a name="l01871"></a>01871                         <span class="keywordflow">if</span> ( ParseGenTextureFlags( stage, curTok ) )
<a name="l01872"></a>01872                                 <span class="keywordflow">continue</span>;
<a name="l01873"></a>01873 
<a name="l01875"></a>01875                         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> texture = ParseTextureRef( curTok, defTextureFormat, errors );
<a name="l01876"></a>01876                         <span class="keywordflow">if</span> ( texture != 0 )
<a name="l01877"></a>01877                                 stage.<a class="code" href="class_gr_texture_stage.html#d1c9b29aa390259ccc36d6f518502801" title="public methods">SetTexture</a>( texture );
<a name="l01878"></a>01878 
<a name="l01879"></a>01879                         <span class="keywordflow">continue</span>;
<a name="l01880"></a>01880                 }
<a name="l01881"></a>01881                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"colorMod"</span> ) )
<a name="l01882"></a>01882                 {
<a name="l01883"></a>01883                         ++curTok;
<a name="l01884"></a>01884                         <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a> <a class="code" href="glext_8h.html#3ea846f998d64f079b86052b6c4193a8">color</a>;
<a name="l01885"></a>01885                         <span class="keywordflow">if</span> ( !ParseColor( color, curTok, arrayTable, varTable, errors ) )
<a name="l01886"></a>01886                                 <span class="keywordflow">return</span> 0;
<a name="l01887"></a>01887 
<a name="l01888"></a>01888                         stage.<a class="code" href="class_gr_texture_stage.html#1803888bbf5d820f060465bd63bf88bd">SetTexColorMod</a>( color );
<a name="l01889"></a>01889                         <span class="keywordflow">continue</span>;
<a name="l01890"></a>01890                 }
<a name="l01891"></a>01891                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"colorAdd"</span> ) )
<a name="l01892"></a>01892                 {
<a name="l01893"></a>01893                         ++curTok;
<a name="l01894"></a>01894                         <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a> color;
<a name="l01895"></a>01895                         <span class="keywordflow">if</span> ( !ParseColor( color, curTok, arrayTable, varTable, errors ) )
<a name="l01896"></a>01896                                 <span class="keywordflow">return</span> 0;
<a name="l01897"></a>01897 
<a name="l01898"></a>01898                         stage.<a class="code" href="class_gr_texture_stage.html#6dc007a985aac8227b9e445829d42756">SetTexColorAdd</a>( color );
<a name="l01899"></a>01899                         <span class="keywordflow">continue</span>;
<a name="l01900"></a>01900                 }
<a name="l01901"></a>01901                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"nomipmap"</span> ) )
<a name="l01902"></a>01902                         mipmapEnable = <span class="keyword">false</span>;
<a name="l01903"></a>01903                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"mipmap"</span> ) )
<a name="l01904"></a>01904                         mipmapEnable = <span class="keyword">true</span>;
<a name="l01905"></a>01905                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"anisotropic"</span> ) )
<a name="l01906"></a>01906                         filterMode = <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f048097400c6cb008ee2154a0b369d6d8fe0">GrTextureStage::EFM_ANISOTROPIC</a>;
<a name="l01907"></a>01907                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"trilinear"</span> ) )
<a name="l01908"></a>01908                         filterMode = <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f0482208e78123e0ffc8170576e9dbf9ceb1">GrTextureStage::EFM_TRILINEAR</a>;
<a name="l01909"></a>01909                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"bilinear"</span> ) )
<a name="l01910"></a>01910                         filterMode = <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f048501ac6f236392708f83174094dfa9f7b">GrTextureStage::EFM_BILINEAR</a>;
<a name="l01911"></a>01911                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"nearest"</span> ) )
<a name="l01912"></a>01912                         filterMode = <a class="code" href="class_gr_texture_stage.html#b86144a2e97311bb975db7c2c361f048582052f16383ad9a61b663a0b8782208">GrTextureStage::EFM_NEAREST</a>;
<a name="l01914"></a>01914                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"clampS"</span> ) )
<a name="l01915"></a>01915                         addressModeS = <a class="code" href="class_gr_texture_stage.html#dea63364bc3369d0cf5ef74b76268d0e59142b13ea84cd62f7609132ada3b380">GrTextureStage::EAM_CLAMP</a>;
<a name="l01916"></a>01916                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"repeatS"</span> ) )
<a name="l01917"></a>01917                         addressModeS = <a class="code" href="class_gr_texture_stage.html#dea63364bc3369d0cf5ef74b76268d0e74df555bc49f7e73a5892485ae1e8cc7">GrTextureStage::EAM_REPEAT</a>;
<a name="l01918"></a>01918                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"clampT"</span> ) )
<a name="l01919"></a>01919                         addressModeT = <a class="code" href="class_gr_texture_stage.html#dea63364bc3369d0cf5ef74b76268d0e59142b13ea84cd62f7609132ada3b380">GrTextureStage::EAM_CLAMP</a>;
<a name="l01920"></a>01920                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"repeatT"</span> ) )
<a name="l01921"></a>01921                         addressModeT = <a class="code" href="class_gr_texture_stage.html#dea63364bc3369d0cf5ef74b76268d0e74df555bc49f7e73a5892485ae1e8cc7">GrTextureStage::EAM_REPEAT</a>;
<a name="l01922"></a>01922                 <span class="keywordflow">else</span>
<a name="l01923"></a>01923                 {
<a name="l01924"></a>01924                         errors = <span class="stringliteral">"Unrecognized expression in texture stage."</span>;
<a name="l01925"></a>01925                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01926"></a>01926                 }
<a name="l01927"></a>01927                 ++curTok;
<a name="l01928"></a>01928         }
<a name="l01929"></a>01929 
<a name="l01931"></a>01931         ++curTok;
<a name="l01932"></a>01932 
<a name="l01934"></a>01934         stage.<a class="code" href="class_gr_texture_stage.html#bd3af2826c14f1e0bb6b93e9031f4294">SetAddressMode</a>( addressModeS, addressModeT );
<a name="l01935"></a>01935         stage.<a class="code" href="class_gr_texture_stage.html#f2d25544ef1026d7f705074db5c88902">SetFilterMode</a>( filterMode );
<a name="l01936"></a>01936         stage.<a class="code" href="class_gr_texture_stage.html#ed9af9744e9097a1745e1c9efda29141">SetMipMapEnable</a>( mipmapEnable );
<a name="l01937"></a>01937 
<a name="l01939"></a>01939         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01940"></a>01940 }
<a name="l01941"></a>01941 
<a name="l01942"></a>01942 <span class="comment">//----------------------------------------------------------</span>
<a name="l01943"></a>01943 <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a>
<a name="l01944"></a>01944 ParseTextureRef( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c">GrTextureBase::EFORMAT</a> defFormat, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l01945"></a>01945 {
<a name="l01947"></a>01947         <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a> imagePath = ParseImageRef( curTok );
<a name="l01948"></a>01948 
<a name="l01950"></a>01950         <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c">GrTextureBase::EFORMAT</a> <a class="code" href="_g_l_8h.html#e2d3db041c6004a67047659b42f73a44">format</a> = defFormat;
<a name="l01951"></a>01951         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_u_t_message_8h.html#0a3c0b351ab09281b662a9ff4f900a53">flags</a> = 0;
<a name="l01952"></a>01952         <span class="keywordtype">bool</span> cache = <span class="keyword">true</span>;
<a name="l01953"></a>01953         <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"[ "</span> ) )
<a name="l01954"></a>01954         {
<a name="l01955"></a>01955                 <span class="keywordflow">if</span> ( !ParseTextureFlags( curTok, format, flags, cache, errors ) )
<a name="l01956"></a>01956                         <span class="keywordflow">return</span> 0;
<a name="l01957"></a>01957         }
<a name="l01958"></a>01958 
<a name="l01960"></a>01960         <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a> texture = <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#42a8622f0332de231fcabe925bf06b21">GetTextureFile</a>( imagePath, format, flags, <span class="keyword">false</span>, cache );
<a name="l01961"></a>01961         <span class="keywordflow">if</span> ( !texture )
<a name="l01962"></a>01962         {
<a name="l01963"></a>01963                 <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="_u_t_message_8h.html#e28c9430ba2b97dabdc5ca98ff772987">buf</a>[ 1024 ];
<a name="l01964"></a>01964                 <a class="code" href="graphics__afx_8h.html#a82dd3ff328502bcc6df2569a013e6ab" title="requires a C99 compatible preprocessor...">_snprintf_s</a>( buf, <span class="keyword">sizeof</span>( buf ), <span class="keyword">sizeof</span>( buf )-1, <span class="stringliteral">"Unable to load texture '%s'."</span>, imagePath.<a class="code" href="class_u_path.html#970648bc09145c6da1712022d84ad3b7" title="returns the path string.">GetPathString</a>().c_str() );
<a name="l01965"></a>01965                 <span class="keywordflow">return</span> 0;
<a name="l01966"></a>01966         }
<a name="l01967"></a>01967         <span class="keywordflow">return</span> texture;
<a name="l01968"></a>01968 }
<a name="l01969"></a>01969 
<a name="l01970"></a>01970 <span class="comment">//----------------------------------------------------------</span>
<a name="l01971"></a>01971 <span class="keywordtype">bool</span>
<a name="l01972"></a>01972 ParseGenTextureFlags( <a class="code" href="class_gr_texture_stage.html" title="class GrTextureStage">GrTextureStage</a>&amp; stage, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; stream )
<a name="l01973"></a>01973 {
<a name="l01975"></a>01975         <span class="keywordflow">if</span> ( IsTok( stream, <span class="stringliteral">"_reflection"</span> ) )
<a name="l01976"></a>01976         {
<a name="l01977"></a>01977                 stage.<a class="code" href="class_gr_texture_stage.html#4656b7b3dca1699a7ed25f89c57c190e">SetGenTextureFlag</a>( <a class="code" href="class_gr_texture_stage.html#1af32ceaadafc4e51e34f1e143476176">GrTextureStage::kGenReflection</a> );
<a name="l01978"></a>01978                 ++stream;
<a name="l01979"></a>01979                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01980"></a>01980         }
<a name="l01981"></a>01981         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( stream, <span class="stringliteral">"_currentDepth"</span> ) )
<a name="l01982"></a>01982         {
<a name="l01983"></a>01983                 stage.<a class="code" href="class_gr_texture_stage.html#4656b7b3dca1699a7ed25f89c57c190e">SetGenTextureFlag</a>( <a class="code" href="class_gr_texture_stage.html#9aaa704c6b85414a990ba3327e83ccf2">GrTextureStage::kGenCurDepth</a> );
<a name="l01984"></a>01984                 ++stream;
<a name="l01985"></a>01985                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01986"></a>01986         }
<a name="l01987"></a>01987         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( stream, <span class="stringliteral">"_currentRender"</span> ) )
<a name="l01988"></a>01988         {
<a name="l01989"></a>01989                 stage.<a class="code" href="class_gr_texture_stage.html#4656b7b3dca1699a7ed25f89c57c190e">SetGenTextureFlag</a>( <a class="code" href="class_gr_texture_stage.html#2e5a1af71fd34ff5f174493b3da79496">GrTextureStage::kGenCurRender</a> );
<a name="l01990"></a>01990                 ++stream;
<a name="l01991"></a>01991                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01992"></a>01992         }
<a name="l01993"></a>01993         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( stream, <span class="stringliteral">"_envCube"</span> ) )
<a name="l01994"></a>01994         {
<a name="l01995"></a>01995                 stage.<a class="code" href="class_gr_texture_stage.html#4656b7b3dca1699a7ed25f89c57c190e">SetGenTextureFlag</a>( <a class="code" href="class_gr_texture_stage.html#c8c9e946cb577f989ca9fc7a922858c8">GrTextureStage::kGenEnvCube</a> );
<a name="l01996"></a>01996                 ++stream;
<a name="l01997"></a>01997                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01998"></a>01998         }
<a name="l01999"></a>01999         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( stream, <span class="stringliteral">"_envDepthCube"</span> ) )
<a name="l02000"></a>02000         {
<a name="l02001"></a>02001                 stage.<a class="code" href="class_gr_texture_stage.html#4656b7b3dca1699a7ed25f89c57c190e">SetGenTextureFlag</a>( <a class="code" href="class_gr_texture_stage.html#ba5017eeaf633d3301825798bc63ac88">GrTextureStage::kGenEnvDepthCube</a> );
<a name="l02002"></a>02002                 ++stream;
<a name="l02003"></a>02003                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02004"></a>02004         }
<a name="l02005"></a>02005 
<a name="l02007"></a>02007         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02008"></a>02008 }
<a name="l02009"></a>02009 
<a name="l02010"></a>02010 <span class="comment">//----------------------------------------------------------</span>
<a name="l02011"></a>02011 <a class="code" href="class_u_ref.html">URef&lt; GrTextureBase &gt;</a>
<a name="l02012"></a>02012 ParseTextureCubeRef( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l02013"></a>02013 {
<a name="l02014"></a>02014         <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a> images[ 6 ];
<a name="l02015"></a>02015         images[ 0 ] = ParseImageRef( curTok );
<a name="l02016"></a>02016 
<a name="l02017"></a>02017         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1; i &lt; 6; ++i )
<a name="l02018"></a>02018         {
<a name="l02019"></a>02019                 <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">","</span> ) &amp;&amp; i != 6 )
<a name="l02020"></a>02020                 {
<a name="l02021"></a>02021                         errors = <span class="stringliteral">"Expected comma between image references."</span>;
<a name="l02022"></a>02022                         <span class="keywordflow">return</span> 0;
<a name="l02023"></a>02023                 }
<a name="l02024"></a>02024                 ++curTok;
<a name="l02025"></a>02025 
<a name="l02027"></a>02027                 images[ i ] = ParseImageRef( curTok );
<a name="l02028"></a>02028         }
<a name="l02029"></a>02029 
<a name="l02031"></a>02031         <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c">GrTextureBase::EFORMAT</a> format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c7299859c496a8865b40024d76e6edfcd" title="5:5:5:1">GrTextureBase::EF_RGBA32</a>;
<a name="l02032"></a>02032         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags = 0;
<a name="l02033"></a>02033         <span class="keywordtype">bool</span> cache = <span class="keyword">true</span>;
<a name="l02034"></a>02034         <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"[ "</span> ) )
<a name="l02035"></a>02035         {
<a name="l02036"></a>02036                 <span class="keywordflow">if</span> ( !ParseTextureFlags( curTok, format, flags, cache, errors ) )
<a name="l02037"></a>02037                         <span class="keywordflow">return</span> 0;
<a name="l02038"></a>02038         }
<a name="l02039"></a>02039 
<a name="l02040"></a>02040         <span class="keyword">const</span> <a class="code" href="class_u_path.html" title="Purpose: To provide a clean way to represent paths strings.">UPath</a>* imageNamePtrs[] = {
<a name="l02041"></a>02041                 images + 0,
<a name="l02042"></a>02042                 images + 1,
<a name="l02043"></a>02043                 images + 2,
<a name="l02044"></a>02044                 images + 3,
<a name="l02045"></a>02045                 images + 4,
<a name="l02046"></a>02046                 images + 5,
<a name="l02047"></a>02047         };
<a name="l02048"></a>02048 
<a name="l02050"></a>02050         <span class="keywordflow">return</span> <a class="code" href="_gr_texture_mgr_8cpp.html#51ad772529ca3df5a1d62836ace41d5c" title="singleton pointer.">gGrTextureMgr</a>-&gt;<a class="code" href="class_gr_texture_mgr.html#cce335f8def2910986ab5b7b2e4a02c6">GetTextureCubeFiles</a>( imageNamePtrs, format, flags, cache );
<a name="l02051"></a>02051 }
<a name="l02052"></a>02052 
<a name="l02053"></a>02053 <span class="comment">//----------------------------------------------------------</span>
<a name="l02054"></a>02054 <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a>
<a name="l02055"></a>02055 ParseExpr( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l02056"></a>02056 {
<a name="l02060"></a>02060         <span class="keywordflow">if</span> ( !<a class="code" href="_bsc_expr_lib_8cpp.html#76e0394cb2c80623f6b74099001f7b03" title="expression parser">BscIsExpr</a>( curTok, arrayTable, varTable ) )
<a name="l02061"></a>02061         {
<a name="l02062"></a>02062                 errors = <span class="stringliteral">"Error parsing expression."</span>;
<a name="l02063"></a>02063                 <span class="keywordflow">return</span> 0;
<a name="l02064"></a>02064         }
<a name="l02065"></a>02065         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> expr;
<a name="l02066"></a>02066         curTok += <a class="code" href="_bsc_expr_lib_8cpp.html#50274692a7d2e36f3df9b8e6d330f0dc">BscParseExpr</a>( &amp;expr, curTok, arrayTable, varTable );
<a name="l02067"></a>02067         <span class="keywordflow">return</span> expr;
<a name="l02068"></a>02068 }
<a name="l02069"></a>02069 
<a name="l02070"></a>02070 <span class="comment">//----------------------------------------------------------</span>
<a name="l02071"></a>02071 <span class="keywordtype">bool</span>
<a name="l02072"></a>02072 ParseInteger( <span class="keywordtype">int</span>&amp; value, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l02073"></a>02073 {
<a name="l02075"></a>02075         <span class="keywordtype">int</span> sign = 1;
<a name="l02076"></a>02076         <span class="keywordflow">if</span> ( curTok-&gt;<a class="code" href="struct_s_bsc_token.html#0c4dfdfcd3c3fcbffd6bb515b7e7a1c4" title="data members.">tokenId</a> == <a class="code" href="_bsc_lexer_8h.html#3340d30bfea194b81e0fc23ffb2b7e92">BL_MINUS</a> )
<a name="l02077"></a>02077         {
<a name="l02078"></a>02078                 sign = -1;
<a name="l02079"></a>02079                 ++curTok;
<a name="l02080"></a>02080         }
<a name="l02081"></a>02081         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( curTok-&gt;<a class="code" href="struct_s_bsc_token.html#0c4dfdfcd3c3fcbffd6bb515b7e7a1c4" title="data members.">tokenId</a> == <a class="code" href="_bsc_lexer_8h.html#50403b96509db27112c819010a9ac9a3" title="mathematical operators">BL_PLUS</a> )
<a name="l02082"></a>02082                 ++curTok;
<a name="l02083"></a>02083 
<a name="l02085"></a>02085         <span class="keywordflow">if</span> ( curTok-&gt;<a class="code" href="struct_s_bsc_token.html#0c4dfdfcd3c3fcbffd6bb515b7e7a1c4" title="data members.">tokenId</a> != <a class="code" href="_bsc_lexer_8h.html#2a97eaf485271f44145c102dad2917c0" title="literals">BL_NUMBER</a> )
<a name="l02086"></a>02086         {
<a name="l02087"></a>02087                 errors = <span class="stringliteral">"Expecting number, but found \""</span>;
<a name="l02088"></a>02088                 errors += curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l02089"></a>02089                 errors += <span class="stringliteral">"\"."</span>;
<a name="l02090"></a>02090                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02091"></a>02091         }
<a name="l02092"></a>02092 
<a name="l02094"></a>02094         value = atoi( curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>.c_str() );
<a name="l02095"></a>02095 
<a name="l02097"></a>02097         ++curTok;
<a name="l02098"></a>02098 
<a name="l02100"></a>02100         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02101"></a>02101 }
<a name="l02102"></a>02102 
<a name="l02103"></a>02103 <span class="comment">//----------------------------------------------------------</span>
<a name="l02104"></a>02104 <span class="keywordtype">bool</span>
<a name="l02105"></a>02105 ParseVec3( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; value, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l02106"></a>02106                    <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l02107"></a>02107 {
<a name="l02109"></a>02109         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> xExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l02110"></a>02110         <span class="keywordflow">if</span> ( xExpr == 0 )
<a name="l02111"></a>02111                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02112"></a>02112 
<a name="l02113"></a>02113         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">","</span> ) )
<a name="l02114"></a>02114         {
<a name="l02115"></a>02115                 errors = <span class="stringliteral">"Missing comma."</span>;
<a name="l02116"></a>02116                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02117"></a>02117         }
<a name="l02118"></a>02118         ++curTok;
<a name="l02119"></a>02119 
<a name="l02121"></a>02121         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> yExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l02122"></a>02122         <span class="keywordflow">if</span> ( yExpr == 0 )
<a name="l02123"></a>02123                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02124"></a>02124 
<a name="l02125"></a>02125         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">","</span> ) )
<a name="l02126"></a>02126         {
<a name="l02127"></a>02127                 errors = <span class="stringliteral">"Missing comma."</span>;
<a name="l02128"></a>02128                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02129"></a>02129         }
<a name="l02130"></a>02130         ++curTok;
<a name="l02131"></a>02131 
<a name="l02133"></a>02133         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> zExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l02134"></a>02134         <span class="keywordflow">if</span> ( zExpr == 0 )
<a name="l02135"></a>02135                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02136"></a>02136 
<a name="l02138"></a>02138         value.<a class="code" href="class_m_vec3.html#7ab6073bcf8afbcf630ad8f2ae8992b8">SetX</a>( xExpr-&gt;GetValue() );
<a name="l02139"></a>02139         value.<a class="code" href="class_m_vec3.html#128947a1f8cbc74a87b3b66454dfbb86">SetY</a>( yExpr-&gt;GetValue() );
<a name="l02140"></a>02140         value.<a class="code" href="class_m_vec3.html#bf45cf723890eedc23d0aa9eaf4a578a">SetZ</a>( zExpr-&gt;GetValue() );
<a name="l02141"></a>02141 
<a name="l02143"></a>02143         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02144"></a>02144 }
<a name="l02145"></a>02145 
<a name="l02146"></a>02146 <span class="comment">//----------------------------------------------------------</span>
<a name="l02147"></a>02147 <span class="keywordtype">bool</span>
<a name="l02148"></a>02148 ParseColor( <a class="code" href="class_gr_color.html" title="class GrColor">GrColor</a>&amp; value, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l02149"></a>02149                     <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l02150"></a>02150 {
<a name="l02152"></a>02152         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> rExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l02153"></a>02153         <span class="keywordflow">if</span> ( rExpr == 0 )
<a name="l02154"></a>02154                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02155"></a>02155 
<a name="l02156"></a>02156         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">","</span> ) )
<a name="l02157"></a>02157         {
<a name="l02159"></a>02159                 value.<a class="code" href="class_gr_color.html#4d973c54a9d67c7d61582c1454ae52e4">SetR</a>( rExpr-&gt;GetValue() );
<a name="l02160"></a>02160                 value.<a class="code" href="class_gr_color.html#0ffcc02bd3353035230813c5f2686e77">SetG</a>( rExpr-&gt;GetValue() );
<a name="l02161"></a>02161                 value.<a class="code" href="class_gr_color.html#71409afb6c4ac6765f1b92d80e25379e">SetB</a>( rExpr-&gt;GetValue() );
<a name="l02162"></a>02162                 value.<a class="code" href="class_gr_color.html#160b009ce60dc997e554a0b82b4a238f">SetA</a>( rExpr-&gt;GetValue() );
<a name="l02163"></a>02163                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02164"></a>02164         }
<a name="l02165"></a>02165         ++curTok;
<a name="l02166"></a>02166 
<a name="l02168"></a>02168         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> gExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l02169"></a>02169         <span class="keywordflow">if</span> ( gExpr == 0 )
<a name="l02170"></a>02170                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02171"></a>02171 
<a name="l02172"></a>02172         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">","</span> ) )
<a name="l02173"></a>02173         {
<a name="l02174"></a>02174                 errors = <span class="stringliteral">"Missing comma."</span>;
<a name="l02175"></a>02175                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02176"></a>02176         }
<a name="l02177"></a>02177         ++curTok;
<a name="l02178"></a>02178 
<a name="l02180"></a>02180         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> bExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l02181"></a>02181         <span class="keywordflow">if</span> ( bExpr == 0 )
<a name="l02182"></a>02182                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02183"></a>02183 
<a name="l02184"></a>02184         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">","</span> ) )
<a name="l02185"></a>02185         {
<a name="l02186"></a>02186                 errors = <span class="stringliteral">"Missing comma."</span>;
<a name="l02187"></a>02187                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02188"></a>02188         }
<a name="l02189"></a>02189         ++curTok;
<a name="l02190"></a>02190 
<a name="l02192"></a>02192         <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a> aExpr = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l02193"></a>02193         <span class="keywordflow">if</span> ( aExpr == 0 )
<a name="l02194"></a>02194                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02195"></a>02195 
<a name="l02197"></a>02197         value.<a class="code" href="class_gr_color.html#4d973c54a9d67c7d61582c1454ae52e4">SetR</a>( rExpr-&gt;GetValue() );
<a name="l02198"></a>02198         value.<a class="code" href="class_gr_color.html#0ffcc02bd3353035230813c5f2686e77">SetG</a>( gExpr-&gt;GetValue() );
<a name="l02199"></a>02199         value.<a class="code" href="class_gr_color.html#71409afb6c4ac6765f1b92d80e25379e">SetB</a>( bExpr-&gt;GetValue() );
<a name="l02200"></a>02200         value.<a class="code" href="class_gr_color.html#160b009ce60dc997e554a0b82b4a238f">SetA</a>( aExpr-&gt;GetValue() );
<a name="l02201"></a>02201 
<a name="l02203"></a>02203         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02204"></a>02204 }
<a name="l02205"></a>02205 
<a name="l02206"></a>02206 <span class="comment">//----------------------------------------------------------</span>
<a name="l02207"></a>02207 <span class="keywordtype">bool</span>
<a name="l02208"></a>02208 ParseVec4Expr( <a class="code" href="class_u_ref.html">URef&lt; UExprTerm &gt;</a>* <a class="code" href="glext_8h.html#300a8ed5fb9490aa35713406ec0412df">values</a>, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable,
<a name="l02209"></a>02209                     <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l02210"></a>02210 {
<a name="l02212"></a>02212         values[ 0 ] = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l02213"></a>02213         <span class="keywordflow">if</span> ( values[ 0 ] == 0 )
<a name="l02214"></a>02214                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02215"></a>02215 
<a name="l02216"></a>02216         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">","</span> ) )
<a name="l02217"></a>02217         {
<a name="l02218"></a>02218                 errors = <span class="stringliteral">"Missing comma."</span>;
<a name="l02219"></a>02219                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02220"></a>02220         }
<a name="l02221"></a>02221         ++curTok;
<a name="l02222"></a>02222 
<a name="l02224"></a>02224         values[ 1 ] = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l02225"></a>02225         <span class="keywordflow">if</span> ( values[ 1 ] == 0 )
<a name="l02226"></a>02226                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02227"></a>02227 
<a name="l02228"></a>02228         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">","</span> ) )
<a name="l02229"></a>02229         {
<a name="l02230"></a>02230                 errors = <span class="stringliteral">"Missing comma."</span>;
<a name="l02231"></a>02231                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02232"></a>02232         }
<a name="l02233"></a>02233         ++curTok;
<a name="l02234"></a>02234 
<a name="l02236"></a>02236         values[ 2 ] = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l02237"></a>02237         <span class="keywordflow">if</span> ( values[ 2 ] == 0 )
<a name="l02238"></a>02238                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02239"></a>02239 
<a name="l02240"></a>02240         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">","</span> ) )
<a name="l02241"></a>02241         {
<a name="l02242"></a>02242                 errors = <span class="stringliteral">"Missing comma."</span>;
<a name="l02243"></a>02243                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02244"></a>02244         }
<a name="l02245"></a>02245         ++curTok;
<a name="l02246"></a>02246 
<a name="l02248"></a>02248         values[ 3 ] = ParseExpr( curTok, arrayTable, varTable, errors );
<a name="l02249"></a>02249         <span class="keywordflow">if</span> ( values[ 3 ] == 0 )
<a name="l02250"></a>02250                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02251"></a>02251 
<a name="l02253"></a>02253         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02254"></a>02254 }
<a name="l02255"></a>02255 
<a name="l02256"></a>02256 <span class="comment">//----------------------------------------------------------</span>
<a name="l02257"></a>02257 <span class="keywordtype">bool</span>
<a name="l02258"></a>02258 ParseTextureFlags( <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c">GrTextureBase::EFORMAT</a>&amp; format, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; flags, <span class="keywordtype">bool</span>&amp; cache, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l02259"></a>02259 {
<a name="l02260"></a>02260         cache = <span class="keyword">true</span>;
<a name="l02261"></a>02261         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"[ "</span> ) )
<a name="l02262"></a>02262         {
<a name="l02263"></a>02263                 errors = <span class="stringliteral">"Expected [ "</span>;
<a name="l02264"></a>02264                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02265"></a>02265         }
<a name="l02266"></a>02266         ++curTok;
<a name="l02267"></a>02267 
<a name="l02268"></a>02268         <span class="keywordflow">do</span>
<a name="l02269"></a>02269         {
<a name="l02271"></a>02271                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"nocompress"</span> ) )
<a name="l02272"></a>02272                         flags |= <a class="code" href="class_gr_texture_base.html#184780018f2b67996c9274798e52607e">GrTextureBase::kNoCompress</a>;
<a name="l02273"></a>02273                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"nomipmap"</span> ) )
<a name="l02274"></a>02274                         flags |= <a class="code" href="class_gr_texture_base.html#47f4a8d764ba3c8e9e353a394edfcd2c">GrTextureBase::kNoMipMap</a>;
<a name="l02275"></a>02275                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"border"</span> ) )
<a name="l02276"></a>02276                         flags |= <a class="code" href="class_gr_texture_base.html#eadfc66a46b95c9a456782906da84890">GrTextureBase::kBorder</a>;
<a name="l02277"></a>02277                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"nocache"</span> ) )
<a name="l02278"></a>02278                         cache = <span class="keyword">false</span>;
<a name="l02279"></a>02279 
<a name="l02281"></a>02281                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"normalmap"</span> ) )
<a name="l02282"></a>02282                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c1775e1ba3426990f650c54815621c86d">GrTextureBase::EF_NORMALMAP</a>;
<a name="l02283"></a>02283                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"hidefnormalmap"</span> ) )
<a name="l02284"></a>02284                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687cfb1681fdea644264aedeef91c0b7d337" title="expands at best to G=X, A=Y. assumes Z is up in TS.">GrTextureBase::EF_HIGHDEFNORMALMAP</a>;
<a name="l02285"></a>02285                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"rgb15_a1"</span> ) )
<a name="l02286"></a>02286                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c816b7060f072b80f09c85d6b4a65a2a1">GrTextureBase::EF_RGB15_A1</a>;
<a name="l02287"></a>02287                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"rgb24"</span> ) )
<a name="l02288"></a>02288                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687ca7c3890d328296e7d4585d88588ef90c">GrTextureBase::EF_RGB24</a>;
<a name="l02289"></a>02289                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"rgba32"</span> ) )
<a name="l02290"></a>02290                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c7299859c496a8865b40024d76e6edfcd" title="5:5:5:1">GrTextureBase::EF_RGBA32</a>;
<a name="l02291"></a>02291                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"rgb48f"</span> ) )
<a name="l02292"></a>02292                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687cef44a075b0bdab2381607283bfd6ec65">GrTextureBase::EF_RGB48F</a>;
<a name="l02293"></a>02293                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"rgba64f"</span> ) )
<a name="l02294"></a>02294                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c49083663a804af33ec7afe10b304b8ca">GrTextureBase::EF_RGBA64F</a>;
<a name="l02295"></a>02295                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"alpha8"</span> ) )
<a name="l02296"></a>02296                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687cde609f274dc7439abc17ccffbf8c2a95">GrTextureBase::EF_A8</a>;
<a name="l02297"></a>02297                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"l8"</span> ) )
<a name="l02298"></a>02298                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c999b259cbadcf5c6e44b479ab5050f77">GrTextureBase::EF_L8</a>;
<a name="l02299"></a>02299                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"la16"</span> ) )
<a name="l02300"></a>02300                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687ca8e8bf5ad64aa73119d52ab3535f1326">GrTextureBase::EF_LA16</a>;
<a name="l02301"></a>02301                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"la32f"</span> ) )
<a name="l02302"></a>02302                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687cd57c301520793d5844ca23a5f47f7b60">GrTextureBase::EF_LA32F</a>;
<a name="l02303"></a>02303                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"i8"</span> ) )
<a name="l02304"></a>02304                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c53ac3129a7a6b0fffa12a2f590c7175f">GrTextureBase::EF_I8</a>;
<a name="l02305"></a>02305                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"guess"</span> ) )
<a name="l02306"></a>02306                         format = <a class="code" href="class_gr_texture_base.html#82c606022e93566ba55fe4cd3beb687c983e954e5c478c1cd15fff916318eeb7">GrTextureBase::EF_GUESS</a>;
<a name="l02307"></a>02307                 <span class="keywordflow">else</span>
<a name="l02308"></a>02308                 {
<a name="l02309"></a>02309                         errors = <span class="stringliteral">"Unrecognized texture flag."</span>;
<a name="l02310"></a>02310                         <span class="keywordflow">return</span> 0;
<a name="l02311"></a>02311                 }
<a name="l02312"></a>02312                 ++curTok;
<a name="l02313"></a>02313 
<a name="l02315"></a>02315                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">","</span> ) )
<a name="l02316"></a>02316                         ++curTok;
<a name="l02317"></a>02317                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">" ]"</span> ) )
<a name="l02318"></a>02318                 {
<a name="l02320"></a>02320                         ++curTok;
<a name="l02321"></a>02321                         <span class="keywordflow">break</span>;
<a name="l02322"></a>02322                 }
<a name="l02323"></a>02323                 <span class="keywordflow">else</span>
<a name="l02324"></a>02324                 {
<a name="l02325"></a>02325                         errors = <span class="stringliteral">"Expected comma or closing square brace."</span>;
<a name="l02326"></a>02326                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02327"></a>02327                 }
<a name="l02328"></a>02328         }
<a name="l02329"></a>02329         <span class="keywordflow">while</span>( <span class="keyword">true</span> );
<a name="l02330"></a>02330 
<a name="l02332"></a>02332         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02333"></a>02333 }
<a name="l02334"></a>02334 
<a name="l02335"></a>02335 <span class="comment">//----------------------------------------------------------</span>
<a name="l02336"></a>02336 <span class="keywordtype">bool</span>
<a name="l02337"></a>02337 ParseTerrain( <a class="code" href="struct_s_terrain_info.html">STerrainInfo</a>&amp; info, <span class="keyword">const</span> <a class="code" href="struct_s_bsc_token.html">SBscToken</a>*&amp; curTok, <span class="keyword">const</span> <a class="code" href="class_bsc_array_table.html" title="class BscArrayTable">BscArrayTable</a>&amp; arrayTable, <span class="keyword">const</span> <a class="code" href="class_bsc_var_table.html" title="class BscArrayTable">BscVarTable</a>&amp; varTable, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; errors )
<a name="l02338"></a>02338 {
<a name="l02340"></a>02340         info.<a class="code" href="struct_s_terrain_info.html#a372741e19a5bb43394c1fe36e0c55f8">instanceName</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l02341"></a>02341         ++curTok;
<a name="l02342"></a>02342 
<a name="l02345"></a>02345         <span class="keywordflow">if</span> ( !IsTok( curTok, <span class="stringliteral">"{"</span> ) )
<a name="l02346"></a>02346         {
<a name="l02347"></a>02347                 errors = <span class="stringliteral">"Missing opening brace!"</span>;
<a name="l02348"></a>02348                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02349"></a>02349         }
<a name="l02350"></a>02350         ++curTok;
<a name="l02351"></a>02351 
<a name="l02353"></a>02353         <span class="keywordflow">while</span> ( !IsTok( curTok, <span class="stringliteral">"}"</span> ) )
<a name="l02354"></a>02354         {
<a name="l02355"></a>02355                 <span class="keywordflow">if</span> ( IsTok( curTok, <span class="stringliteral">"path"</span> ) )
<a name="l02356"></a>02356                 {
<a name="l02358"></a>02358                         ++curTok;
<a name="l02359"></a>02359 
<a name="l02361"></a>02361                         info.<a class="code" href="struct_s_terrain_info.html#9486e3c92a348c875916be85672b06f2">path</a> = curTok-&gt;<a class="code" href="struct_s_bsc_token.html#cecfc1abee39ac469aeda97016d2e5fe" title="UL_nnn.">text</a>;
<a name="l02362"></a>02362                         ++curTok;
<a name="l02363"></a>02363                 }
<a name="l02364"></a>02364                 <span class="keywordflow">else</span>
<a name="l02365"></a>02365                 {
<a name="l02366"></a>02366                         errors = <span class="stringliteral">"Unrecognized expression in terrain declaration."</span>;
<a name="l02367"></a>02367                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02368"></a>02368                 }
<a name="l02369"></a>02369         }
<a name="l02370"></a>02370 
<a name="l02372"></a>02372         ++curTok;
<a name="l02373"></a>02373 
<a name="l02375"></a>02375         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02376"></a>02376 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Feb 13 17:19:56 2009 for Bootstrap Engine by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
