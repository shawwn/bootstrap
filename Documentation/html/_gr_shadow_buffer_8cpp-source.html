<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Bootstrap Engine: C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrShadowBuffer.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrShadowBuffer.cpp</h1><a href="_gr_shadow_buffer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//----------------------------------------------------------</span>
<a name="l00006"></a>00006 <span class="comment"></span><span class="comment">//----------------------------------------------------------</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="graphics__afx_8h.html">graphics_afx.h</a>"</span>
<a name="l00008"></a>00008 
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="_gr_shadow_buffer_8h.html">GrShadowBuffer.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="_gr_render_target_mgr_8h.html">GrRenderTargetMgr.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="_gr_render_target_8h.html">GrRenderTarget.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="_gr_renderbuffer_8h.html">GrRenderbuffer.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="_gr_texture_8h.html">GrTexture.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="_g_l_subsys_8h.html">GLSubsys.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="_gr_util_8h.html">GrUtil.h</a>"</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment">//**********************************************************</span>
<a name="l00023"></a>00023 <span class="comment"></span><span class="comment">//**********************************************************</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">//==========================================================</span>
<a name="l00027"></a>00027 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="comment">//----------------------------------------------------------</span>
<a name="l00030"></a><a class="code" href="class_gr_shadow_buffer.html#00945d61630372cd9e47951c07aeeef5">00030</a> <a class="code" href="class_gr_shadow_buffer.html#00945d61630372cd9e47951c07aeeef5" title="class header.">GrShadowBuffer::GrShadowBuffer</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_g_l_8h.html#e6531b1788ca42a9ae8155b0c52e7630">width</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_g_l_8h.html#b2e63df950c3789599e1e43f477bc9e3">height</a> )
<a name="l00031"></a>00031 : _prevRT( 0 )
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( <a class="code" href="common__afx_8h.html#57be1bf0723f638d0d40c91339bd6f05">IsPow2</a>( width ) &amp;&amp; width &lt;= 2048 );
<a name="l00034"></a>00034         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( <a class="code" href="common__afx_8h.html#57be1bf0723f638d0d40c91339bd6f05">IsPow2</a>( height ) &amp;&amp; height &lt;= 2048 );
<a name="l00035"></a>00035         BuildRenderTarget( width, height );
<a name="l00036"></a>00036 }
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="comment">//----------------------------------------------------------</span>
<a name="l00039"></a><a class="code" href="class_gr_shadow_buffer.html#21c7a7e89872ff5d1f3d475d4259c370">00039</a> <a class="code" href="class_gr_shadow_buffer.html#21c7a7e89872ff5d1f3d475d4259c370">GrShadowBuffer::~GrShadowBuffer</a>()
<a name="l00040"></a>00040 {
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 }
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="comment">//==========================================================</span>
<a name="l00047"></a>00047 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="comment">//----------------------------------------------------------</span>
<a name="l00050"></a>00050 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00051"></a><a class="code" href="class_gr_shadow_buffer.html#48b42cb4ab666f7b920a4bed33ce1a2d">00051</a> <a class="code" href="class_gr_shadow_buffer.html#48b42cb4ab666f7b920a4bed33ce1a2d" title="public methods">GrShadowBuffer::GetWidth</a>()<span class="keyword"> const</span>
<a name="l00052"></a>00052 <span class="keyword"></span>{
<a name="l00053"></a>00053         <span class="keywordflow">return</span> _renderTarget-&gt;GetWidth();
<a name="l00054"></a>00054 }
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="comment">//----------------------------------------------------------</span>
<a name="l00057"></a>00057 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00058"></a><a class="code" href="class_gr_shadow_buffer.html#09532b8365c6f1ac03811306fddccba5">00058</a> <a class="code" href="class_gr_shadow_buffer.html#09532b8365c6f1ac03811306fddccba5">GrShadowBuffer::GetHeight</a>()<span class="keyword"> const</span>
<a name="l00059"></a>00059 <span class="keyword"></span>{
<a name="l00060"></a>00060         <span class="keywordflow">return</span> _renderTarget-&gt;GetHeight();
<a name="l00061"></a>00061 }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">//----------------------------------------------------------</span>
<a name="l00064"></a>00064 <span class="keywordtype">void</span>
<a name="l00065"></a><a class="code" href="class_gr_shadow_buffer.html#ac80386a135c833c980497559936e98f">00065</a> <a class="code" href="class_gr_shadow_buffer.html#ac80386a135c833c980497559936e98f">GrShadowBuffer::Bind</a>()
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _prevRT == 0 );
<a name="l00068"></a>00068         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( <a class="code" href="class_gr_render_target.html#0bf3b1509691c2567d9b0f01a29f42d4" title="binds back to the primary render target.">GrRenderTarget::GetCurrentRT</a>() != _renderTarget );
<a name="l00069"></a>00069 
<a name="l00071"></a>00071         _prevRT = <a class="code" href="class_gr_render_target.html#0bf3b1509691c2567d9b0f01a29f42d4" title="binds back to the primary render target.">GrRenderTarget::GetCurrentRT</a>();
<a name="l00072"></a>00072         _renderTarget-&gt;Bind();
<a name="l00073"></a>00073         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _prevRT );
<a name="l00074"></a>00074 
<a name="l00076"></a>00076         <a class="code" href="_gr_util_8cpp.html#bafd90d401a31030835ccacc7322688e">GrDisable</a>( <a class="code" href="_gr_util_8h.html#47199898343345437f15b87b709a20e6">GR_SCISSORTEST</a> );
<a name="l00077"></a>00077         <a class="code" href="_gr_util_8cpp.html#7b33558bb79e3c6936f26553c282d081">GrSetWriteEnable</a>( <a class="code" href="_gr_util_8h.html#263ecb0b6dc90d2aca7b9291d81a7024">GR_DEPTH</a> );
<a name="l00078"></a>00078         <a class="code" href="_gr_util_8cpp.html#60654372f8080fc80b5e1ef0aea7dd99" title="Rendering functions.">GrClear</a>();
<a name="l00079"></a>00079 }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">//----------------------------------------------------------</span>
<a name="l00082"></a>00082 <a class="code" href="class_u_ref.html">URef&lt; GrTexture &gt;</a>
<a name="l00083"></a><a class="code" href="class_gr_shadow_buffer.html#248dc6ca6068c376661cb45a02205e89">00083</a> <a class="code" href="class_gr_shadow_buffer.html#248dc6ca6068c376661cb45a02205e89">GrShadowBuffer::Finish</a>()
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( <a class="code" href="class_gr_render_target.html#0bf3b1509691c2567d9b0f01a29f42d4" title="binds back to the primary render target.">GrRenderTarget::GetCurrentRT</a>() == _renderTarget );
<a name="l00086"></a>00086         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _prevRT );
<a name="l00087"></a>00087 
<a name="l00088"></a>00088         <a class="code" href="_g_l_subsys_8h.html#ab12f88c1ad74a5b4876f37fcf105bda">CHECK_GL</a>();
<a name="l00089"></a>00089 
<a name="l00090"></a>00090         <a class="code" href="class_u_ref.html">URef&lt; GrTexture &gt;</a> ret;
<a name="l00091"></a>00091         <span class="keywordflow">if</span> ( _copyDepthTex )
<a name="l00092"></a>00092         {
<a name="l00094"></a>00094                 _copyDepthTex-&gt;Bind( 0 );
<a name="l00095"></a>00095                 <a class="code" href="_g_l_subsys_8cpp.html#5da4b58b9f46390407a3d765281a044c">bglCopyTexSubImage2D</a>( <a class="code" href="_g_l_8h.html#d4de17abefa73fa2ef53379f73b734be">GL_TEXTURE_2D</a>, 0, 0, 0, 0, 0, _copyDepthTex-&gt;GetWidth(), _copyDepthTex-&gt;GetHeight() );
<a name="l00096"></a>00096                 ret = _copyDepthTex;
<a name="l00097"></a>00097                 <a class="code" href="_g_l_subsys_8h.html#ab12f88c1ad74a5b4876f37fcf105bda">CHECK_GL</a>();
<a name="l00098"></a>00098         }
<a name="l00099"></a>00099         <span class="keywordflow">else</span>
<a name="l00100"></a>00100         {
<a name="l00102"></a>00102                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _renderTarget-&gt;HasDepthTex() );
<a name="l00103"></a>00103                 ret = ( <a class="code" href="class_gr_texture.html" title="class GrTexture">GrTexture</a>* )( <a class="code" href="class_gr_texture_base.html" title="class GrTextureBase">GrTextureBase</a>* )_renderTarget-&gt;GetDepthTex();
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105 
<a name="l00107"></a>00107         _prevRT-&gt;<a class="code" href="class_gr_render_target.html#26ee9e8fef318184bbf038f4b718f746" title="binds this render target.">Bind</a>();
<a name="l00108"></a>00108         _prevRT = 0;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         <span class="keywordflow">return</span> ret;
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">//==========================================================</span>
<a name="l00116"></a>00116 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="comment">//----------------------------------------------------------</span>
<a name="l00119"></a>00119 <span class="keywordtype">void</span>
<a name="l00120"></a>00120 GrShadowBuffer::BuildRenderTarget( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_g_l_8h.html#e6531b1788ca42a9ae8155b0c52e7630">width</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_g_l_8h.html#b2e63df950c3789599e1e43f477bc9e3">height</a> )
<a name="l00121"></a>00121 {
<a name="l00123"></a>00123         <a class="code" href="class_u_ref.html">URef&lt;GrTextureBase&gt;</a> depthTex = <a class="code" href="_gr_render_target_mgr_8cpp.html#e724d8bfeb4bcd97146e35ca1646dd2f" title="class header.">gGrRenderTargetMgr</a>-&gt;<a class="code" href="class_gr_render_target_mgr.html#7e1d7957a2167cd17b678a44da653898">CreateRendertexture</a>( width, height, <a class="code" href="class_gr_render_target_mgr.html#66d0ebb49e9781283d824f19f4bbc3f6d6aefc75876632a9133c89c34a2d1d23">GrRenderTargetMgr::EF_DEPTH16</a>,
<a name="l00124"></a>00124                 <a class="code" href="class_gr_texture_base.html#47f4a8d764ba3c8e9e353a394edfcd2c">GrTextureBase::kNoMipMap</a> | <a class="code" href="class_gr_texture_base.html#184780018f2b67996c9274798e52607e">GrTextureBase::kNoCompress</a>, <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e5308d02dc086ce7c780adab8a7bb57a1bb19">GrTextureBase::ETT_2D</a> );
<a name="l00125"></a>00125         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( depthTex-&gt;GetType() == <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e5308d02dc086ce7c780adab8a7bb57a1bb19">GrTextureBase::ETT_2D</a> );
<a name="l00126"></a>00126 
<a name="l00128"></a>00128 <span class="preprocessor">#if GR_OPTION_ALPHATEST_COLOR_WRITE</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>        <a class="code" href="class_u_ref.html">URef&lt;GrTextureBase&gt;</a> colorTex = <a class="code" href="_gr_render_target_mgr_8cpp.html#e724d8bfeb4bcd97146e35ca1646dd2f" title="class header.">gGrRenderTargetMgr</a>-&gt;<a class="code" href="class_gr_render_target_mgr.html#7e1d7957a2167cd17b678a44da653898">CreateRendertexture</a>( width, height, <a class="code" href="class_gr_render_target_mgr.html#66d0ebb49e9781283d824f19f4bbc3f68daf6d100b1c33a7c1cbb6851e64dd2b" title="not supported for renderbuffers.">GrRenderTargetMgr::EF_RGBA32</a>,
<a name="l00130"></a>00130                 <a class="code" href="class_gr_texture_base.html#47f4a8d764ba3c8e9e353a394edfcd2c">GrTextureBase::kNoMipMap</a> | <a class="code" href="class_gr_texture_base.html#184780018f2b67996c9274798e52607e">GrTextureBase::kNoCompress</a>, <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e5308d02dc086ce7c780adab8a7bb57a1bb19">GrTextureBase::ETT_2D</a> );
<a name="l00131"></a>00131         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( colorTex-&gt;GetType() == <a class="code" href="class_gr_texture_base.html#5ce3676de03c3c565a9a0995334e5308d02dc086ce7c780adab8a7bb57a1bb19">GrTextureBase::ETT_2D</a> );
<a name="l00132"></a>00132 
<a name="l00134"></a>00134         _renderTarget = <a class="code" href="_gr_render_target_mgr_8cpp.html#e724d8bfeb4bcd97146e35ca1646dd2f" title="class header.">gGrRenderTargetMgr</a>-&gt;<a class="code" href="class_gr_render_target_mgr.html#2dc9cb29f5f88c355eaab0938c0f355d" title="create a render target.">CreateRenderTarget</a>( colorTex, depthTex );
<a name="l00135"></a>00135 <span class="preprocessor">#else</span>
<a name="l00137"></a>00137 <span class="preprocessor">        _renderTarget = gGrRenderTargetMgr-&gt;CreateRenderTarget( 0, ( GrTextureBase* )depthTex );</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>
<a name="l00140"></a>00140         <span class="keywordflow">if</span> ( !_renderTarget )
<a name="l00141"></a>00141         {
<a name="l00144"></a>00144                 <a class="code" href="class_u_ref.html">URef&lt; GrRenderbuffer &gt;</a> colorBuf = <a class="code" href="_gr_render_target_mgr_8cpp.html#e724d8bfeb4bcd97146e35ca1646dd2f" title="class header.">gGrRenderTargetMgr</a>-&gt;<a class="code" href="class_gr_render_target_mgr.html#fabad7a065e67c6bd8f04e98e1501061" title="rendertarget component creation.">CreateRenderbuffer</a>( width, height, <a class="code" href="class_gr_render_target_mgr.html#66d0ebb49e9781283d824f19f4bbc3f68daf6d100b1c33a7c1cbb6851e64dd2b" title="not supported for renderbuffers.">GrRenderTargetMgr::EF_RGBA32</a> );
<a name="l00145"></a>00145                 <a class="code" href="class_u_ref.html">URef&lt; GrRenderbuffer &gt;</a> depthBuf = <a class="code" href="_gr_render_target_mgr_8cpp.html#e724d8bfeb4bcd97146e35ca1646dd2f" title="class header.">gGrRenderTargetMgr</a>-&gt;<a class="code" href="class_gr_render_target_mgr.html#fabad7a065e67c6bd8f04e98e1501061" title="rendertarget component creation.">CreateRenderbuffer</a>( width, height, <a class="code" href="class_gr_render_target_mgr.html#66d0ebb49e9781283d824f19f4bbc3f6921d4c2f8d32dd605d25dee31fc2312d" title="not supported for renderbuffers.">GrRenderTargetMgr::EF_DEPTH</a> );
<a name="l00146"></a>00146 
<a name="l00148"></a>00148                 _renderTarget = <a class="code" href="_gr_render_target_mgr_8cpp.html#e724d8bfeb4bcd97146e35ca1646dd2f" title="class header.">gGrRenderTargetMgr</a>-&gt;<a class="code" href="class_gr_render_target_mgr.html#2dc9cb29f5f88c355eaab0938c0f355d" title="create a render target.">CreateRenderTarget</a>( colorBuf, depthBuf );
<a name="l00149"></a>00149                 <span class="keywordflow">if</span> ( !_renderTarget )
<a name="l00150"></a>00150                 {
<a name="l00151"></a>00151                         <a class="code" href="common__afx_8h.html#b7017537090be31ed41b17e6d25330d6">B_ERROR</a>( <span class="stringliteral">"Unable to find a valid shadow buffer format!"</span> );
<a name="l00152"></a>00152                 }
<a name="l00153"></a>00153 
<a name="l00155"></a>00155                 _copyDepthTex = ( <a class="code" href="class_gr_texture.html" title="class GrTexture">GrTexture</a>* )( <a class="code" href="class_gr_texture_base.html" title="class GrTextureBase">GrTextureBase</a>* )depthTex;
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Feb 13 17:19:58 2009 for Bootstrap Engine by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
