<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Bootstrap Engine: C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrMesh.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrMesh.cpp</h1><a href="_gr_mesh_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//----------------------------------------------------------</span>
<a name="l00006"></a>00006 <span class="comment"></span><span class="comment">//----------------------------------------------------------</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="graphics__afx_8h.html">graphics_afx.h</a>"</span>
<a name="l00008"></a>00008 
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="_gr_mesh_8h.html">GrMesh.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="_u_reader_8h.html">UReader.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="_m_vec3_8h.html">MVec3.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="_m_vec2_8h.html">MVec2.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="_gr_config_8h.html">GrConfig.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="_g_l_subsys_8h.html">GLSubsys.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="_m_mat4x4_8h.html">MMat4x4.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="_m_mat3x3_8h.html">MMat3x3.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "<a class="code" href="_m_vec3_8h.html">MVec3.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="_m_plane_8h.html">MPlane.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="_u_reader_8h.html">UReader.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "<a class="code" href="_u_writer_8h.html">UWriter.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="_gr_polygon_group_8h.html">GrPolygonGroup.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="_gr_polygon_8h.html">GrPolygon.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="_gr_mesh_v_b_8h.html">GrMeshVB.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="_gr_mesh_i_b_8h.html">GrMeshIB.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="_gr_skin_8h.html">GrSkin.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="_gr_uber_texture_8h.html">GrUberTexture.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include "<a class="code" href="_m_ray_8h.html">MRay.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="_gr_texture_mgr_8h.html">GrTextureMgr.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="_gr_mesh_buffer_mgr_8h.html">GrMeshBufferMgr.h</a>"</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include "<a class="code" href="_u_l_r_u_hash_8h.html">ULRUHash.h</a>"</span>
<a name="l00034"></a>00034 
<a name="l00036"></a>00036 <span class="comment">//#include "NVTriStrip/NVTriStrip.h"</span>
<a name="l00037"></a>00037 
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="_gr_mesh_8cpp.html#002b2f4894492820fe708b1b7e7c5e70">00042</a> <span class="preprocessor">#define EPSILON                 1.0e-7</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00045"></a>00045 <span class="comment">//#define _REPORT_OBJ_QUERY_SPIN</span>
<a name="l00046"></a>00046 <span class="comment">//#define _NO_RENDER</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="keyword">using</span> std::vector;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="comment">//----------------------------------------------------------</span>
<a name="l00051"></a><a class="code" href="_gr_mesh_8cpp.html#bc42d61dca77b64871e1666bee0e2307">00051</a> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="_gr_mesh_8cpp.html#bc42d61dca77b64871e1666bee0e2307">ComputeTriangleNormal</a>( <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; <a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a>, <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; <a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a>, <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; <a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a> )
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053         <span class="keywordflow">return</span> (v1 - v0).<a class="code" href="class_m_vec3.html#dcd74e76cefbb1b650c5dece5f115aae">Cross</a>(v2 - v0).<a class="code" href="class_m_vec3.html#139cf1db336ecf0ca02157f6f3605647">Normalized</a>();
<a name="l00054"></a>00054 }
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="comment">//**********************************************************</span>
<a name="l00059"></a>00059 <span class="comment"></span><span class="comment">//**********************************************************</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">//==========================================================</span>
<a name="l00063"></a>00063 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="comment">//----------------------------------------------------------</span>
<a name="l00066"></a><a class="code" href="class_gr_mesh.html#da12f2c59e9315aad65efd9f856e0d16">00066</a> <a class="code" href="class_gr_mesh.html#da12f2c59e9315aad65efd9f856e0d16" title="class GrMesh">GrMesh::GrMesh</a>( <a class="code" href="class_u_reader.html" title="Purpose: To wrap and simplify pointer read operations.">UReader</a>&amp; reader )
<a name="l00067"></a>00067 : _name( <span class="stringliteral">""</span> )
<a name="l00068"></a>00068 , _rangeCount( 0 )
<a name="l00069"></a>00069 , _ranges( 0 )
<a name="l00070"></a>00070 , _aaBox( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 0.0f ), <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 0.0f ) )
<a name="l00071"></a>00071 , _uberTexture( 0 )
<a name="l00072"></a>00072 , _skin( 0 )
<a name="l00073"></a>00073 , _startSkinIdx( 0 )
<a name="l00074"></a>00074 , _skinVertexCount( 0 )
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076         <a class="code" href="class_gr_mesh.html#4ade8286c992e61e1029bab4e75a4eb9">Load</a>( reader, <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray</a>&lt; <a class="code" href="class_u_ref.html">URef&lt; GrSkin &gt;</a> &gt;() );
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">//----------------------------------------------------------</span>
<a name="l00080"></a><a class="code" href="class_gr_mesh.html#81af8af4ed876aa87e65bab52a19f714">00080</a> <a class="code" href="class_gr_mesh.html#da12f2c59e9315aad65efd9f856e0d16" title="class GrMesh">GrMesh::GrMesh</a>( <a class="code" href="class_u_reader.html" title="Purpose: To wrap and simplify pointer read operations.">UReader</a>&amp; reader, <span class="keyword">const</span> <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray</a>&lt; <a class="code" href="class_u_ref.html">URef&lt; GrSkin &gt;</a> &gt;&amp; skins )
<a name="l00081"></a>00081 : _name( <span class="stringliteral">""</span> )
<a name="l00082"></a>00082 , _rangeCount( 0 )
<a name="l00083"></a>00083 , _ranges( 0 )
<a name="l00084"></a>00084 , _aaBox( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 0.0f ), <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 0.0f ) )
<a name="l00085"></a>00085 , _uberTexture( 0 )
<a name="l00086"></a>00086 , _skin( 0 )
<a name="l00087"></a>00087 , _startSkinIdx( 0 )
<a name="l00088"></a>00088 , _skinVertexCount( 0 )
<a name="l00089"></a>00089 {
<a name="l00090"></a>00090         <a class="code" href="class_gr_mesh.html#4ade8286c992e61e1029bab4e75a4eb9">Load</a>( reader, skins );
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="comment">//----------------------------------------------------------</span>
<a name="l00094"></a><a class="code" href="class_gr_mesh.html#2b1dc3fccc2037163884b7d436da63a5">00094</a> <a class="code" href="class_gr_mesh.html#da12f2c59e9315aad65efd9f856e0d16" title="class GrMesh">GrMesh::GrMesh</a>( <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; <a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a>,
<a name="l00095"></a>00095                                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> *verts,
<a name="l00096"></a>00096                                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> *normals,
<a name="l00097"></a>00097                                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> *binormals,
<a name="l00098"></a>00098                                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> *tangents,
<a name="l00099"></a>00099                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *colors,
<a name="l00100"></a>00100                                 <span class="keyword">const</span> <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a> *uvs,
<a name="l00101"></a>00101                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> vertexCount,
<a name="l00102"></a>00102                                 <span class="keyword">const</span> <a class="code" href="struct_gr_mesh_1_1_s_range.html">SRange</a> *ranges,
<a name="l00103"></a>00103                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rangeCount,
<a name="l00104"></a>00104                                 <a class="code" href="class_u_ref.html">URef&lt; GrUberTexture &gt;</a> uberTexture,
<a name="l00105"></a>00105                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vbFlags )
<a name="l00106"></a>00106 : _name( name )
<a name="l00107"></a>00107 , _rangeCount( rangeCount )
<a name="l00108"></a>00108 , _ranges( new <a class="code" href="struct_gr_mesh_1_1_s_range.html">SRange</a>[ rangeCount ] )
<a name="l00109"></a>00109 , _aaBox( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 0.0f ), <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 0.0f ) )
<a name="l00110"></a>00110 , _uberTexture( uberTexture )
<a name="l00111"></a>00111 , _skin( 0 )
<a name="l00112"></a>00112 , _startSkinIdx( 0 )
<a name="l00113"></a>00113 , _skinVertexCount( 0 )
<a name="l00114"></a>00114 {
<a name="l00116"></a>00116         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( vertexCount &gt; 0 );
<a name="l00117"></a>00117         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( rangeCount &gt; 0 );
<a name="l00118"></a>00118 
<a name="l00120"></a>00120         _vertexBuffer = <a class="code" href="_gr_mesh_buffer_mgr_8cpp.html#b3896ffcf9e16ca80efeb7f2e44ba879" title="class header.">gGrMeshBufferMgr</a>-&gt;<a class="code" href="class_gr_mesh_buffer_mgr.html#e2becc9588cfb3d8858a4c998bc3dbc6" title="public methods">CreateMeshVB</a>( vertexCount, verts, normals, binormals, tangents, colors, uvs, vbFlags );
<a name="l00121"></a>00121 
<a name="l00123"></a>00123         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _rangeCount; ++i )
<a name="l00124"></a>00124                 _ranges[ i ] = ranges[ i ];
<a name="l00125"></a>00125 
<a name="l00127"></a>00127         CalcAABox();
<a name="l00128"></a>00128         CalcBoundingSphere();
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="comment">//----------------------------------------------------------</span>
<a name="l00132"></a><a class="code" href="class_gr_mesh.html#fe2182b75dc1f6a02a096cea277872f8">00132</a> <a class="code" href="class_gr_mesh.html#da12f2c59e9315aad65efd9f856e0d16" title="class GrMesh">GrMesh::GrMesh</a>( <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; <a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a>,
<a name="l00133"></a>00133                                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> *verts,
<a name="l00134"></a>00134                                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> *normals,
<a name="l00135"></a>00135                                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> *binormals,
<a name="l00136"></a>00136                                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> *tangents,
<a name="l00137"></a>00137                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *colors,
<a name="l00138"></a>00138                                 <span class="keyword">const</span> <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a> *uvs,
<a name="l00139"></a>00139                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> vertexCount,
<a name="l00140"></a>00140                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *<a class="code" href="_g_l_8h.html#0c1a6a349ce1520ca0284e13dcad1f86">indices</a>,
<a name="l00141"></a>00141                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indexCount,
<a name="l00142"></a>00142                                 <span class="keyword">const</span> <a class="code" href="struct_gr_mesh_1_1_s_range.html">SRange</a> *ranges,
<a name="l00143"></a>00143                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rangeCount,
<a name="l00144"></a>00144                                 <a class="code" href="class_u_ref.html">URef&lt; GrUberTexture &gt;</a> uberTexture,
<a name="l00145"></a>00145                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vbFlags,
<a name="l00146"></a>00146                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibFlags,
<a name="l00147"></a>00147                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxVertexCount,
<a name="l00148"></a>00148                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxIndexCount )
<a name="l00149"></a>00149 : _name( name )
<a name="l00150"></a>00150 , _ranges( new <a class="code" href="struct_gr_mesh_1_1_s_range.html">SRange</a>[ rangeCount ] )
<a name="l00151"></a>00151 , _rangeCount( rangeCount )
<a name="l00152"></a>00152 , _aaBox( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 0.0f ), <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 0.0f ) )
<a name="l00153"></a>00153 , _uberTexture( uberTexture )
<a name="l00154"></a>00154 , _skin( 0 )
<a name="l00155"></a>00155 , _startSkinIdx( 0 )
<a name="l00156"></a>00156 , _skinVertexCount( 0 )
<a name="l00157"></a>00157 {
<a name="l00159"></a>00159         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( vertexCount &gt; 0 );
<a name="l00160"></a>00160 
<a name="l00162"></a>00162         _vertexBuffer = <a class="code" href="_gr_mesh_buffer_mgr_8cpp.html#b3896ffcf9e16ca80efeb7f2e44ba879" title="class header.">gGrMeshBufferMgr</a>-&gt;<a class="code" href="class_gr_mesh_buffer_mgr.html#e2becc9588cfb3d8858a4c998bc3dbc6" title="public methods">CreateMeshVB</a>( vertexCount, verts, normals, binormals,
<a name="l00163"></a>00163                 tangents, colors, uvs, vbFlags, maxVertexCount );
<a name="l00164"></a>00164         <span class="keywordflow">if</span> ( indexCount &gt; 0 )
<a name="l00165"></a>00165                 _indexBuffer = <a class="code" href="_gr_mesh_buffer_mgr_8cpp.html#b3896ffcf9e16ca80efeb7f2e44ba879" title="class header.">gGrMeshBufferMgr</a>-&gt;<a class="code" href="class_gr_mesh_buffer_mgr.html#91c2e8bf41d8e63797ace280348679eb">CreateMeshIB</a>( indexCount, indices, ibFlags, maxIndexCount );
<a name="l00166"></a>00166 
<a name="l00168"></a>00168         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _rangeCount; ++i )
<a name="l00169"></a>00169                 _ranges[ i ] = ranges[ i ];
<a name="l00170"></a>00170 
<a name="l00172"></a>00172         CalcAABox();
<a name="l00173"></a>00173         CalcBoundingSphere();
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="comment">//----------------------------------------------------------</span>
<a name="l00177"></a><a class="code" href="class_gr_mesh.html#9ac6adeb0a429135ddce8487e65b05e9">00177</a> <a class="code" href="class_gr_mesh.html#da12f2c59e9315aad65efd9f856e0d16" title="class GrMesh">GrMesh::GrMesh</a>( <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; <a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a>,
<a name="l00178"></a>00178                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexComponents,
<a name="l00179"></a>00179                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount,
<a name="l00180"></a>00180                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indexCount,
<a name="l00181"></a>00181                                 <span class="keyword">const</span> <a class="code" href="struct_gr_mesh_1_1_s_range.html">SRange</a>* ranges,
<a name="l00182"></a>00182                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rangeCount,
<a name="l00183"></a>00183                                 <a class="code" href="class_u_ref.html">URef&lt; GrUberTexture &gt;</a> uberTexture,
<a name="l00184"></a>00184                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vbFlags,
<a name="l00185"></a>00185                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibFlags )
<a name="l00186"></a>00186 : _name( name )
<a name="l00187"></a>00187 , _ranges( new <a class="code" href="struct_gr_mesh_1_1_s_range.html">SRange</a>[ rangeCount ] )
<a name="l00188"></a>00188 , _rangeCount( rangeCount )
<a name="l00189"></a>00189 , _aaBox( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 0.0f ), <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 0.0f ) )
<a name="l00190"></a>00190 , _uberTexture( uberTexture )
<a name="l00191"></a>00191 , _skin( 0 )
<a name="l00192"></a>00192 , _startSkinIdx( 0 )
<a name="l00193"></a>00193 , _skinVertexCount( 0 )
<a name="l00194"></a>00194 {
<a name="l00196"></a>00196         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( vertexCount &gt; 0 );
<a name="l00197"></a>00197 
<a name="l00199"></a>00199         _vertexBuffer = <a class="code" href="_gr_mesh_buffer_mgr_8cpp.html#b3896ffcf9e16ca80efeb7f2e44ba879" title="class header.">gGrMeshBufferMgr</a>-&gt;<a class="code" href="class_gr_mesh_buffer_mgr.html#e2becc9588cfb3d8858a4c998bc3dbc6" title="public methods">CreateMeshVB</a>( vertexCount, vertexComponents, vbFlags );
<a name="l00200"></a>00200         <span class="keywordflow">if</span> ( indexCount &gt; 0 )
<a name="l00201"></a>00201                 _indexBuffer = <a class="code" href="_gr_mesh_buffer_mgr_8cpp.html#b3896ffcf9e16ca80efeb7f2e44ba879" title="class header.">gGrMeshBufferMgr</a>-&gt;<a class="code" href="class_gr_mesh_buffer_mgr.html#91c2e8bf41d8e63797ace280348679eb">CreateMeshIB</a>( indexCount, ibFlags );
<a name="l00202"></a>00202 
<a name="l00204"></a>00204         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _rangeCount; ++i )
<a name="l00205"></a>00205                 _ranges[ i ] = ranges[ i ];
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="comment">//----------------------------------------------------------</span>
<a name="l00209"></a>00209 <a class="code" href="class_gr_mesh.html#da12f2c59e9315aad65efd9f856e0d16" title="class GrMesh">GrMesh::GrMesh</a>( <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; <a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a>,
<a name="l00210"></a>00210                                 <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* verts,
<a name="l00211"></a>00211                                 <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* normals,
<a name="l00212"></a>00212                                 <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* binormals,
<a name="l00213"></a>00213                                 <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* tangents,
<a name="l00214"></a>00214                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>* colors,
<a name="l00215"></a>00215                                 <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a>* uvs,
<a name="l00216"></a>00216                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> vertexCount,
<a name="l00217"></a>00217                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <a class="code" href="_g_l_8h.html#0c1a6a349ce1520ca0284e13dcad1f86">indices</a>,
<a name="l00218"></a>00218                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indexCount,
<a name="l00219"></a>00219                                 SRange* ranges,
<a name="l00220"></a>00220                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rangeCount,
<a name="l00221"></a>00221                                 <a class="code" href="class_u_ref.html">URef&lt; GrUberTexture &gt;</a> uberTexture,
<a name="l00222"></a>00222                                 <span class="keyword">const</span> <a class="code" href="class_m_a_a_box.html" title="class MAABox">MAABox</a>&amp; aaBox,
<a name="l00223"></a>00223                                 <span class="keyword">const</span> <a class="code" href="class_m_sphere.html" title="class MSphere">MSphere</a>&amp; boundingSphere,
<a name="l00224"></a>00224                                 <span class="keywordtype">bool</span> vbDynamic,
<a name="l00225"></a>00225                                 <span class="keywordtype">bool</span> ibDynamic )
<a name="l00226"></a>00226 : _name( name )
<a name="l00227"></a>00227 , _ranges( new SRange[ rangeCount ] )
<a name="l00228"></a>00228 , _rangeCount( rangeCount )
<a name="l00229"></a>00229 , _aaBox( aaBox )
<a name="l00230"></a>00230 , _boundingSphere( boundingSphere )
<a name="l00231"></a>00231 , _uberTexture( uberTexture )
<a name="l00232"></a>00232 , _skin( 0 )
<a name="l00233"></a>00233 , _startSkinIdx( 0 )
<a name="l00234"></a>00234 , _skinVertexCount( 0 )
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( vertexCount &gt; 0 );
<a name="l00237"></a>00237         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( indexCount &gt; 0 || indices == 0 );
<a name="l00238"></a>00238 
<a name="l00240"></a>00240         _vertexBuffer = <a class="code" href="_gr_mesh_buffer_mgr_8cpp.html#b3896ffcf9e16ca80efeb7f2e44ba879" title="class header.">gGrMeshBufferMgr</a>-&gt;<a class="code" href="class_gr_mesh_buffer_mgr.html#e2becc9588cfb3d8858a4c998bc3dbc6" title="public methods">CreateMeshVB</a>( vertexCount, verts, normals, binormals,
<a name="l00241"></a>00241                 tangents, colors, uvs, vbDynamic );
<a name="l00242"></a>00242         <span class="keywordflow">if</span> ( indexCount &gt; 0 )
<a name="l00243"></a>00243                 _indexBuffer = <a class="code" href="_gr_mesh_buffer_mgr_8cpp.html#b3896ffcf9e16ca80efeb7f2e44ba879" title="class header.">gGrMeshBufferMgr</a>-&gt;<a class="code" href="class_gr_mesh_buffer_mgr.html#91c2e8bf41d8e63797ace280348679eb">CreateMeshIB</a>( indexCount, indices, ibDynamic );
<a name="l00244"></a>00244 
<a name="l00246"></a>00246         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _rangeCount; ++i )
<a name="l00247"></a>00247                 _ranges[ i ] = ranges[ i ];
<a name="l00248"></a>00248 
<a name="l00250"></a>00250         CalcAABox();
<a name="l00251"></a>00251         CalcBoundingSphere();
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 <span class="comment">//----------------------------------------------------------</span>
<a name="l00255"></a><a class="code" href="class_gr_mesh.html#7c9e4336b2d7378db2ed663a06213d3d">00255</a> <a class="code" href="class_gr_mesh.html#7c9e4336b2d7378db2ed663a06213d3d" title="ctor.">GrMesh::~GrMesh</a>()
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257         CleanUp();
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="comment">//==========================================================</span>
<a name="l00263"></a>00263 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="comment">//----------------------------------------------------------</span>
<a name="l00266"></a>00266 <a class="code" href="class_gr_mesh.html" title="class GrMesh">GrMesh</a>*
<a name="l00267"></a><a class="code" href="class_gr_mesh.html#6881fa0be412c2e0d8efef6e1f4e5865">00267</a> <a class="code" href="class_gr_mesh.html#6881fa0be412c2e0d8efef6e1f4e5865" title="creates a &amp;quot;deep&amp;quot; clone of a mesh.">GrMesh::Clone</a>()
<a name="l00268"></a>00268 {
<a name="l00270"></a>00270         <a class="code" href="class_gr_mesh.html" title="class GrMesh">GrMesh</a>* newMesh = <span class="keyword">new</span> <a class="code" href="class_gr_mesh.html#da12f2c59e9315aad65efd9f856e0d16" title="class GrMesh">GrMesh</a>( _name, _vertexBuffer-&gt;GetVertices(), _vertexBuffer-&gt;GetNormals(),
<a name="l00271"></a>00271                 _vertexBuffer-&gt;GetBiNormals(), _vertexBuffer-&gt;GetTangents(), _vertexBuffer-&gt;GetColors(),
<a name="l00272"></a>00272                 _vertexBuffer-&gt;GetTexCoords(), _vertexBuffer-&gt;GetVertexCount(), _indexBuffer-&gt;GetIndices(),
<a name="l00273"></a>00273                 _indexBuffer-&gt;GetIndexCount(), _ranges, _rangeCount, _uberTexture, _aaBox, _boundingSphere,
<a name="l00274"></a>00274                 ( _vertexBuffer-&gt;GetFlags() &amp; <a class="code" href="class_gr_mesh_v_b.html#2af3fdf0087d2543d2861bd677139cdc">GrMeshVB::kDynamic</a> ) != 0, ( _indexBuffer-&gt;GetFlags() &amp; <a class="code" href="class_gr_mesh_i_b.html#5793b340a735f6ef818f74e6727fcf00">GrMeshIB::kDynamic</a> ) != 0 );
<a name="l00275"></a>00275 
<a name="l00277"></a>00277         <span class="keywordflow">if</span> ( _skin != 0 )
<a name="l00278"></a>00278                 newMesh-&gt;<a class="code" href="class_gr_mesh.html#ca24f02b9e2cf3342a81f9ee1493f6ea">SetSkin</a>( _skin );
<a name="l00279"></a>00279 
<a name="l00281"></a>00281         <span class="keywordflow">return</span> newMesh;
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 <span class="comment">//----------------------------------------------------------</span>
<a name="l00285"></a>00285 <a class="code" href="class_gr_mesh.html" title="class GrMesh">GrMesh</a>*
<a name="l00286"></a><a class="code" href="class_gr_mesh.html#52203681acabf93d8193f9111d0853a3">00286</a> <a class="code" href="class_gr_mesh.html#52203681acabf93d8193f9111d0853a3">GrMesh::CloneRange</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rangeIdx )
<a name="l00287"></a>00287 {
<a name="l00288"></a>00288         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( rangeIdx &lt; _rangeCount );
<a name="l00289"></a>00289 
<a name="l00290"></a>00290         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_g_l_8h.html#c55adc720a3098c1b454d2a4647f4361">start</a> = _ranges[ rangeIdx ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a>;
<a name="l00291"></a>00291         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_g_l_8h.html#10b284d589000663becfbc6867a3a9f7">count</a> = _ranges[ rangeIdx ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a>;
<a name="l00292"></a>00292         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l00293"></a>00293         {
<a name="l00294"></a>00294                 start = _ranges[ rangeIdx ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#63e71ca2a50a27fa4c6b95ebfd7472f4" title="number of vertices or indices to process.">minIndex</a>;
<a name="l00295"></a>00295                 count = _ranges[ rangeIdx ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#7e44b7370e15a3faaea7669107d2f4cd" title="only used for indexed meshes.">maxIndex</a> - _ranges[ rangeIdx ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#63e71ca2a50a27fa4c6b95ebfd7472f4" title="number of vertices or indices to process.">minIndex</a> + 1;
<a name="l00296"></a>00296         }
<a name="l00297"></a>00297 
<a name="l00299"></a>00299         <a class="code" href="struct_gr_mesh_1_1_s_range.html">SRange</a> <a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a>;
<a name="l00300"></a>00300         range.<a class="code" href="struct_gr_mesh_1_1_s_range.html#332525f7e1ef670c14bd59cd8b47a34f">name</a> = _ranges[ rangeIdx ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#332525f7e1ef670c14bd59cd8b47a34f">name</a>;
<a name="l00301"></a>00301         range.<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a> = 0;
<a name="l00302"></a>00302         range.<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a> = _ranges[ rangeIdx ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a>;
<a name="l00303"></a>00303         range.<a class="code" href="struct_gr_mesh_1_1_s_range.html#7e44b7370e15a3faaea7669107d2f4cd" title="only used for indexed meshes.">maxIndex</a> = _ranges[ rangeIdx ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#7e44b7370e15a3faaea7669107d2f4cd" title="only used for indexed meshes.">maxIndex</a> - _ranges[ rangeIdx ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#63e71ca2a50a27fa4c6b95ebfd7472f4" title="number of vertices or indices to process.">minIndex</a>;
<a name="l00304"></a>00304         range.<a class="code" href="struct_gr_mesh_1_1_s_range.html#63e71ca2a50a27fa4c6b95ebfd7472f4" title="number of vertices or indices to process.">minIndex</a> = 0;
<a name="l00305"></a>00305 
<a name="l00307"></a>00307         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* indices = 0;
<a name="l00308"></a>00308         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indexCount = 0;
<a name="l00309"></a>00309         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l00310"></a>00310         {
<a name="l00312"></a>00312                 indexCount = range.<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a>;
<a name="l00313"></a>00313                 indices = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>[ indexCount ];
<a name="l00314"></a>00314                 <a class="code" href="common__afx_8cpp.html#b4b15928b71967d4c4eb8c12c3108643">MemCopy</a>( indices, _indexBuffer-&gt;GetIndices() + _ranges[ rangeIdx ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a>, indexCount * <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> short ) );
<a name="l00315"></a>00315 
<a name="l00317"></a>00317                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; indexCount; ++i )
<a name="l00318"></a>00318                         indices[ i ] -= start;
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320 
<a name="l00322"></a>00322         <a class="code" href="class_gr_mesh.html" title="class GrMesh">GrMesh</a>* newMesh = <span class="keyword">new</span> <a class="code" href="class_gr_mesh.html#da12f2c59e9315aad65efd9f856e0d16" title="class GrMesh">GrMesh</a>( _name, _vertexBuffer-&gt;GetVertices() + start, _vertexBuffer-&gt;GetNormals() + start,
<a name="l00323"></a>00323                 _vertexBuffer-&gt;GetBiNormals() + start, _vertexBuffer-&gt;GetTangents() + start, _vertexBuffer-&gt;GetColors() + start,
<a name="l00324"></a>00324                 _vertexBuffer-&gt;GetTexCoords() + start, count, indices, indexCount, &amp;range, 1, _uberTexture, _aaBox, _boundingSphere, 0 );
<a name="l00325"></a>00325 
<a name="l00327"></a>00327         <span class="keyword">delete</span>[] indices;
<a name="l00328"></a>00328 
<a name="l00330"></a>00330         <span class="keywordflow">if</span> ( _skin != 0 )
<a name="l00331"></a>00331                 newMesh-&gt;<a class="code" href="class_gr_mesh.html#ca24f02b9e2cf3342a81f9ee1493f6ea">SetSkin</a>( _skin, start, count );
<a name="l00332"></a>00332 
<a name="l00334"></a>00334         <span class="keywordflow">return</span> newMesh;
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <span class="comment">//----------------------------------------------------------</span>
<a name="l00338"></a>00338 <span class="keywordtype">void</span>
<a name="l00339"></a><a class="code" href="class_gr_mesh.html#ba35b1bb123116cae53994e78ea56758">00339</a> <a class="code" href="class_gr_mesh.html#ba35b1bb123116cae53994e78ea56758" title="caches the data for rendering.">GrMesh::Cache</a>()
<a name="l00340"></a>00340 {
<a name="l00341"></a>00341         _vertexBuffer-&gt;Cache();
<a name="l00342"></a>00342         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l00343"></a>00343                 _indexBuffer-&gt;Cache();
<a name="l00344"></a>00344 }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 <span class="comment">//----------------------------------------------------------</span>
<a name="l00347"></a>00347 <span class="keywordtype">void</span>
<a name="l00348"></a><a class="code" href="class_gr_mesh.html#6c86454dab1da04bdda47d7aa1dcf363">00348</a> <a class="code" href="class_gr_mesh.html#6c86454dab1da04bdda47d7aa1dcf363">GrMesh::Evict</a>()
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350         _vertexBuffer-&gt;Evict();
<a name="l00351"></a>00351         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l00352"></a>00352                 _indexBuffer-&gt;Evict();
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="comment">//----------------------------------------------------------</span>
<a name="l00356"></a>00356 <span class="keywordtype">void</span>
<a name="l00357"></a><a class="code" href="class_gr_mesh.html#abdbc531ac793a38243ab776d48de289">00357</a> <a class="code" href="class_gr_mesh.html#abdbc531ac793a38243ab776d48de289">GrMesh::Pick</a>( <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">TriHitArray</a>&amp; triHits, <span class="keyword">const</span> <a class="code" href="class_m_ray.html" title="class MRay">MRay</a>&amp; ray )<span class="keyword"> const</span>
<a name="l00358"></a>00358 <span class="keyword"></span>{
<a name="l00362"></a>00362 
<a name="l00365"></a>00365         <span class="keywordtype">float</span> localU = 0.0f;
<a name="l00366"></a>00366         <span class="keywordtype">float</span> localV = 0.0f;
<a name="l00367"></a>00367         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> point;
<a name="l00368"></a>00368         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> triangleVertex = ~0;
<a name="l00369"></a>00369         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a> = 0; <a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a> &lt; _rangeCount; ++<a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a> )
<a name="l00370"></a>00370         {
<a name="l00372"></a>00372                 <span class="keywordflow">if</span> ( ray.<a class="code" href="class_m_ray.html#d58f4fca993f73968696e69fa58f4a93" title="returns true if the ray intersects with the box provided.">Intersect</a>( _ranges[ <a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a> ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6f515e5181e2803d43e7e2bc36bdb430">aaBox</a> ) )
<a name="l00373"></a>00373                 {
<a name="l00376"></a>00376                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexIncr = 3;
<a name="l00377"></a>00377 
<a name="l00379"></a>00379                         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l00380"></a>00380                         {
<a name="l00382"></a>00382                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* indices = _indexBuffer-&gt;GetIndices();
<a name="l00383"></a>00383 
<a name="l00386"></a>00386                                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> = 0; <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> &lt; _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a>; <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> += 3 )
<a name="l00387"></a>00387                                 {
<a name="l00389"></a>00389                                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vert = _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a> + <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a>;
<a name="l00390"></a>00390                                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a> = _vertexBuffer-&gt;GetVertices()[ indices[ vert ] ];
<a name="l00391"></a>00391                                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a> = _vertexBuffer-&gt;GetVertices()[ indices[ vert+1 ] ];
<a name="l00392"></a>00392                                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a> = _vertexBuffer-&gt;GetVertices()[ indices[ vert+2 ] ];
<a name="l00393"></a>00393 
<a name="l00394"></a>00394                                         <span class="keywordflow">if</span> ( ray.<a class="code" href="class_m_ray.html#d58f4fca993f73968696e69fa58f4a93" title="returns true if the ray intersects with the box provided.">Intersect</a>( point, localU, localV, v0, v1, v2, <span class="keyword">false</span> ) )
<a name="l00395"></a>00395                                         {
<a name="l00396"></a>00396                                                 <a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html" title="triangle collision data.">STriCollision</a>&amp; collision = triHits.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>();
<a name="l00397"></a>00397                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#e6ab3b0597fa4e4e7b8fa40f676af3b1">u</a> = localU;
<a name="l00398"></a>00398                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#0968edfada1308e305efea20a6fc4eea">v</a> = localV;
<a name="l00399"></a>00399                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#e2e9284d6e67030d452a77f285849f08">w</a> = 1.0f - localU - localV;
<a name="l00400"></a>00400                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#3a4997da126ca2145ef6974ba9f4b6c2">hitLoc</a> = point;
<a name="l00401"></a>00401                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#c0ef99ec1c7b6f52176ac1538e98195a">hitNormal</a> = <a class="code" href="_gr_mesh_8cpp.html#bc42d61dca77b64871e1666bee0e2307">ComputeTriangleNormal</a>( v0, v1, v2 );
<a name="l00402"></a>00402                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#625b98685d218e3ffcee8a1802298daf">triIdx</a> = vert / 3;
<a name="l00403"></a>00403                                         }
<a name="l00404"></a>00404                                 }
<a name="l00405"></a>00405                         }
<a name="l00406"></a>00406                         <span class="keywordflow">else</span>
<a name="l00407"></a>00407                         {
<a name="l00410"></a>00410                                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> = 0; <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> &lt; _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a>; <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> += vertexIncr )
<a name="l00411"></a>00411                                 {
<a name="l00413"></a>00413                                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vert = _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a> + <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a>;
<a name="l00414"></a>00414                                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a> = _vertexBuffer-&gt;GetVertices()[ vert ];
<a name="l00415"></a>00415                                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a> = _vertexBuffer-&gt;GetVertices()[ vert+1 ];
<a name="l00416"></a>00416                                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a> = _vertexBuffer-&gt;GetVertices()[ vert+2 ];
<a name="l00417"></a>00417 
<a name="l00418"></a>00418                                         <span class="keywordflow">if</span> ( ray.<a class="code" href="class_m_ray.html#d58f4fca993f73968696e69fa58f4a93" title="returns true if the ray intersects with the box provided.">Intersect</a>( point, localU, localV, v0, v1, v2 ) )
<a name="l00419"></a>00419                                         {
<a name="l00420"></a>00420                                                 <a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html" title="triangle collision data.">STriCollision</a>&amp; collision = triHits.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>();
<a name="l00421"></a>00421                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#e6ab3b0597fa4e4e7b8fa40f676af3b1">u</a> = localU;
<a name="l00422"></a>00422                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#0968edfada1308e305efea20a6fc4eea">v</a> = localV;
<a name="l00423"></a>00423                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#e2e9284d6e67030d452a77f285849f08">w</a> = 1.0f - localU - localV;
<a name="l00424"></a>00424                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#3a4997da126ca2145ef6974ba9f4b6c2">hitLoc</a> = point;
<a name="l00425"></a>00425                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#c0ef99ec1c7b6f52176ac1538e98195a">hitNormal</a> = <a class="code" href="_gr_mesh_8cpp.html#bc42d61dca77b64871e1666bee0e2307">ComputeTriangleNormal</a>( v0, v1, v2 );
<a name="l00426"></a>00426                                                 collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#625b98685d218e3ffcee8a1802298daf">triIdx</a> = vert / 3;
<a name="l00427"></a>00427                                         }
<a name="l00428"></a>00428                                 }
<a name="l00429"></a>00429                         }
<a name="l00430"></a>00430                 }
<a name="l00431"></a>00431         }
<a name="l00432"></a>00432 }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 <span class="comment">//----------------------------------------------------------</span>
<a name="l00435"></a>00435 <span class="keywordtype">void</span>
<a name="l00436"></a><a class="code" href="class_gr_mesh.html#460827f482933fc4d076225afdebd595">00436</a> <a class="code" href="class_gr_mesh.html#460827f482933fc4d076225afdebd595">GrMesh::PickRange</a>( <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">TriHitArray</a>&amp; triHits, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a>, <span class="keyword">const</span> <a class="code" href="class_m_ray.html" title="class MRay">MRay</a>&amp; ray )<span class="keyword"> const</span>
<a name="l00437"></a>00437 <span class="keyword"></span>{
<a name="l00438"></a>00438         <span class="keywordtype">float</span> localU = 0.0f;
<a name="l00439"></a>00439         <span class="keywordtype">float</span> localV = 0.0f;
<a name="l00440"></a>00440         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> point;
<a name="l00441"></a>00441 
<a name="l00443"></a>00443         <span class="keywordflow">if</span> ( ray.<a class="code" href="class_m_ray.html#d58f4fca993f73968696e69fa58f4a93" title="returns true if the ray intersects with the box provided.">Intersect</a>( _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6f515e5181e2803d43e7e2bc36bdb430">aaBox</a> ) )
<a name="l00444"></a>00444         {
<a name="l00447"></a>00447                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexIncr = 3;
<a name="l00448"></a>00448 
<a name="l00450"></a>00450                 <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l00451"></a>00451                 {
<a name="l00453"></a>00453                         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* indices = _indexBuffer-&gt;GetIndices();
<a name="l00454"></a>00454 
<a name="l00457"></a>00457                         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> = 0; <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> &lt; _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a>; <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> += 3 )
<a name="l00458"></a>00458                         {
<a name="l00460"></a>00460                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vert = _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a> + <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a>;
<a name="l00461"></a>00461                                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a> = _vertexBuffer-&gt;GetVertices()[ indices[ vert ] ];
<a name="l00462"></a>00462                                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a> = _vertexBuffer-&gt;GetVertices()[ indices[ vert+1 ] ];
<a name="l00463"></a>00463                                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a> = _vertexBuffer-&gt;GetVertices()[ indices[ vert+2 ] ];
<a name="l00464"></a>00464 
<a name="l00465"></a>00465                                 <span class="keywordflow">if</span> ( ray.<a class="code" href="class_m_ray.html#d58f4fca993f73968696e69fa58f4a93" title="returns true if the ray intersects with the box provided.">Intersect</a>( point, localU, localV, v0, v1, v2, <span class="keyword">false</span> ) )
<a name="l00466"></a>00466                                 {
<a name="l00467"></a>00467                                         <a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html" title="triangle collision data.">STriCollision</a>&amp; collision = triHits.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>();
<a name="l00468"></a>00468                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#e6ab3b0597fa4e4e7b8fa40f676af3b1">u</a> = localU;
<a name="l00469"></a>00469                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#0968edfada1308e305efea20a6fc4eea">v</a> = localV;
<a name="l00470"></a>00470                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#e2e9284d6e67030d452a77f285849f08">w</a> = 1.0f - localU - localV;
<a name="l00471"></a>00471                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#3a4997da126ca2145ef6974ba9f4b6c2">hitLoc</a> = point;
<a name="l00472"></a>00472                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#c0ef99ec1c7b6f52176ac1538e98195a">hitNormal</a> = <a class="code" href="_gr_mesh_8cpp.html#bc42d61dca77b64871e1666bee0e2307">ComputeTriangleNormal</a>( v0, v1, v2 );
<a name="l00473"></a>00473                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#625b98685d218e3ffcee8a1802298daf">triIdx</a> = vert / 3;
<a name="l00474"></a>00474                                 }
<a name="l00475"></a>00475                         }
<a name="l00476"></a>00476                 }
<a name="l00477"></a>00477                 <span class="keywordflow">else</span>
<a name="l00478"></a>00478                 {
<a name="l00481"></a>00481                         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> = 0; <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> &lt; _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a>; <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> += vertexIncr )
<a name="l00482"></a>00482                         {
<a name="l00484"></a>00484                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vert = _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a> + <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a>;
<a name="l00485"></a>00485                                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a> = _vertexBuffer-&gt;GetVertices()[ vert ];
<a name="l00486"></a>00486                                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a> = _vertexBuffer-&gt;GetVertices()[ vert+1 ];
<a name="l00487"></a>00487                                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a> = _vertexBuffer-&gt;GetVertices()[ vert+2 ];
<a name="l00488"></a>00488 
<a name="l00489"></a>00489                                 <span class="keywordflow">if</span> ( ray.<a class="code" href="class_m_ray.html#d58f4fca993f73968696e69fa58f4a93" title="returns true if the ray intersects with the box provided.">Intersect</a>( point, localU, localV, v0, v1, v2 ) )
<a name="l00490"></a>00490                                 {
<a name="l00491"></a>00491                                         <a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html" title="triangle collision data.">STriCollision</a>&amp; collision = triHits.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>();
<a name="l00492"></a>00492                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#e6ab3b0597fa4e4e7b8fa40f676af3b1">u</a> = localU;
<a name="l00493"></a>00493                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#0968edfada1308e305efea20a6fc4eea">v</a> = localV;
<a name="l00494"></a>00494                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#e2e9284d6e67030d452a77f285849f08">w</a> = 1.0f - localU - localV;
<a name="l00495"></a>00495                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#3a4997da126ca2145ef6974ba9f4b6c2">hitLoc</a> = point;
<a name="l00496"></a>00496                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#c0ef99ec1c7b6f52176ac1538e98195a">hitNormal</a> = <a class="code" href="_gr_mesh_8cpp.html#bc42d61dca77b64871e1666bee0e2307">ComputeTriangleNormal</a>( v0, v1, v2 );
<a name="l00497"></a>00497                                         collision.<a class="code" href="struct_gr_mesh_1_1_s_tri_collision.html#625b98685d218e3ffcee8a1802298daf">triIdx</a> = vert / 3;
<a name="l00498"></a>00498                                 }
<a name="l00499"></a>00499                         }
<a name="l00500"></a>00500                 }
<a name="l00501"></a>00501         }
<a name="l00502"></a>00502 }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504 <span class="comment">//----------------------------------------------------------</span>
<a name="l00505"></a>00505 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00506"></a><a class="code" href="class_gr_mesh.html#e7333b5704ae13ba18cc501569f5777f">00506</a> <a class="code" href="class_gr_mesh.html#e7333b5704ae13ba18cc501569f5777f" title="triangle info.">GrMesh::GetTriCount</a>()<span class="keyword"> const</span>
<a name="l00507"></a>00507 <span class="keyword"></span>{
<a name="l00509"></a>00509         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_g_l_8h.html#10b284d589000663becfbc6867a3a9f7">count</a> = 0;
<a name="l00510"></a>00510         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l00511"></a>00511                 count = _indexBuffer-&gt;GetIndexCount() / 3;
<a name="l00512"></a>00512         <span class="keywordflow">else</span>
<a name="l00513"></a>00513                 count = _vertexBuffer-&gt;GetVertexCount() / 3;
<a name="l00514"></a>00514 
<a name="l00516"></a>00516         <span class="keywordflow">return</span> count;
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="comment">//----------------------------------------------------------</span>
<a name="l00520"></a>00520 <span class="keywordtype">void</span>
<a name="l00521"></a><a class="code" href="class_gr_mesh.html#849176ce5be062beb72f947828846b2a">00521</a> <a class="code" href="class_gr_mesh.html#849176ce5be062beb72f947828846b2a">GrMesh::GetTriInfo</a>( <a class="code" href="struct_gr_mesh_1_1_s_tri_info.html" title="triangle info.">STriInfo</a>&amp; triInfo, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> triIdx )<span class="keyword"> const</span>
<a name="l00522"></a>00522 <span class="keyword"></span>{
<a name="l00524"></a>00524         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( triIdx &lt; <a class="code" href="class_gr_mesh.html#e7333b5704ae13ba18cc501569f5777f" title="triangle info.">GetTriCount</a>() );
<a name="l00525"></a>00525 
<a name="l00526"></a>00526         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_g_l_8h.html#c55adc720a3098c1b454d2a4647f4361">start</a> = 3 * triIdx;
<a name="l00527"></a>00527         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l00528"></a>00528         {
<a name="l00530"></a>00530                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* indices = _indexBuffer-&gt;GetIndices();
<a name="l00531"></a>00531                 triInfo.<a class="code" href="struct_gr_mesh_1_1_s_tri_info.html#9bc04351aef8330fc78affacb8e996b8">vertIdx0</a> = indices[ start+0 ];
<a name="l00532"></a>00532                 triInfo.<a class="code" href="struct_gr_mesh_1_1_s_tri_info.html#f5c9d056b0352c52ff90d8e93c5c2a8d">vertIdx1</a> = indices[ start+1 ];
<a name="l00533"></a>00533                 triInfo.<a class="code" href="struct_gr_mesh_1_1_s_tri_info.html#34bdea9839ffbe456dee3b49b1c95843">vertIdx2</a> = indices[ start+2 ];
<a name="l00534"></a>00534         }
<a name="l00535"></a>00535         <span class="keywordflow">else</span>
<a name="l00536"></a>00536         {
<a name="l00538"></a>00538                 triInfo.<a class="code" href="struct_gr_mesh_1_1_s_tri_info.html#9bc04351aef8330fc78affacb8e996b8">vertIdx0</a> = start+0;
<a name="l00539"></a>00539                 triInfo.<a class="code" href="struct_gr_mesh_1_1_s_tri_info.html#f5c9d056b0352c52ff90d8e93c5c2a8d">vertIdx1</a> = start+1;
<a name="l00540"></a>00540                 triInfo.<a class="code" href="struct_gr_mesh_1_1_s_tri_info.html#34bdea9839ffbe456dee3b49b1c95843">vertIdx2</a> = start+2;
<a name="l00541"></a>00541         }
<a name="l00542"></a>00542 
<a name="l00544"></a>00544         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _rangeCount; ++i )
<a name="l00545"></a>00545         {
<a name="l00547"></a>00547                 <a class="code" href="struct_gr_mesh_1_1_s_range.html">SRange</a>* curRange = _ranges + i;
<a name="l00548"></a>00548 
<a name="l00550"></a>00550                 <span class="keywordflow">if</span> ( ( start - curRange-&gt;<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a> ) &lt; curRange-&gt;<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a> )
<a name="l00551"></a>00551                 {
<a name="l00552"></a>00552                         triInfo.<a class="code" href="struct_gr_mesh_1_1_s_tri_info.html#c78784ea7bad63b92d4bd7ae1e11f429">range</a> = i;
<a name="l00553"></a>00553                         <span class="keywordflow">break</span>;
<a name="l00554"></a>00554                 }
<a name="l00555"></a>00555         }
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="comment">//----------------------------------------------------------</span>
<a name="l00559"></a>00559 <a class="code" href="class_u_ref.html">URef&lt; GrMeshVB &gt;</a>
<a name="l00560"></a><a class="code" href="class_gr_mesh.html#590cc2567fbac6ca8f5516319c911e04">00560</a> <a class="code" href="class_gr_mesh.html#590cc2567fbac6ca8f5516319c911e04" title="vertex info.">GrMesh::GetVertexData</a>()<span class="keyword"> const</span>
<a name="l00561"></a>00561 <span class="keyword"></span>{
<a name="l00562"></a>00562         <span class="keywordflow">return</span> _vertexBuffer;
<a name="l00563"></a>00563 }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565 <span class="comment">//----------------------------------------------------------</span>
<a name="l00566"></a>00566 <a class="code" href="class_u_ref.html">URef&lt; GrMeshIB &gt;</a>
<a name="l00567"></a><a class="code" href="class_gr_mesh.html#7ca8bc1bd71272eb87da9e4ada920735">00567</a> <a class="code" href="class_gr_mesh.html#7ca8bc1bd71272eb87da9e4ada920735">GrMesh::GetIndexData</a>()<span class="keyword"> const</span>
<a name="l00568"></a>00568 <span class="keyword"></span>{
<a name="l00569"></a>00569         <span class="keywordflow">return</span> _indexBuffer;
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 <span class="comment">//----------------------------------------------------------</span>
<a name="l00573"></a>00573 <a class="code" href="class_u_ref.html">URef&lt; GrUberTexture &gt;</a>
<a name="l00574"></a><a class="code" href="class_gr_mesh.html#37000fa9e2a6d480b6956f862e8372d6">00574</a> <a class="code" href="class_gr_mesh.html#37000fa9e2a6d480b6956f862e8372d6" title="ubertexture.">GrMesh::GetUberTexture</a>()<span class="keyword"> const</span>
<a name="l00575"></a>00575 <span class="keyword"></span>{
<a name="l00576"></a>00576         <span class="keywordflow">return</span> _uberTexture;
<a name="l00577"></a>00577 }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579 <span class="comment">//----------------------------------------------------------</span>
<a name="l00580"></a>00580 <span class="keywordtype">void</span>
<a name="l00581"></a><a class="code" href="class_gr_mesh.html#a3a4f0ec27a7c9484f2dc57363030c24">00581</a> <a class="code" href="class_gr_mesh.html#a3a4f0ec27a7c9484f2dc57363030c24" title="call to notify the mesh that it&amp;#39;s vertex/index data has changed.">GrMesh::VertexDataChanged</a>()
<a name="l00582"></a>00582 {
<a name="l00584"></a>00584         CalcAABox();
<a name="l00585"></a>00585         CalcBoundingSphere();
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="comment">//----------------------------------------------------------</span>
<a name="l00589"></a>00589 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00590"></a><a class="code" href="class_gr_mesh.html#3b42e0893f6ac4d502122860069a88b8">00590</a> <a class="code" href="class_gr_mesh.html#3b42e0893f6ac4d502122860069a88b8" title="returns the number of vertices in the mesh.">GrMesh::GetVertexCount</a>()<span class="keyword"> const</span>
<a name="l00591"></a>00591 <span class="keyword"></span>{
<a name="l00592"></a>00592         <span class="keywordflow">return</span> _vertexBuffer-&gt;GetVertexCount();
<a name="l00593"></a>00593 }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595 <span class="comment">//----------------------------------------------------------</span>
<a name="l00596"></a>00596 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00597"></a><a class="code" href="class_gr_mesh.html#501d594b2d86fd5f5519477e88b94471">00597</a> <a class="code" href="class_gr_mesh.html#501d594b2d86fd5f5519477e88b94471">GrMesh::GetIndexCount</a>()<span class="keyword"> const</span>
<a name="l00598"></a>00598 <span class="keyword"></span>{
<a name="l00599"></a>00599         <span class="keywordflow">return</span> ( _indexBuffer ? _indexBuffer-&gt;GetIndexCount() : 0 );
<a name="l00600"></a>00600 }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602 <span class="comment">//----------------------------------------------------------</span>
<a name="l00603"></a>00603 <span class="keywordtype">void</span>
<a name="l00604"></a><a class="code" href="class_gr_mesh.html#ca24f02b9e2cf3342a81f9ee1493f6ea">00604</a> <a class="code" href="class_gr_mesh.html#ca24f02b9e2cf3342a81f9ee1493f6ea">GrMesh::SetSkin</a>( <a class="code" href="class_u_ref.html">URef&lt; GrSkin &gt;</a> skin )
<a name="l00605"></a>00605 {
<a name="l00607"></a>00607         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _skin == 0 );
<a name="l00608"></a>00608         _skin = skin;
<a name="l00609"></a>00609         _startSkinIdx = 0;
<a name="l00610"></a>00610         _skinVertexCount = _vertexBuffer-&gt;GetVertexCount();
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 <span class="comment">//----------------------------------------------------------</span>
<a name="l00614"></a>00614 <span class="keyword">const</span> <a class="code" href="class_m_sphere.html" title="class MSphere">MSphere</a>&amp;
<a name="l00615"></a><a class="code" href="class_gr_mesh.html#2d67438c5107a3846d7f8eae065dd515">00615</a> <a class="code" href="class_gr_mesh.html#2d67438c5107a3846d7f8eae065dd515">GrMesh::GetRangeBoundingSphere</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a> )<span class="keyword"> const</span>
<a name="l00616"></a>00616 <span class="keyword"></span>{
<a name="l00617"></a>00617         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( range &lt; _rangeCount );
<a name="l00618"></a>00618         <span class="keywordflow">return</span> _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#7c2fe272192a5165a0f3c6b854ba83d1">bounds</a>;
<a name="l00619"></a>00619 }
<a name="l00620"></a>00620 
<a name="l00621"></a>00621 <span class="comment">//----------------------------------------------------------</span>
<a name="l00622"></a>00622 <span class="keyword">const</span> <a class="code" href="class_m_a_a_box.html" title="class MAABox">MAABox</a>&amp;
<a name="l00623"></a><a class="code" href="class_gr_mesh.html#f6da12bd6191e5489bf3f7080146de14">00623</a> <a class="code" href="class_gr_mesh.html#f6da12bd6191e5489bf3f7080146de14">GrMesh::GetRangeAABox</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a> )<span class="keyword"> const</span>
<a name="l00624"></a>00624 <span class="keyword"></span>{
<a name="l00625"></a>00625         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( range &lt; _rangeCount );
<a name="l00626"></a>00626         <span class="keywordflow">return</span> _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6f515e5181e2803d43e7e2bc36bdb430">aaBox</a>;
<a name="l00627"></a>00627 }
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 <span class="comment">//----------------------------------------------------------</span>
<a name="l00630"></a>00630 <span class="keywordtype">void</span>
<a name="l00631"></a><a class="code" href="class_gr_mesh.html#d0b90ad938d228f7cdce75600e9fc937">00631</a> <a class="code" href="class_gr_mesh.html#d0b90ad938d228f7cdce75600e9fc937">GrMesh::GetRangePlane</a>( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; outNormal, <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; outPoint, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a> )<span class="keyword"> const</span>
<a name="l00632"></a>00632 <span class="keyword"></span>{
<a name="l00633"></a>00633         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( range &lt; _rangeCount );
<a name="l00634"></a>00634 
<a name="l00636"></a>00636         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* vertices = _vertexBuffer-&gt;GetVertices();
<a name="l00637"></a>00637         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( vertices != 0 );
<a name="l00638"></a>00638         <span class="keywordflow">if</span> ( _indexBuffer != 0 )
<a name="l00639"></a>00639         {
<a name="l00641"></a>00641                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* indices = _indexBuffer-&gt;GetIndices();
<a name="l00642"></a>00642 
<a name="l00644"></a>00644                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _ranges[ range ].<a class="code" href="_g_l_8h.html#10b284d589000663becfbc6867a3a9f7">count</a> &gt;= 3 );
<a name="l00645"></a>00645                 <span class="keywordflow">if</span> ( _ranges[ range ].<a class="code" href="_g_l_8h.html#10b284d589000663becfbc6867a3a9f7">count</a> &lt; 3 )
<a name="l00646"></a>00646                         <span class="keywordflow">return</span>;
<a name="l00647"></a>00647 
<a name="l00648"></a>00648                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> baseVert = _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a>;
<a name="l00649"></a>00649                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> triIndex = 0;
<a name="l00650"></a>00650                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indexCount = _indexBuffer-&gt;GetIndexCount();
<a name="l00651"></a>00651                 <span class="keywordflow">while</span> ( ( baseVert + 3 ) &lt; indexCount )
<a name="l00652"></a>00652                 {
<a name="l00653"></a>00653                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> pt0 = vertices[ indices[ baseVert + 0 ] ];
<a name="l00654"></a>00654                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> pt1 = vertices[ indices[ baseVert + 1 ] ];
<a name="l00655"></a>00655                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> pt2 = vertices[ indices[ baseVert + 2 ] ];
<a name="l00656"></a>00656 
<a name="l00658"></a>00658                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> normal = ( pt2 - pt1 ).Cross( pt0 - pt1 );
<a name="l00659"></a>00659 
<a name="l00661"></a>00661                         <span class="keywordflow">if</span> ( normal.<a class="code" href="class_m_vec3.html#6deaf4608ece1b212f214a1d8d304cc7">MagSqr</a>() &gt; 0.01 )
<a name="l00662"></a>00662                         {
<a name="l00663"></a>00663                                 normal.<a class="code" href="class_m_vec3.html#89f60c8001f1e04e5d17327e3b9ada63">Normalize</a>();
<a name="l00664"></a>00664 
<a name="l00666"></a>00666                                 outNormal = normal;
<a name="l00667"></a>00667                                 outPoint = pt0;
<a name="l00668"></a>00668                                 <span class="keywordflow">return</span>;
<a name="l00669"></a>00669                         }
<a name="l00670"></a>00670 
<a name="l00672"></a>00672                         baseVert += 3;
<a name="l00673"></a>00673                         ++triIndex;
<a name="l00674"></a>00674                 }
<a name="l00675"></a>00675         }
<a name="l00676"></a>00676         <span class="keywordflow">else</span>
<a name="l00677"></a>00677         {
<a name="l00679"></a>00679                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _ranges[ range ].<a class="code" href="_g_l_8h.html#10b284d589000663becfbc6867a3a9f7">count</a> &gt;= 3 );
<a name="l00680"></a>00680                 <span class="keywordflow">if</span> ( _ranges[ range ].<a class="code" href="_g_l_8h.html#10b284d589000663becfbc6867a3a9f7">count</a> &lt; 3 )
<a name="l00681"></a>00681                         <span class="keywordflow">return</span>;
<a name="l00682"></a>00682 
<a name="l00684"></a>00684                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> baseVert = _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a>;
<a name="l00685"></a>00685                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> triIndex = 0;
<a name="l00686"></a>00686                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = _vertexBuffer-&gt;GetVertexCount();
<a name="l00687"></a>00687                 <span class="keywordflow">while</span> ( ( baseVert + 3 ) &lt; vertexCount )
<a name="l00688"></a>00688                 {
<a name="l00689"></a>00689                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> pt0 = vertices[ baseVert + 0 ];
<a name="l00690"></a>00690                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> pt1 = vertices[ baseVert + 1 ];
<a name="l00691"></a>00691                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> pt2 = vertices[ baseVert + 2 ];
<a name="l00692"></a>00692 
<a name="l00694"></a>00694                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> normal = ( pt0 - pt1 ).Cross( pt2 - pt1 );
<a name="l00695"></a>00695 
<a name="l00697"></a>00697                         <span class="keywordflow">if</span> ( normal.<a class="code" href="class_m_vec3.html#6deaf4608ece1b212f214a1d8d304cc7">MagSqr</a>() &gt; 0.01 )
<a name="l00698"></a>00698                         {
<a name="l00699"></a>00699                                 normal.<a class="code" href="class_m_vec3.html#89f60c8001f1e04e5d17327e3b9ada63">Normalize</a>();
<a name="l00700"></a>00700 
<a name="l00702"></a>00702                                 outNormal = normal;
<a name="l00703"></a>00703                                 outPoint = pt0;
<a name="l00704"></a>00704                                 <span class="keywordflow">return</span>;
<a name="l00705"></a>00705                         }
<a name="l00706"></a>00706 
<a name="l00708"></a>00708                         baseVert += 3;
<a name="l00709"></a>00709                         ++triIndex;
<a name="l00710"></a>00710                 }
<a name="l00711"></a>00711         }
<a name="l00712"></a>00712 
<a name="l00714"></a>00714         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( <span class="keyword">false</span> );
<a name="l00715"></a>00715         outNormal = <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 1.0f );
<a name="l00716"></a>00716         outPoint = <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 0.0f );
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 <span class="comment">//----------------------------------------------------------</span>
<a name="l00720"></a>00720 <span class="keywordtype">void</span>
<a name="l00721"></a>00721 GrMesh::CalcAABox()
<a name="l00722"></a>00722 {
<a name="l00724"></a>00724         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* vertices = _vertexBuffer-&gt;GetVertices();
<a name="l00725"></a>00725         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = _vertexBuffer-&gt;GetVertexCount();
<a name="l00726"></a>00726 
<a name="l00728"></a>00728         <span class="keywordtype">float</span> minX = FLT_MAX;
<a name="l00729"></a>00729         <span class="keywordtype">float</span> minY = FLT_MAX;
<a name="l00730"></a>00730         <span class="keywordtype">float</span> minZ = FLT_MAX;
<a name="l00731"></a>00731         <span class="keywordtype">float</span> maxX = -FLT_MAX;
<a name="l00732"></a>00732         <span class="keywordtype">float</span> maxY = -FLT_MAX;
<a name="l00733"></a>00733         <span class="keywordtype">float</span> maxZ = -FLT_MAX;
<a name="l00734"></a>00734         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; vertexCount; ++i )
<a name="l00735"></a>00735         {
<a name="l00736"></a>00736                 minX = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( vertices[ i ].<a class="code" href="glext_8h.html#d77deca22f617d3f0e0eb786445689fc">x</a>, minX );
<a name="l00737"></a>00737                 minY = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( vertices[ i ].<a class="code" href="_g_l_8h.html#9298c7ad619074f5285b32c6b72bfdea">y</a>, minY );
<a name="l00738"></a>00738                 minZ = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( vertices[ i ].<a class="code" href="glext_8h.html#5b27107fca91cf19a778530405575b37">z</a>, minZ );
<a name="l00739"></a>00739                 maxX = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( vertices[ i ].<a class="code" href="glext_8h.html#d77deca22f617d3f0e0eb786445689fc">x</a>, maxX );
<a name="l00740"></a>00740                 maxY = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( vertices[ i ].<a class="code" href="_g_l_8h.html#9298c7ad619074f5285b32c6b72bfdea">y</a>, maxY );
<a name="l00741"></a>00741                 maxZ = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( vertices[ i ].<a class="code" href="glext_8h.html#5b27107fca91cf19a778530405575b37">z</a>, maxZ );
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743         _aaBox = <a class="code" href="class_m_a_a_box.html" title="class MAABox">MAABox</a>( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( ( maxX + minX ) * 0.5f, ( maxY + minY ) * 0.5f, ( maxZ + minZ ) * 0.5f ),
<a name="l00744"></a>00744                                          <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.5f * ( maxX - minX ), 0.5f * ( maxY - minY ), 0.5f * ( maxZ - minZ ) ) );
<a name="l00745"></a>00745 
<a name="l00747"></a>00747         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#31034e24af8271ed8267858116fe2e48">r</a> = 0; <a class="code" href="glext_8h.html#31034e24af8271ed8267858116fe2e48">r</a> &lt; _rangeCount; ++<a class="code" href="glext_8h.html#31034e24af8271ed8267858116fe2e48">r</a> )
<a name="l00748"></a>00748         {
<a name="l00749"></a>00749                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startVertex = <a class="code" href="class_gr_mesh.html#de8aa56cad498c5eb9e362fd3e5618cd">GetRangeVertexStart</a>( <a class="code" href="glext_8h.html#31034e24af8271ed8267858116fe2e48">r</a> );
<a name="l00750"></a>00750                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endVertex = startVertex + <a class="code" href="class_gr_mesh.html#47e18fec5f6a5e448cff0b5f27008aa6">GetRangeVertexCount</a>( <a class="code" href="glext_8h.html#31034e24af8271ed8267858116fe2e48">r</a> );
<a name="l00751"></a>00751 
<a name="l00753"></a>00753                 minX = FLT_MAX;
<a name="l00754"></a>00754                 minY = FLT_MAX;
<a name="l00755"></a>00755                 minZ = FLT_MAX;
<a name="l00756"></a>00756                 maxX = -FLT_MAX;
<a name="l00757"></a>00757                 maxY = -FLT_MAX;
<a name="l00758"></a>00758                 maxZ = -FLT_MAX;
<a name="l00759"></a>00759                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> = startVertex; <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> &lt; endVertex; ++<a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> )
<a name="l00760"></a>00760                 {
<a name="l00761"></a>00761                         minX = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( vertices[ <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> ].<a class="code" href="glext_8h.html#d77deca22f617d3f0e0eb786445689fc">x</a>, minX );
<a name="l00762"></a>00762                         minY = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( vertices[ <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> ].<a class="code" href="_g_l_8h.html#9298c7ad619074f5285b32c6b72bfdea">y</a>, minY );
<a name="l00763"></a>00763                         minZ = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( vertices[ <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> ].<a class="code" href="glext_8h.html#5b27107fca91cf19a778530405575b37">z</a>, minZ );
<a name="l00764"></a>00764                         maxX = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( vertices[ <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> ].<a class="code" href="glext_8h.html#d77deca22f617d3f0e0eb786445689fc">x</a>, maxX );
<a name="l00765"></a>00765                         maxY = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( vertices[ <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> ].<a class="code" href="_g_l_8h.html#9298c7ad619074f5285b32c6b72bfdea">y</a>, maxY );
<a name="l00766"></a>00766                         maxZ = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( vertices[ <a class="code" href="glext_8h.html#dfdba28282fbf886223676912be34ab4">v</a> ].<a class="code" href="glext_8h.html#5b27107fca91cf19a778530405575b37">z</a>, maxZ );
<a name="l00767"></a>00767                 }
<a name="l00768"></a>00768                 _ranges[ <a class="code" href="glext_8h.html#31034e24af8271ed8267858116fe2e48">r</a> ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6f515e5181e2803d43e7e2bc36bdb430">aaBox</a> = <a class="code" href="class_m_a_a_box.html" title="class MAABox">MAABox</a>( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( ( maxX + minX ) * 0.5f, ( maxY + minY ) * 0.5f, ( maxZ + minZ ) * 0.5f ),
<a name="l00769"></a>00769                                                                          <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.5f * ( maxX - minX ), 0.5f * ( maxY - minY ), 0.5f * ( maxZ - minZ ) ) );
<a name="l00770"></a>00770         }
<a name="l00771"></a>00771 }
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 <span class="comment">//----------------------------------------------------------</span>
<a name="l00774"></a>00774 <span class="keywordtype">void</span>
<a name="l00775"></a><a class="code" href="class_gr_mesh.html#3b9775285ccb15047c7ec7d026b1553c">00775</a> <a class="code" href="class_gr_mesh.html#3b9775285ccb15047c7ec7d026b1553c" title="optimizes mesh data for rendering.">GrMesh::Optimize</a>()
<a name="l00776"></a>00776 {
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 }
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 <span class="comment">//----------------------------------------------------------</span>
<a name="l00781"></a>00781 <span class="keywordtype">void</span>
<a name="l00782"></a><a class="code" href="class_gr_mesh.html#2e37339a92db06216e801375e8c2ffc3">00782</a> <a class="code" href="class_gr_mesh.html#2e37339a92db06216e801375e8c2ffc3" title="process all vertices in a range.">GrMesh::BeginRender</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexComponents )
<a name="l00783"></a>00783 {
<a name="l00784"></a>00784         _vertexBuffer-&gt;Bind( vertexComponents );
<a name="l00785"></a>00785         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l00786"></a>00786                 _indexBuffer-&gt;Bind();
<a name="l00787"></a>00787         <span class="keywordflow">else</span>
<a name="l00788"></a>00788                 <a class="code" href="_gr_util_8cpp.html#0f573923ce54d669ceb19234cc2f8d36">GrBindIB</a>( 0 );
<a name="l00789"></a>00789 }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791 <span class="comment">//----------------------------------------------------------</span>
<a name="l00792"></a>00792 <span class="keywordtype">void</span>
<a name="l00793"></a><a class="code" href="class_gr_mesh.html#44d75d42f7e25e048904ed371e276a81">00793</a> <a class="code" href="class_gr_mesh.html#44d75d42f7e25e048904ed371e276a81" title="must be called before rendering.">GrMesh::Render</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a>, <span class="keywordtype">bool</span> buildOccQuery )
<a name="l00794"></a>00794 {
<a name="l00795"></a>00795 <span class="preprocessor">#if !defined _NO_RENDER</span>
<a name="l00796"></a>00796 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( _indexBuffer != 0 )
<a name="l00797"></a>00797         {
<a name="l00798"></a>00798                 <a class="code" href="_g_l_subsys_8cpp.html#423585e9e2816753618fa813f15475bf">bglDrawRangeElements</a>( 
<a name="l00799"></a>00799                         <a class="code" href="_g_l_8h.html#6079e7a02a59adad65eb953d9482b1ed">GL_TRIANGLES</a>,
<a name="l00800"></a>00800                         _ranges[ range ].minIndex,
<a name="l00801"></a>00801                         _ranges[ range ].maxIndex,
<a name="l00802"></a>00802                         _ranges[ range ].<a class="code" href="_g_l_8h.html#10b284d589000663becfbc6867a3a9f7">count</a>,
<a name="l00803"></a>00803                         <a class="code" href="_g_l_8h.html#36c3f955599ab92217a70cce8a22e11f">GL_UNSIGNED_SHORT</a>,
<a name="l00804"></a>00804                         ( ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* )0 ) + _ranges[ range ].<a class="code" href="_g_l_8h.html#c55adc720a3098c1b454d2a4647f4361">start</a> );
<a name="l00805"></a>00805         }
<a name="l00806"></a>00806         <span class="keywordflow">else</span>
<a name="l00807"></a>00807         {
<a name="l00809"></a>00809                 <a class="code" href="_g_l_subsys_8cpp.html#2ba9bfe7eec2c0fb8e598623238be561">bglDrawArrays</a>( <a class="code" href="_g_l_8h.html#6079e7a02a59adad65eb953d9482b1ed">GL_TRIANGLES</a>, _ranges[ range ].<a class="code" href="_g_l_8h.html#c55adc720a3098c1b454d2a4647f4361">start</a>, _ranges[ range ].<a class="code" href="_g_l_8h.html#10b284d589000663becfbc6867a3a9f7">count</a> );
<a name="l00810"></a>00810         }
<a name="l00811"></a>00811         <a class="code" href="_g_l_subsys_8h.html#ab12f88c1ad74a5b4876f37fcf105bda">CHECK_GL</a>();
<a name="l00812"></a>00812 <span class="preprocessor">#endif</span>
<a name="l00813"></a>00813 <span class="preprocessor"></span>}
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 <span class="comment">//----------------------------------------------------------</span>
<a name="l00816"></a>00816 <span class="keywordtype">void</span>
<a name="l00817"></a><a class="code" href="class_gr_mesh.html#68406b099ee7e6a796ba4ca230cb73a8">00817</a> <a class="code" href="class_gr_mesh.html#68406b099ee7e6a796ba4ca230cb73a8" title="debugging functions.">GrMesh::DrawNormals</a>()
<a name="l00818"></a>00818 {
<a name="l00819"></a>00819         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* vertices = _vertexBuffer-&gt;GetVertices();
<a name="l00820"></a>00820         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* normals = _vertexBuffer-&gt;GetNormals();
<a name="l00821"></a>00821         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = _vertexBuffer-&gt;GetVertexCount();
<a name="l00822"></a>00822         <a class="code" href="_g_l_subsys_8cpp.html#afdf3a93cbf608f43789a1fa3ff1a925">bglBegin</a>( <a class="code" href="_g_l_8h.html#532ed3612eae8eaed8a7a53ecd7a28f3">GL_LINES</a> );
<a name="l00823"></a>00823         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; vertexCount; ++i )
<a name="l00824"></a>00824         {
<a name="l00825"></a>00825                 <a class="code" href="_g_l_subsys_8cpp.html#e38cf5086b3c3fb243e11f7e58bb5dd3">bglVertex3f</a>( vertices[ i ].<a class="code" href="glext_8h.html#d77deca22f617d3f0e0eb786445689fc">x</a>, vertices[ i ].<a class="code" href="_g_l_8h.html#9298c7ad619074f5285b32c6b72bfdea">y</a>, vertices[ i ].<a class="code" href="glext_8h.html#5b27107fca91cf19a778530405575b37">z</a> );
<a name="l00826"></a>00826                 <a class="code" href="_g_l_subsys_8cpp.html#e38cf5086b3c3fb243e11f7e58bb5dd3">bglVertex3f</a>( vertices[ i ].x+normals[ i ].x, vertices[ i ].y+normals[ i ].y, vertices[ i ].z+normals[ i ].z );
<a name="l00827"></a>00827         }
<a name="l00828"></a>00828         <a class="code" href="_g_l_subsys_8cpp.html#98e730ab9ca687a9a110d6d6707a38ae">bglEnd</a>();
<a name="l00829"></a>00829 }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831 <span class="comment">//----------------------------------------------------------</span>
<a name="l00832"></a>00832 <span class="keywordtype">void</span>
<a name="l00833"></a><a class="code" href="class_gr_mesh.html#04d6da4023764e8fad5e8824bf0bcb56">00833</a> <a class="code" href="class_gr_mesh.html#04d6da4023764e8fad5e8824bf0bcb56">GrMesh::DrawTangents</a>()
<a name="l00834"></a>00834 {
<a name="l00835"></a>00835         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* vertices = _vertexBuffer-&gt;GetVertices();
<a name="l00836"></a>00836         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* tangents = _vertexBuffer-&gt;GetTangents();
<a name="l00837"></a>00837         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = _vertexBuffer-&gt;GetVertexCount();
<a name="l00838"></a>00838         <a class="code" href="_g_l_subsys_8cpp.html#afdf3a93cbf608f43789a1fa3ff1a925">bglBegin</a>( <a class="code" href="_g_l_8h.html#532ed3612eae8eaed8a7a53ecd7a28f3">GL_LINES</a> );
<a name="l00839"></a>00839         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; vertexCount; ++i )
<a name="l00840"></a>00840         {
<a name="l00841"></a>00841                 <a class="code" href="_g_l_subsys_8cpp.html#e38cf5086b3c3fb243e11f7e58bb5dd3">bglVertex3f</a>( vertices[ i ].<a class="code" href="glext_8h.html#d77deca22f617d3f0e0eb786445689fc">x</a>, vertices[ i ].<a class="code" href="_g_l_8h.html#9298c7ad619074f5285b32c6b72bfdea">y</a>, vertices[ i ].<a class="code" href="glext_8h.html#5b27107fca91cf19a778530405575b37">z</a> );
<a name="l00842"></a>00842                 <a class="code" href="_g_l_subsys_8cpp.html#e38cf5086b3c3fb243e11f7e58bb5dd3">bglVertex3f</a>( vertices[ i ].x+tangents[ i ].x, vertices[ i ].y+tangents[ i ].y, vertices[ i ].z+tangents[ i ].z );
<a name="l00843"></a>00843         }
<a name="l00844"></a>00844         <a class="code" href="_g_l_subsys_8cpp.html#98e730ab9ca687a9a110d6d6707a38ae">bglEnd</a>();
<a name="l00845"></a>00845 }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847 <span class="comment">//----------------------------------------------------------</span>
<a name="l00848"></a>00848 <span class="keywordtype">void</span>
<a name="l00849"></a><a class="code" href="class_gr_mesh.html#a2f68d017f548b65b3a7a23cf451d71d">00849</a> <a class="code" href="class_gr_mesh.html#a2f68d017f548b65b3a7a23cf451d71d">GrMesh::DrawBinormals</a>()
<a name="l00850"></a>00850 {
<a name="l00851"></a>00851         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* vertices = _vertexBuffer-&gt;GetVertices();
<a name="l00852"></a>00852         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* biNormals = _vertexBuffer-&gt;GetBiNormals();
<a name="l00853"></a>00853         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = _vertexBuffer-&gt;GetVertexCount();
<a name="l00854"></a>00854         <a class="code" href="_g_l_subsys_8cpp.html#afdf3a93cbf608f43789a1fa3ff1a925">bglBegin</a>( <a class="code" href="_g_l_8h.html#532ed3612eae8eaed8a7a53ecd7a28f3">GL_LINES</a> );
<a name="l00855"></a>00855         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; vertexCount; ++i )
<a name="l00856"></a>00856         {
<a name="l00857"></a>00857                 <a class="code" href="_g_l_subsys_8cpp.html#e38cf5086b3c3fb243e11f7e58bb5dd3">bglVertex3f</a>( vertices[ i ].<a class="code" href="glext_8h.html#d77deca22f617d3f0e0eb786445689fc">x</a>, vertices[ i ].<a class="code" href="_g_l_8h.html#9298c7ad619074f5285b32c6b72bfdea">y</a>, vertices[ i ].<a class="code" href="glext_8h.html#5b27107fca91cf19a778530405575b37">z</a> );
<a name="l00858"></a>00858                 <a class="code" href="_g_l_subsys_8cpp.html#e38cf5086b3c3fb243e11f7e58bb5dd3">bglVertex3f</a>( vertices[ i ].x+biNormals[ i ].x, vertices[ i ].y+biNormals[ i ].y, vertices[ i ].z+biNormals[ i ].z );
<a name="l00859"></a>00859         }
<a name="l00860"></a>00860         <a class="code" href="_g_l_subsys_8cpp.html#98e730ab9ca687a9a110d6d6707a38ae">bglEnd</a>();
<a name="l00861"></a>00861 }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 <span class="comment">//----------------------------------------------------------</span>
<a name="l00864"></a>00864 <span class="keywordtype">void</span>
<a name="l00865"></a><a class="code" href="class_gr_mesh.html#ead45c368e214350ddb2f218471f18cc">00865</a> <a class="code" href="class_gr_mesh.html#ead45c368e214350ddb2f218471f18cc" title="saving and loading.">GrMesh::Save</a>( <a class="code" href="class_u_writer.html" title="Purpose: To wrap and simplify pointer write operations.">UWriter</a>&amp; writer )<span class="keyword"> const</span>
<a name="l00866"></a>00866 <span class="keyword"></span>{
<a name="l00867"></a>00867         writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( <span class="stringliteral">'\0HSM'</span> );
<a name="l00868"></a>00868 
<a name="l00870"></a>00870         writer.<a class="code" href="class_u_writer.html#ad53e1a9063eec9545834eb288fe0767">WriteShort</a>( 0 );
<a name="l00871"></a>00871         writer.<a class="code" href="class_u_writer.html#ad53e1a9063eec9545834eb288fe0767">WriteShort</a>( 2 );
<a name="l00872"></a>00872 
<a name="l00874"></a>00874         writer.<a class="code" href="class_u_writer.html#bbe55ee0c4a3b202b365da202899d410" title="public methods">WriteString</a>( _name );
<a name="l00875"></a>00875 
<a name="l00877"></a>00877         writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( _vertexBuffer-&gt;GetFlags() );
<a name="l00878"></a>00878         writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( _indexBuffer ? _indexBuffer-&gt;GetFlags() : 0 );
<a name="l00879"></a>00879 
<a name="l00881"></a>00881         writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( ( <span class="keywordtype">int</span> )_rangeCount );
<a name="l00882"></a>00882         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _rangeCount; ++i )
<a name="l00883"></a>00883         {
<a name="l00885"></a>00885                 writer.<a class="code" href="class_u_writer.html#bbe55ee0c4a3b202b365da202899d410" title="public methods">WriteString</a>( _ranges[ i ].name );
<a name="l00886"></a>00886                 writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( ( <span class="keywordtype">int</span> )_ranges[ i ].<a class="code" href="_g_l_8h.html#c55adc720a3098c1b454d2a4647f4361">start</a> );
<a name="l00887"></a>00887                 writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( ( <span class="keywordtype">int</span> )_ranges[ i ].<a class="code" href="_g_l_8h.html#10b284d589000663becfbc6867a3a9f7">count</a> );
<a name="l00888"></a>00888                 writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( ( <span class="keywordtype">int</span> )_ranges[ i ].minIndex );
<a name="l00889"></a>00889                 writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( ( <span class="keywordtype">int</span> )_ranges[ i ].maxIndex );
<a name="l00890"></a>00890 
<a name="l00891"></a>00891                 _ranges[ i ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#7c2fe272192a5165a0f3c6b854ba83d1">bounds</a>.<a class="code" href="class_m_sphere.html#7481f688cff487b8d49d597d73263db8">Save</a>( writer );
<a name="l00892"></a>00892                 _ranges[ i ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6f515e5181e2803d43e7e2bc36bdb430">aaBox</a>.<a class="code" href="class_m_a_a_box.html#c24b0c3002a56fd52de6628e1864e485">Save</a>( writer );
<a name="l00893"></a>00893         }
<a name="l00894"></a>00894 
<a name="l00896"></a>00896         writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( ( <span class="keywordtype">int</span> )_vertexBuffer-&gt;GetVertexCount() );
<a name="l00897"></a>00897         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l00898"></a>00898                 writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( ( <span class="keywordtype">int</span> )_indexBuffer-&gt;GetIndexCount() );
<a name="l00899"></a>00899         <span class="keywordflow">else</span>
<a name="l00900"></a>00900                 writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( 0 );
<a name="l00901"></a>00901 
<a name="l00903"></a>00903         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_u_t_message_8h.html#0a3c0b351ab09281b662a9ff4f900a53">flags</a> = _vertexBuffer-&gt;GetUsedComponents();
<a name="l00904"></a>00904 
<a name="l00906"></a>00906         writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( ( <span class="keywordtype">int</span> )flags );
<a name="l00907"></a>00907 
<a name="l00909"></a>00909         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = _vertexBuffer-&gt;GetVertexCount();
<a name="l00910"></a>00910         writer.<a class="code" href="class_u_writer.html#db6161ee8139f7215bddb0c0e9f7f427">WriteBytes</a>( _vertexBuffer-&gt;GetVertices(), <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> ) * vertexCount );
<a name="l00911"></a>00911         <span class="keywordflow">if</span> ( _vertexBuffer-&gt;GetTangents() )
<a name="l00912"></a>00912                 writer.<a class="code" href="class_u_writer.html#db6161ee8139f7215bddb0c0e9f7f427">WriteBytes</a>( _vertexBuffer-&gt;GetTangents(), <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> ) * vertexCount );
<a name="l00913"></a>00913 
<a name="l00914"></a>00914         <span class="keywordflow">if</span> ( _vertexBuffer-&gt;GetBiNormals() )
<a name="l00915"></a>00915                 writer.<a class="code" href="class_u_writer.html#db6161ee8139f7215bddb0c0e9f7f427">WriteBytes</a>( _vertexBuffer-&gt;GetBiNormals(), <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> ) * vertexCount );
<a name="l00916"></a>00916 
<a name="l00917"></a>00917         <span class="keywordflow">if</span> ( _vertexBuffer-&gt;GetNormals() )
<a name="l00918"></a>00918                 writer.<a class="code" href="class_u_writer.html#db6161ee8139f7215bddb0c0e9f7f427">WriteBytes</a>( _vertexBuffer-&gt;GetNormals(), <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> ) * vertexCount );
<a name="l00919"></a>00919 
<a name="l00920"></a>00920         <span class="keywordflow">if</span> ( _vertexBuffer-&gt;GetTexCoords() )
<a name="l00921"></a>00921                 writer.<a class="code" href="class_u_writer.html#db6161ee8139f7215bddb0c0e9f7f427">WriteBytes</a>( _vertexBuffer-&gt;GetTexCoords(), <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a> ) * vertexCount );
<a name="l00922"></a>00922 
<a name="l00923"></a>00923         <span class="keywordflow">if</span> ( _vertexBuffer-&gt;GetColors() )
<a name="l00924"></a>00924                 writer.<a class="code" href="class_u_writer.html#db6161ee8139f7215bddb0c0e9f7f427">WriteBytes</a>( _vertexBuffer-&gt;GetColors(), <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> long ) * vertexCount );
<a name="l00925"></a>00925 
<a name="l00927"></a>00927         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l00928"></a>00928                 writer.<a class="code" href="class_u_writer.html#db6161ee8139f7215bddb0c0e9f7f427">WriteBytes</a>( _indexBuffer-&gt;GetIndices(), <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> short ) * _indexBuffer-&gt;GetIndexCount() );
<a name="l00929"></a>00929 
<a name="l00931"></a>00931         writer.<a class="code" href="class_u_writer.html#bbe55ee0c4a3b202b365da202899d410" title="public methods">WriteString</a>( _skin != 0 ? _skin-&gt;GetName() : <span class="stringliteral">""</span> );
<a name="l00932"></a>00932         writer.<a class="code" href="class_u_writer.html#a1f6d44d3988a40cc188ab237c5edc0a">WriteUInt</a>( _startSkinIdx );
<a name="l00933"></a>00933         writer.<a class="code" href="class_u_writer.html#a1f6d44d3988a40cc188ab237c5edc0a">WriteUInt</a>( _skinVertexCount );
<a name="l00934"></a>00934 
<a name="l00936"></a>00936         _aaBox.<a class="code" href="class_m_a_a_box.html#c24b0c3002a56fd52de6628e1864e485">Save</a>( writer );
<a name="l00937"></a>00937 
<a name="l00939"></a>00939         _boundingSphere.<a class="code" href="class_m_sphere.html#7481f688cff487b8d49d597d73263db8">Save</a>( writer );
<a name="l00940"></a>00940 
<a name="l00942"></a>00942 }
<a name="l00943"></a>00943 
<a name="l00944"></a>00944 <span class="comment">//----------------------------------------------------------</span>
<a name="l00945"></a>00945 <span class="keywordtype">void</span>
<a name="l00946"></a><a class="code" href="class_gr_mesh.html#4ade8286c992e61e1029bab4e75a4eb9">00946</a> <a class="code" href="class_gr_mesh.html#4ade8286c992e61e1029bab4e75a4eb9">GrMesh::Load</a>( <a class="code" href="class_u_reader.html" title="Purpose: To wrap and simplify pointer read operations.">UReader</a>&amp; reader, <span class="keyword">const</span> <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray</a>&lt; <a class="code" href="class_u_ref.html">URef&lt; GrSkin &gt;</a> &gt;&amp; skins )
<a name="l00947"></a>00947 {
<a name="l00949"></a>00949         CleanUp();
<a name="l00950"></a>00950 
<a name="l00951"></a>00951         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> majorVer = 0;
<a name="l00952"></a>00952         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> minorVer = 0;
<a name="l00953"></a>00953         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> tag = reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00954"></a>00954         <span class="keywordflow">if</span> ( tag == <span class="stringliteral">'\0HSM'</span> )
<a name="l00955"></a>00955         {
<a name="l00956"></a>00956                 minorVer = reader.<a class="code" href="class_u_reader.html#4ddc2edc9b761259588297ef1618a68b">ReadShort</a>();
<a name="l00957"></a>00957                 majorVer = reader.<a class="code" href="class_u_reader.html#4ddc2edc9b761259588297ef1618a68b">ReadShort</a>();
<a name="l00958"></a>00958         }
<a name="l00959"></a>00959         <span class="keywordflow">else</span>
<a name="l00960"></a>00960         {
<a name="l00961"></a>00961                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( tag == <span class="stringliteral">'HSEM'</span> );
<a name="l00962"></a>00962         }
<a name="l00963"></a>00963 
<a name="l00965"></a>00965         _name = reader.<a class="code" href="class_u_reader.html#2c8ded1a48118dd661e60ce19a6c926a" title="public members">ReadString</a>();
<a name="l00966"></a>00966 
<a name="l00968"></a>00968         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vbFlags = reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00969"></a>00969         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibFlags = reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00970"></a>00970 
<a name="l00972"></a>00972         _rangeCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00973"></a>00973         _ranges = <span class="keyword">new</span> <a class="code" href="struct_gr_mesh_1_1_s_range.html">SRange</a>[ _rangeCount ];
<a name="l00974"></a>00974         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _rangeCount; ++i )
<a name="l00975"></a>00975         {
<a name="l00977"></a>00977                 _ranges[ i ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#332525f7e1ef670c14bd59cd8b47a34f">name</a> = reader.<a class="code" href="class_u_reader.html#2c8ded1a48118dd661e60ce19a6c926a" title="public members">ReadString</a>();
<a name="l00978"></a>00978                 _ranges[ i ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a> = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00979"></a>00979                 _ranges[ i ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a> = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00980"></a>00980                 _ranges[ i ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#63e71ca2a50a27fa4c6b95ebfd7472f4" title="number of vertices or indices to process.">minIndex</a> = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00981"></a>00981                 _ranges[ i ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#7e44b7370e15a3faaea7669107d2f4cd" title="only used for indexed meshes.">maxIndex</a> = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00982"></a>00982 
<a name="l00984"></a>00984                 <span class="keywordflow">if</span> ( majorVer &lt; 2 )
<a name="l00985"></a>00985                         reader.<a class="code" href="class_u_reader.html#2c8ded1a48118dd661e60ce19a6c926a" title="public members">ReadString</a>();
<a name="l00986"></a>00986 
<a name="l00988"></a>00988                 _ranges[ i ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#7c2fe272192a5165a0f3c6b854ba83d1">bounds</a>.<a class="code" href="class_m_sphere.html#5b22737c077b40775756e2845859c925">Load</a>( reader );
<a name="l00989"></a>00989                 _ranges[ i ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6f515e5181e2803d43e7e2bc36bdb430">aaBox</a>.<a class="code" href="class_m_a_a_box.html#7658fd191ee1fbbf3d6f93d0221fe13a">Load</a>( reader );
<a name="l00990"></a>00990         }
<a name="l00991"></a>00991 
<a name="l00993"></a>00993         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00994"></a>00994         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indexCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00995"></a>00995 
<a name="l00997"></a>00997         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_u_t_message_8h.html#0a3c0b351ab09281b662a9ff4f900a53">flags</a> = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00998"></a>00998 
<a name="l01002"></a>01002         _vertexBuffer = <a class="code" href="_gr_mesh_buffer_mgr_8cpp.html#b3896ffcf9e16ca80efeb7f2e44ba879" title="class header.">gGrMeshBufferMgr</a>-&gt;<a class="code" href="class_gr_mesh_buffer_mgr.html#e2becc9588cfb3d8858a4c998bc3dbc6" title="public methods">CreateMeshVB</a>( vertexCount, flags &amp; <a class="code" href="_gr_config_8h.html#bff9fb4a09063e0c6941f735cd3ebc0f">GR_ATTRIB_MASK_ALL</a>,
<a name="l01003"></a>01003                 ( vbFlags &amp; <a class="code" href="class_gr_mesh_v_b.html#2af3fdf0087d2543d2861bd677139cdc">GrMeshVB::kDynamic</a> ) != 0 );
<a name="l01004"></a>01004 
<a name="l01006"></a>01006         <span class="keywordflow">if</span> ( flags &amp; <a class="code" href="_gr_config_8h.html#2edd88842519480ffc74005f8219c83d" title="engine driven shader attribute enable flags.">GR_ATTRIB_POSITION_MASK</a> )
<a name="l01007"></a>01007                 reader.<a class="code" href="class_u_reader.html#bd5d03b7bca4540f0cdcfb4226f002ee">ReadBytes</a>( _vertexBuffer-&gt;GetVertices(), <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> ) * vertexCount );
<a name="l01008"></a>01008 
<a name="l01009"></a>01009         <span class="keywordflow">if</span> ( flags &amp; <a class="code" href="_gr_config_8h.html#a5dacae32db07853c8fbe5ac8da96099">GR_ATTRIB_TANGENT_MASK</a> )
<a name="l01010"></a>01010                 reader.<a class="code" href="class_u_reader.html#bd5d03b7bca4540f0cdcfb4226f002ee">ReadBytes</a>( _vertexBuffer-&gt;GetTangents(), <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> ) * vertexCount );
<a name="l01011"></a>01011 
<a name="l01012"></a>01012         <span class="keywordflow">if</span> ( flags &amp; <a class="code" href="_gr_config_8h.html#2f62b5af7e819726604bbbd575bd6da3">GR_ATTRIB_BINORMAL_MASK</a> )
<a name="l01013"></a>01013                 reader.<a class="code" href="class_u_reader.html#bd5d03b7bca4540f0cdcfb4226f002ee">ReadBytes</a>( _vertexBuffer-&gt;GetBiNormals(), <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> ) * vertexCount );
<a name="l01014"></a>01014 
<a name="l01015"></a>01015         <span class="keywordflow">if</span> ( flags &amp; <a class="code" href="_gr_config_8h.html#a8ee6eedb550888bea1ad5eca3fee7d9">GR_ATTRIB_NORMAL_MASK</a> )
<a name="l01016"></a>01016                 reader.<a class="code" href="class_u_reader.html#bd5d03b7bca4540f0cdcfb4226f002ee">ReadBytes</a>( _vertexBuffer-&gt;GetNormals(), <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> ) * vertexCount );
<a name="l01017"></a>01017 
<a name="l01018"></a>01018         <span class="keywordflow">if</span> ( flags &amp; <a class="code" href="_gr_config_8h.html#3f063b92b78becda8efba252ecb3bccd">GR_ATTRIB_TEXCOORD_MASK</a> )
<a name="l01019"></a>01019                 reader.<a class="code" href="class_u_reader.html#bd5d03b7bca4540f0cdcfb4226f002ee">ReadBytes</a>( _vertexBuffer-&gt;GetTexCoords(), <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a> ) * vertexCount );
<a name="l01020"></a>01020 
<a name="l01021"></a>01021         <span class="keywordflow">if</span> ( flags &amp; <a class="code" href="_gr_config_8h.html#8bf9bfc6d234029203d9fc6e1bc50225">GR_ATTRIB_COLOR_MASK</a> )
<a name="l01022"></a>01022                 reader.<a class="code" href="class_u_reader.html#bd5d03b7bca4540f0cdcfb4226f002ee">ReadBytes</a>( _vertexBuffer-&gt;GetColors(), <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> long ) * vertexCount );
<a name="l01023"></a>01023 
<a name="l01025"></a>01025         <span class="keywordflow">if</span> ( indexCount )
<a name="l01026"></a>01026         {
<a name="l01027"></a>01027                 _indexBuffer = <a class="code" href="_gr_mesh_buffer_mgr_8cpp.html#b3896ffcf9e16ca80efeb7f2e44ba879" title="class header.">gGrMeshBufferMgr</a>-&gt;<a class="code" href="class_gr_mesh_buffer_mgr.html#91c2e8bf41d8e63797ace280348679eb">CreateMeshIB</a>( indexCount, ( ibFlags &amp; <a class="code" href="class_gr_mesh_i_b.html#5793b340a735f6ef818f74e6727fcf00">GrMeshIB::kDynamic</a> ) != 0 );
<a name="l01028"></a>01028                 reader.<a class="code" href="class_u_reader.html#bd5d03b7bca4540f0cdcfb4226f002ee">ReadBytes</a>( _indexBuffer-&gt;GetIndices(), <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> short ) * indexCount );
<a name="l01029"></a>01029         }
<a name="l01030"></a>01030 
<a name="l01032"></a>01032         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> skinName = reader.<a class="code" href="class_u_reader.html#2c8ded1a48118dd661e60ce19a6c926a" title="public members">ReadString</a>();
<a name="l01033"></a>01033         <span class="keywordflow">if</span> ( skinName.length() &gt; 0 )
<a name="l01034"></a>01034         {
<a name="l01035"></a>01035                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; skins.GetElemCount(); ++i )
<a name="l01036"></a>01036                 {
<a name="l01037"></a>01037                         <span class="keywordflow">if</span> ( skins[ i ]-&gt;<a class="code" href="class_gr_mesh.html#0e0a8a4a9bf673b8164599bb6b76c0a5">GetName</a>() == skinName )
<a name="l01038"></a>01038                         {
<a name="l01039"></a>01039                                 _skin = skins[ i ];
<a name="l01040"></a>01040                                 <span class="keywordflow">break</span>;
<a name="l01041"></a>01041                         }
<a name="l01042"></a>01042                 }
<a name="l01043"></a>01043         }
<a name="l01044"></a>01044         _startSkinIdx = reader.<a class="code" href="class_u_reader.html#14d2bfe8a38307b1ecb774b70c910c65">ReadUInt</a>();
<a name="l01045"></a>01045         _skinVertexCount = reader.<a class="code" href="class_u_reader.html#14d2bfe8a38307b1ecb774b70c910c65">ReadUInt</a>();
<a name="l01046"></a>01046 
<a name="l01048"></a>01048         _aaBox.<a class="code" href="class_m_a_a_box.html#7658fd191ee1fbbf3d6f93d0221fe13a">Load</a>( reader );
<a name="l01049"></a>01049 
<a name="l01051"></a>01051         _boundingSphere.<a class="code" href="class_m_sphere.html#5b22737c077b40775756e2845859c925">Load</a>( reader );
<a name="l01052"></a>01052 }
<a name="l01053"></a>01053 
<a name="l01054"></a>01054 
<a name="l01055"></a>01055 <span class="comment">//==========================================================</span>
<a name="l01057"></a>01057 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l01058"></a>01058 
<a name="l01059"></a>01059 <span class="comment">//----------------------------------------------------------</span>
<a name="l01060"></a>01060 <span class="keywordtype">void</span>
<a name="l01061"></a>01061 <a class="code" href="class_gr_mesh.html#ca24f02b9e2cf3342a81f9ee1493f6ea">GrMesh::SetSkin</a>( <a class="code" href="class_u_ref.html">URef&lt; GrSkin &gt;</a> skin, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startIdx, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> skinVertexCount )
<a name="l01062"></a>01062 {
<a name="l01063"></a>01063         _skin = skin;
<a name="l01064"></a>01064         _startSkinIdx = startIdx;
<a name="l01065"></a>01065         _skinVertexCount = skinVertexCount;
<a name="l01066"></a>01066 }
<a name="l01067"></a>01067 
<a name="l01068"></a>01068 <span class="comment">//----------------------------------------------------------</span>
<a name="l01069"></a>01069 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l01070"></a><a class="code" href="class_gr_mesh.html#de8aa56cad498c5eb9e362fd3e5618cd">01070</a> <a class="code" href="class_gr_mesh.html#de8aa56cad498c5eb9e362fd3e5618cd">GrMesh::GetRangeVertexStart</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a> )<span class="keyword"> const</span>
<a name="l01071"></a>01071 <span class="keyword"></span>{
<a name="l01072"></a>01072         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l01073"></a>01073                 <span class="keywordflow">return</span> _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#63e71ca2a50a27fa4c6b95ebfd7472f4" title="number of vertices or indices to process.">minIndex</a>;
<a name="l01074"></a>01074         <span class="keywordflow">return</span> _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a>;
<a name="l01075"></a>01075 }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077 <span class="comment">//----------------------------------------------------------</span>
<a name="l01078"></a>01078 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l01079"></a><a class="code" href="class_gr_mesh.html#47e18fec5f6a5e448cff0b5f27008aa6">01079</a> <a class="code" href="class_gr_mesh.html#47e18fec5f6a5e448cff0b5f27008aa6">GrMesh::GetRangeVertexCount</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#7b8ad0b27a927682837f95528fa454f5">range</a> )<span class="keyword"> const</span>
<a name="l01080"></a>01080 <span class="keyword"></span>{
<a name="l01081"></a>01081         <span class="keywordflow">if</span> ( _indexBuffer )
<a name="l01082"></a>01082                 <span class="keywordflow">return</span> _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#7e44b7370e15a3faaea7669107d2f4cd" title="only used for indexed meshes.">maxIndex</a> - _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#63e71ca2a50a27fa4c6b95ebfd7472f4" title="number of vertices or indices to process.">minIndex</a> + 1;
<a name="l01083"></a>01083         <span class="keywordflow">return</span> _ranges[ range ].<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a>;
<a name="l01084"></a>01084 }
<a name="l01085"></a>01085 
<a name="l01086"></a>01086 <span class="comment">//----------------------------------------------------------</span>
<a name="l01087"></a>01087 <span class="keywordtype">void</span>
<a name="l01088"></a>01088 GrMesh::CalcBoundingSphere()
<a name="l01089"></a>01089 {
<a name="l01091"></a>01091         _boundingSphere.<a class="code" href="class_m_sphere.html#b511291f81201151624da739876a1284">SetCenter</a>( _aaBox.<a class="code" href="class_m_a_a_box.html#a9fbd78524a8e1c00a165177b7cf888f">GetCenter</a>() );
<a name="l01092"></a>01092         _boundingSphere.<a class="code" href="class_m_sphere.html#94cc442a90bbb4f5d4f3e8e9036cef71">SetRadius</a>( _aaBox.<a class="code" href="class_m_a_a_box.html#9c4c37dd6c9bffdbe6926c5a4c60145c">GetHalfExts</a>().<a class="code" href="class_m_vec3.html#5dfd83de3ed52ac479d69a1c8407d495">Mag</a>() );
<a name="l01093"></a>01093 
<a name="l01095"></a>01095         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="glext_8h.html#31034e24af8271ed8267858116fe2e48">r</a> = 0; <a class="code" href="glext_8h.html#31034e24af8271ed8267858116fe2e48">r</a> &lt; _rangeCount; ++<a class="code" href="glext_8h.html#31034e24af8271ed8267858116fe2e48">r</a> )
<a name="l01096"></a>01096         {
<a name="l01097"></a>01097                 SRange&amp; curRange = _ranges[ <a class="code" href="glext_8h.html#31034e24af8271ed8267858116fe2e48">r</a> ];
<a name="l01098"></a>01098                 curRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#7c2fe272192a5165a0f3c6b854ba83d1">bounds</a>.<a class="code" href="class_m_sphere.html#b511291f81201151624da739876a1284">SetCenter</a>( curRange.aaBox.GetCenter() );
<a name="l01099"></a>01099                 curRange.bounds.SetRadius( curRange.aaBox.GetHalfExts().Mag() );
<a name="l01100"></a>01100         }
<a name="l01101"></a>01101 }
<a name="l01102"></a>01102 
<a name="l01103"></a>01103 <span class="comment">//----------------------------------------------------------</span>
<a name="l01104"></a>01104 <span class="keywordtype">void</span>
<a name="l01105"></a>01105 GrMesh::CleanUp()
<a name="l01106"></a>01106 {
<a name="l01107"></a>01107         <span class="keyword">delete</span>[] _ranges;
<a name="l01108"></a>01108         _skin = 0;
<a name="l01109"></a>01109         _ranges = 0;
<a name="l01110"></a>01110         _vertexBuffer = 0;
<a name="l01111"></a>01111         _indexBuffer = 0;
<a name="l01112"></a>01112 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Feb 13 17:19:55 2009 for Bootstrap Engine by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
