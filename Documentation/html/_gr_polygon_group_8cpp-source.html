<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Bootstrap Engine: C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrPolygonGroup.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrPolygonGroup.cpp</h1><a href="_gr_polygon_group_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//----------------------------------------------------------</span>
<a name="l00006"></a>00006 <span class="comment"></span><span class="comment">//----------------------------------------------------------</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="graphics__afx_8h.html">graphics_afx.h</a>"</span>
<a name="l00008"></a>00008 
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="_gr_polygon_group_8h.html">GrPolygonGroup.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="_gr_polygon_8h.html">GrPolygon.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="_gr_mesh_inst_8h.html">GrMeshInst.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="_gr_mesh_8h.html">GrMesh.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="_m_plane_8h.html">MPlane.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="_gr_material_8h.html">GrMaterial.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="_gr_texture_base_8h.html">GrTextureBase.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="_m_sphere_8h.html">MSphere.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "<a class="code" href="_gr_skin_8h.html">GrSkin.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="_gr_texture_8h.html">GrTexture.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="_gr_polygon_b_i_tree_8h.html">GrPolygonBITree.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "<a class="code" href="_gr_calc_tangents_8h.html">GrCalcTangents.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="_gr_uber_texture_8h.html">GrUberTexture.h</a>"</span>
<a name="l00025"></a>00025 
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#include &lt;set&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#endif</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>
<a name="l00034"></a><a class="code" href="_gr_polygon_group_8cpp.html#b09ee0b40519668a6e27d7b07921a9db">00034</a> <span class="preprocessor">#define USE_APPROX_COMPARE                              1</span>
<a name="l00035"></a><a class="code" href="_gr_polygon_group_8cpp.html#e0f46c846cc714bc91c2d64d736c4791">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define INDEXIFY_RANGES_SEPARATE                1</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a><a class="code" href="_gr_polygon_group_8cpp.html#e680c9539eb76f05dd8330b6e65897eb">00037</a> <span class="preprocessor">#define TO_FIXED_18( x )                                ( ( int )( ( double )( x ) * 262144.0 + 0.5 * Sign( x ) ) )</span>
<a name="l00038"></a><a class="code" href="_gr_polygon_group_8cpp.html#fbad844d782d7a357d2c20a479892e88">00038</a> <span class="preprocessor"></span><span class="preprocessor">#define TO_FIXED_10( x )                                ( ( int )( ( double )( x ) * 1024.0 + 0.5 * Sign( x ) ) )</span>
<a name="l00039"></a><a class="code" href="_gr_polygon_group_8cpp.html#4ddf448d15b8e574ccc0229822b8469a">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define TO_FIXED_8( x )                                 ( ( int )( ( double )( x ) * 256.0 + 0.5 * Sign( x ) ) )</span>
<a name="l00040"></a><a class="code" href="_gr_polygon_group_8cpp.html#2e25aab783a65f7d0c9e8000311324c3">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define TO_FIXED_0( x )                                 ( ( int )( ( double )( x ) * 0.0 + 0.5 * Sign( x ) ) )</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a><a class="code" href="class_poly_mat_cmp.html">00042</a> <span class="keyword">class </span><a class="code" href="class_poly_mat_cmp.html">PolyMatCmp</a>
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044 <span class="keyword">public</span>:
<a name="l00045"></a><a class="code" href="class_poly_mat_cmp.html#63a69ce5e6036ba3d601a9e58165a2bf">00045</a>         <span class="keywordtype">bool</span>            <a class="code" href="class_poly_mat_cmp.html#63a69ce5e6036ba3d601a9e58165a2bf">operator () </a>( <span class="keyword">const</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>* lhs, <span class="keyword">const</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>* rhs )
<a name="l00046"></a>00046         {
<a name="l00048"></a>00048                 intptr_t lhsMat = ( intptr_t )( <a class="code" href="class_gr_material.html" title="class GrMaterial">GrMaterial</a>* )lhs-&gt;<a class="code" href="class_gr_polygon.html#b4a64686345e7c952395fb5432822f7d" title="material information.">GetMaterial</a>();
<a name="l00049"></a>00049                 intptr_t rhsMat = ( intptr_t )( <a class="code" href="class_gr_material.html" title="class GrMaterial">GrMaterial</a>* )rhs-&gt;<a class="code" href="class_gr_polygon.html#b4a64686345e7c952395fb5432822f7d" title="material information.">GetMaterial</a>();
<a name="l00050"></a>00050                 <span class="keywordflow">return</span> ( lhsMat &lt; rhsMat );
<a name="l00051"></a>00051         }
<a name="l00052"></a>00052 };
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="struct_s_simple_polygon.html">00054</a> <span class="keyword">struct </span><a class="code" href="struct_s_simple_polygon.html">SSimplePolygon</a>
<a name="l00055"></a>00055 {
<a name="l00056"></a><a class="code" href="struct_s_simple_polygon.html#474a336bea3a1e9e988b9d1211772e85">00056</a>         <a class="code" href="class_u_fast_array.html">UFastArray&lt; MVec3 &gt;</a>     <a class="code" href="struct_s_simple_polygon.html#474a336bea3a1e9e988b9d1211772e85">positions</a>;
<a name="l00057"></a><a class="code" href="struct_s_simple_polygon.html#c22461865e7eff26f0fed34c6eab08c6">00057</a>         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="struct_s_simple_polygon.html#c22461865e7eff26f0fed34c6eab08c6">tangent</a>;
<a name="l00058"></a><a class="code" href="struct_s_simple_polygon.html#0f58581dbcc49a06ea638e7647d075da">00058</a>         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="struct_s_simple_polygon.html#0f58581dbcc49a06ea638e7647d075da">binormal</a>;
<a name="l00059"></a><a class="code" href="struct_s_simple_polygon.html#0b9b7c7c6003096ce4362f81486b2c82">00059</a>         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="struct_s_simple_polygon.html#0b9b7c7c6003096ce4362f81486b2c82">normal</a>;
<a name="l00060"></a><a class="code" href="struct_s_simple_polygon.html#fd206b6c754d78d5bdab7f57726d3cb3">00060</a>         <span class="keywordtype">float</span> <a class="code" href="struct_s_simple_polygon.html#fd206b6c754d78d5bdab7f57726d3cb3">texelWidth</a>;
<a name="l00061"></a><a class="code" href="struct_s_simple_polygon.html#615cc6a328ae01bf15c78afa713c3e10">00061</a>         <span class="keywordtype">float</span> <a class="code" href="struct_s_simple_polygon.html#615cc6a328ae01bf15c78afa713c3e10">texelHeight</a>;
<a name="l00062"></a>00062 };
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="struct_s_line_height_range.html">00064</a> <span class="keyword">struct </span><a class="code" href="struct_s_line_height_range.html">SLineHeightRange</a>
<a name="l00065"></a>00065 {
<a name="l00066"></a><a class="code" href="struct_s_line_height_range.html#eb8741756e818510265720b20f87b084">00066</a>         <span class="keywordtype">float</span> <a class="code" href="struct_s_line_height_range.html#eb8741756e818510265720b20f87b084">texelStart</a>;               
<a name="l00067"></a><a class="code" href="struct_s_line_height_range.html#893a7454b4fd6b3a9b24383ea84e4f8a">00067</a>         <span class="keywordtype">float</span> <a class="code" href="struct_s_line_height_range.html#893a7454b4fd6b3a9b24383ea84e4f8a" title="first texel for the height.">texelHeight</a>;              
<a name="l00068"></a>00068 };
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="_gr_polygon_group_8cpp.html#121886848e5ea9e2a8cae30364d4ced6">00070</a> <span class="keyword">template</span>&lt; <span class="keyword">typename</span> _T, <span class="keyword">typename</span> iterator &gt; _T* <a class="code" href="_gr_polygon_group_8cpp.html#121886848e5ea9e2a8cae30364d4ced6">CopyVector</a>( iterator begin, iterator <a class="code" href="_g_l_8h.html#432111147038972f06e049e18a837002">end</a>, <span class="keywordtype">size_t</span> <a class="code" href="_g_l_8h.html#10b284d589000663becfbc6867a3a9f7">count</a> )
<a name="l00071"></a>00071 {
<a name="l00073"></a>00073         <span class="keywordflow">if</span> ( begin == end || count == 0 )
<a name="l00074"></a>00074                 <span class="keywordflow">return</span> 0;
<a name="l00075"></a>00075 
<a name="l00077"></a>00077         _T* mem = <span class="keyword">new</span> _T[ count ];
<a name="l00078"></a>00078         <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> i = 0; i &lt; count; ++i, ++begin )
<a name="l00079"></a>00079         {
<a name="l00080"></a>00080                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( begin != end );
<a name="l00081"></a>00081                 mem[ i ] = *begin;
<a name="l00082"></a>00082         }
<a name="l00083"></a>00083 
<a name="l00085"></a>00085         <span class="keywordflow">return</span> mem;
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="keyword">static</span> <span class="keywordtype">bool</span> PlaneSortCmp( <span class="keyword">const</span> std::pair&lt; float, MPlane &gt;&amp; <a class="code" href="glext_8h.html#85b8f6c07fbc1fb5d77c2ae090f21995">left</a>, <span class="keyword">const</span> std::pair&lt; float, MPlane &gt;&amp; <a class="code" href="glext_8h.html#5ffadbbacc6b89cf6218bc43b384d3fe">right</a> );
<a name="l00089"></a>00089 <span class="keyword">static</span> <span class="keywordtype">int</span> PolygonCmp( <span class="keyword">const</span> <a class="code" href="struct_s_simple_polygon.html">SSimplePolygon</a>* <a class="code" href="glext_8h.html#85b8f6c07fbc1fb5d77c2ae090f21995">left</a>, <span class="keyword">const</span> <a class="code" href="struct_s_simple_polygon.html">SSimplePolygon</a>* <a class="code" href="glext_8h.html#5ffadbbacc6b89cf6218bc43b384d3fe">right</a> );
<a name="l00090"></a>00090 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="_u_t_x_8h.html#a254d9bac3ece6a9d99def539e8a80eb">__int64</a> CalcEdgeHash( <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; <a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a>, <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; <a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a> );
<a name="l00091"></a>00091 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> IsPositionEqual( <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; rhs );
<a name="l00092"></a>00092 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> IsNormalEqual( <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; rhs );
<a name="l00093"></a>00093 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> IsTangentEqual( <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; rhs );
<a name="l00094"></a>00094 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> IsUVEqual( <span class="keyword">const</span> <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a>&amp; rhs );
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="comment">//**********************************************************</span>
<a name="l00098"></a>00098 <span class="comment"></span><span class="comment">//**********************************************************</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="comment">//==========================================================</span>
<a name="l00102"></a>00102 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="comment">//----------------------------------------------------------</span>
<a name="l00105"></a><a class="code" href="class_gr_polygon_group.html#aa3b23b7e01fc2b036a5b9826f95948a">00105</a> <a class="code" href="class_gr_polygon_group.html#aa3b23b7e01fc2b036a5b9826f95948a" title="class GrPolygonGroup">GrPolygonGroup::GrPolygonGroup</a>()
<a name="l00106"></a>00106 : _vertexCount( 0 )
<a name="l00107"></a>00107 , _aaBoxDirty( true )
<a name="l00108"></a>00108 , _boneCount( 0 ) 
<a name="l00109"></a>00109 , _boneNameArray( 0 )
<a name="l00110"></a>00110 , _invBindMatrices( 0 )
<a name="l00111"></a>00111 , _skinned( false )
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="comment">//----------------------------------------------------------</span>
<a name="l00117"></a><a class="code" href="class_gr_polygon_group.html#be9925f6b0511d2130e51891e6e685b5">00117</a> <a class="code" href="class_gr_polygon_group.html#aa3b23b7e01fc2b036a5b9826f95948a" title="class GrPolygonGroup">GrPolygonGroup::GrPolygonGroup</a>( <span class="keyword">const</span> PolygonVec&amp; list )
<a name="l00118"></a>00118 : _vertexCount( 0 )
<a name="l00119"></a>00119 , _aaBoxDirty( true )
<a name="l00120"></a>00120 , _boneCount( 0 ) 
<a name="l00121"></a>00121 , _boneNameArray( 0 )
<a name="l00122"></a>00122 , _invBindMatrices( 0 )
<a name="l00123"></a>00123 , _skinned( false )
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125         _polygons = list;
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="comment">//----------------------------------------------------------</span>
<a name="l00129"></a><a class="code" href="class_gr_polygon_group.html#b2c44b09732752e66e66bad26b06d65a">00129</a> <a class="code" href="class_gr_polygon_group.html#aa3b23b7e01fc2b036a5b9826f95948a" title="class GrPolygonGroup">GrPolygonGroup::GrPolygonGroup</a>( <span class="keyword">const</span> <a class="code" href="class_gr_polygon_group.html" title="class GrPolygonGroup">GrPolygonGroup</a>&amp; <a class="code" href="wglext_8h.html#69cec9b28d037f2272131b4fcd148620">group</a> )
<a name="l00130"></a>00130 : _vertexCount( 0 )
<a name="l00131"></a>00131 , _boneNameArray( 0 )
<a name="l00132"></a>00132 , _invBindMatrices( 0 )
<a name="l00133"></a>00133 , _boneCount( 0 )
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135         Copy( group );
<a name="l00136"></a>00136 }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="comment">//----------------------------------------------------------</span>
<a name="l00139"></a><a class="code" href="class_gr_polygon_group.html#d8d202f8e381f757ce2f9591e84b3142">00139</a> <a class="code" href="class_gr_polygon_group.html#d8d202f8e381f757ce2f9591e84b3142">GrPolygonGroup::~GrPolygonGroup</a>()
<a name="l00140"></a>00140 {
<a name="l00141"></a>00141         <a class="code" href="class_gr_polygon_group.html#a3bcc378c3f94203ec19e897361ae164">Clear</a>();
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="comment">//==========================================================</span>
<a name="l00147"></a>00147 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">//----------------------------------------------------------</span>
<a name="l00150"></a>00150 <a class="code" href="class_m_sphere.html" title="class MSphere">MSphere</a>
<a name="l00151"></a><a class="code" href="class_gr_polygon_group.html#ebce104e3d59538c74e2701e98542afa">00151</a> <a class="code" href="class_gr_polygon_group.html#ebce104e3d59538c74e2701e98542afa" title="returns a volume that encompasses all polygons.">GrPolygonGroup::GetBoundingSphere</a>()<span class="keyword"> const</span>
<a name="l00152"></a>00152 <span class="keyword"></span>{
<a name="l00154"></a>00154         EnsureAABox();
<a name="l00155"></a>00155         <span class="keywordtype">float</span> radius = _aaBox.<a class="code" href="class_m_a_a_box.html#9c4c37dd6c9bffdbe6926c5a4c60145c">GetHalfExts</a>().<a class="code" href="class_m_vec3.html#5dfd83de3ed52ac479d69a1c8407d495">Mag</a>();
<a name="l00156"></a>00156         <span class="keywordflow">return</span> <a class="code" href="class_m_sphere.html" title="class MSphere">MSphere</a>( _aaBox.<a class="code" href="class_m_a_a_box.html#a9fbd78524a8e1c00a165177b7cf888f">GetCenter</a>(), radius );
<a name="l00157"></a>00157 }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 <span class="comment">//----------------------------------------------------------</span>
<a name="l00160"></a>00160 <span class="keyword">const</span> <a class="code" href="class_m_a_a_box.html" title="class MAABox">MAABox</a>&amp;
<a name="l00161"></a><a class="code" href="class_gr_polygon_group.html#f036e17871ac905b28a8e9c90da6d0e6">00161</a> <a class="code" href="class_gr_polygon_group.html#f036e17871ac905b28a8e9c90da6d0e6">GrPolygonGroup::GetAABox</a>()<span class="keyword"> const</span>
<a name="l00162"></a>00162 <span class="keyword"></span>{
<a name="l00163"></a>00163         EnsureAABox();
<a name="l00164"></a>00164         <span class="keywordflow">return</span> _aaBox;
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="comment">//----------------------------------------------------------</span>
<a name="l00168"></a>00168 <span class="keyword">const</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>&amp;
<a name="l00169"></a><a class="code" href="class_gr_polygon_group.html#267706848b196a4f1b7b0ebdeeb7188e">00169</a> <a class="code" href="class_gr_polygon_group.html#267706848b196a4f1b7b0ebdeeb7188e">GrPolygonGroup::GetPolygon</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i )<span class="keyword"> const</span>
<a name="l00170"></a>00170 <span class="keyword"></span>{
<a name="l00171"></a>00171         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( i &lt; <a class="code" href="class_gr_polygon_group.html#3e0a4ae8030ded12301495eed40135df" title="polygon iteration">GetPolygonCount</a>() );
<a name="l00172"></a>00172         <span class="keywordflow">return</span> *_polygons[ i ];
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="comment">//----------------------------------------------------------</span>
<a name="l00176"></a>00176 <span class="keywordtype">void</span>
<a name="l00177"></a><a class="code" href="class_gr_polygon_group.html#cc582187546be8c5c3d412c5980a9029">00177</a> <a class="code" href="class_gr_polygon_group.html#cc582187546be8c5c3d412c5980a9029">GrPolygonGroup::SetPolygonMaterial</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, <a class="code" href="class_u_ref.html">URef&lt; GrMaterial &gt;</a> material )
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( i &lt; <a class="code" href="class_gr_polygon_group.html#3e0a4ae8030ded12301495eed40135df" title="polygon iteration">GetPolygonCount</a>() );
<a name="l00180"></a>00180         _polygons[ i ]-&gt;SetMaterial( material );
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="comment">//----------------------------------------------------------</span>
<a name="l00184"></a>00184 <span class="keywordtype">void</span>
<a name="l00185"></a><a class="code" href="class_gr_polygon_group.html#011cfe165e7b23f6b1a3710e63be95ec">00185</a> <a class="code" href="class_gr_polygon_group.html#011cfe165e7b23f6b1a3710e63be95ec">GrPolygonGroup::SetPolygonUserData</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> userData )
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( i &lt; <a class="code" href="class_gr_polygon_group.html#3e0a4ae8030ded12301495eed40135df" title="polygon iteration">GetPolygonCount</a>() );
<a name="l00188"></a>00188         _polygons[ i ]-&gt;SetUserData( userData );        
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="comment">//----------------------------------------------------------</span>
<a name="l00192"></a>00192 <span class="keywordtype">void</span>
<a name="l00193"></a><a class="code" href="class_gr_polygon_group.html#4385ad81ad1653c24b7a5a18018bb7a5">00193</a> <a class="code" href="class_gr_polygon_group.html#4385ad81ad1653c24b7a5a18018bb7a5">GrPolygonGroup::SetGroupUserData</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> userData )
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polyCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )_polygons.size();
<a name="l00196"></a>00196         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; polyCount; ++i )
<a name="l00197"></a>00197                 _polygons[ i ]-&gt;SetUserData( userData );
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="comment">//----------------------------------------------------------</span>
<a name="l00201"></a>00201 <span class="keywordtype">void</span>
<a name="l00202"></a><a class="code" href="class_gr_polygon_group.html#33200fb9c4556c940a842f9504bd2a85">00202</a> <a class="code" href="class_gr_polygon_group.html#33200fb9c4556c940a842f9504bd2a85" title="vertex component changes.">GrPolygonGroup::SetPolygonUV</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polygon, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertex, <span class="keyword">const</span> <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a>&amp; uv )<span class="keyword"> const</span>
<a name="l00203"></a>00203 <span class="keyword"></span>{
<a name="l00205"></a>00205         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( polygon &lt; ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> )_polygons.size() );
<a name="l00206"></a>00206         <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>&amp; curPolygon = *_polygons[ polygon ];
<a name="l00207"></a>00207 
<a name="l00209"></a>00209         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( vertex &lt; curPolygon.GetVertexCount() );
<a name="l00210"></a>00210         _polygons[ polygon ]-&gt;GetVertex( vertex ).uv = uv;
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <span class="comment">//----------------------------------------------------------</span>
<a name="l00214"></a>00214 <span class="keywordtype">void</span>
<a name="l00215"></a><a class="code" href="class_gr_polygon_group.html#95956f1b189590a55244810b49610fe3">00215</a> <a class="code" href="class_gr_polygon_group.html#95956f1b189590a55244810b49610fe3" title="sets vertex normals for polygons to the face normal.">GrPolygonGroup::GenFaceNormals</a>()
<a name="l00216"></a>00216 {
<a name="l00218"></a>00218         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polyCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )( _polygons.size() );
<a name="l00219"></a>00219         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; polyCount; ++i )
<a name="l00220"></a>00220         {
<a name="l00222"></a>00222                 <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>&amp; curPolygon = *_polygons[ i ];
<a name="l00223"></a>00223                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( curPolygon.<a class="code" href="class_gr_polygon.html#ef233c1659fde726aa60a1718a4ea8a4" title="vertex information.">GetVertexCount</a>() &gt;= 3 );
<a name="l00224"></a>00224 
<a name="l00226"></a>00226                 curPolygon.<a class="code" href="class_gr_polygon.html#b710c1e840a9047a2288813fc005974d">SetVertexFlags</a>( _polygons[ i ]-&gt;GetVertexFlags() | <a class="code" href="class_gr_polygon.html#f85991824f91a6724771e1ace01f1caf" title="valid flags.">GrPolygon::kNormal</a> );
<a name="l00227"></a>00227 
<a name="l00229"></a>00229                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> faceNormal = curPolygon.<a class="code" href="class_gr_polygon.html#52de5745993a825a901f9fc39c7c0fe4" title="returns the plane the verts lie on.">GetPlane</a>().<a class="code" href="class_m_plane.html#a467926800c24aad63d84af773ee61ba" title="if the value is ( - ), then the point is behind the plane. If ( + ), then on the...">GetNormal</a>();
<a name="l00230"></a>00230                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = curPolygon.<a class="code" href="class_gr_polygon.html#ef233c1659fde726aa60a1718a4ea8a4" title="vertex information.">GetVertexCount</a>();
<a name="l00231"></a>00231                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; vertexCount; ++j )
<a name="l00232"></a>00232                         curPolygon.<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( j ).<a class="code" href="struct_s_polygon_vertex.html#107117b51a3b3ca1863396cf8333ca1d">normal</a> = faceNormal;
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <span class="comment">//----------------------------------------------------------</span>
<a name="l00237"></a>00237 <span class="keywordtype">void</span>
<a name="l00238"></a><a class="code" href="class_gr_polygon_group.html#976f3a77c1696b3bc1b0797ad6d4e2ca">00238</a> <a class="code" href="class_gr_polygon_group.html#976f3a77c1696b3bc1b0797ad6d4e2ca" title="generates the tangent space basis.">GrPolygonGroup::GenTSBasis</a>()
<a name="l00239"></a>00239 {
<a name="l00241"></a>00241         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polyCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )( _polygons.size() );
<a name="l00242"></a>00242         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>* faceTangents = <span class="keyword">new</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>[ polyCount ];
<a name="l00243"></a>00243         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>* faceBinormals = <span class="keyword">new</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>[ polyCount ];
<a name="l00244"></a>00244 
<a name="l00246"></a>00246         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newFlags = <a class="code" href="class_gr_polygon.html#294f4e919c062a31183e59d05c2352ae">GrPolygon::kTangent</a> | <a class="code" href="class_gr_polygon.html#8649525f9a18567bd50c87ab9436a9d9">GrPolygon::kBiNormal</a>;
<a name="l00247"></a>00247         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; polyCount; ++i )
<a name="l00248"></a>00248         {
<a name="l00250"></a>00250                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _polygons[ i ]-&gt;<a class="code" href="class_gr_polygon_group.html#c8abcd749d8ba99fca070795ca770b2b" title="returns the total number of vertices in the group.">GetVertexCount</a>() &gt;= 3 );
<a name="l00251"></a>00251 
<a name="l00253"></a>00253                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( ( _polygons[ i ]-&gt;GetVertexFlags() &amp; <a class="code" href="class_gr_polygon.html#f61ee04e7a4e4e076f5e4beb223d8fbc">GrPolygon::kUV</a> ) != 0 );
<a name="l00254"></a>00254 
<a name="l00256"></a>00256                 _polygons[ i ]-&gt;SetVertexFlags( _polygons[ i ]-&gt;GetVertexFlags() | newFlags );
<a name="l00257"></a>00257 
<a name="l00259"></a>00259                 <span class="keywordflow">if</span> ( !GenPolygonTSBasis( faceTangents[ i ], faceBinormals[ i ], *_polygons[ i ] ) )
<a name="l00260"></a>00260                 {
<a name="l00261"></a>00261                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( !<span class="stringliteral">"failed to generate tangents and binormals."</span> );
<a name="l00262"></a>00262 
<a name="l00265"></a>00265                         faceTangents[ i ] = <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 1.0f, 0.0f, 0.0f );
<a name="l00266"></a>00266                         faceBinormals[ i ] = <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 1.0f, 0.0f );
<a name="l00267"></a>00267 
<a name="l00269"></a>00269                         <span class="keywordflow">if</span> ( _polygons[ i ]-&gt;GetNormal().Dot( faceTangents[ i ] ) &gt; 0.95f )
<a name="l00270"></a>00270                                 faceTangents[ i ] = _polygons[ i ]-&gt;GetNormal().Cross( faceBinormals[ i ] );
<a name="l00271"></a>00271                         <span class="keywordflow">if</span> ( _polygons[ i ]-&gt;GetNormal().Dot( faceBinormals[ i ] ) &gt; 0.95f )
<a name="l00272"></a>00272                                 faceBinormals[ i ] = _polygons[ i ]-&gt;GetNormal().Cross( faceTangents[ i ] );
<a name="l00273"></a>00273                 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( faceTangents[ i ].MagSqr() &gt; 0.9f &amp;&amp; faceTangents[ i ].MagSqr() &lt; 1.1f );
<a name="l00276"></a>00276                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( faceBinormals[ i ].MagSqr() &gt; 0.9f &amp;&amp; faceBinormals[ i ].MagSqr() &lt; 1.1f );
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278 
<a name="l00280"></a>00280         <a class="code" href="class_gr_polygon_b_i_tree.html" title="class GrPolygonBITree">GrPolygonBITree</a> partition( <span class="keyword">this</span>, <span class="keyword">false</span> );
<a name="l00281"></a>00281 
<a name="l00283"></a>00283         <a class="code" href="class_u_fast_array.html">UFastArray&lt; unsigned int &gt;</a> neighbors;
<a name="l00284"></a>00284         neighbors.<a class="code" href="class_u_fast_array.html#aab86583bca71336ee7122bc77aa861e" title="ensures that storage for the number of objects specified is allocated.">Reserve</a>( 10000 );
<a name="l00285"></a>00285 
<a name="l00290"></a>00290 <span class="preprocessor">#if 1</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span>        <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poly = 0; poly &lt; polyCount; ++poly )
<a name="l00292"></a>00292         {
<a name="l00294"></a>00294                 <span class="keyword">const</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>* curPoly = _polygons[ poly ];
<a name="l00295"></a>00295 
<a name="l00298"></a>00298                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = curPoly-&gt;<a class="code" href="class_gr_polygon.html#ef233c1659fde726aa60a1718a4ea8a4" title="vertex information.">GetVertexCount</a>();
<a name="l00299"></a>00299                 <span class="keywordflow">if</span> ( vertexCount == 0 )
<a name="l00300"></a>00300                         <span class="keywordflow">continue</span>;
<a name="l00301"></a>00301 
<a name="l00303"></a>00303                 <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> boxMin( curPoly-&gt;<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( 0 ).<a class="code" href="struct_s_polygon_vertex.html#522e1e97ae3be47d4ea6d424773fc569" title="set to a combination of the constants above.">position</a> );
<a name="l00304"></a>00304                 <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> boxMax( curPoly-&gt;<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( 0 ).<a class="code" href="struct_s_polygon_vertex.html#522e1e97ae3be47d4ea6d424773fc569" title="set to a combination of the constants above.">position</a> );
<a name="l00305"></a>00305                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vert = 1; vert &lt; vertexCount; ++vert )
<a name="l00306"></a>00306                 {
<a name="l00308"></a>00308                         <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; curPos = curPoly-&gt;<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( vert ).<a class="code" href="struct_s_polygon_vertex.html#522e1e97ae3be47d4ea6d424773fc569" title="set to a combination of the constants above.">position</a>;
<a name="l00309"></a>00309 
<a name="l00311"></a>00311                         boxMin.<a class="code" href="struct_s_vec3.html#a30ab4ca24f2b7968f6b21a97c28a812">x</a> = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( boxMin.x, curPos.<a class="code" href="struct_s_vec3.html#a30ab4ca24f2b7968f6b21a97c28a812">x</a> );
<a name="l00312"></a>00312                         boxMin.y = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( boxMin.y, curPos.<a class="code" href="struct_s_vec3.html#9e4d6ddc68169c650b437a7d1714f299">y</a> );
<a name="l00313"></a>00313                         boxMin.z = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( boxMin.z, curPos.<a class="code" href="struct_s_vec3.html#d9d349dd9369afd5bd7d056e59b3ae4a">z</a> );
<a name="l00314"></a>00314 
<a name="l00316"></a>00316                         boxMax.x = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( boxMax.x, curPos.<a class="code" href="struct_s_vec3.html#a30ab4ca24f2b7968f6b21a97c28a812">x</a> );
<a name="l00317"></a>00317                         boxMax.y = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( boxMax.y, curPos.<a class="code" href="struct_s_vec3.html#9e4d6ddc68169c650b437a7d1714f299">y</a> );
<a name="l00318"></a>00318                         boxMax.z = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( boxMax.z, curPos.<a class="code" href="struct_s_vec3.html#d9d349dd9369afd5bd7d056e59b3ae4a">z</a> );
<a name="l00319"></a>00319                 }
<a name="l00320"></a>00320 
<a name="l00323"></a>00323                 <span class="keyword">const</span> <span class="keywordtype">float</span> kBoundsEpsilon = 5.0f * <a class="code" href="_gr_config_8h.html#0c8c406ac7852e52c6b28afecf3f64b9">GR_GENERIC_DISTANCE_EPSILON</a>;
<a name="l00324"></a>00324                 boxMin.x -= kBoundsEpsilon;
<a name="l00325"></a>00325                 boxMin.y -= kBoundsEpsilon;
<a name="l00326"></a>00326                 boxMin.z -= kBoundsEpsilon;
<a name="l00327"></a>00327                 boxMax.x += kBoundsEpsilon;
<a name="l00328"></a>00328                 boxMax.y += kBoundsEpsilon;
<a name="l00329"></a>00329                 boxMax.z += kBoundsEpsilon;
<a name="l00330"></a>00330 
<a name="l00332"></a>00332                 neighbors.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l00333"></a>00333                 partition.<a class="code" href="class_gr_polygon_b_i_tree.html#996913f341c57731dede839590ca4481" title="returns all polygons that touch the bounding volume specified.">GetPolygons</a>( neighbors, boxMin, boxMax );
<a name="l00334"></a>00334 
<a name="l00336"></a>00336                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vert = 0; vert &lt; vertexCount; ++vert )
<a name="l00337"></a>00337                 {
<a name="l00339"></a>00339                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> matchCount = 1;
<a name="l00340"></a>00340                         <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; position1 = _polygons[ poly ]-&gt;GetVertex( vert ).position;
<a name="l00341"></a>00341                         <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; normal1 = _polygons[ poly ]-&gt;GetVertex( vert ).normal;
<a name="l00342"></a>00342                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> orthoTangent1 = faceTangents[ poly ].<a class="code" href="class_m_vec3.html#90de66244ee48f99a07924deb28a9d35">Orthonormalized</a>( normal1 );
<a name="l00343"></a>00343                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> orthoBinormal1 = faceBinormals[ poly ].<a class="code" href="class_m_vec3.html#90de66244ee48f99a07924deb28a9d35">Orthonormalized</a>( normal1 );
<a name="l00344"></a>00344                         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> curTangent = orthoTangent1;
<a name="l00345"></a>00345                         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> curBinormal = orthoBinormal1;
<a name="l00346"></a>00346 
<a name="l00348"></a>00348                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighborCount = neighbors.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>();
<a name="l00349"></a>00349                         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> neighbor = 0; neighbor &lt; neighborCount; ++neighbor )
<a name="l00350"></a>00350                         {
<a name="l00352"></a>00352                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poly2 = neighbors[ neighbor ];
<a name="l00353"></a>00353 
<a name="l00355"></a>00355                                 <span class="keywordflow">if</span> ( poly == poly2 )
<a name="l00356"></a>00356                                         <span class="keywordflow">continue</span>;
<a name="l00357"></a>00357 
<a name="l00359"></a>00359                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount2 = _polygons[ poly2 ]-&gt;GetVertexCount();
<a name="l00360"></a>00360                                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vert2 = 0; vert2 &lt; vertexCount2; ++vert2 )
<a name="l00361"></a>00361                                 {
<a name="l00363"></a>00363                                         <span class="keyword">const</span> <span class="keywordtype">float</span> kTolerance = -0.5f;
<a name="l00364"></a>00364 
<a name="l00368"></a>00368                                         <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; position2 = _polygons[ poly2 ]-&gt;GetVertex( vert2 ).position;
<a name="l00369"></a>00369                                         <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; normal2 = _polygons[ poly2 ]-&gt;GetVertex( vert2 ).normal;
<a name="l00370"></a>00370                                         <span class="keywordflow">if</span> ( IsPositionEqual( position1, position2 ) &amp;&amp; IsNormalEqual( normal1, normal2 ) )
<a name="l00371"></a>00371                                         {
<a name="l00374"></a>00374                                                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> orthoTangent2 = faceTangents[ poly2 ].<a class="code" href="class_m_vec3.html#90de66244ee48f99a07924deb28a9d35">Orthonormalized</a>( normal2 );
<a name="l00375"></a>00375                                                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> orthoBinormal2 = faceBinormals[ poly2 ].<a class="code" href="class_m_vec3.html#90de66244ee48f99a07924deb28a9d35">Orthonormalized</a>( normal2 );
<a name="l00376"></a>00376 
<a name="l00380"></a>00380                                                 <span class="keywordflow">if</span> ( ( orthoTangent1.<a class="code" href="class_m_vec3.html#c224832dd149a1f44add1fa271b5b909">Dot</a>( orthoTangent2 ) &gt; kTolerance ) &amp;&amp;
<a name="l00381"></a>00381                                                          ( orthoBinormal1.<a class="code" href="class_m_vec3.html#c224832dd149a1f44add1fa271b5b909">Dot</a>( orthoBinormal2 ) &gt; kTolerance ) )
<a name="l00382"></a>00382                                                 {
<a name="l00385"></a>00385                                                         curTangent += orthoTangent2;
<a name="l00386"></a>00386                                                         curBinormal += orthoBinormal2;
<a name="l00387"></a>00387                                                         ++matchCount;
<a name="l00388"></a>00388                                                         <span class="keywordflow">break</span>;
<a name="l00389"></a>00389                                                 }
<a name="l00390"></a>00390                                         }
<a name="l00391"></a>00391                                 }
<a name="l00392"></a>00392                         }
<a name="l00393"></a>00393 
<a name="l00397"></a>00397                         <span class="keywordflow">if</span> ( curTangent.<a class="code" href="struct_s_vec3.html#903103913dbda8f416cd4eaab7faa5f7">Mag</a>() &lt; <a class="code" href="class_m_vec3.html#fe4df239e5cc14ba66ccdc907bff32c6" title="class header">MVec3::kNormalizeEpsilon</a> )
<a name="l00398"></a>00398                                 curTangent = <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 1.0f, 0.0f, 0.0f );
<a name="l00399"></a>00399                         <span class="keywordflow">if</span> ( curBinormal.<a class="code" href="struct_s_vec3.html#903103913dbda8f416cd4eaab7faa5f7">Mag</a>() &lt; <a class="code" href="class_m_vec3.html#fe4df239e5cc14ba66ccdc907bff32c6" title="class header">MVec3::kNormalizeEpsilon</a> )
<a name="l00400"></a>00400                                 curBinormal = <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 1.0f, 0.0f );
<a name="l00401"></a>00401 
<a name="l00402"></a>00402                         _polygons[ poly ]-&gt;GetVertex( vert ).tangent = curTangent.<a class="code" href="struct_s_vec3.html#cfb19f8729abb5eade96512a5153df07">Normalized</a>();
<a name="l00403"></a>00403                         _polygons[ poly ]-&gt;GetVertex( vert ).binormal = curBinormal.<a class="code" href="struct_s_vec3.html#cfb19f8729abb5eade96512a5153df07">Normalized</a>();
<a name="l00404"></a>00404 
<a name="l00406"></a>00406                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _polygons[ poly ]-&gt;GetVertex( vert ).tangent.MagSqr() &gt; 0.0001f );
<a name="l00407"></a>00407                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _polygons[ poly ]-&gt;GetVertex( vert ).binormal.MagSqr() &gt; 0.0001f );
<a name="l00408"></a>00408                 }
<a name="l00409"></a>00409         }
<a name="l00410"></a>00410 <span class="preprocessor">#else</span>
<a name="l00411"></a>00411 <span class="preprocessor"></span>        <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poly = 0; poly &lt; polyCount; ++poly )
<a name="l00412"></a>00412         {
<a name="l00414"></a>00414                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = _polygons[ poly ]-&gt;GetVertexCount();
<a name="l00415"></a>00415                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vert = 0; vert &lt; vertexCount; ++vert )
<a name="l00416"></a>00416                 {
<a name="l00418"></a>00418                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> matchCount = 1;
<a name="l00419"></a>00419                         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> curTangent = faceTangents[ poly ];
<a name="l00420"></a>00420                         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> curBinormal = faceBinormals[ poly ];
<a name="l00421"></a>00421 
<a name="l00422"></a>00422                         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poly2 = 0; poly2 &lt; polyCount; ++poly2 )
<a name="l00423"></a>00423                         {
<a name="l00425"></a>00425                                 <span class="keywordflow">if</span> ( poly == poly2 )
<a name="l00426"></a>00426                                         <span class="keywordflow">continue</span>;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount2 = _polygons[ poly2 ]-&gt;GetVertexCount();
<a name="l00429"></a>00429                                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vert2 = 0; vert2 &lt; vertexCount2; ++vert2 )
<a name="l00430"></a>00430                                 {
<a name="l00432"></a>00432                                         <span class="keyword">const</span> <span class="keywordtype">float</span> kTolerance = 0.5f;
<a name="l00433"></a>00433 
<a name="l00437"></a>00437                                         <span class="keywordflow">if</span> ( ( _polygons[ poly ]-&gt;GetVertex( vert ).position == _polygons[ poly2 ]-&gt;GetVertex( vert2 ).position ) &amp;&amp;
<a name="l00438"></a>00438                                                  ( _polygons[ poly ]-&gt;GetVertex( vert ).normal == _polygons[ poly2 ]-&gt;GetVertex( vert2 ).normal ) &amp;&amp;
<a name="l00439"></a>00439                                                  ( faceTangents[ poly2 ].Dot( faceTangents[ poly ] ) &gt; kTolerance ) &amp;&amp;
<a name="l00440"></a>00440                                                  ( faceBinormals[ poly2 ].Dot( faceBinormals[ poly ] ) &gt; kTolerance ) )
<a name="l00441"></a>00441                                         {
<a name="l00443"></a>00443                                                 curTangent += faceTangents[ poly2 ];
<a name="l00444"></a>00444                                                 curBinormal += faceBinormals[ poly2 ];
<a name="l00445"></a>00445                                                 ++matchCount;
<a name="l00446"></a>00446                                                 <span class="keywordflow">break</span>;
<a name="l00447"></a>00447                                         }
<a name="l00448"></a>00448                                 }
<a name="l00449"></a>00449                         }
<a name="l00450"></a>00450 
<a name="l00452"></a>00452                         <span class="keywordflow">if</span> ( curTangent.<a class="code" href="struct_s_vec3.html#721348baa5a216e3784241336baa34f4">MagSqr</a>() &lt; 0.0001f )
<a name="l00453"></a>00453                         {
<a name="l00455"></a>00455                                 curTangent = <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 1.0f, 0.0f, 0.0f );
<a name="l00456"></a>00456                         }
<a name="l00457"></a>00457                         <span class="keywordflow">if</span> ( curBinormal.<a class="code" href="struct_s_vec3.html#721348baa5a216e3784241336baa34f4">MagSqr</a>() &lt; 0.0001f )
<a name="l00458"></a>00458                         {
<a name="l00460"></a>00460                                 curBinormal = <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 1.0f, 0.0f );
<a name="l00461"></a>00461                         }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463                         _polygons[ poly ]-&gt;GetVertex( vert ).tangent = curTangent.<a class="code" href="struct_s_vec3.html#cfb19f8729abb5eade96512a5153df07">Normalized</a>();
<a name="l00464"></a>00464                         _polygons[ poly ]-&gt;GetVertex( vert ).binormal = curBinormal.<a class="code" href="struct_s_vec3.html#cfb19f8729abb5eade96512a5153df07">Normalized</a>();
<a name="l00465"></a>00465 
<a name="l00466"></a>00466                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _polygons[ poly ]-&gt;GetVertex( vert ).tangent.MagSqr() &gt; 0.0001f );
<a name="l00467"></a>00467                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _polygons[ poly ]-&gt;GetVertex( vert ).binormal.MagSqr() &gt; 0.0001f );
<a name="l00468"></a>00468                 }
<a name="l00469"></a>00469         }
<a name="l00470"></a>00470 <span class="preprocessor">#endif</span>
<a name="l00471"></a>00471 <span class="preprocessor"></span>
<a name="l00474"></a>00474         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; polyCount; ++i )
<a name="l00475"></a>00475         {
<a name="l00476"></a>00476                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = _polygons[ i ]-&gt;GetVertexCount();
<a name="l00477"></a>00477                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; vertexCount; ++j )
<a name="l00478"></a>00478                 {
<a name="l00479"></a>00479                         <a class="code" href="struct_s_polygon_vertex.html" title="polygon vertex.">SPolygonVertex</a>&amp; vertex = _polygons[ i ]-&gt;GetVertex( j );
<a name="l00480"></a>00480                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( vertex.<a class="code" href="struct_s_polygon_vertex.html#107117b51a3b3ca1863396cf8333ca1d">normal</a>.<a class="code" href="struct_s_vec3.html#721348baa5a216e3784241336baa34f4">MagSqr</a>() &gt; 0.0001f );
<a name="l00481"></a>00481                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( vertex.<a class="code" href="struct_s_polygon_vertex.html#3ef855ac9b84b59cbbed657520d9c7fd">tangent</a>.<a class="code" href="struct_s_vec3.html#721348baa5a216e3784241336baa34f4">MagSqr</a>() &gt; 0.0001f );
<a name="l00482"></a>00482                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( vertex.<a class="code" href="struct_s_polygon_vertex.html#ac8e96e25997ee7f5460b5af7e19f5ff">binormal</a>.<a class="code" href="struct_s_vec3.html#721348baa5a216e3784241336baa34f4">MagSqr</a>() &gt; 0.0001f );
<a name="l00483"></a>00483 
<a name="l00485"></a>00485                         {
<a name="l00486"></a>00486                                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> temp = vertex.<a class="code" href="struct_s_polygon_vertex.html#3ef855ac9b84b59cbbed657520d9c7fd">tangent</a>;
<a name="l00487"></a>00487                                 temp.<a class="code" href="class_m_vec3.html#65c10253d74af1520788361ca191cd50">Orthonormalize</a>( vertex.<a class="code" href="struct_s_polygon_vertex.html#107117b51a3b3ca1863396cf8333ca1d">normal</a> );
<a name="l00488"></a>00488                                 vertex.<a class="code" href="struct_s_polygon_vertex.html#3ef855ac9b84b59cbbed657520d9c7fd">tangent</a> = temp;
<a name="l00489"></a>00489                         }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 <span class="preprocessor">#if 0</span>
<a name="l00493"></a>00493 <span class="preprocessor">                        {</span>
<a name="l00494"></a>00494 <span class="preprocessor"></span>                                <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> temp = vertex.<a class="code" href="struct_s_polygon_vertex.html#ac8e96e25997ee7f5460b5af7e19f5ff">binormal</a>;
<a name="l00495"></a>00495                                 temp.<a class="code" href="class_m_vec3.html#65c10253d74af1520788361ca191cd50">Orthonormalize</a>( vertex.<a class="code" href="struct_s_polygon_vertex.html#107117b51a3b3ca1863396cf8333ca1d">normal</a> );
<a name="l00496"></a>00496                                 vertex.<a class="code" href="struct_s_polygon_vertex.html#ac8e96e25997ee7f5460b5af7e19f5ff">binormal</a> = temp;
<a name="l00497"></a>00497                         }
<a name="l00498"></a>00498 <span class="preprocessor">#else</span>
<a name="l00504"></a>00504 <span class="preprocessor">                        {</span>
<a name="l00507"></a>00507 <span class="preprocessor">                                MVec3 newBinormal = vertex.normal.Cross( vertex.tangent );</span>
<a name="l00508"></a>00508 <span class="preprocessor"></span>                                <span class="keywordflow">if</span> ( newBinormal.Dot( vertex.binormal ) &gt; 0.0f )
<a name="l00509"></a>00509                                         vertex.binormal = newBinormal;
<a name="l00510"></a>00510                                 <span class="keywordflow">else</span>
<a name="l00511"></a>00511                                         vertex.binormal = -newBinormal;
<a name="l00512"></a>00512 
<a name="l00514"></a>00514                                 vertex.binormal.<a class="code" href="class_m_vec3.html#89f60c8001f1e04e5d17327e3b9ada63">Normalize</a>();
<a name="l00515"></a>00515                         }
<a name="l00516"></a>00516 <span class="preprocessor">#endif</span>
<a name="l00518"></a>00518 <span class="preprocessor">                        B_ASSERT( vertex.tangent.MagSqr() &gt; 0.0001f );</span>
<a name="l00519"></a>00519 <span class="preprocessor"></span>                        <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( vertex.binormal.MagSqr() &gt; 0.0001f );
<a name="l00520"></a>00520                 }
<a name="l00521"></a>00521         }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523         <span class="keyword">delete</span>[] faceTangents;
<a name="l00524"></a>00524         <span class="keyword">delete</span>[] faceBinormals;
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 <span class="comment">//----------------------------------------------------------</span>
<a name="l00528"></a>00528 <span class="keywordtype">void</span>
<a name="l00529"></a><a class="code" href="class_gr_polygon_group.html#bd4a96665b406a9694b87f950abc7b10">00529</a> <a class="code" href="class_gr_polygon_group.html#bd4a96665b406a9694b87f950abc7b10" title="UV coordinate generation.">GrPolygonGroup::GenPlanarUVMap</a>( <span class="keyword">const</span> <a class="code" href="class_m_plane.html" title="class MPlane">MPlane</a>&amp; projectionPlane )
<a name="l00530"></a>00530 {
<a name="l00532"></a>00532         <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; planeNormal = projectionPlane.<a class="code" href="class_m_plane.html#a467926800c24aad63d84af773ee61ba" title="if the value is ( - ), then the point is behind the plane. If ( + ), then on the...">GetNormal</a>();
<a name="l00533"></a>00533         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> planarOrigin = -projectionPlane.<a class="code" href="class_m_plane.html#5d577b90d83e5c9aab6d221cd9d8bda1">GetD</a>() * planeNormal;
<a name="l00534"></a>00534         <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> kUp( 0.0f, 1.0f, 0.0f );
<a name="l00535"></a>00535         <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> kRight( 1.0f, 0.0f, 0.0f );
<a name="l00536"></a>00536 
<a name="l00538"></a>00538         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> up;
<a name="l00539"></a>00539         <span class="keywordflow">if</span> ( <a class="code" href="common__afx_8h.html#7b41d482448c80b0a0e2d2c1fac77bfd">Abs</a>( planeNormal.<a class="code" href="class_m_vec3.html#c224832dd149a1f44add1fa271b5b909">Dot</a>( kUp ) ) &gt; 0.9f )
<a name="l00540"></a>00540                 up = kRight;
<a name="l00541"></a>00541         <span class="keywordflow">else</span>
<a name="l00542"></a>00542                 up = kUp;
<a name="l00543"></a>00543 
<a name="l00545"></a>00545         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> <a class="code" href="glext_8h.html#5ffadbbacc6b89cf6218bc43b384d3fe">right</a> = up.<a class="code" href="class_m_vec3.html#dcd74e76cefbb1b650c5dece5f115aae">Cross</a>( planeNormal ).<a class="code" href="class_m_vec3.html#139cf1db336ecf0ca02157f6f3605647">Normalized</a>();
<a name="l00546"></a>00546         up = right.<a class="code" href="class_m_vec3.html#dcd74e76cefbb1b650c5dece5f115aae">Cross</a>( planeNormal );
<a name="l00547"></a>00547 
<a name="l00549"></a>00549         <span class="keywordtype">float</span> minU = FLT_MAX;
<a name="l00550"></a>00550         <span class="keywordtype">float</span> minV = FLT_MAX;
<a name="l00551"></a>00551         <span class="keywordtype">float</span> maxU = -FLT_MAX;
<a name="l00552"></a>00552         <span class="keywordtype">float</span> maxV = -FLT_MAX;
<a name="l00553"></a>00553 
<a name="l00555"></a>00555         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polyCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )( _polygons.size() );
<a name="l00556"></a>00556         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; polyCount; ++i )
<a name="l00557"></a>00557         {
<a name="l00559"></a>00559                 <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>&amp; curPolygon = *_polygons[ i ];
<a name="l00560"></a>00560 
<a name="l00562"></a>00562                 curPolygon.<a class="code" href="class_gr_polygon.html#b710c1e840a9047a2288813fc005974d">SetVertexFlags</a>( curPolygon.<a class="code" href="class_gr_polygon.html#d5cb84031e18ea044c44cb7e245b7fc2">GetVertexFlags</a>() | <a class="code" href="class_gr_polygon.html#f61ee04e7a4e4e076f5e4beb223d8fbc">GrPolygon::kUV</a> );
<a name="l00563"></a>00563 
<a name="l00565"></a>00565                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = curPolygon.<a class="code" href="class_gr_polygon.html#ef233c1659fde726aa60a1718a4ea8a4" title="vertex information.">GetVertexCount</a>();
<a name="l00566"></a>00566                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; vertexCount; ++j )
<a name="l00567"></a>00567                 {
<a name="l00569"></a>00569                         <a class="code" href="struct_s_polygon_vertex.html" title="polygon vertex.">SPolygonVertex</a>&amp; vertex = curPolygon.<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( j );
<a name="l00570"></a>00570 
<a name="l00572"></a>00572                         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> position = vertex.<a class="code" href="struct_s_polygon_vertex.html#522e1e97ae3be47d4ea6d424773fc569" title="set to a combination of the constants above.">position</a>;
<a name="l00573"></a>00573                         vertex.<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>.<a class="code" href="struct_s_vec2.html#328ec1b6dafebcc1eb6bf84f790f39b7">x</a> = right.<a class="code" href="class_m_vec3.html#c224832dd149a1f44add1fa271b5b909">Dot</a>( position );
<a name="l00574"></a>00574                         vertex.<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>.<a class="code" href="struct_s_vec2.html#47cf4560950d17311222a547a98c4fde">y</a> = up.<a class="code" href="class_m_vec3.html#c224832dd149a1f44add1fa271b5b909">Dot</a>( position );
<a name="l00575"></a>00575 
<a name="l00576"></a>00576                         minU = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( vertex.<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>.<a class="code" href="struct_s_vec2.html#328ec1b6dafebcc1eb6bf84f790f39b7">x</a>, minU );
<a name="l00577"></a>00577                         minV = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( vertex.<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>.<a class="code" href="struct_s_vec2.html#47cf4560950d17311222a547a98c4fde">y</a>, minV );
<a name="l00578"></a>00578                         maxU = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( vertex.<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>.<a class="code" href="struct_s_vec2.html#328ec1b6dafebcc1eb6bf84f790f39b7">x</a>, maxU );
<a name="l00579"></a>00579                         maxV = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( vertex.<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>.<a class="code" href="struct_s_vec2.html#47cf4560950d17311222a547a98c4fde">y</a>, maxV );
<a name="l00580"></a>00580                 }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582         }
<a name="l00583"></a>00583 
<a name="l00585"></a>00585         <span class="keywordtype">float</span> <a class="code" href="glext_8h.html#281421b881aa7a1266842b73a3bc7655">scale</a> = 1.0f / <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( maxU - minU, maxV - minV );
<a name="l00586"></a>00586 
<a name="l00588"></a>00588         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; polyCount; ++i )
<a name="l00589"></a>00589         {
<a name="l00591"></a>00591                 <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>&amp; curPolygon = *_polygons[ i ];
<a name="l00592"></a>00592 
<a name="l00594"></a>00594                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = curPolygon.<a class="code" href="class_gr_polygon.html#ef233c1659fde726aa60a1718a4ea8a4" title="vertex information.">GetVertexCount</a>();
<a name="l00595"></a>00595                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; vertexCount; ++j )
<a name="l00596"></a>00596                 {
<a name="l00598"></a>00598                         <a class="code" href="struct_s_polygon_vertex.html" title="polygon vertex.">SPolygonVertex</a>&amp; vertex = curPolygon.<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( j );
<a name="l00599"></a>00599 
<a name="l00601"></a>00601                         vertex.<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>.<a class="code" href="struct_s_vec2.html#328ec1b6dafebcc1eb6bf84f790f39b7">x</a> = ( vertex.<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>.<a class="code" href="struct_s_vec2.html#328ec1b6dafebcc1eb6bf84f790f39b7">x</a> - minU ) * scale;
<a name="l00602"></a>00602                         vertex.<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>.<a class="code" href="struct_s_vec2.html#47cf4560950d17311222a547a98c4fde">y</a> = ( vertex.<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>.<a class="code" href="struct_s_vec2.html#47cf4560950d17311222a547a98c4fde">y</a> - minV ) * scale;
<a name="l00603"></a>00603                 }
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605 }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607 <span class="comment">//----------------------------------------------------------</span>
<a name="l00608"></a>00608 <span class="keywordtype">void</span>
<a name="l00609"></a><a class="code" href="class_gr_polygon_group.html#a6fbc43f25738738b71f89be14c4de7a">00609</a> <a class="code" href="class_gr_polygon_group.html#a6fbc43f25738738b71f89be14c4de7a" title="Edge list generation.">GrPolygonGroup::GenEdgeList</a>( EdgeVec&amp; edges )
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611         <span class="keyword">typedef</span> std::map&lt; __int64, SEdge &gt; EdgeMap;
<a name="l00612"></a>00612         EdgeMap edgeMap;
<a name="l00613"></a>00613         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _polygons.size(); ++i )
<a name="l00614"></a>00614         {
<a name="l00616"></a>00616                 <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>&amp; curPoly = *_polygons[ i ];
<a name="l00617"></a>00617                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> edgeCount = curPoly.<a class="code" href="class_gr_polygon.html#ef233c1659fde726aa60a1718a4ea8a4" title="vertex information.">GetVertexCount</a>() - 1;
<a name="l00618"></a>00618                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; edgeCount; ++j )
<a name="l00619"></a>00619                 {
<a name="l00620"></a>00620                         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> pos0 = curPoly.<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( j ).<a class="code" href="struct_s_polygon_vertex.html#522e1e97ae3be47d4ea6d424773fc569" title="set to a combination of the constants above.">position</a>;
<a name="l00621"></a>00621                         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> pos1 = curPoly.<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( j+1 ).<a class="code" href="struct_s_polygon_vertex.html#522e1e97ae3be47d4ea6d424773fc569" title="set to a combination of the constants above.">position</a>;
<a name="l00622"></a>00622 
<a name="l00626"></a>00626                         EdgeMap::iterator iter = edgeMap.find( CalcEdgeHash( pos1, pos0 ) );
<a name="l00627"></a>00627                         <span class="keywordflow">if</span> ( iter == edgeMap.end() )
<a name="l00628"></a>00628                         {
<a name="l00629"></a>00629                                 <a class="code" href="struct_gr_polygon_group_1_1_s_edge.html">SEdge</a> edge;
<a name="l00630"></a>00630                                 edge.<a class="code" href="struct_gr_polygon_group_1_1_s_edge.html#e3f83451acdd35d449949fcd3ceb6955">polygonIndices</a>[ 0 ] = i;
<a name="l00631"></a>00631                                 edge.<a class="code" href="struct_gr_polygon_group_1_1_s_edge.html#e3f83451acdd35d449949fcd3ceb6955">polygonIndices</a>[ 1 ] = ~0;
<a name="l00632"></a>00632                                 edge.<a class="code" href="struct_gr_polygon_group_1_1_s_edge.html#cef6b20f41b849099e05a158e3a6b730">edges</a>[ 0 ] = j;
<a name="l00633"></a>00633                                 edge.<a class="code" href="struct_gr_polygon_group_1_1_s_edge.html#cef6b20f41b849099e05a158e3a6b730">edges</a>[ 1 ] = ~0;
<a name="l00634"></a>00634                                 edgeMap[ CalcEdgeHash( pos0, pos1 ) ] = edge;
<a name="l00635"></a>00635                         }
<a name="l00636"></a>00636                         <span class="keywordflow">else</span>
<a name="l00637"></a>00637                         {
<a name="l00638"></a>00638                                 iter-&gt;second.<a class="code" href="struct_gr_polygon_group_1_1_s_edge.html#e3f83451acdd35d449949fcd3ceb6955">polygonIndices</a>[ 1 ] = i;
<a name="l00639"></a>00639                                 iter-&gt;second.edges[ 1 ] = j;
<a name="l00640"></a>00640                         }
<a name="l00641"></a>00641                 }
<a name="l00642"></a>00642         }
<a name="l00643"></a>00643 
<a name="l00645"></a>00645         EdgeMap::iterator iter = edgeMap.begin();
<a name="l00646"></a>00646         <span class="keyword">const</span> EdgeMap::iterator <a class="code" href="_g_l_8h.html#432111147038972f06e049e18a837002">end</a> = edgeMap.end();
<a name="l00647"></a>00647         <span class="keywordflow">for</span> ( ; iter != end; ++iter )
<a name="l00648"></a>00648                 edges.push_back( iter-&gt;second );
<a name="l00649"></a>00649 }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 <span class="comment">//----------------------------------------------------------</span>
<a name="l00652"></a>00652 <span class="keywordtype">void</span>
<a name="l00653"></a><a class="code" href="class_gr_polygon_group.html#2f06fcddd6fd04a28b8ae8682a36d508">00653</a> <a class="code" href="class_gr_polygon_group.html#2f06fcddd6fd04a28b8ae8682a36d508" title="polygon management.">GrPolygonGroup::AddPolygon</a>( <span class="keyword">const</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>&amp; polygon )
<a name="l00654"></a>00654 {
<a name="l00656"></a>00656         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( !_skinned );
<a name="l00657"></a>00657 
<a name="l00659"></a>00659         _aaBoxDirty = <span class="keyword">true</span>;
<a name="l00660"></a>00660         _polygons.push_back( <span class="keyword">new</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>( polygon ) );
<a name="l00661"></a>00661         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( polygon.<a class="code" href="class_gr_polygon.html#ef233c1659fde726aa60a1718a4ea8a4" title="vertex information.">GetVertexCount</a>() != 0 );
<a name="l00662"></a>00662         _vertexCount += polygon.<a class="code" href="class_gr_polygon.html#ef233c1659fde726aa60a1718a4ea8a4" title="vertex information.">GetVertexCount</a>();
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 <span class="comment">//----------------------------------------------------------</span>
<a name="l00666"></a>00666 <span class="keywordtype">void</span>
<a name="l00667"></a><a class="code" href="class_gr_polygon_group.html#3a7869b9ff3ae864be0aa71efcca2def">00667</a> <a class="code" href="class_gr_polygon_group.html#3a7869b9ff3ae864be0aa71efcca2def">GrPolygonGroup::AddGroup</a>( <span class="keyword">const</span> <a class="code" href="class_gr_polygon_group.html" title="class GrPolygonGroup">GrPolygonGroup</a>&amp; <a class="code" href="wglext_8h.html#69cec9b28d037f2272131b4fcd148620">group</a> )
<a name="l00668"></a>00668 {
<a name="l00671"></a>00671         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( _polygons.size() == 0 || _skinned == group.<a class="code" href="class_gr_polygon_group.html#629f3ddb0dcb89c967bae70e720af366" title="true if skinned.">_skinned</a> );
<a name="l00672"></a>00672         <span class="keywordflow">if</span> ( _polygons.size() == 0 &amp;&amp; group.<a class="code" href="class_gr_polygon_group.html#629f3ddb0dcb89c967bae70e720af366" title="true if skinned.">_skinned</a> )
<a name="l00673"></a>00673                 _skinned = <span class="keyword">true</span>;
<a name="l00674"></a>00674 
<a name="l00676"></a>00676         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* boneRemapping = 0;
<a name="l00677"></a>00677         <span class="keywordflow">if</span> ( _skinned )
<a name="l00678"></a>00678         {
<a name="l00680"></a>00680                 boneRemapping = ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* )alloca( group.<a class="code" href="class_gr_polygon_group.html#99dfce21f473d59e71e9745e11e030e9" title="skinning info.">_boneCount</a> * <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ) );
<a name="l00681"></a>00681 
<a name="l00684"></a>00684                 <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>* newBoneNameArray = <span class="keyword">new</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>[ _boneCount + group.<a class="code" href="class_gr_polygon_group.html#99dfce21f473d59e71e9745e11e030e9" title="skinning info.">_boneCount</a> ];
<a name="l00685"></a>00685                 <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>* newInvBindMatrices = <span class="keyword">new</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>[ _boneCount + group.<a class="code" href="class_gr_polygon_group.html#99dfce21f473d59e71e9745e11e030e9" title="skinning info.">_boneCount</a> ];
<a name="l00686"></a>00686                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _boneCount; ++i )
<a name="l00687"></a>00687                 {
<a name="l00688"></a>00688                         newBoneNameArray[ i ] = _boneNameArray[ i ];
<a name="l00689"></a>00689                         newInvBindMatrices[ i ] = _invBindMatrices[ i ];
<a name="l00690"></a>00690                 }
<a name="l00691"></a>00691 
<a name="l00693"></a>00693                 <span class="keyword">delete</span>[] _boneNameArray;
<a name="l00694"></a>00694                 <span class="keyword">delete</span>[] _invBindMatrices;
<a name="l00695"></a>00695                 _boneNameArray = newBoneNameArray;
<a name="l00696"></a>00696                 _invBindMatrices = newInvBindMatrices;
<a name="l00697"></a>00697 
<a name="l00699"></a>00699                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newBoneCount = _boneCount;
<a name="l00700"></a>00700                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; group.<a class="code" href="class_gr_polygon_group.html#99dfce21f473d59e71e9745e11e030e9" title="skinning info.">_boneCount</a>; ++i )
<a name="l00701"></a>00701                 {
<a name="l00703"></a>00703                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0;
<a name="l00704"></a>00704                         <span class="keywordflow">for</span> ( ; j &lt; _boneCount; ++j )
<a name="l00705"></a>00705                         {
<a name="l00706"></a>00706                                 <span class="keywordflow">if</span> ( _boneNameArray[ j ] == group.<a class="code" href="class_gr_polygon_group.html#509dbb9fde8f9c5fe0324bd415a0cb6f">_boneNameArray</a>[ i ] )
<a name="l00707"></a>00707                                 {
<a name="l00708"></a>00708                                         boneRemapping[ i ] = j;
<a name="l00709"></a>00709                                         <span class="keywordflow">break</span>;
<a name="l00710"></a>00710                                 }
<a name="l00711"></a>00711                         }
<a name="l00712"></a>00712 
<a name="l00714"></a>00714                         <span class="keywordflow">if</span> ( j == _boneCount )
<a name="l00715"></a>00715                         {
<a name="l00717"></a>00717                                 _boneNameArray[ newBoneCount ] = group.<a class="code" href="class_gr_polygon_group.html#509dbb9fde8f9c5fe0324bd415a0cb6f">_boneNameArray</a>[ i ];
<a name="l00718"></a>00718                                 _invBindMatrices[ newBoneCount ] = group.<a class="code" href="class_gr_polygon_group.html#f92c9c6bb1a972d1dd1c54fd2647087f">_invBindMatrices</a>[ i ];
<a name="l00719"></a>00719 
<a name="l00721"></a>00721                                 boneRemapping[ i ] = newBoneCount;
<a name="l00722"></a>00722 
<a name="l00724"></a>00724                                 ++newBoneCount;
<a name="l00725"></a>00725                         }
<a name="l00726"></a>00726                 }
<a name="l00727"></a>00727 
<a name="l00729"></a>00729                 _boneCount = newBoneCount;
<a name="l00730"></a>00730         }
<a name="l00731"></a>00731 
<a name="l00733"></a>00733         _polygons.reserve( _polygons.size() + group.<a class="code" href="class_gr_polygon_group.html#988ca7457097c8cc7eb735ddfc3b5036">_polygons</a>.size() );
<a name="l00734"></a>00734         _aaBoxDirty = <span class="keyword">true</span>;
<a name="l00735"></a>00735         _vertexCount += group.<a class="code" href="class_gr_polygon_group.html#c8abcd749d8ba99fca070795ca770b2b" title="returns the total number of vertices in the group.">GetVertexCount</a>();
<a name="l00736"></a>00736         PolygonVec::const_iterator iter = group.<a class="code" href="class_gr_polygon_group.html#988ca7457097c8cc7eb735ddfc3b5036">_polygons</a>.begin();
<a name="l00737"></a>00737         <span class="keyword">const</span> PolygonVec::const_iterator <a class="code" href="_g_l_8h.html#432111147038972f06e049e18a837002">end</a> = group.<a class="code" href="class_gr_polygon_group.html#988ca7457097c8cc7eb735ddfc3b5036">_polygons</a>.end();
<a name="l00738"></a>00738         <span class="keywordflow">for</span> ( ; iter != end; ++iter )
<a name="l00739"></a>00739         {
<a name="l00740"></a>00740                 _polygons.push_back( <span class="keyword">new</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>( *( *iter ) ) );
<a name="l00741"></a>00741                 <span class="keywordflow">if</span> ( _skinned )
<a name="l00742"></a>00742                         _polygons.back()-&gt;RemapBoneIndices( boneRemapping );
<a name="l00743"></a>00743         }
<a name="l00744"></a>00744 }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746 <span class="comment">//----------------------------------------------------------</span>
<a name="l00747"></a>00747 <span class="keywordtype">void</span>
<a name="l00748"></a><a class="code" href="class_gr_polygon_group.html#852fd667f43f1ceabf80ceb8d86168d6">00748</a> <a class="code" href="class_gr_polygon_group.html#3a7869b9ff3ae864be0aa71efcca2def">GrPolygonGroup::AddGroup</a>( <span class="keyword">const</span> <a class="code" href="class_gr_polygon_group.html" title="class GrPolygonGroup">GrPolygonGroup</a>&amp; <a class="code" href="wglext_8h.html#69cec9b28d037f2272131b4fcd148620">group</a>, <span class="keyword">const</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>&amp; <a class="code" href="glext_8h.html#07993c0d92c1aeeb357ba0495c8b5325">transform</a>, <span class="keyword">const</span> <a class="code" href="class_m_mat3x3.html" title="class MMat3x3">MMat3x3</a>&amp; normalRot )
<a name="l00749"></a>00749 {
<a name="l00752"></a>00752         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( !_skinned );
<a name="l00753"></a>00753 
<a name="l00755"></a>00755         _aaBoxDirty = <span class="keyword">true</span>;
<a name="l00756"></a>00756         _vertexCount += group.<a class="code" href="class_gr_polygon_group.html#c8abcd749d8ba99fca070795ca770b2b" title="returns the total number of vertices in the group.">GetVertexCount</a>();
<a name="l00757"></a>00757         _polygons.reserve( _polygons.size() + group.<a class="code" href="class_gr_polygon_group.html#988ca7457097c8cc7eb735ddfc3b5036">_polygons</a>.size() );
<a name="l00758"></a>00758         PolygonVec::const_iterator iter = group.<a class="code" href="class_gr_polygon_group.html#988ca7457097c8cc7eb735ddfc3b5036">_polygons</a>.begin();
<a name="l00759"></a>00759         <span class="keyword">const</span> PolygonVec::const_iterator <a class="code" href="_g_l_8h.html#432111147038972f06e049e18a837002">end</a> = group.<a class="code" href="class_gr_polygon_group.html#988ca7457097c8cc7eb735ddfc3b5036">_polygons</a>.end();
<a name="l00760"></a>00760         <span class="keywordflow">for</span> ( ; iter != end; ++iter )
<a name="l00761"></a>00761         {
<a name="l00762"></a>00762                 _polygons.push_back( <span class="keyword">new</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>( ( *iter )-&gt;Transform( transform, normalRot ) ) );
<a name="l00763"></a>00763         }
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766 <span class="comment">//----------------------------------------------------------</span>
<a name="l00767"></a>00767 <span class="keywordtype">void</span>
<a name="l00768"></a><a class="code" href="class_gr_polygon_group.html#a3bcc378c3f94203ec19e897361ae164">00768</a> <a class="code" href="class_gr_polygon_group.html#a3bcc378c3f94203ec19e897361ae164">GrPolygonGroup::Clear</a>()
<a name="l00769"></a>00769 {
<a name="l00770"></a>00770         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _polygons.size(); ++i )
<a name="l00771"></a>00771                 <span class="keyword">delete</span> _polygons[ i ];
<a name="l00772"></a>00772         _polygons.clear();
<a name="l00773"></a>00773         _vertexCount = 0;
<a name="l00774"></a>00774         _aaBox = <a class="code" href="class_m_a_a_box.html" title="class MAABox">MAABox</a>();
<a name="l00775"></a>00775         _aaBoxDirty = <span class="keyword">true</span>;
<a name="l00776"></a>00776         <span class="keyword">delete</span>[] _boneNameArray;
<a name="l00777"></a>00777         <span class="keyword">delete</span>[] _invBindMatrices;
<a name="l00778"></a>00778         _boneNameArray = 0;
<a name="l00779"></a>00779         _invBindMatrices = 0;
<a name="l00780"></a>00780         _boneCount = 0;
<a name="l00781"></a>00781         _skinned = <span class="keyword">false</span>;
<a name="l00782"></a>00782 }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784 <span class="comment">//----------------------------------------------------------</span>
<a name="l00785"></a>00785 <span class="keywordtype">void</span>
<a name="l00786"></a><a class="code" href="class_gr_polygon_group.html#04f5e9959c34e61726e25ff80d120989">00786</a> <a class="code" href="class_gr_polygon_group.html#04f5e9959c34e61726e25ff80d120989" title="Note that this object takes ownership over the pointers passed in.">GrPolygonGroup::SetSkinningInfo</a>( <a class="code" href="struct_s_polygon_skin_vertex.html" title="polygon vertex skinning info.">SPolygonSkinVertex</a>* skinVertArray, <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>* boneNames, <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>* invBindMatrices, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_g_l_8h.html#10b284d589000663becfbc6867a3a9f7">count</a> )
<a name="l00787"></a>00787 {
<a name="l00789"></a>00789         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( skinVertArray != 0 );
<a name="l00790"></a>00790         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( boneNames != 0 );
<a name="l00791"></a>00791         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( invBindMatrices != 0 );
<a name="l00792"></a>00792         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( count &gt; 0 );
<a name="l00793"></a>00793 
<a name="l00795"></a>00795         _skinned = <span class="keyword">true</span>;
<a name="l00796"></a>00796 
<a name="l00798"></a>00798         <span class="keyword">delete</span>[] _boneNameArray;
<a name="l00799"></a>00799         <span class="keyword">delete</span>[] _invBindMatrices;
<a name="l00800"></a>00800 
<a name="l00802"></a>00802         _boneNameArray = boneNames;
<a name="l00803"></a>00803         _invBindMatrices = invBindMatrices;
<a name="l00804"></a>00804         _boneCount = count;
<a name="l00805"></a>00805 
<a name="l00809"></a>00809         PolygonVec::iterator iter = _polygons.begin();
<a name="l00810"></a>00810         PolygonVec::iterator <a class="code" href="_g_l_8h.html#432111147038972f06e049e18a837002">end</a> = _polygons.end();
<a name="l00811"></a>00811         <span class="keywordflow">for</span> ( ; iter != end; ++iter )
<a name="l00812"></a>00812         {
<a name="l00813"></a>00813                 ( *iter )-&gt;SetSkinningInfo( skinVertArray );
<a name="l00814"></a>00814                 skinVertArray += ( *iter )-&gt;GetVertexCount();
<a name="l00815"></a>00815         }
<a name="l00816"></a>00816 }
<a name="l00817"></a>00817 
<a name="l00818"></a>00818 <span class="comment">//----------------------------------------------------------</span>
<a name="l00819"></a>00819 <span class="keywordtype">void</span>
<a name="l00820"></a><a class="code" href="class_gr_polygon_group.html#887ed72b43c9832341bd9059fb43d123">00820</a> <a class="code" href="class_gr_polygon_group.html#887ed72b43c9832341bd9059fb43d123" title="removes degenerate triangles and duplicate vertices.">GrPolygonGroup::OptimizePolygons</a>( <span class="keywordtype">float</span> epsilon, <span class="keywordtype">float</span> distEpsilonSqr )
<a name="l00821"></a>00821 {
<a name="l00822"></a>00822         PolygonVec::iterator iter = _polygons.begin();
<a name="l00823"></a>00823         PolygonVec::iterator <a class="code" href="_g_l_8h.html#432111147038972f06e049e18a837002">end</a> = _polygons.end();
<a name="l00824"></a>00824         <span class="keywordflow">while</span> ( iter != end )
<a name="l00825"></a>00825         {
<a name="l00827"></a>00827                 <span class="keywordflow">if</span> ( ( *iter )-&gt;IsDegenerate( epsilon ) )
<a name="l00828"></a>00828                 {
<a name="l00829"></a>00829                         _vertexCount -= ( *iter )-&gt;GetVertexCount();
<a name="l00830"></a>00830                         <span class="keyword">delete</span> ( *iter );
<a name="l00831"></a>00831                         iter = _polygons.erase( iter );
<a name="l00832"></a>00832                         end = _polygons.end();
<a name="l00833"></a>00833                         <span class="keywordflow">continue</span>;
<a name="l00834"></a>00834                 }
<a name="l00835"></a>00835 
<a name="l00837"></a>00837                 ++iter;
<a name="l00838"></a>00838         }
<a name="l00839"></a>00839 }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841 <span class="comment">//----------------------------------------------------------</span>
<a name="l00842"></a>00842 <span class="keywordtype">void</span>
<a name="l00843"></a><a class="code" href="class_gr_polygon_group.html#e361b892b9d9a739c82679e67eb689e7">00843</a> <a class="code" href="class_gr_polygon_group.html#e361b892b9d9a739c82679e67eb689e7" title="welds vertices together.">GrPolygonGroup::WeldVertices</a>( <span class="keywordtype">float</span> distEpsilonSqr )
<a name="l00844"></a>00844 {
<a name="l00845"></a>00845         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polyCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )( _polygons.size() );
<a name="l00846"></a>00846         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; polyCount; ++i )
<a name="l00847"></a>00847         {
<a name="l00848"></a>00848                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = i + 1; j &lt; polyCount; ++j )
<a name="l00849"></a>00849                 {
<a name="l00850"></a>00850                         _polygons[ i ]-&gt;WeldVertices( *_polygons[ j ], distEpsilonSqr );
<a name="l00851"></a>00851                 }
<a name="l00852"></a>00852         }
<a name="l00853"></a>00853 }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855 <span class="comment">//----------------------------------------------------------</span>
<a name="l00856"></a>00856 <span class="keywordtype">void</span>
<a name="l00857"></a><a class="code" href="class_gr_polygon_group.html#1f1f0c55854848f37a12efe4f0bb1819">00857</a> <a class="code" href="class_gr_polygon_group.html#1f1f0c55854848f37a12efe4f0bb1819" title="builds a palette of planes to use for splitting from the geometry in the group.">GrPolygonGroup::FixTJuncs</a>( <span class="keyword">const</span> <a class="code" href="class_gr_polygon_group.html" title="class GrPolygonGroup">GrPolygonGroup</a>&amp; <a class="code" href="wglext_8h.html#69cec9b28d037f2272131b4fcd148620">group</a>, <span class="keywordtype">float</span> epsilon )
<a name="l00858"></a>00858 {
<a name="l00859"></a>00859         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polyCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )( _polygons.size() );
<a name="l00860"></a>00860         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; polyCount; ++i )
<a name="l00861"></a>00861         {
<a name="l00862"></a>00862                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; group.<a class="code" href="class_gr_polygon_group.html#3e0a4ae8030ded12301495eed40135df" title="polygon iteration">GetPolygonCount</a>(); ++j )
<a name="l00863"></a>00863                 {
<a name="l00864"></a>00864                         <span class="keywordflow">if</span> ( _polygons[ i ]-&gt;GetUserFlags() &amp; <a class="code" href="class_gr_polygon.html#836e951bdd2b98548ff07a856432365c59f4225180877655ae73407b30696ada">GrPolygon::EFV_EDGEPOLY</a> )
<a name="l00865"></a>00865                                 _polygons[ i ]-&gt;CheckTJunc( *group.<a class="code" href="class_gr_polygon_group.html#988ca7457097c8cc7eb735ddfc3b5036">_polygons</a>[ j ], epsilon );
<a name="l00866"></a>00866                 }
<a name="l00867"></a>00867         }
<a name="l00868"></a>00868 }
<a name="l00869"></a>00869 <span class="comment">/*</span>
<a name="l00870"></a>00870 <span class="comment">//----------------------------------------------------------</span>
<a name="l00871"></a>00871 <span class="comment">void</span>
<a name="l00872"></a>00872 <span class="comment">GrPolygonGroup::BuildCoplanarGroups( std::vector&lt; GrCoplanarPolygonGroup &gt;&amp; groups, float epsilon ) const</span>
<a name="l00873"></a>00873 <span class="comment">{</span>
<a name="l00875"></a>00875 <span class="comment">        B_ASSERT( groups.size() == 0 );</span>
<a name="l00876"></a>00876 <span class="comment"></span>
<a name="l00878"></a>00878 <span class="comment">        unsigned int curPolyIdx = 0;</span>
<a name="l00879"></a>00879 <span class="comment">        PolygonVec::const_iterator polygonIter = _polygons.begin();</span>
<a name="l00880"></a>00880 <span class="comment">        const PolygonVec::const_iterator polygonEnd = _polygons.end();</span>
<a name="l00881"></a>00881 <span class="comment">        for ( ; polygonIter != polygonEnd; ++polygonIter, ++curPolyIdx )</span>
<a name="l00882"></a>00882 <span class="comment">        {</span>
<a name="l00884"></a>00884 <span class="comment">                std::vector&lt; GrCoplanarPolygonGroup &gt;::iterator groupIter = groups.begin();</span>
<a name="l00885"></a>00885 <span class="comment">                const std::vector&lt; GrCoplanarPolygonGroup &gt;::iterator groupEnd = groups.end();</span>
<a name="l00886"></a>00886 <span class="comment">                for ( ; groupIter != groupEnd; ++groupIter )</span>
<a name="l00887"></a>00887 <span class="comment">                {</span>
<a name="l00888"></a>00888 <span class="comment">                        if ( groupIter-&gt;IsCoplanar( *polygonIter ) )</span>
<a name="l00889"></a>00889 <span class="comment">                        {</span>
<a name="l00890"></a>00890 <span class="comment">                                groupIter-&gt;AddPolygon( curPolyIdx );</span>
<a name="l00891"></a>00891 <span class="comment">                                break;</span>
<a name="l00892"></a>00892 <span class="comment">                        }</span>
<a name="l00893"></a>00893 <span class="comment">                }</span>
<a name="l00894"></a>00894 <span class="comment"></span>
<a name="l00896"></a>00896 <span class="comment">                if ( groupIter != groupEnd )</span>
<a name="l00897"></a>00897 <span class="comment">                        continue;</span>
<a name="l00898"></a>00898 <span class="comment"></span>
<a name="l00901"></a>00901 <span class="comment">                const MPlane&amp; plane = polygonIter-&gt;GetPlane();</span>
<a name="l00902"></a>00902 <span class="comment">                groups.push_back( GrCoplanarPolygonGroup( plane, epsilon ) );</span>
<a name="l00903"></a>00903 <span class="comment">                groups.back().AddPolygon( curPolyIdx );</span>
<a name="l00904"></a>00904 <span class="comment">        }</span>
<a name="l00905"></a>00905 <span class="comment"></span>
<a name="l00907"></a>00907 <span class="comment">        std::sort( groups.begin(), groups.end(), GroupSortFunc );</span>
<a name="l00908"></a>00908 <span class="comment">}</span>
<a name="l00909"></a>00909 <span class="comment">*/</span>
<a name="l00910"></a>00910 <span class="comment">//----------------------------------------------------------</span>
<a name="l00911"></a>00911 <span class="keywordtype">void</span>
<a name="l00912"></a><a class="code" href="class_gr_polygon_group.html#78b2f9321b1e04e636a5ea434326a010">00912</a> <a class="code" href="class_gr_polygon_group.html#78b2f9321b1e04e636a5ea434326a010" title="builds a palette of planes to use for splitting from the geometry in the group.">GrPolygonGroup::GenPlaneList</a>( std::vector&lt; MPlane &gt;&amp; planes, <span class="keywordtype">float</span> epsilon )<span class="keyword"> const</span>
<a name="l00913"></a>00913 <span class="keyword"></span>{
<a name="l00914"></a>00914         <a class="code" href="common__afx_8cpp.html#f1a1e0f08b49000974368246e5b97f84" title="debug output/console output function.">PrintF</a>( <span class="stringliteral">"Building plane list..."</span> );
<a name="l00915"></a>00915 
<a name="l00917"></a>00917         planes.clear();
<a name="l00918"></a>00918 
<a name="l00920"></a>00920         std::vector&lt; std::pair&lt; float, MPlane &gt; &gt; localPlaneVec;
<a name="l00921"></a>00921 
<a name="l00923"></a>00923         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> curPolyIdx = 0;
<a name="l00924"></a>00924         PolygonVec::const_iterator polygonIter = _polygons.begin();
<a name="l00925"></a>00925         <span class="keyword">const</span> PolygonVec::const_iterator polygonEnd = _polygons.end();
<a name="l00926"></a>00926         <span class="keywordflow">for</span> ( ; polygonIter != polygonEnd; ++polygonIter, ++curPolyIdx )
<a name="l00927"></a>00927         {
<a name="l00929"></a>00929                 std::vector&lt; std::pair&lt; float, MPlane &gt; &gt;::iterator planeIter = localPlaneVec.begin();
<a name="l00930"></a>00930                 <span class="keyword">const</span> std::vector&lt; std::pair&lt; float, MPlane &gt; &gt;::iterator planeEnd = localPlaneVec.end();
<a name="l00931"></a>00931                 <span class="keywordflow">for</span> ( ; planeIter != planeEnd; ++planeIter )
<a name="l00932"></a>00932                 {
<a name="l00933"></a>00933                         <span class="keywordflow">if</span> ( ( *polygonIter )-&gt;IsCoplanar( planeIter-&gt;second, epsilon ) )
<a name="l00934"></a>00934                         {
<a name="l00935"></a>00935                                 planeIter-&gt;first += ( *polygonIter )-&gt;GetArea();
<a name="l00936"></a>00936                                 <span class="keywordflow">break</span>;
<a name="l00937"></a>00937                         }
<a name="l00938"></a>00938                 }
<a name="l00939"></a>00939 
<a name="l00941"></a>00941                 <span class="keywordflow">if</span> ( planeIter != planeEnd )
<a name="l00942"></a>00942                         <span class="keywordflow">continue</span>;
<a name="l00943"></a>00943 
<a name="l00945"></a>00945                 <span class="keyword">const</span> <a class="code" href="class_m_plane.html" title="class MPlane">MPlane</a>&amp; plane = ( *polygonIter )-&gt;GetPlane();
<a name="l00946"></a>00946                 localPlaneVec.push_back( std::pair&lt; float, MPlane &gt;( ( *polygonIter )-&gt;GetArea(), plane ) );
<a name="l00947"></a>00947         }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949         <a class="code" href="common__afx_8cpp.html#f1a1e0f08b49000974368246e5b97f84" title="debug output/console output function.">PrintF</a>(
<a name="l00950"></a>00950                 <span class="stringliteral">" [done]\n"</span>
<a name="l00951"></a>00951                 <span class="stringliteral">" Number of planes: %i\n"</span>, ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> )localPlaneVec.size() );
<a name="l00952"></a>00952 
<a name="l00954"></a>00954         std::sort( localPlaneVec.begin(), localPlaneVec.end(), PlaneSortCmp );
<a name="l00955"></a>00955 
<a name="l00957"></a>00957         std::vector&lt; std::pair&lt; float, MPlane &gt; &gt;::iterator iter = localPlaneVec.begin();
<a name="l00958"></a>00958         <span class="keyword">const</span> std::vector&lt; std::pair&lt; float, MPlane &gt; &gt;::iterator <a class="code" href="_g_l_8h.html#432111147038972f06e049e18a837002">end</a> = localPlaneVec.end();
<a name="l00959"></a>00959         <span class="keywordflow">for</span> ( ; iter != end; ++iter )
<a name="l00960"></a>00960                 planes.push_back( iter-&gt;second );
<a name="l00961"></a>00961 }
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 <span class="comment">//----------------------------------------------------------</span>
<a name="l00964"></a>00964 <span class="keywordtype">int</span>
<a name="l00965"></a><a class="code" href="class_gr_polygon_group.html#740ca90b8b5492d1da5b4195d9f2e82c">00965</a> <a class="code" href="class_gr_polygon_group.html#740ca90b8b5492d1da5b4195d9f2e82c" title="splits the polygons into two groups using the plane passed in.">GrPolygonGroup::Split</a>( <a class="code" href="class_gr_polygon_group.html" title="class GrPolygonGroup">GrPolygonGroup</a>&amp; front, <a class="code" href="class_gr_polygon_group.html" title="class GrPolygonGroup">GrPolygonGroup</a>&amp; back, <span class="keyword">const</span> <a class="code" href="class_m_plane.html" title="class MPlane">MPlane</a>&amp; plane, <span class="keywordtype">float</span> epsilon )<span class="keyword"> const</span>
<a name="l00966"></a>00966 <span class="keyword"></span>{
<a name="l00968"></a>00968         <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a> frontPoly;
<a name="l00969"></a>00969         <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a> backPoly;
<a name="l00970"></a>00970         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _polygons.size(); ++i )
<a name="l00971"></a>00971         {
<a name="l00972"></a>00972                 <span class="keywordtype">int</span> side = _polygons[ i ]-&gt;Split( frontPoly, backPoly, plane, epsilon );
<a name="l00973"></a>00973                 <span class="keywordflow">if</span> ( side &gt;= 0 )
<a name="l00974"></a>00974                         front.<a class="code" href="class_gr_polygon_group.html#2f06fcddd6fd04a28b8ae8682a36d508" title="polygon management.">AddPolygon</a>( frontPoly );
<a name="l00975"></a>00975                 <span class="keywordflow">if</span> ( side &lt;= 0 )
<a name="l00976"></a>00976                         back.<a class="code" href="class_gr_polygon_group.html#2f06fcddd6fd04a28b8ae8682a36d508" title="polygon management.">AddPolygon</a>( backPoly );
<a name="l00977"></a>00977         }
<a name="l00978"></a>00978 
<a name="l00980"></a>00980         <span class="keywordtype">int</span> ret = 0;
<a name="l00981"></a>00981         <span class="keywordflow">if</span> ( front.<a class="code" href="class_gr_polygon_group.html#3e0a4ae8030ded12301495eed40135df" title="polygon iteration">GetPolygonCount</a>() &gt; 0 )
<a name="l00982"></a>00982                 ret += 1;
<a name="l00983"></a>00983         <span class="keywordflow">if</span> ( back.<a class="code" href="class_gr_polygon_group.html#3e0a4ae8030ded12301495eed40135df" title="polygon iteration">GetPolygonCount</a>() &gt; 0 )
<a name="l00984"></a>00984                 ret -= 1;
<a name="l00985"></a>00985 
<a name="l00987"></a>00987         <span class="keywordflow">return</span> ret;
<a name="l00988"></a>00988 }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990 <span class="comment">//----------------------------------------------------------</span>
<a name="l00991"></a>00991 <span class="keywordtype">int</span>
<a name="l00992"></a><a class="code" href="class_gr_polygon_group.html#7e0719fa01ae4b03cd135fdc91ff4697">00992</a> <a class="code" href="class_gr_polygon_group.html#7e0719fa01ae4b03cd135fdc91ff4697">GrPolygonGroup::Classify</a>( <a class="code" href="class_gr_polygon_group.html" title="class GrPolygonGroup">GrPolygonGroup</a>&amp; front, <a class="code" href="class_gr_polygon_group.html" title="class GrPolygonGroup">GrPolygonGroup</a>&amp; back, <span class="keyword">const</span> <a class="code" href="class_m_plane.html" title="class MPlane">MPlane</a>&amp; plane )<span class="keyword"> const</span>
<a name="l00993"></a>00993 <span class="keyword"></span>{
<a name="l00995"></a>00995         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _polygons.size(); ++i )
<a name="l00996"></a>00996         {
<a name="l00998"></a>00998                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> center;
<a name="l00999"></a>00999                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertCount = _polygons[ i ]-&gt;GetVertexCount();
<a name="l01000"></a>01000                 <span class="keywordtype">float</span> invVertCount = 1.0f / vertCount;
<a name="l01001"></a>01001                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; vertCount; ++j )
<a name="l01002"></a>01002                         center += _polygons[ i ]-&gt;GetVertex( j ).position;
<a name="l01003"></a>01003 
<a name="l01005"></a>01005                 center *= invVertCount;
<a name="l01006"></a>01006 
<a name="l01009"></a>01009                 <span class="keywordtype">int</span> side = plane.<a class="code" href="class_m_plane.html#ba18afe95e49cc82c2d1f1feca4f1838" title="returns the side the point passed in is on.">GetSide</a>( center, <a class="code" href="_gr_config_8h.html#0c8c406ac7852e52c6b28afecf3f64b9">GR_GENERIC_DISTANCE_EPSILON</a> );
<a name="l01010"></a>01010                 <span class="keywordflow">if</span> ( side &gt;= 0 )
<a name="l01011"></a>01011                         front.<a class="code" href="class_gr_polygon_group.html#2f06fcddd6fd04a28b8ae8682a36d508" title="polygon management.">AddPolygon</a>( *_polygons[ i ] );
<a name="l01012"></a>01012                 <span class="keywordflow">if</span> ( side &lt; 0 )
<a name="l01013"></a>01013                         back.<a class="code" href="class_gr_polygon_group.html#2f06fcddd6fd04a28b8ae8682a36d508" title="polygon management.">AddPolygon</a>( *_polygons[ i ] );
<a name="l01014"></a>01014         }
<a name="l01015"></a>01015 
<a name="l01017"></a>01017         <span class="keywordtype">int</span> ret = 0;
<a name="l01018"></a>01018         <span class="keywordflow">if</span> ( front.<a class="code" href="class_gr_polygon_group.html#3e0a4ae8030ded12301495eed40135df" title="polygon iteration">GetPolygonCount</a>() &gt; 0 )
<a name="l01019"></a>01019                 ret += 1;
<a name="l01020"></a>01020         <span class="keywordflow">if</span> ( back.<a class="code" href="class_gr_polygon_group.html#3e0a4ae8030ded12301495eed40135df" title="polygon iteration">GetPolygonCount</a>() &gt; 0 )
<a name="l01021"></a>01021                 ret -= 1;
<a name="l01022"></a>01022 
<a name="l01024"></a>01024         <span class="keywordflow">return</span> ret;     
<a name="l01025"></a>01025 }
<a name="l01026"></a>01026 
<a name="l01027"></a>01027 <span class="comment">//----------------------------------------------------------</span>
<a name="l01028"></a>01028 <span class="keywordtype">bool</span>
<a name="l01029"></a><a class="code" href="class_gr_polygon_group.html#d158b0569c3feb64ba0bc71091eb3605">01029</a> <a class="code" href="class_gr_polygon_group.html#d158b0569c3feb64ba0bc71091eb3605" title="determine if we have a convex set of polygons.">GrPolygonGroup::IsConvexSet</a>( <span class="keywordtype">float</span> epsilon )<span class="keyword"> const</span>
<a name="l01030"></a>01030 <span class="keyword"></span>{
<a name="l01031"></a>01031         std::vector&lt; MPlane &gt; planes;
<a name="l01032"></a>01032         <a class="code" href="class_gr_polygon_group.html#78b2f9321b1e04e636a5ea434326a010" title="builds a palette of planes to use for splitting from the geometry in the group.">GenPlaneList</a>( planes, epsilon );
<a name="l01033"></a>01033 
<a name="l01035"></a>01035         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; planes.size(); ++i )
<a name="l01036"></a>01036         {
<a name="l01037"></a>01037                 <span class="keyword">const</span> <a class="code" href="class_m_plane.html" title="class MPlane">MPlane</a>&amp; curPlane = planes[ i ];
<a name="l01038"></a>01038                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; _polygons.size(); ++j )
<a name="l01039"></a>01039                 {
<a name="l01040"></a>01040                         <a class="code" href="class_gr_polygon.html#3e8aa04f4841547a5c8a055e1722204b">GrPolygon::EPLANERELATION</a> planeRel = _polygons[ j ]-&gt;CalcPlaneRelation( curPlane, epsilon );
<a name="l01041"></a>01041                         <span class="keywordflow">if</span> ( planeRel == <a class="code" href="class_gr_polygon.html#3e8aa04f4841547a5c8a055e1722204b8bc72f093b56434a0afe8bb6925a5524">GrPolygon::EPR_BACK</a> || planeRel == <a class="code" href="class_gr_polygon.html#3e8aa04f4841547a5c8a055e1722204b06455f448fa7ab97d7a136c65bfee546">GrPolygon::EPR_SPLIT</a> )
<a name="l01042"></a>01042                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01043"></a>01043                 }
<a name="l01044"></a>01044         }
<a name="l01045"></a>01045 
<a name="l01047"></a>01047         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01048"></a>01048 }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050 <span class="comment">//----------------------------------------------------------</span>
<a name="l01051"></a>01051 <span class="keywordtype">void</span>
<a name="l01052"></a><a class="code" href="class_gr_polygon_group.html#487e928a1d486489a0e0005cc0eb8669">01052</a> <a class="code" href="class_gr_polygon_group.html#487e928a1d486489a0e0005cc0eb8669" title="converts into mesh(es).">GrPolygonGroup::GenMeshes</a>( std::vector&lt; GrMeshInst* &gt;&amp; meshes, <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; <a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a>, <span class="keywordtype">bool</span> genVertexColors,
<a name="l01053"></a>01053                                                    <span class="keywordtype">bool</span> vboEnable, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxVertexCount )<span class="keyword"> const</span>
<a name="l01054"></a>01054 <span class="keyword"></span>{
<a name="l01057"></a>01057         <span class="keywordflow">if</span> ( <a class="code" href="class_gr_polygon_group.html#c8abcd749d8ba99fca070795ca770b2b" title="returns the total number of vertices in the group.">GetVertexCount</a>() &lt;= maxVertexCount )
<a name="l01058"></a>01058         {
<a name="l01059"></a>01059                 GenMeshesInternal( meshes, name, genVertexColors, vboEnable );
<a name="l01060"></a>01060                 <span class="keywordflow">return</span>;
<a name="l01061"></a>01061         }
<a name="l01062"></a>01062 
<a name="l01064"></a>01064         std::list&lt; GrPolygonGroup &gt; groups;
<a name="l01065"></a>01065         groups.push_back( <a class="code" href="class_gr_polygon_group.html#aa3b23b7e01fc2b036a5b9826f95948a" title="class GrPolygonGroup">GrPolygonGroup</a>() );
<a name="l01066"></a>01066         groups.push_back( <a class="code" href="class_gr_polygon_group.html#aa3b23b7e01fc2b036a5b9826f95948a" title="class GrPolygonGroup">GrPolygonGroup</a>() );
<a name="l01067"></a>01067 
<a name="l01070"></a>01070         <a class="code" href="class_gr_polygon_group.html#7e0719fa01ae4b03cd135fdc91ff4697">Classify</a>( groups.front(), groups.back(), CalcSplitPlane() );
<a name="l01071"></a>01071 
<a name="l01074"></a>01074         <span class="keywordtype">bool</span> needWork = <span class="keyword">true</span>;
<a name="l01075"></a>01075         std::list&lt; GrPolygonGroup &gt;::iterator iter = groups.begin();
<a name="l01076"></a>01076         <span class="keywordflow">do</span>
<a name="l01077"></a>01077         {
<a name="l01079"></a>01079                 <span class="keywordflow">if</span> ( iter-&gt;GetVertexCount() &gt; maxVertexCount )
<a name="l01080"></a>01080                 {
<a name="l01082"></a>01082                         groups.push_back( <a class="code" href="class_gr_polygon_group.html#aa3b23b7e01fc2b036a5b9826f95948a" title="class GrPolygonGroup">GrPolygonGroup</a>() );
<a name="l01083"></a>01083                         <a class="code" href="class_gr_polygon_group.html" title="class GrPolygonGroup">GrPolygonGroup</a>&amp; front = groups.back();
<a name="l01084"></a>01084                         groups.push_back( <a class="code" href="class_gr_polygon_group.html#aa3b23b7e01fc2b036a5b9826f95948a" title="class GrPolygonGroup">GrPolygonGroup</a>() );
<a name="l01085"></a>01085                         <a class="code" href="class_gr_polygon_group.html" title="class GrPolygonGroup">GrPolygonGroup</a>&amp; back = groups.back();
<a name="l01086"></a>01086 
<a name="l01088"></a>01088                         <span class="keywordtype">int</span> result = iter-&gt;Classify( front, back, iter-&gt;<a class="code" href="class_gr_polygon_group.html#86af95ddc57cd2ea128a8715bea2072d">CalcSplitPlane</a>() );
<a name="l01089"></a>01089                         <span class="keywordflow">if</span> ( result != 0 )
<a name="l01090"></a>01090                         {
<a name="l01093"></a>01093                                 groups.pop_back();
<a name="l01094"></a>01094                                 groups.pop_back();
<a name="l01095"></a>01095 
<a name="l01097"></a>01097                                 ++iter;
<a name="l01098"></a>01098                         }
<a name="l01099"></a>01099                         <span class="keywordflow">else</span>
<a name="l01100"></a>01100                         {
<a name="l01102"></a>01102                                 iter = groups.erase( iter );
<a name="l01103"></a>01103                         }
<a name="l01104"></a>01104                 }
<a name="l01105"></a>01105                 <span class="keywordflow">else</span>
<a name="l01106"></a>01106                 {
<a name="l01109"></a>01109                         ++iter;
<a name="l01110"></a>01110                 }
<a name="l01111"></a>01111         }
<a name="l01112"></a>01112         <span class="keywordflow">while</span>( iter != groups.end() );
<a name="l01113"></a>01113 
<a name="l01115"></a>01115         <span class="keywordflow">for</span> ( iter = groups.begin(); iter != groups.end(); ++iter )
<a name="l01116"></a>01116                 iter-&gt;GenMeshesInternal( meshes, name, genVertexColors, vboEnable );
<a name="l01117"></a>01117 }
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 
<a name="l01120"></a>01120 <span class="comment">//==========================================================</span>
<a name="l01122"></a>01122 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l01123"></a>01123 
<a name="l01124"></a>01124 <span class="comment">//----------------------------------------------------------</span>
<a name="l01125"></a>01125 <span class="keywordtype">void</span>
<a name="l01126"></a>01126 GrPolygonGroup::GenMeshesInternal( std::vector&lt; GrMeshInst* &gt;&amp; meshes, <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; <a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a>, <span class="keywordtype">bool</span> genVertexColors,
<a name="l01127"></a>01127                                                                    <span class="keywordtype">bool</span> vboEnable )<span class="keyword"> const</span>
<a name="l01128"></a>01128 <span class="keyword"></span>{
<a name="l01140"></a>01140         std::map&lt; __int64, std::vector&lt; const GrPolygon* &gt; &gt; formatGroups;
<a name="l01141"></a>01141         PolygonVec::const_iterator polyIter = _polygons.begin();
<a name="l01142"></a>01142         <span class="keyword">const</span> PolygonVec::const_iterator polyEnd = _polygons.end();
<a name="l01143"></a>01143         <span class="keywordflow">for</span> ( ; polyIter != polyEnd; ++polyIter )
<a name="l01144"></a>01144         {
<a name="l01146"></a>01146                 <span class="keyword">const</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>* curPolygon = *polyIter;
<a name="l01147"></a>01147 
<a name="l01149"></a>01149                 <span class="keywordflow">if</span> ( curPolygon-&gt;<a class="code" href="class_gr_polygon.html#b4a64686345e7c952395fb5432822f7d" title="material information.">GetMaterial</a>() == 0 )
<a name="l01150"></a>01150                         <span class="keywordflow">continue</span>;
<a name="l01151"></a>01151 
<a name="l01154"></a>01154                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_u_t_message_8h.html#0a3c0b351ab09281b662a9ff4f900a53">flags</a> = curPolygon-&gt;<a class="code" href="class_gr_polygon.html#d5cb84031e18ea044c44cb7e245b7fc2">GetVertexFlags</a>();
<a name="l01155"></a>01155                 <a class="code" href="class_gr_uber_texture.html" title="class GrUberTexture">GrUberTexture</a>* uberTexture = curPolygon-&gt;<a class="code" href="class_gr_polygon.html#7e2c3270815ee17025f222dc0c3be4ea" title="ubertexture information.">GetUberTexture</a>();
<a name="l01156"></a>01156 
<a name="l01158"></a>01158                 <a class="code" href="_u_t_x_8h.html#a254d9bac3ece6a9d99def539e8a80eb">__int64</a> hash = <a class="code" href="common__afx_8cpp.html#112b1d49a048535f30ce9916f6c56c56">HashMem64</a>( &amp;flags, <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ) );
<a name="l01159"></a>01159                 hash = <a class="code" href="common__afx_8cpp.html#112b1d49a048535f30ce9916f6c56c56">HashMem64</a>( &amp;uberTexture, <span class="keyword">sizeof</span>( <a class="code" href="class_gr_uber_texture.html" title="class GrUberTexture">GrUberTexture</a>* ), hash );
<a name="l01160"></a>01160 
<a name="l01162"></a>01162                 std::vector&lt; const GrPolygon* &gt;&amp; <a class="code" href="wglext_8h.html#69cec9b28d037f2272131b4fcd148620">group</a> = formatGroups[ hash ];
<a name="l01163"></a>01163                 group.push_back( curPolygon );
<a name="l01164"></a>01164         }
<a name="l01165"></a>01165 
<a name="l01167"></a>01167         <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; GrMesh::SRange &gt;</a> rangeVec;
<a name="l01168"></a>01168         <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; URef&lt; GrMaterial &gt;</a> &gt; rangeMaterials;
<a name="l01169"></a>01169 
<a name="l01171"></a>01171         <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; SVec3 &gt;</a> verts;
<a name="l01172"></a>01172         <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; SVec3 &gt;</a> normals;
<a name="l01173"></a>01173         <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; SVec3 &gt;</a> binormals;
<a name="l01174"></a>01174         <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; SVec3 &gt;</a> tangents;
<a name="l01175"></a>01175         <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; unsigned long &gt;</a> colors;
<a name="l01176"></a>01176         <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; SVec2 &gt;</a> uvs;
<a name="l01177"></a>01177         <a class="code" href="class_u_fast_array.html">UFastArray&lt; unsigned int &gt;</a> skinBoneIds;
<a name="l01178"></a>01178         <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; SVec3 &gt;</a> skinWeights;
<a name="l01179"></a>01179 
<a name="l01181"></a>01181         <a class="code" href="class_poly_mat_cmp.html">PolyMatCmp</a> polyMatCmp;
<a name="l01182"></a>01182         <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; unsigned short &gt;</a> <a class="code" href="_g_l_8h.html#0c1a6a349ce1520ca0284e13dcad1f86">indices</a>;
<a name="l01183"></a>01183         std::map&lt; __int64, std::vector&lt; const GrPolygon* &gt; &gt;::iterator iter = formatGroups.begin();
<a name="l01184"></a>01184         <span class="keyword">const</span> std::map&lt; __int64, std::vector&lt; const GrPolygon* &gt; &gt;::iterator <a class="code" href="_g_l_8h.html#432111147038972f06e049e18a837002">end</a> = formatGroups.end();
<a name="l01185"></a>01185         <span class="keywordflow">for</span> ( ; iter != end; ++iter )
<a name="l01186"></a>01186         {
<a name="l01188"></a>01188                 std::vector&lt; const GrPolygon* &gt;&amp; curGroup = iter-&gt;second;
<a name="l01189"></a>01189                 <span class="keywordflow">if</span> ( curGroup.size() == 0 )
<a name="l01190"></a>01190                         <span class="keywordflow">continue</span>;
<a name="l01191"></a>01191 
<a name="l01193"></a>01193                 std::sort( curGroup.begin(), curGroup.end(), polyMatCmp );
<a name="l01194"></a>01194 
<a name="l01196"></a>01196                 <a class="code" href="class_gr_material.html" title="class GrMaterial">GrMaterial</a>* curMat = curGroup[ 0 ]-&gt;GetMaterial();
<a name="l01197"></a>01197                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags = curGroup[ 0 ]-&gt;GetVertexFlags();
<a name="l01198"></a>01198                 <a class="code" href="class_gr_uber_texture.html" title="class GrUberTexture">GrUberTexture</a>* curUberTex = curGroup[ 0 ]-&gt;GetUberTexture();
<a name="l01199"></a>01199 
<a name="l01202"></a>01202                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( curMat != 0 );
<a name="l01203"></a>01203 
<a name="l01204"></a>01204 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l01205"></a>01205 <span class="preprocessor"></span>                std::set&lt; GrMaterial* &gt; usedMaterials;
<a name="l01206"></a>01206 <span class="preprocessor">#endif</span>
<a name="l01207"></a>01207 <span class="preprocessor"></span>
<a name="l01209"></a>01209                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> kMaxVertexCount = 30000;
<a name="l01210"></a>01210                 std::vector&lt; const GrPolygon* &gt;::iterator polyIter = curGroup.begin();
<a name="l01211"></a>01211                 <span class="keyword">const</span> std::vector&lt; const GrPolygon* &gt;::iterator polyEnd = curGroup.end();
<a name="l01212"></a>01212                 <span class="keywordflow">do</span>
<a name="l01213"></a>01213                 {
<a name="l01215"></a>01215                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rangeStart = 0;
<a name="l01216"></a>01216                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = 0;
<a name="l01217"></a>01217 
<a name="l01219"></a>01219                         rangeVec.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l01220"></a>01220                         rangeMaterials.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l01221"></a>01221 
<a name="l01223"></a>01223                         verts.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l01224"></a>01224                         normals.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l01225"></a>01225                         tangents.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l01226"></a>01226                         binormals.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l01227"></a>01227                         colors.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l01228"></a>01228                         uvs.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l01229"></a>01229                         skinBoneIds.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l01230"></a>01230                         skinWeights.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l01231"></a>01231 
<a name="l01234"></a>01234                         <span class="keywordflow">for</span> ( ; polyIter != polyEnd &amp;&amp; vertexCount &lt; kMaxVertexCount; ++polyIter )
<a name="l01235"></a>01235                         {
<a name="l01237"></a>01237                                 <span class="keywordflow">if</span> ( ( *polyIter )-&gt;GetMaterial() != curMat )
<a name="l01238"></a>01238                                 {
<a name="l01240"></a>01240                                         <a class="code" href="struct_gr_mesh_1_1_s_range.html">GrMesh::SRange</a> newRange;
<a name="l01241"></a>01241                                         newRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#332525f7e1ef670c14bd59cd8b47a34f">name</a> = curMat-&gt;GetName();
<a name="l01242"></a>01242                                         newRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a> = rangeStart;
<a name="l01243"></a>01243                                         newRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a> = vertexCount - rangeStart;
<a name="l01244"></a>01244                                         rangeVec.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( newRange );
<a name="l01245"></a>01245 
<a name="l01246"></a>01246 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l01247"></a>01247 <span class="preprocessor"></span>                                        <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( usedMaterials.find( curMat ) == usedMaterials.end() );
<a name="l01248"></a>01248                                         usedMaterials.insert( curMat );
<a name="l01249"></a>01249 <span class="preprocessor">#endif</span>
<a name="l01250"></a>01250 <span class="preprocessor"></span>
<a name="l01252"></a>01252                                         rangeMaterials.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( curMat );
<a name="l01253"></a>01253 
<a name="l01255"></a>01255                                         rangeStart = vertexCount;
<a name="l01256"></a>01256                                         curMat = ( *polyIter )-&gt;GetMaterial();
<a name="l01257"></a>01257 
<a name="l01260"></a>01260                                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( curMat != 0 );
<a name="l01261"></a>01261                                 }
<a name="l01262"></a>01262 
<a name="l01264"></a>01264                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polyTriCount = ( *polyIter )-&gt;GetTriangleCount();
<a name="l01265"></a>01265                                 <a class="code" href="struct_s_polygon_triangle.html" title="polygon triangle.">SPolygonTriangle</a> *triangles = 0;
<a name="l01266"></a>01266                                 <a class="code" href="struct_s_polygon_triangle_skin.html" title="polygon triangle skinning info.">SPolygonTriangleSkin</a>* skinTriangles = 0;
<a name="l01267"></a>01267                                 <span class="keywordflow">if</span> ( _skinned )
<a name="l01268"></a>01268                                 {
<a name="l01270"></a>01270                                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> totalVertexDataSize = <span class="keyword">sizeof</span>( <a class="code" href="struct_s_polygon_triangle.html" title="polygon triangle.">SPolygonTriangle</a> ) + <span class="keyword">sizeof</span>( <a class="code" href="struct_s_polygon_triangle_skin.html" title="polygon triangle skinning info.">SPolygonTriangleSkin</a> );
<a name="l01271"></a>01271                                         triangles = ( <a class="code" href="struct_s_polygon_triangle.html" title="polygon triangle.">SPolygonTriangle</a>* )<a class="code" href="common__afx_8cpp.html#a38123a381fda4eb71767e320a1331d1" title="temporary memory allocation">TempAlloc</a>( polyTriCount * totalVertexDataSize );
<a name="l01272"></a>01272                                         skinTriangles = ( <a class="code" href="struct_s_polygon_triangle_skin.html" title="polygon triangle skinning info.">SPolygonTriangleSkin</a>* )( triangles + polyTriCount );
<a name="l01273"></a>01273                                 }
<a name="l01274"></a>01274                                 <span class="keywordflow">else</span>
<a name="l01275"></a>01275                                 {
<a name="l01277"></a>01277                                         triangles = ( <a class="code" href="struct_s_polygon_triangle.html" title="polygon triangle.">SPolygonTriangle</a>* )<a class="code" href="common__afx_8cpp.html#a38123a381fda4eb71767e320a1331d1" title="temporary memory allocation">TempAlloc</a>( polyTriCount * <span class="keyword">sizeof</span>( <a class="code" href="struct_s_polygon_triangle.html" title="polygon triangle.">SPolygonTriangle</a> ) );
<a name="l01278"></a>01278                                 }
<a name="l01279"></a>01279 
<a name="l01281"></a>01281                                 ( *polyIter )-&gt;Triangulate( triangles, skinTriangles );
<a name="l01282"></a>01282 
<a name="l01284"></a>01284                                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tri = 0; tri &lt; polyTriCount; ++tri )
<a name="l01285"></a>01285                                 {
<a name="l01287"></a>01287                                         verts.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a>.position );
<a name="l01288"></a>01288                                         verts.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a>.position );
<a name="l01289"></a>01289                                         verts.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a>.position );
<a name="l01290"></a>01290                                         <span class="keywordflow">if</span> ( flags &amp; <a class="code" href="class_gr_polygon.html#f85991824f91a6724771e1ace01f1caf" title="valid flags.">GrPolygon::kNormal</a> )
<a name="l01291"></a>01291                                         {
<a name="l01292"></a>01292                                                 normals.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a>.normal.Normalized() );
<a name="l01293"></a>01293                                                 normals.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a>.normal.Normalized() );
<a name="l01294"></a>01294                                                 normals.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a>.normal.Normalized() );
<a name="l01295"></a>01295                                         }
<a name="l01296"></a>01296                                         <span class="keywordflow">if</span> ( flags &amp; <a class="code" href="class_gr_polygon.html#294f4e919c062a31183e59d05c2352ae">GrPolygon::kTangent</a> )
<a name="l01297"></a>01297                                         {
<a name="l01298"></a>01298                                                 tangents.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a>.tangent.Normalized() );
<a name="l01299"></a>01299                                                 tangents.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a>.tangent.Normalized() );
<a name="l01300"></a>01300                                                 tangents.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a>.tangent.Normalized() );
<a name="l01301"></a>01301                                         }
<a name="l01302"></a>01302                                         <span class="keywordflow">if</span> ( flags &amp; <a class="code" href="class_gr_polygon.html#8649525f9a18567bd50c87ab9436a9d9">GrPolygon::kBiNormal</a> )
<a name="l01303"></a>01303                                         {
<a name="l01304"></a>01304                                                 binormals.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a>.binormal.Normalized() );
<a name="l01305"></a>01305                                                 binormals.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a>.binormal.Normalized() );
<a name="l01306"></a>01306                                                 binormals.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a>.binormal.Normalized() );
<a name="l01307"></a>01307                                         }
<a name="l01308"></a>01308                                         <span class="keywordflow">if</span> ( flags &amp; <a class="code" href="class_gr_polygon.html#438f9ff37f015e22bd8e48f94637b766">GrPolygon::kColor</a> )
<a name="l01309"></a>01309                                         {
<a name="l01310"></a>01310                                                 colors.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( *( ( <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>* )triangles[ tri ].<a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a>.color ) );
<a name="l01311"></a>01311                                                 colors.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( *( ( <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>* )triangles[ tri ].<a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a>.color ) );
<a name="l01312"></a>01312                                                 colors.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( *( ( <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>* )triangles[ tri ].<a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a>.color ) );
<a name="l01313"></a>01313                                         }
<a name="l01314"></a>01314                                         <span class="keywordflow">if</span> ( flags &amp; <a class="code" href="class_gr_polygon.html#f61ee04e7a4e4e076f5e4beb223d8fbc">GrPolygon::kUV</a> )
<a name="l01315"></a>01315                                         {
<a name="l01316"></a>01316                                                 uvs.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a>.uv );
<a name="l01317"></a>01317                                                 uvs.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a>.uv );
<a name="l01318"></a>01318                                                 uvs.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( triangles[ tri ].<a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a>.uv );
<a name="l01319"></a>01319                                         }
<a name="l01320"></a>01320                                         <span class="keywordflow">if</span> ( _skinned )
<a name="l01321"></a>01321                                         {
<a name="l01322"></a>01322                                                 skinBoneIds.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( skinTriangles[ tri ].s0.boneIds );
<a name="l01323"></a>01323                                                 skinBoneIds.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( skinTriangles[ tri ].s1.boneIds );
<a name="l01324"></a>01324                                                 skinBoneIds.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( skinTriangles[ tri ].s2.boneIds );
<a name="l01325"></a>01325                                                 skinWeights.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( skinTriangles[ tri ].s0.weights );
<a name="l01326"></a>01326                                                 skinWeights.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( skinTriangles[ tri ].s1.weights );
<a name="l01327"></a>01327                                                 skinWeights.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( skinTriangles[ tri ].s2.weights );
<a name="l01328"></a>01328                                         }
<a name="l01329"></a>01329                                 }
<a name="l01330"></a>01330 
<a name="l01332"></a>01332                                 vertexCount += 3 * polyTriCount;
<a name="l01333"></a>01333 
<a name="l01335"></a>01335                                 <a class="code" href="common__afx_8cpp.html#4f8b297dfd37bb5e5081041d840d19cf">TempFree</a>( triangles );
<a name="l01336"></a>01336                         }
<a name="l01337"></a>01337 
<a name="l01339"></a>01339                         <a class="code" href="struct_gr_mesh_1_1_s_range.html">GrMesh::SRange</a> newRange;
<a name="l01340"></a>01340                         newRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#332525f7e1ef670c14bd59cd8b47a34f">name</a> = curMat-&gt;GetName();
<a name="l01341"></a>01341                         newRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a> = rangeStart;
<a name="l01342"></a>01342                         newRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a> = vertexCount - rangeStart;
<a name="l01343"></a>01343                         rangeVec.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( newRange );
<a name="l01344"></a>01344 
<a name="l01346"></a>01346                         rangeMaterials.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( curMat );
<a name="l01347"></a>01347 
<a name="l01349"></a>01349                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( rangeMaterials.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() == rangeVec.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() );
<a name="l01350"></a>01350 
<a name="l01352"></a>01352                         indices.<a class="code" href="class_u_fast_array.html#97c6c9910cc6e541254eaaaa530d48a9">Clear</a>();
<a name="l01353"></a>01353                         indices.<a class="code" href="class_u_fast_array.html#406813631148524e47f65bb3be44db61" title="resizes the array to the size specified.">Resize</a>( vertexCount, 0 );
<a name="l01354"></a>01354 <span class="preprocessor">#if !INDEXIFY_RANGES_SEPARATE</span>
<a name="l01356"></a>01356 <span class="preprocessor">                        vertexCount = IndexifyMesh( indices,</span>
<a name="l01357"></a>01357 <span class="preprocessor"></span>                                verts.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? verts.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01358"></a>01358                                 normals.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? normals.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01359"></a>01359                                 tangents.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? tangents.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01360"></a>01360                                 binormals.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? binormals.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01361"></a>01361                                 colors.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? colors.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01362"></a>01362                                 uvs.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? uvs.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01363"></a>01363                                 uniqueUVs.GetElemCount() ? uniqueUVs.GetPtr() : 0,
<a name="l01364"></a>01364                                 skinBoneIds.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? skinBoneIds.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01365"></a>01365                                 skinWeights.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? skinWeights.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01366"></a>01366                                 0, 0, vertexCount );
<a name="l01367"></a>01367 <span class="preprocessor">#else</span>
<a name="l01368"></a>01368 <span class="preprocessor"></span>                        vertexCount = 0;
<a name="l01369"></a>01369 <span class="preprocessor">#endif</span>
<a name="l01371"></a>01371 <span class="preprocessor">                        for ( unsigned int i = 0; i &lt; rangeVec.GetElemCount(); ++i )</span>
<a name="l01372"></a>01372 <span class="preprocessor"></span>                        {
<a name="l01374"></a>01374                                 <a class="code" href="struct_gr_mesh_1_1_s_range.html">GrMesh::SRange</a>&amp; curRange = rangeVec[ i ];
<a name="l01375"></a>01375 <span class="preprocessor">#if INDEXIFY_RANGES_SEPARATE</span>
<a name="l01381"></a>01381 <span class="preprocessor">                                vertexCount += IndexifyMesh( indices,</span>
<a name="l01382"></a>01382 <span class="preprocessor"></span>                                        verts.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? verts.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01383"></a>01383                                         normals.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? normals.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01384"></a>01384                                         tangents.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? tangents.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01385"></a>01385                                         binormals.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? binormals.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01386"></a>01386                                         colors.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? colors.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01387"></a>01387                                         uvs.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? uvs.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01388"></a>01388                                         skinBoneIds.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? skinBoneIds.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01389"></a>01389                                         skinWeights.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? skinWeights.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01390"></a>01390                                         curRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a>, vertexCount, curRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a> );
<a name="l01391"></a>01391 <span class="preprocessor">#endif</span>
<a name="l01394"></a>01394 <span class="preprocessor">                                curRange.minIndex = 0xFFFF;</span>
<a name="l01395"></a>01395 <span class="preprocessor"></span>                                curRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#7e44b7370e15a3faaea7669107d2f4cd" title="only used for indexed meshes.">maxIndex</a> = 0;
<a name="l01396"></a>01396 
<a name="l01398"></a>01398                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = curRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#baaa840da5e956fb1b9c1750a0c8928f">start</a>;
<a name="l01399"></a>01399                                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; curRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#6431490fa0589e30eb3eef84b21352c5" title="starting vertex or index.">count</a>; ++j, ++idx )
<a name="l01400"></a>01400                                 {
<a name="l01401"></a>01401                                         curRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#63e71ca2a50a27fa4c6b95ebfd7472f4" title="number of vertices or indices to process.">minIndex</a> = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( indices[ idx ], ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> )curRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#63e71ca2a50a27fa4c6b95ebfd7472f4" title="number of vertices or indices to process.">minIndex</a> );
<a name="l01402"></a>01402                                         curRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#7e44b7370e15a3faaea7669107d2f4cd" title="only used for indexed meshes.">maxIndex</a> = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( indices[ idx ], ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> )curRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#7e44b7370e15a3faaea7669107d2f4cd" title="only used for indexed meshes.">maxIndex</a> );
<a name="l01403"></a>01403                                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( curRange.<a class="code" href="struct_gr_mesh_1_1_s_range.html#7e44b7370e15a3faaea7669107d2f4cd" title="only used for indexed meshes.">maxIndex</a> &lt; vertexCount );
<a name="l01404"></a>01404                                 }
<a name="l01405"></a>01405                         }
<a name="l01406"></a>01406 
<a name="l01407"></a>01407                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> curMeshCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )meshes.size();
<a name="l01408"></a>01408                         <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a> curMeshName = name;
<a name="l01409"></a>01409                         curMeshName += <span class="stringliteral">"_"</span>;
<a name="l01410"></a>01410                         curMeshName &lt;&lt; curMeshCount;
<a name="l01411"></a>01411 
<a name="l01412"></a>01412                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( vertexCount &gt; 0 );
<a name="l01413"></a>01413 
<a name="l01415"></a>01415                         <a class="code" href="class_u_ref.html">URef&lt; GrMesh &gt;</a> newMesh = <span class="keyword">new</span> <a class="code" href="class_gr_mesh.html" title="class GrMesh">GrMesh</a>(
<a name="l01416"></a>01416                                 curMeshName,
<a name="l01417"></a>01417                                 ( verts.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() &gt; 0 ) ? verts.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01418"></a>01418                                 ( normals.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() &gt; 0 ) ? normals.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01419"></a>01419                                 ( binormals.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() &gt; 0 ) ? binormals.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01420"></a>01420                                 ( tangents.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() &gt; 0 ) ? tangents.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01421"></a>01421                                 ( colors.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() &gt; 0 ) ? colors.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01422"></a>01422                                 ( uvs.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() &gt; 0 ) ? uvs.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01423"></a>01423                                 vertexCount,
<a name="l01424"></a>01424                                 ( indices.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() &gt; 0 ) ? indices.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01425"></a>01425                                 ( <span class="keywordtype">unsigned</span> short )indices.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(),
<a name="l01426"></a>01426                                 ( rangeVec.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() &gt; 0 ) ? rangeVec.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01427"></a>01427                                 ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )( rangeVec.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ),
<a name="l01428"></a>01428                                 curUberTex,
<a name="l01429"></a>01429                                 vboEnable );
<a name="l01430"></a>01430 
<a name="l01432"></a>01432                         <span class="keywordflow">if</span> ( _skinned )
<a name="l01433"></a>01433                         {
<a name="l01435"></a>01435                                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( skinWeights.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() == verts.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() );
<a name="l01436"></a>01436                                 <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( skinBoneIds.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() == verts.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() );
<a name="l01437"></a>01437 
<a name="l01439"></a>01439                                 <a class="code" href="class_gr_skin.html" title="class GrSkin">GrSkin</a>* skin = <span class="keyword">new</span> <a class="code" href="class_gr_skin.html" title="class GrSkin">GrSkin</a>( curMeshName + <span class="stringliteral">"_skin"</span>, newMesh-&gt;Clone(),
<a name="l01440"></a>01440                                         skinWeights.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? skinWeights.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01441"></a>01441                                         skinBoneIds.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() ? skinBoneIds.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>() : 0,
<a name="l01442"></a>01442                                         _boneNameArray, _invBindMatrices, _boneCount );
<a name="l01443"></a>01443                                 newMesh-&gt;SetSkin( skin );
<a name="l01444"></a>01444                         }
<a name="l01445"></a>01445 
<a name="l01448"></a>01448                         <a class="code" href="class_gr_mesh_inst.html" title="class GrMeshInst">GrMeshInst</a>* meshInst = <span class="keyword">new</span> <a class="code" href="class_gr_mesh_inst.html" title="class GrMeshInst">GrMeshInst</a>( newMesh, rangeMaterials.<a class="code" href="class_u_fast_array.html#8db9c643b2bd8c7a2a4770e74ca76e31">GetPtr</a>(), <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>() );
<a name="l01449"></a>01449                         meshes.push_back( meshInst );
<a name="l01450"></a>01450 
<a name="l01451"></a>01451                 } <span class="keywordflow">while</span> ( polyIter != polyEnd );
<a name="l01452"></a>01452         }
<a name="l01453"></a>01453 }
<a name="l01454"></a>01454 
<a name="l01455"></a>01455 <span class="comment">//----------------------------------------------------------</span>
<a name="l01456"></a>01456 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l01457"></a>01457 GrPolygonGroup::IndexifyMesh( <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; unsigned short &gt;</a>&amp; indices, <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* positions, <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* normals,
<a name="l01458"></a>01458                                                           <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* biNormals, <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* tangents, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>* colors, <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a>* texCoords,
<a name="l01459"></a>01459                                                           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* skinBoneIds, <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>* skinWeights, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startVertex,
<a name="l01460"></a>01460                                                           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dstVertex, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount )<span class="keyword"> const</span>
<a name="l01461"></a>01461 <span class="keyword"></span>{
<a name="l01462"></a>01462 <span class="preprocessor">#if 1</span>
<a name="l01463"></a>01463 <span class="preprocessor"></span>        <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( dstVertex &lt;= startVertex );
<a name="l01464"></a>01464 
<a name="l01466"></a>01466         <span class="keywordtype">int</span> *duplicates = <span class="keyword">new</span> <span class="keywordtype">int</span>[ vertexCount ];
<a name="l01467"></a>01467         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; vertexCount; ++i )
<a name="l01468"></a>01468                 duplicates[ i ] = -1;
<a name="l01469"></a>01469 
<a name="l01471"></a>01471         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> endVertex = startVertex + vertexCount;
<a name="l01472"></a>01472         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = startVertex; i &lt; endVertex; ++i )
<a name="l01473"></a>01473         {
<a name="l01475"></a>01475                 <span class="keywordflow">if</span> ( duplicates[ i - startVertex ] != -1 )
<a name="l01476"></a>01476                         <span class="keywordflow">continue</span>;
<a name="l01477"></a>01477 
<a name="l01479"></a>01479                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = i + 1; j &lt; endVertex; ++j )
<a name="l01480"></a>01480                 {
<a name="l01482"></a>01482                         <span class="keywordflow">if</span> ( duplicates[ j - startVertex ] != -1 )
<a name="l01483"></a>01483                                 <span class="keywordflow">continue</span>;
<a name="l01484"></a>01484 
<a name="l01486"></a>01486                         <span class="keywordflow">if</span> ( !IsPositionEqual( positions[ i ], positions[ j ] ) )
<a name="l01487"></a>01487                                 <span class="keywordflow">continue</span>;
<a name="l01488"></a>01488 
<a name="l01489"></a>01489                         <span class="keywordflow">if</span> ( normals &amp;&amp; !IsNormalEqual( normals[ i ], normals[ j ] ) )
<a name="l01490"></a>01490                                 <span class="keywordflow">continue</span>;
<a name="l01491"></a>01491 
<a name="l01492"></a>01492                         <span class="keywordflow">if</span> ( biNormals &amp;&amp; !IsTangentEqual( biNormals[ i ], biNormals[ j ] ) )
<a name="l01493"></a>01493                                 <span class="keywordflow">continue</span>;
<a name="l01494"></a>01494 
<a name="l01495"></a>01495                         <span class="keywordflow">if</span> ( tangents &amp;&amp; !IsTangentEqual( tangents[ i ], tangents[ j ] ) )
<a name="l01496"></a>01496                                 <span class="keywordflow">continue</span>;
<a name="l01497"></a>01497 
<a name="l01498"></a>01498                         <span class="keywordflow">if</span> ( colors &amp;&amp; colors[ i ] != colors[ j ] )
<a name="l01499"></a>01499                                 <span class="keywordflow">continue</span>;
<a name="l01500"></a>01500 
<a name="l01501"></a>01501                         <span class="keywordflow">if</span> ( texCoords &amp;&amp; !IsUVEqual( texCoords[ i ], texCoords[ j ] ) )
<a name="l01502"></a>01502                                 <span class="keywordflow">continue</span>;
<a name="l01503"></a>01503 
<a name="l01504"></a>01504                         <span class="keywordflow">if</span> ( skinBoneIds &amp;&amp; skinBoneIds[ i ] != skinBoneIds[ j ] )
<a name="l01505"></a>01505                                 <span class="keywordflow">continue</span>;
<a name="l01506"></a>01506 
<a name="l01507"></a>01507                         <span class="keywordflow">if</span> ( skinWeights &amp;&amp; skinWeights[ i ] != skinWeights[ j ] )
<a name="l01508"></a>01508                                 <span class="keywordflow">continue</span>;
<a name="l01509"></a>01509 
<a name="l01511"></a>01511                         duplicates[ j - startVertex ] = i;
<a name="l01512"></a>01512                 }
<a name="l01513"></a>01513         }
<a name="l01514"></a>01514 
<a name="l01517"></a>01517         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dstAdj = startVertex - dstVertex;
<a name="l01518"></a>01518         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> adjustCount = 0;
<a name="l01519"></a>01519         <span class="keywordtype">int</span>* curDuplicate = duplicates;
<a name="l01520"></a>01520         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = startVertex; i &lt; endVertex; ++i, ++curDuplicate )
<a name="l01521"></a>01521         {
<a name="l01522"></a>01522                 <span class="keywordflow">if</span> ( *curDuplicate != -1 )
<a name="l01523"></a>01523                 {
<a name="l01525"></a>01525                         ++adjustCount;
<a name="l01526"></a>01526                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( *curDuplicate &lt; ( <span class="keywordtype">int</span> )i );
<a name="l01527"></a>01527                         indices[ i ] = indices[ *curDuplicate ];
<a name="l01528"></a>01528                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( indices[ i ] &lt; endVertex );
<a name="l01529"></a>01529                 }
<a name="l01530"></a>01530                 <span class="keywordflow">else</span>
<a name="l01531"></a>01531                 {
<a name="l01532"></a>01532                         indices[ i ] = ( <span class="keywordtype">unsigned</span> short )( i - adjustCount - dstAdj );
<a name="l01533"></a>01533                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( indices[ i ] &lt; endVertex );
<a name="l01534"></a>01534                 }
<a name="l01535"></a>01535         }
<a name="l01536"></a>01536 
<a name="l01539"></a>01539         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newVertexCount = vertexCount - adjustCount;
<a name="l01540"></a>01540         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( newVertexCount &gt; 0 );
<a name="l01541"></a>01541 
<a name="l01543"></a>01543         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastVertex = dstVertex + newVertexCount;
<a name="l01544"></a>01544         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = startVertex; i &lt; endVertex; ++i )
<a name="l01545"></a>01545         {
<a name="l01546"></a>01546                 <span class="keywordflow">if</span> ( duplicates[ i - startVertex ] == -1 )
<a name="l01547"></a>01547                 {
<a name="l01548"></a>01548                         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( indices[ i ] &lt; ( <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> )lastVertex );
<a name="l01549"></a>01549                         positions[ indices[ i ] ] = positions[ i ];
<a name="l01550"></a>01550                         <span class="keywordflow">if</span> ( normals )
<a name="l01551"></a>01551                                 normals[ indices[ i ] ] = normals[ i ];
<a name="l01552"></a>01552                         <span class="keywordflow">if</span> ( tangents )
<a name="l01553"></a>01553                                 tangents[ indices[ i ] ] = tangents[ i ];
<a name="l01554"></a>01554                         <span class="keywordflow">if</span> ( biNormals )
<a name="l01555"></a>01555                                 biNormals[ indices[ i ] ] = biNormals[ i ];
<a name="l01556"></a>01556                         <span class="keywordflow">if</span> ( colors )
<a name="l01557"></a>01557                                 colors[ indices[ i ] ] = colors[ i ];
<a name="l01558"></a>01558                         <span class="keywordflow">if</span> ( texCoords )
<a name="l01559"></a>01559                                 texCoords[ indices[ i ] ] = texCoords[ i ];
<a name="l01560"></a>01560                         <span class="keywordflow">if</span> ( skinBoneIds )
<a name="l01561"></a>01561                                 skinBoneIds[ indices[ i ] ] = skinBoneIds[ i ];
<a name="l01562"></a>01562                         <span class="keywordflow">if</span> ( skinWeights )
<a name="l01563"></a>01563                                 skinWeights[ indices[ i ] ] = skinWeights[ i ];
<a name="l01564"></a>01564                 }
<a name="l01565"></a>01565         }
<a name="l01566"></a>01566 
<a name="l01568"></a>01568         <span class="keyword">delete</span>[] duplicates;
<a name="l01569"></a>01569 
<a name="l01571"></a>01571         <span class="keywordflow">return</span> newVertexCount;
<a name="l01572"></a>01572 <span class="preprocessor">#else</span>
<a name="l01573"></a>01573 <span class="preprocessor"></span><span class="preprocessor">#pragma message ( "Performance warning... mesh indexing is disabled." )</span>
<a name="l01574"></a>01574 <span class="preprocessor"></span>
<a name="l01576"></a>01576         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; vertexCount; ++i )
<a name="l01577"></a>01577                 indices.push_back( i );
<a name="l01578"></a>01578         <span class="keywordflow">return</span> vertexCount;
<a name="l01579"></a>01579 <span class="preprocessor">#endif</span>
<a name="l01580"></a>01580 <span class="preprocessor"></span>}
<a name="l01581"></a>01581 
<a name="l01582"></a>01582 <span class="comment">//----------------------------------------------------------</span>
<a name="l01583"></a>01583 <span class="keywordtype">void</span>
<a name="l01584"></a>01584 GrPolygonGroup::Copy( <span class="keyword">const</span> <a class="code" href="class_gr_polygon_group.html" title="class GrPolygonGroup">GrPolygonGroup</a>&amp; group )
<a name="l01585"></a>01585 {
<a name="l01586"></a>01586         _aaBox = group.<a class="code" href="class_gr_polygon_group.html#486c783ed39513307b497d939a720df8">_aaBox</a>;
<a name="l01587"></a>01587         _vertexCount = group.<a class="code" href="class_gr_polygon_group.html#76225ebab210fa29232157face212729">_vertexCount</a>;
<a name="l01588"></a>01588         _aaBoxDirty = group.<a class="code" href="class_gr_polygon_group.html#ca65922b3c4d7e84dd9360a1c56f4339">_aaBoxDirty</a>;
<a name="l01589"></a>01589         _skinned = group.<a class="code" href="class_gr_polygon_group.html#629f3ddb0dcb89c967bae70e720af366" title="true if skinned.">_skinned</a>;
<a name="l01590"></a>01590 
<a name="l01591"></a>01591         <span class="keyword">delete</span>[] _boneNameArray;
<a name="l01592"></a>01592         <span class="keyword">delete</span>[] _invBindMatrices;
<a name="l01593"></a>01593         <span class="keywordflow">if</span> ( _skinned )
<a name="l01594"></a>01594         {
<a name="l01595"></a>01595                 _boneCount = group.<a class="code" href="class_gr_polygon_group.html#99dfce21f473d59e71e9745e11e030e9" title="skinning info.">_boneCount</a>;
<a name="l01596"></a>01596                 _boneNameArray = <span class="keyword">new</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>[ _boneCount ];
<a name="l01597"></a>01597                 _invBindMatrices = <span class="keyword">new</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>[ _boneCount ];
<a name="l01598"></a>01598                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _boneCount; ++i )
<a name="l01599"></a>01599                 {
<a name="l01600"></a>01600                         _boneNameArray[ i ] = group.<a class="code" href="class_gr_polygon_group.html#509dbb9fde8f9c5fe0324bd415a0cb6f">_boneNameArray</a>[ i ];
<a name="l01601"></a>01601                         _invBindMatrices[ i ] = group.<a class="code" href="class_gr_polygon_group.html#f92c9c6bb1a972d1dd1c54fd2647087f">_invBindMatrices</a>[ i ];
<a name="l01602"></a>01602                 }
<a name="l01603"></a>01603         }
<a name="l01604"></a>01604         <span class="keywordflow">else</span>
<a name="l01605"></a>01605         {
<a name="l01606"></a>01606                 _boneCount = 0;
<a name="l01607"></a>01607                 _boneNameArray = 0;
<a name="l01608"></a>01608                 _invBindMatrices = 0;
<a name="l01609"></a>01609         }
<a name="l01610"></a>01610 
<a name="l01611"></a>01611         _polygons.reserve( group.<a class="code" href="class_gr_polygon_group.html#988ca7457097c8cc7eb735ddfc3b5036">_polygons</a>.size() );
<a name="l01612"></a>01612         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polyCount = group.<a class="code" href="class_gr_polygon_group.html#3e0a4ae8030ded12301495eed40135df" title="polygon iteration">GetPolygonCount</a>();
<a name="l01613"></a>01613         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; polyCount; ++i )
<a name="l01614"></a>01614                 _polygons.push_back( <span class="keyword">new</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>( *group.<a class="code" href="class_gr_polygon_group.html#988ca7457097c8cc7eb735ddfc3b5036">_polygons</a>[ i ] ) );
<a name="l01615"></a>01615 }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617 <span class="comment">//----------------------------------------------------------</span>
<a name="l01618"></a>01618 <span class="keywordtype">void</span>
<a name="l01619"></a>01619 GrPolygonGroup::EnsureAABox()<span class="keyword"> const</span>
<a name="l01620"></a>01620 <span class="keyword"></span>{
<a name="l01621"></a>01621         <span class="keywordflow">if</span> ( !_aaBoxDirty )
<a name="l01622"></a>01622                 <span class="keywordflow">return</span>;
<a name="l01623"></a>01623 
<a name="l01625"></a>01625         _aaBoxDirty = <span class="keyword">false</span>;
<a name="l01626"></a>01626 
<a name="l01628"></a>01628         <span class="keywordflow">if</span> ( _polygons.size() == 0 )
<a name="l01629"></a>01629         {
<a name="l01630"></a>01630                 _aaBox = <a class="code" href="class_m_a_a_box.html" title="class MAABox">MAABox</a>();
<a name="l01631"></a>01631                 <span class="keywordflow">return</span>;
<a name="l01632"></a>01632         }
<a name="l01633"></a>01633 
<a name="l01638"></a>01638         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> maxExts( -FLT_MAX, -FLT_MAX, -FLT_MAX );
<a name="l01639"></a>01639         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> minExts( FLT_MAX, FLT_MAX, FLT_MAX );
<a name="l01640"></a>01640         PolygonVec::const_iterator iter = _polygons.begin();
<a name="l01641"></a>01641         <span class="keyword">const</span> PolygonVec::const_iterator end = _polygons.end();
<a name="l01642"></a>01642         <span class="keywordflow">for</span> ( ; iter != end; ++iter )
<a name="l01643"></a>01643         {
<a name="l01645"></a>01645                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertexCount = ( *iter )-&gt;GetVertexCount();
<a name="l01646"></a>01646                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; vertexCount; ++i )
<a name="l01647"></a>01647                 {
<a name="l01648"></a>01648                         maxExts.x = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( maxExts.x, ( *iter )-&gt;GetVertex( i ).position.x );
<a name="l01649"></a>01649                         maxExts.y = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( maxExts.y, ( *iter )-&gt;GetVertex( i ).position.y );
<a name="l01650"></a>01650                         maxExts.z = <a class="code" href="common__afx_8h.html#dd09d155ffe827b203d3236b451752e7">Max</a>( maxExts.z, ( *iter )-&gt;GetVertex( i ).position.z );
<a name="l01651"></a>01651                         minExts.x = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( minExts.x, ( *iter )-&gt;GetVertex( i ).position.x );
<a name="l01652"></a>01652                         minExts.y = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( minExts.y, ( *iter )-&gt;GetVertex( i ).position.y );
<a name="l01653"></a>01653                         minExts.z = <a class="code" href="common__afx_8h.html#0296e17691267defafdfde06589f50d5">Min</a>( minExts.z, ( *iter )-&gt;GetVertex( i ).position.z );
<a name="l01654"></a>01654                 }
<a name="l01655"></a>01655         }
<a name="l01656"></a>01656 
<a name="l01658"></a>01658         _aaBox.<a class="code" href="class_m_a_a_box.html#65a37e6adae9f465bb0ac964f4bfbe63">SetCenter</a>( 0.5f * ( maxExts + minExts ) );
<a name="l01659"></a>01659         _aaBox.<a class="code" href="class_m_a_a_box.html#9ce3a23bc3cfa705d6776807289bd178">SetHalfExts</a>(
<a name="l01660"></a>01660                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>(
<a name="l01661"></a>01661                            0.5f * ( maxExts.x - minExts.x ),
<a name="l01662"></a>01662                            0.5f * ( maxExts.y - minExts.y ),
<a name="l01663"></a>01663                            0.5f * ( maxExts.z - minExts.z ) 
<a name="l01664"></a>01664                          )
<a name="l01665"></a>01665                 );
<a name="l01666"></a>01666 }
<a name="l01667"></a>01667 
<a name="l01668"></a>01668 <span class="comment">//----------------------------------------------------------</span>
<a name="l01669"></a>01669 <span class="keywordtype">bool</span>
<a name="l01670"></a>01670 GrPolygonGroup::GenPolygonTSBasis( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; tangentOut, <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; binormalOut, <span class="keyword">const</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>&amp; polygon )
<a name="l01671"></a>01671 {
<a name="l01673"></a>01673         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polyVertexCount = polygon.<a class="code" href="class_gr_polygon.html#ef233c1659fde726aa60a1718a4ea8a4" title="vertex information.">GetVertexCount</a>();
<a name="l01674"></a>01674         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startIdx = 0;
<a name="l01675"></a>01675         <span class="keywordflow">for</span> ( ; startIdx &lt; polyVertexCount; ++startIdx )
<a name="l01676"></a>01676         {
<a name="l01678"></a>01678                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; <a class="code" href="glext_8h.html#8f5597b6002609ead33af221dcf29790">v0</a> = polygon.<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( startIdx ).<a class="code" href="struct_s_polygon_vertex.html#522e1e97ae3be47d4ea6d424773fc569" title="set to a combination of the constants above.">position</a>;
<a name="l01679"></a>01679                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; <a class="code" href="glext_8h.html#435c176a02c061b43e19bdf7c86cceae">v1</a> = polygon.<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( ( startIdx + 1 ) % polyVertexCount ).<a class="code" href="struct_s_polygon_vertex.html#522e1e97ae3be47d4ea6d424773fc569" title="set to a combination of the constants above.">position</a>;
<a name="l01680"></a>01680                 <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; <a class="code" href="glext_8h.html#0928f6d0f0f794ba000a21dfae422136">v2</a> = polygon.<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( ( startIdx + 2 ) % polyVertexCount ).<a class="code" href="struct_s_polygon_vertex.html#522e1e97ae3be47d4ea6d424773fc569" title="set to a combination of the constants above.">position</a>;
<a name="l01681"></a>01681 
<a name="l01683"></a>01683                 <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> normal = ( v2 - v1 ).Cross( v1 - v0 );
<a name="l01684"></a>01684                 <span class="keywordflow">if</span> ( normal.<a class="code" href="class_m_vec3.html#5dfd83de3ed52ac479d69a1c8407d495">Mag</a>() &gt; <a class="code" href="class_m_vec3.html#fe4df239e5cc14ba66ccdc907bff32c6" title="class header">MVec3::kNormalizeEpsilon</a> )
<a name="l01685"></a>01685                 {
<a name="l01687"></a>01687                         <span class="keyword">const</span> <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a>&amp; tc0 = polygon.<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( startIdx ).<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>;
<a name="l01688"></a>01688                         <span class="keyword">const</span> <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a>&amp; tc1 = polygon.<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( ( startIdx + 1 ) % polyVertexCount ).<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>;
<a name="l01689"></a>01689                         <span class="keyword">const</span> <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a>&amp; tc2 = polygon.<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( ( startIdx + 2 ) % polyVertexCount ).<a class="code" href="struct_s_polygon_vertex.html#022e87802986b84acbdae9c27e689c12" title="0 = blue, 1 = green, 2 = red, 3 = alpha.">uv</a>;
<a name="l01690"></a>01690                         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> tangentOutTemp;
<a name="l01691"></a>01691                         <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> binormalOutTemp;
<a name="l01692"></a>01692                         <a class="code" href="_gr_calc_tangents_8cpp.html#0e87bf2c26d1b5448bd739dcfefb100c" title="class header.">GrCalcTangents</a>( tangentOutTemp, binormalOutTemp, v0, v1, v2, tc0, tc1, tc2, <span class="keyword">true</span> );
<a name="l01693"></a>01693                         tangentOut = tangentOutTemp;
<a name="l01694"></a>01694                         binormalOut = binormalOutTemp;
<a name="l01695"></a>01695 
<a name="l01697"></a>01697                         <span class="keywordflow">break</span>;
<a name="l01698"></a>01698                 }
<a name="l01699"></a>01699         }
<a name="l01700"></a>01700 
<a name="l01702"></a>01702         <span class="keywordflow">return</span> startIdx != polyVertexCount;
<a name="l01703"></a>01703 }
<a name="l01704"></a>01704 
<a name="l01705"></a>01705 <span class="comment">//----------------------------------------------------------</span>
<a name="l01706"></a>01706 <a class="code" href="class_m_plane.html" title="class MPlane">MPlane</a>
<a name="l01707"></a>01707 GrPolygonGroup::CalcSplitPlane()<span class="keyword"> const</span>
<a name="l01708"></a>01708 <span class="keyword"></span>{
<a name="l01710"></a>01710         <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a> centroid;
<a name="l01711"></a>01711         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polyCount = ( <span class="keywordtype">unsigned</span> <a class="code" href="_g_l_aux_8h.html#b832c174e145540d491b0830fc05dbb1">int</a> )_polygons.size();
<a name="l01712"></a>01712         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; polyCount; ++i )
<a name="l01713"></a>01713         {
<a name="l01714"></a>01714                 <span class="keyword">const</span> <a class="code" href="class_gr_polygon.html" title="class GrPolygon">GrPolygon</a>* curPoly = _polygons[ i ];
<a name="l01715"></a>01715                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vertCount = curPoly-&gt;<a class="code" href="class_gr_polygon.html#ef233c1659fde726aa60a1718a4ea8a4" title="vertex information.">GetVertexCount</a>();
<a name="l01716"></a>01716                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; vertCount; ++j )
<a name="l01717"></a>01717                         centroid += curPoly-&gt;<a class="code" href="class_gr_polygon.html#5af4ec7c3b097b081a44b79f904baacd">GetVertex</a>( j ).<a class="code" href="struct_s_polygon_vertex.html#522e1e97ae3be47d4ea6d424773fc569" title="set to a combination of the constants above.">position</a>;
<a name="l01718"></a>01718         }
<a name="l01719"></a>01719         centroid *= 1.0f / ( float )<a class="code" href="class_gr_polygon_group.html#c8abcd749d8ba99fca070795ca770b2b" title="returns the total number of vertices in the group.">GetVertexCount</a>();
<a name="l01720"></a>01720 
<a name="l01722"></a>01722         <span class="keyword">const</span> <a class="code" href="class_m_a_a_box.html" title="class MAABox">MAABox</a>&amp; aaBox = <a class="code" href="class_gr_polygon_group.html#f036e17871ac905b28a8e9c90da6d0e6">GetAABox</a>();
<a name="l01723"></a>01723         <a class="code" href="class_m_plane.html" title="class MPlane">MPlane</a> plane = <a class="code" href="class_m_plane.html" title="class MPlane">MPlane</a>( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 0.0f, 1.0f ), centroid );
<a name="l01724"></a>01724 
<a name="l01727"></a>01727         <span class="keyword">const</span> <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>&amp; halfExts = aaBox.<a class="code" href="class_m_a_a_box.html#9c4c37dd6c9bffdbe6926c5a4c60145c">GetHalfExts</a>();
<a name="l01728"></a>01728         <span class="keywordflow">if</span> ( halfExts.<a class="code" href="class_m_vec3.html#8b834219441d8d65b3e4df28fe03f60f">GetX</a>() &gt; halfExts.<a class="code" href="class_m_vec3.html#dfadf4adb521222d91980376a7679dc8">GetY</a>() )
<a name="l01729"></a>01729         {
<a name="l01730"></a>01730                 <span class="keywordflow">if</span> ( halfExts.<a class="code" href="class_m_vec3.html#8b834219441d8d65b3e4df28fe03f60f">GetX</a>() &gt; halfExts.<a class="code" href="class_m_vec3.html#8b29390479c105bbb9926188b9742329">GetZ</a>() )
<a name="l01731"></a>01731                 {
<a name="l01733"></a>01733                         plane = <a class="code" href="class_m_plane.html" title="class MPlane">MPlane</a>( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 1.0f, 0.0f, 0.0f ), centroid );
<a name="l01734"></a>01734                 }
<a name="l01735"></a>01735         }
<a name="l01736"></a>01736         <span class="keywordflow">else</span>
<a name="l01737"></a>01737         {
<a name="l01738"></a>01738                 <span class="keywordflow">if</span> ( halfExts.<a class="code" href="class_m_vec3.html#dfadf4adb521222d91980376a7679dc8">GetY</a>() &gt; halfExts.<a class="code" href="class_m_vec3.html#8b29390479c105bbb9926188b9742329">GetZ</a>() )
<a name="l01739"></a>01739                 {
<a name="l01741"></a>01741                         plane = <a class="code" href="class_m_plane.html" title="class MPlane">MPlane</a>( <a class="code" href="class_m_vec3.html" title="class MVec3">MVec3</a>( 0.0f, 1.0f, 0.0f ), centroid );
<a name="l01742"></a>01742                 }
<a name="l01743"></a>01743         }
<a name="l01744"></a>01744 
<a name="l01746"></a>01746         <span class="keywordflow">return</span> plane;
<a name="l01747"></a>01747 }
<a name="l01748"></a>01748 <span class="comment">/*</span>
<a name="l01749"></a>01749 <span class="comment">//----------------------------------------------------------</span>
<a name="l01750"></a>01750 <span class="comment">void</span>
<a name="l01751"></a>01751 <span class="comment">GrPolygonGroup::CheckAABox( const GrPolygon&amp; polygon )</span>
<a name="l01752"></a>01752 <span class="comment">{</span>
<a name="l01753"></a>01753 <span class="comment">        float halfWidth = _aaBox.width * 0.5f;</span>
<a name="l01754"></a>01754 <span class="comment">        float halfHeight = _aaBox.height * 0.5f;</span>
<a name="l01755"></a>01755 <span class="comment">        float halfDepth = _aaBox.depth * 0.5f;</span>
<a name="l01756"></a>01756 <span class="comment">        SVec3 maxExts = SVec3( _aaBox.pos.x + halfWidth, _aaBox.pos.y + halfHeight, _aaBox.pos.z + halfDepth );</span>
<a name="l01757"></a>01757 <span class="comment">        SVec3 minExts = SVec3( _aaBox.pos.x - halfWidth, _aaBox.pos.y - halfHeight, _aaBox.pos.z - halfDepth );</span>
<a name="l01758"></a>01758 <span class="comment">        unsigned int vertexCount = polygon.GetVertexCount();</span>
<a name="l01759"></a>01759 <span class="comment">        for ( unsigned int i = 0; i &lt; vertexCount; ++i )</span>
<a name="l01760"></a>01760 <span class="comment">        {</span>
<a name="l01761"></a>01761 <span class="comment">                maxExts.x = Max( maxExts.x, polygon.GetVertex( i ).position.x );</span>
<a name="l01762"></a>01762 <span class="comment">                maxExts.y = Max( maxExts.y, polygon.GetVertex( i ).position.y );</span>
<a name="l01763"></a>01763 <span class="comment">                maxExts.z = Max( maxExts.z, polygon.GetVertex( i ).position.z );</span>
<a name="l01764"></a>01764 <span class="comment">                minExts.x = Min( minExts.x, polygon.GetVertex( i ).position.x );</span>
<a name="l01765"></a>01765 <span class="comment">                minExts.y = Min( minExts.y, polygon.GetVertex( i ).position.y );</span>
<a name="l01766"></a>01766 <span class="comment">                minExts.z = Min( minExts.z, polygon.GetVertex( i ).position.z );</span>
<a name="l01767"></a>01767 <span class="comment">        }</span>
<a name="l01768"></a>01768 <span class="comment"></span>
<a name="l01769"></a>01769 <span class="comment">        _aaBox.pos = 0.5f * maxExts + 0.5f * minExts;</span>
<a name="l01770"></a>01770 <span class="comment">        _aaBox.width = maxExts.x - minExts.x;</span>
<a name="l01771"></a>01771 <span class="comment">        _aaBox.height = maxExts.y - minExts.y;</span>
<a name="l01772"></a>01772 <span class="comment">        _aaBox.depth = maxExts.z - minExts.z;</span>
<a name="l01773"></a>01773 <span class="comment">}</span>
<a name="l01774"></a>01774 <span class="comment">*/</span>
<a name="l01775"></a>01775 <span class="comment">//----------------------------------------------------------</span>
<a name="l01776"></a>01776 <span class="keywordtype">int</span>
<a name="l01777"></a>01777 PolygonCmp( <span class="keyword">const</span> <a class="code" href="struct_s_simple_polygon.html">SSimplePolygon</a>* <a class="code" href="glext_8h.html#85b8f6c07fbc1fb5d77c2ae090f21995">left</a>, <span class="keyword">const</span> <a class="code" href="struct_s_simple_polygon.html">SSimplePolygon</a>* <a class="code" href="glext_8h.html#5ffadbbacc6b89cf6218bc43b384d3fe">right</a> )
<a name="l01778"></a>01778 {
<a name="l01780"></a>01780         <span class="keywordflow">if</span> ( left-&gt;<a class="code" href="struct_s_simple_polygon.html#615cc6a328ae01bf15c78afa713c3e10">texelHeight</a> &lt; right-&gt;<a class="code" href="struct_s_simple_polygon.html#615cc6a328ae01bf15c78afa713c3e10">texelHeight</a> )
<a name="l01781"></a>01781                 <span class="keywordflow">return</span> -1;
<a name="l01782"></a>01782         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( left-&gt;<a class="code" href="struct_s_simple_polygon.html#615cc6a328ae01bf15c78afa713c3e10">texelHeight</a> &gt; right-&gt;<a class="code" href="struct_s_simple_polygon.html#615cc6a328ae01bf15c78afa713c3e10">texelHeight</a> )
<a name="l01783"></a>01783                 <span class="keywordflow">return</span> 1;
<a name="l01784"></a>01784 
<a name="l01786"></a>01786         <span class="keywordflow">return</span> 0;
<a name="l01787"></a>01787 }
<a name="l01788"></a>01788 
<a name="l01789"></a>01789 <span class="comment">//----------------------------------------------------------</span>
<a name="l01790"></a>01790 <span class="keywordtype">bool</span>
<a name="l01791"></a>01791 PlaneSortCmp( <span class="keyword">const</span> std::pair&lt; float, MPlane &gt;&amp; left, <span class="keyword">const</span> std::pair&lt; float, MPlane &gt;&amp; right )
<a name="l01792"></a>01792 {
<a name="l01793"></a>01793         <span class="keyword">const</span> <span class="keywordtype">float</span> kClassArea = 300.0f;
<a name="l01794"></a>01794 
<a name="l01797"></a>01797 <span class="comment">//      int leftClass = ( int )Floor( left.first / kClassArea );</span>
<a name="l01798"></a>01798 <span class="comment">//      int rightClass = ( int )Floor( right.first / kClassArea );</span>
<a name="l01799"></a>01799 
<a name="l01801"></a>01801 <span class="comment">//      if ( leftClass == rightClass )</span>
<a name="l01802"></a>01802 <span class="comment">//              return left.first &gt; right.first;</span>
<a name="l01803"></a>01803 
<a name="l01805"></a>01805 <span class="comment">//      return leftClass &lt; rightClass;</span>
<a name="l01806"></a>01806         <span class="keywordflow">return</span> left.first &gt; right.first;
<a name="l01807"></a>01807 }
<a name="l01808"></a>01808 
<a name="l01809"></a>01809 <span class="comment">//----------------------------------------------------------</span>
<a name="l01810"></a>01810 <span class="keywordtype">unsigned</span> <a class="code" href="_u_t_x_8h.html#a254d9bac3ece6a9d99def539e8a80eb">__int64</a>
<a name="l01811"></a>01811 CalcEdgeHash( <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; v0, <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; v1 )
<a name="l01812"></a>01812 {
<a name="l01814"></a>01814         <a class="code" href="_u_t_x_8h.html#a254d9bac3ece6a9d99def539e8a80eb">__int64</a> hash = 0;
<a name="l01815"></a>01815         hash = <a class="code" href="common__afx_8cpp.html#112b1d49a048535f30ce9916f6c56c56">HashMem64</a>( ( <span class="keyword">const</span> <span class="keywordtype">char</span>* )&amp;v0, <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> ) );
<a name="l01816"></a>01816         hash = <a class="code" href="common__afx_8cpp.html#112b1d49a048535f30ce9916f6c56c56">HashMem64</a>( ( <span class="keyword">const</span> <span class="keywordtype">char</span>* )&amp;v1, <span class="keyword">sizeof</span>( <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a> ), hash );
<a name="l01817"></a>01817         <span class="keywordflow">return</span> hash;
<a name="l01818"></a>01818 }
<a name="l01819"></a>01819 
<a name="l01820"></a>01820 <span class="comment">//----------------------------------------------------------</span>
<a name="l01821"></a>01821 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01822"></a>01822 IsPositionEqual( <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; rhs )
<a name="l01823"></a>01823 {
<a name="l01824"></a>01824 <span class="preprocessor">#if USE_APPROX_COMPARE</span>
<a name="l01825"></a>01825 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ( <a class="code" href="_gr_polygon_group_8cpp.html#fbad844d782d7a357d2c20a479892e88">TO_FIXED_10</a>( lhs.<a class="code" href="struct_s_vec3.html#a30ab4ca24f2b7968f6b21a97c28a812">x</a> - rhs.<a class="code" href="struct_s_vec3.html#a30ab4ca24f2b7968f6b21a97c28a812">x</a> ) == 0 &amp;&amp;
<a name="l01826"></a>01826                          <a class="code" href="_gr_polygon_group_8cpp.html#fbad844d782d7a357d2c20a479892e88">TO_FIXED_10</a>( lhs.<a class="code" href="struct_s_vec3.html#9e4d6ddc68169c650b437a7d1714f299">y</a> - rhs.<a class="code" href="struct_s_vec3.html#9e4d6ddc68169c650b437a7d1714f299">y</a> ) == 0 &amp;&amp;
<a name="l01827"></a>01827                          <a class="code" href="_gr_polygon_group_8cpp.html#fbad844d782d7a357d2c20a479892e88">TO_FIXED_10</a>( lhs.<a class="code" href="struct_s_vec3.html#d9d349dd9369afd5bd7d056e59b3ae4a">z</a> - rhs.<a class="code" href="struct_s_vec3.html#d9d349dd9369afd5bd7d056e59b3ae4a">z</a> ) == 0 );
<a name="l01828"></a>01828 <span class="preprocessor">#else</span>
<a name="l01829"></a>01829 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ( lhs == rhs );
<a name="l01830"></a>01830 <span class="preprocessor">#endif</span>
<a name="l01831"></a>01831 <span class="preprocessor"></span>}
<a name="l01832"></a>01832 
<a name="l01833"></a>01833 <span class="comment">//----------------------------------------------------------</span>
<a name="l01834"></a>01834 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01835"></a>01835 IsNormalEqual( <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; rhs )
<a name="l01836"></a>01836 {
<a name="l01837"></a>01837 <span class="preprocessor">#if USE_APPROX_COMPARE</span>
<a name="l01838"></a>01838 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ( <a class="code" href="_gr_polygon_group_8cpp.html#4ddf448d15b8e574ccc0229822b8469a">TO_FIXED_8</a>( lhs.<a class="code" href="struct_s_vec3.html#a30ab4ca24f2b7968f6b21a97c28a812">x</a> - rhs.<a class="code" href="struct_s_vec3.html#a30ab4ca24f2b7968f6b21a97c28a812">x</a> ) == 0 &amp;&amp;
<a name="l01839"></a>01839                          <a class="code" href="_gr_polygon_group_8cpp.html#4ddf448d15b8e574ccc0229822b8469a">TO_FIXED_8</a>( lhs.<a class="code" href="struct_s_vec3.html#9e4d6ddc68169c650b437a7d1714f299">y</a> - rhs.<a class="code" href="struct_s_vec3.html#9e4d6ddc68169c650b437a7d1714f299">y</a> ) == 0 &amp;&amp;
<a name="l01840"></a>01840                          <a class="code" href="_gr_polygon_group_8cpp.html#4ddf448d15b8e574ccc0229822b8469a">TO_FIXED_8</a>( lhs.<a class="code" href="struct_s_vec3.html#d9d349dd9369afd5bd7d056e59b3ae4a">z</a> - rhs.<a class="code" href="struct_s_vec3.html#d9d349dd9369afd5bd7d056e59b3ae4a">z</a> ) == 0 );
<a name="l01841"></a>01841 <span class="preprocessor">#else</span>
<a name="l01842"></a>01842 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ( lhs == rhs );
<a name="l01843"></a>01843 <span class="preprocessor">#endif  </span>
<a name="l01844"></a>01844 <span class="preprocessor"></span>}
<a name="l01845"></a>01845 
<a name="l01846"></a>01846 <span class="comment">//----------------------------------------------------------</span>
<a name="l01847"></a>01847 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01848"></a>01848 IsTangentEqual( <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="struct_s_vec3.html" title="struct SVec3">SVec3</a>&amp; rhs )
<a name="l01849"></a>01849 {
<a name="l01850"></a>01850 <span class="preprocessor">#if USE_APPROX_COMPARE</span>
<a name="l01851"></a>01851 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ( <a class="code" href="_gr_polygon_group_8cpp.html#4ddf448d15b8e574ccc0229822b8469a">TO_FIXED_8</a>( lhs.<a class="code" href="struct_s_vec3.html#a30ab4ca24f2b7968f6b21a97c28a812">x</a> - rhs.<a class="code" href="struct_s_vec3.html#a30ab4ca24f2b7968f6b21a97c28a812">x</a> ) == 0 &amp;&amp;
<a name="l01852"></a>01852                          <a class="code" href="_gr_polygon_group_8cpp.html#4ddf448d15b8e574ccc0229822b8469a">TO_FIXED_8</a>( lhs.<a class="code" href="struct_s_vec3.html#9e4d6ddc68169c650b437a7d1714f299">y</a> - rhs.<a class="code" href="struct_s_vec3.html#9e4d6ddc68169c650b437a7d1714f299">y</a> ) == 0 &amp;&amp;
<a name="l01853"></a>01853                          <a class="code" href="_gr_polygon_group_8cpp.html#4ddf448d15b8e574ccc0229822b8469a">TO_FIXED_8</a>( lhs.<a class="code" href="struct_s_vec3.html#d9d349dd9369afd5bd7d056e59b3ae4a">z</a> - rhs.<a class="code" href="struct_s_vec3.html#d9d349dd9369afd5bd7d056e59b3ae4a">z</a> ) == 0 );
<a name="l01854"></a>01854 <span class="preprocessor">#else</span>
<a name="l01855"></a>01855 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ( lhs == rhs );
<a name="l01856"></a>01856 <span class="preprocessor">#endif  </span>
<a name="l01857"></a>01857 <span class="preprocessor"></span>}
<a name="l01858"></a>01858 
<a name="l01859"></a>01859 <span class="comment">//----------------------------------------------------------</span>
<a name="l01860"></a>01860 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01861"></a>01861 IsUVEqual( <span class="keyword">const</span> <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="struct_s_vec2.html" title="Purpose: Contains mesh data.">SVec2</a>&amp; rhs )
<a name="l01862"></a>01862 {
<a name="l01863"></a>01863 <span class="preprocessor">#if USE_APPROX_COMPARE</span>
<a name="l01864"></a>01864 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ( <a class="code" href="_gr_polygon_group_8cpp.html#e680c9539eb76f05dd8330b6e65897eb">TO_FIXED_18</a>( lhs.<a class="code" href="struct_s_vec2.html#328ec1b6dafebcc1eb6bf84f790f39b7">x</a> - rhs.<a class="code" href="struct_s_vec2.html#328ec1b6dafebcc1eb6bf84f790f39b7">x</a> ) == 0 &amp;&amp;
<a name="l01865"></a>01865                          <a class="code" href="_gr_polygon_group_8cpp.html#e680c9539eb76f05dd8330b6e65897eb">TO_FIXED_18</a>( lhs.<a class="code" href="struct_s_vec2.html#47cf4560950d17311222a547a98c4fde">y</a> - rhs.<a class="code" href="struct_s_vec2.html#47cf4560950d17311222a547a98c4fde">y</a> ) == 0 );
<a name="l01866"></a>01866 <span class="preprocessor">#else</span>
<a name="l01867"></a>01867 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ( lhs == rhs );
<a name="l01868"></a>01868 <span class="preprocessor">#endif</span>
<a name="l01869"></a>01869 <span class="preprocessor"></span>}
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Feb 13 17:19:57 2009 for Bootstrap Engine by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
