<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Bootstrap Engine: C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrModelNode.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>C:/Bootstrap/ProjectBX/Documentation/Code/Engine/Graphics/GrModelNode.cpp</h1><a href="_gr_model_node_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//----------------------------------------------------------</span>
<a name="l00006"></a>00006 <span class="comment"></span><span class="comment">//----------------------------------------------------------</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="graphics__afx_8h.html">graphics_afx.h</a>"</span>
<a name="l00008"></a>00008 
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="_gr_model_node_8h.html">GrModelNode.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="_gr_model_8h.html">GrModel.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="_gr_mesh_inst_8h.html">GrMeshInst.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="_gr_polygon_node_8h.html">GrPolygonNode.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="_gr_polygon_mesh_8h.html">GrPolygonMesh.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="_u_writer_8h.html">UWriter.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="_u_reader_8h.html">UReader.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="_gr_frustum_8h.html">GrFrustum.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "<a class="code" href="_m_sphere_8h.html">MSphere.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="_gr_scene_8h.html">GrScene.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="_gr_light_8h.html">GrLight.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "<a class="code" href="_gr_light_mgr_8h.html">GrLightMgr.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="_gr_render_list_8h.html">GrRenderList.h</a>"</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="comment">//**********************************************************</span>
<a name="l00029"></a>00029 <span class="comment"></span><span class="comment">//**********************************************************</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">//==========================================================</span>
<a name="l00033"></a>00033 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="comment">//----------------------------------------------------------</span>
<a name="l00036"></a><a class="code" href="class_gr_model_node.html#30cd7578448ddbb5b07276de2d96cfed">00036</a> <a class="code" href="class_gr_model_node.html#30cd7578448ddbb5b07276de2d96cfed" title="class header.">GrModelNode::GrModelNode</a>( <a class="code" href="class_gr_model.html" title="class GrModel">GrModel</a>* owner, <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>* parent, <span class="keyword">const</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>&amp; local, <a class="code" href="class_gr_mesh_inst.html" title="class GrMeshInst">GrMeshInst</a>* meshInst )
<a name="l00037"></a>00037 : _owner( owner )
<a name="l00038"></a>00038 , _parent( parent )
<a name="l00039"></a>00039 , _local( local )
<a name="l00040"></a>00040 {
<a name="l00041"></a>00041         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( owner != 0 );
<a name="l00042"></a>00042 }
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="comment">//----------------------------------------------------------</span>
<a name="l00045"></a><a class="code" href="class_gr_model_node.html#b63d4ab8c48384da1c14bc5032fde28d">00045</a> <a class="code" href="class_gr_model_node.html#30cd7578448ddbb5b07276de2d96cfed" title="class header.">GrModelNode::GrModelNode</a>( <a class="code" href="class_gr_model.html" title="class GrModel">GrModel</a>* owner, <a class="code" href="class_gr_polygon_node.html" title="class GrPolygonNode">GrPolygonNode</a>* fromTree )
<a name="l00046"></a>00046 : _owner( owner )
<a name="l00047"></a>00047 , _parent( 0 )
<a name="l00048"></a>00048 {
<a name="l00049"></a>00049         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( owner != 0 );
<a name="l00050"></a>00050 
<a name="l00052"></a>00052         <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray&lt; URef&lt; GrPolygonMesh &gt;</a> &gt; polyMeshes;
<a name="l00053"></a>00053         fromTree-&gt;<a class="code" href="class_gr_polygon_node.html#3391bb965d15d459bbc12888f7ced8b6">BuildMeshList</a>( polyMeshes );
<a name="l00054"></a>00054 
<a name="l00056"></a>00056         std::map&lt; tstring, std::vector&lt; GrMeshInst* &gt; &gt; meshes;
<a name="l00057"></a>00057         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; polyMeshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00058"></a>00058         {
<a name="l00060"></a>00060                 <a class="code" href="class_u_ref.html">URef&lt; GrPolygonMesh &gt;</a> curPolyMesh = polyMeshes[ i ];
<a name="l00061"></a>00061 
<a name="l00063"></a>00063                 <span class="keywordflow">if</span> ( meshes.find( curPolyMesh-&gt;GetName() ) != meshes.end() )
<a name="l00064"></a>00064                         <span class="keywordflow">continue</span>;
<a name="l00065"></a>00065 
<a name="l00067"></a>00067                 std::vector&lt; GrMeshInst* &gt;&amp; meshVec = meshes[ curPolyMesh-&gt;GetName() ];
<a name="l00068"></a>00068                 curPolyMesh-&gt;GenMeshes( meshVec );
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070 
<a name="l00072"></a>00072         InitFromPolyNode( owner, fromTree, meshes );
<a name="l00073"></a>00073 
<a name="l00075"></a>00075         std::map&lt; tstring, std::vector&lt; GrMeshInst* &gt; &gt;::iterator iter = meshes.begin();
<a name="l00076"></a>00076         <span class="keywordflow">for</span> ( ; iter != meshes.end(); ++iter )
<a name="l00077"></a>00077         {
<a name="l00078"></a>00078                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; iter-&gt;second.size(); ++i )
<a name="l00079"></a>00079                         <span class="keyword">delete</span> iter-&gt;second[ i ];
<a name="l00080"></a>00080         }
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="comment">//----------------------------------------------------------</span>
<a name="l00084"></a>00084 <a class="code" href="class_gr_model_node.html#30cd7578448ddbb5b07276de2d96cfed" title="class header.">GrModelNode::GrModelNode</a>( <a class="code" href="class_gr_model.html" title="class GrModel">GrModel</a>* owner, <a class="code" href="class_gr_polygon_node.html" title="class GrPolygonNode">GrPolygonNode</a>* fromTree, <span class="keyword">const</span> std::map&lt; <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>, std::vector&lt; GrMeshInst* &gt; &gt;&amp; meshes )
<a name="l00085"></a>00085 : _owner( owner )
<a name="l00086"></a>00086 , _parent( 0 )
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088         InitFromPolyNode( owner, fromTree, meshes );
<a name="l00089"></a>00089 }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="comment">//----------------------------------------------------------</span>
<a name="l00092"></a><a class="code" href="class_gr_model_node.html#391064a9dadfae2e8e0022a1f7009602">00092</a> <a class="code" href="class_gr_model_node.html#30cd7578448ddbb5b07276de2d96cfed" title="class header.">GrModelNode::GrModelNode</a>( <a class="code" href="class_gr_model.html" title="class GrModel">GrModel</a>* owner, <a class="code" href="class_u_reader.html" title="Purpose: To wrap and simplify pointer read operations.">UReader</a>&amp; reader, <span class="keyword">const</span> <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray</a>&lt; <a class="code" href="class_u_ref.html">URef&lt; GrMesh &gt;</a> &gt;&amp; meshes,
<a name="l00093"></a>00093                                                   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> majorVer, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> minorVer )
<a name="l00094"></a>00094 : _owner( owner )
<a name="l00095"></a>00095 , _parent( 0 )
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097         Load( owner, reader, meshes, majorVer, minorVer );
<a name="l00098"></a>00098 }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="comment">//----------------------------------------------------------</span>
<a name="l00101"></a><a class="code" href="class_gr_model_node.html#2dfd62bcdf39b2c3004c762d865ffb0d">00101</a> <a class="code" href="class_gr_model_node.html#2dfd62bcdf39b2c3004c762d865ffb0d">GrModelNode::~GrModelNode</a>()
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> childCount = _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>();
<a name="l00104"></a>00104         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; childCount; ++i )
<a name="l00105"></a>00105                 <span class="keyword">delete</span> _children[ i ];
<a name="l00106"></a>00106 
<a name="l00107"></a>00107         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> meshCount = _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>();
<a name="l00108"></a>00108         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; meshCount; ++i )
<a name="l00109"></a>00109                 <span class="keyword">delete</span> _meshes[ i ];
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <span class="comment">//==========================================================</span>
<a name="l00115"></a>00115 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="comment">//----------------------------------------------------------</span>
<a name="l00118"></a>00118 <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>*
<a name="l00119"></a><a class="code" href="class_gr_model_node.html#6bcd4b9a2763671b7bd20a5556aa1a22">00119</a> <a class="code" href="class_gr_model_node.html#6bcd4b9a2763671b7bd20a5556aa1a22" title="clones a node hierarchy.">GrModelNode::Clone</a>( <a class="code" href="class_gr_model.html" title="class GrModel">GrModel</a>* newOwner, <span class="keywordtype">bool</span> deep, <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>* parent )
<a name="l00120"></a>00120 {
<a name="l00122"></a>00122         <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>* newNode = <span class="keyword">new</span> <a class="code" href="class_gr_model_node.html#30cd7578448ddbb5b07276de2d96cfed" title="class header.">GrModelNode</a>( newOwner, parent, _local );
<a name="l00123"></a>00123         newNode-&gt;<a class="code" href="class_gr_model_node.html#2bf968cb52411d1da1e383d55884ef5c">_name</a> = _name;
<a name="l00124"></a>00124 
<a name="l00126"></a>00126         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00127"></a>00127                 newNode-&gt;<a class="code" href="class_gr_model_node.html#22bb76963b927e129889b1b985068068">_meshes</a>.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( _meshes[ i ]-&gt;Clone( deep ) );
<a name="l00128"></a>00128 
<a name="l00130"></a>00130         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00131"></a>00131                 newNode-&gt;<a class="code" href="class_gr_model_node.html#393bc1ce3bb53b5e9cbdd2903336c747">_children</a>.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( _children[ i ]-&gt;Clone( newOwner, deep, newNode ) );
<a name="l00132"></a>00132 
<a name="l00134"></a>00134         <span class="keywordflow">return</span> newNode;
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="comment">//----------------------------------------------------------</span>
<a name="l00138"></a>00138 <span class="keywordtype">void</span>
<a name="l00139"></a><a class="code" href="class_gr_model_node.html#1de0741bd0fbf78cb7ef6802948b6080">00139</a> <a class="code" href="class_gr_model_node.html#1de0741bd0fbf78cb7ef6802948b6080" title="transform management.">GrModelNode::SetLocal</a>( <span class="keyword">const</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>&amp; local )
<a name="l00140"></a>00140 {
<a name="l00142"></a>00142         _owner-&gt;<a class="code" href="class_gr_model.html#b29ae276eab8a6460d09a0f727765c40" title="forces transforms/bounds to be updated. Internal use only.">MarkAsDirty</a>();
<a name="l00143"></a>00143         _local = local;
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <span class="comment">//----------------------------------------------------------</span>
<a name="l00147"></a>00147 <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>*
<a name="l00148"></a><a class="code" href="class_gr_model_node.html#5b6cf7fff3778f0c4411823132cb5c28">00148</a> <a class="code" href="class_gr_model_node.html#5b6cf7fff3778f0c4411823132cb5c28">GrModelNode::GetChild</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx )
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( idx &lt; _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() );
<a name="l00151"></a>00151         <span class="keywordflow">return</span> _children[ idx ];
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="comment">//----------------------------------------------------------</span>
<a name="l00155"></a>00155 <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>*
<a name="l00156"></a><a class="code" href="class_gr_model_node.html#ea35f9469b11a8a8033f8ad1c7a54c24">00156</a> <a class="code" href="class_gr_model_node.html#ea35f9469b11a8a8033f8ad1c7a54c24">GrModelNode::FindNode</a>( <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="glext_8h.html#f7477b8725fcf509c9623f64b9d09164">name</a>, <span class="keywordtype">bool</span> ignoreCase )
<a name="l00157"></a>00157 {
<a name="l00158"></a>00158         <span class="keywordflow">if</span> ( ignoreCase )
<a name="l00159"></a>00159         {
<a name="l00160"></a>00160                 <span class="keywordflow">if</span> ( _stricmp( _name.c_str(), name ) == 0 )
<a name="l00161"></a>00161                         <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163         <span class="keywordflow">else</span>
<a name="l00164"></a>00164         {
<a name="l00165"></a>00165                 <span class="keywordflow">if</span> ( strcmp( _name.c_str(), name ) == 0 )
<a name="l00166"></a>00166                         <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00167"></a>00167         }
<a name="l00168"></a>00168 
<a name="l00170"></a>00170         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00171"></a>00171         {
<a name="l00172"></a>00172                 <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>* found = _children[ i ]-&gt;FindNode( name, ignoreCase );
<a name="l00173"></a>00173                 <span class="keywordflow">if</span> ( found )
<a name="l00174"></a>00174                         <span class="keywordflow">return</span> found;
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176 
<a name="l00178"></a>00178         <span class="keywordflow">return</span> 0;
<a name="l00179"></a>00179 }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="comment">//----------------------------------------------------------</span>
<a name="l00182"></a>00182 <a class="code" href="class_gr_mesh_inst.html" title="class GrMeshInst">GrMeshInst</a>*
<a name="l00183"></a><a class="code" href="class_gr_model_node.html#f5340d3bc303ba7f9211f89e791b013d">00183</a> <a class="code" href="class_gr_model_node.html#f5340d3bc303ba7f9211f89e791b013d">GrModelNode::GetMeshInst</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx )<span class="keyword"> const</span>
<a name="l00184"></a>00184 <span class="keyword"></span>{
<a name="l00185"></a>00185         <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( idx &lt; <a class="code" href="class_gr_model_node.html#34fb55f7a4af15a5d6f241117f62012f" title="mesh instance management.">GetMeshInstCount</a>() );
<a name="l00186"></a>00186         <span class="keywordflow">return</span> _meshes[ idx ];
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 <span class="comment">//----------------------------------------------------------</span>
<a name="l00190"></a>00190 <span class="keywordtype">void</span>
<a name="l00191"></a><a class="code" href="class_gr_model_node.html#c5c58f7cd659b01c66e0f45054cd6200">00191</a> <a class="code" href="class_gr_model_node.html#c5c58f7cd659b01c66e0f45054cd6200" title="updates the transform.">GrModelNode::Update</a>( <span class="keyword">const</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>&amp; parentMatrix )
<a name="l00192"></a>00192 {
<a name="l00194"></a>00194         _world = parentMatrix * _local;
<a name="l00195"></a>00195 
<a name="l00197"></a>00197         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> meshCount = _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>();
<a name="l00198"></a>00198         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; meshCount; ++i )
<a name="l00199"></a>00199                 _meshes[ i ]-&gt;SetTransform( _world );
<a name="l00200"></a>00200 
<a name="l00202"></a>00202         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00203"></a>00203                 _children[ i ]-&gt;<a class="code" href="class_gr_model_node.html#c5c58f7cd659b01c66e0f45054cd6200" title="updates the transform.">Update</a>( _world );
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="comment">//----------------------------------------------------------</span>
<a name="l00207"></a>00207 <span class="keywordtype">void</span>
<a name="l00208"></a><a class="code" href="class_gr_model_node.html#91040763448f20348673c730e8e6fbf8">00208</a> <a class="code" href="class_gr_model_node.html#91040763448f20348673c730e8e6fbf8" title="calculates an AABB from geometry that includes the origin.">GrModelNode::CalcBounds</a>( <a class="code" href="class_m_a_a_box.html" title="class MAABox">MAABox</a>&amp; bounds )
<a name="l00209"></a>00209 {
<a name="l00211"></a>00211         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> childCount = _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>();
<a name="l00212"></a>00212         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; childCount; ++i )
<a name="l00213"></a>00213                 _children[ i ]-&gt;<a class="code" href="class_gr_model_node.html#91040763448f20348673c730e8e6fbf8" title="calculates an AABB from geometry that includes the origin.">CalcBounds</a>( bounds );
<a name="l00214"></a>00214 
<a name="l00216"></a>00216         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> meshCount = _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>();
<a name="l00217"></a>00217         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; meshCount; ++i )
<a name="l00218"></a>00218                 bounds.<a class="code" href="class_m_a_a_box.html#7da828ab9a51859fb07aedfce50967f0" title="expands the axis-aligned box by the box passed in.">AddBoxToVolume</a>( _meshes[ i ]-&gt;GetOBox() );
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="comment">//----------------------------------------------------------</span>
<a name="l00222"></a>00222 <span class="keywordtype">bool</span>
<a name="l00223"></a><a class="code" href="class_gr_model_node.html#3bc9a825d5c12c5f8484a869e992ac0f">00223</a> <a class="code" href="class_gr_model_node.html#3bc9a825d5c12c5f8484a869e992ac0f" title="calculates the optimal AABB from geometry.">GrModelNode::CalcBoundsExact</a>( <a class="code" href="class_m_a_a_box.html" title="class MAABox">MAABox</a>&amp; bounds, <span class="keywordtype">bool</span> boundsInit )
<a name="l00224"></a>00224 {
<a name="l00226"></a>00226         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> childCount = _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>();
<a name="l00227"></a>00227         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; childCount; ++i )
<a name="l00228"></a>00228                 boundsInit = _children[ i ]-&gt;<a class="code" href="class_gr_model_node.html#3bc9a825d5c12c5f8484a869e992ac0f" title="calculates the optimal AABB from geometry.">CalcBoundsExact</a>( bounds, boundsInit );
<a name="l00229"></a>00229 
<a name="l00231"></a>00231         <span class="keywordflow">if</span> ( boundsInit )
<a name="l00232"></a>00232         {
<a name="l00233"></a>00233                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> meshCount = _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>();
<a name="l00234"></a>00234                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; meshCount; ++i )
<a name="l00235"></a>00235                         bounds.<a class="code" href="class_m_a_a_box.html#7da828ab9a51859fb07aedfce50967f0" title="expands the axis-aligned box by the box passed in.">AddBoxToVolume</a>( _meshes[ i ]-&gt;GetOBox() );
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237         <span class="keywordflow">else</span>
<a name="l00238"></a>00238         {
<a name="l00239"></a>00239                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> meshCount = _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>();
<a name="l00240"></a>00240                 <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; meshCount; ++i )
<a name="l00241"></a>00241                 {
<a name="l00242"></a>00242                         <span class="keywordflow">if</span> ( !boundsInit )
<a name="l00243"></a>00243                         {
<a name="l00244"></a>00244                                 bounds = <a class="code" href="class_m_a_a_box.html" title="class MAABox">MAABox</a>( _meshes[ i ]-&gt;GetOBox() );
<a name="l00245"></a>00245                                 boundsInit = <span class="keyword">true</span>;
<a name="l00246"></a>00246                         }
<a name="l00247"></a>00247                         <span class="keywordflow">else</span>
<a name="l00248"></a>00248                                 bounds.<a class="code" href="class_m_a_a_box.html#7da828ab9a51859fb07aedfce50967f0" title="expands the axis-aligned box by the box passed in.">AddBoxToVolume</a>( _meshes[ i ]-&gt;GetOBox() );
<a name="l00249"></a>00249                 }
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         <span class="keywordflow">return</span> boundsInit;
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="comment">//----------------------------------------------------------</span>
<a name="l00256"></a>00256 <span class="keyword">const</span>
<a name="l00257"></a>00257 <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>&amp;
<a name="l00258"></a><a class="code" href="class_gr_model_node.html#2799107e185b3fb30a4429b1bb0cf1f9">00258</a> <a class="code" href="class_gr_model_node.html#2799107e185b3fb30a4429b1bb0cf1f9">GrModelNode::GetWorld</a>()<span class="keyword"> const</span>
<a name="l00259"></a>00259 <span class="keyword"></span>{
<a name="l00260"></a>00260         <span class="keywordflow">return</span> _world;
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 <span class="comment">//----------------------------------------------------------</span>
<a name="l00264"></a>00264 <span class="keywordtype">void</span>
<a name="l00265"></a><a class="code" href="class_gr_model_node.html#65acb56567cf1c21de6124a9e3ef0b71">00265</a> <a class="code" href="class_gr_model_node.html#65acb56567cf1c21de6124a9e3ef0b71">GrModelNode::SetWorld</a>( <span class="keyword">const</span> <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a>&amp; <a class="code" href="glext_8h.html#07993c0d92c1aeeb357ba0495c8b5325">transform</a> )
<a name="l00266"></a>00266 {
<a name="l00268"></a>00268     _owner-&gt;<a class="code" href="class_gr_model.html#12002759a1e3c55bf2ec71d21f197a0d">EnsureUpdated</a>();
<a name="l00269"></a>00269 
<a name="l00271"></a>00271     <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a> parentWorld;
<a name="l00272"></a>00272     <span class="keywordflow">if</span> ( _parent )
<a name="l00273"></a>00273         parentWorld = _parent-&gt;<a class="code" href="class_gr_model_node.html#2799107e185b3fb30a4429b1bb0cf1f9">GetWorld</a>();
<a name="l00274"></a>00274     <span class="keywordflow">else</span> 
<a name="l00275"></a>00275         parentWorld = _owner-&gt;<a class="code" href="class_gr_model.html#624ce6372c1bdd5a077e51c16adb9242">GetWorld</a>();
<a name="l00276"></a>00276 
<a name="l00278"></a>00278     <a class="code" href="class_m_mat4x4.html" title="class MMat4x4">MMat4x4</a> parentWorldInv;
<a name="l00279"></a>00279     <span class="keywordtype">bool</span> success = parentWorld.<a class="code" href="class_m_mat4x4.html#5045e1a3e2dda8f62a8c3cba29b721db">Inverse</a>( parentWorldInv );
<a name="l00280"></a>00280     <a class="code" href="common__afx_8h.html#2630490ce4292ed6d05359d2957796b8">B_ASSERT</a>( success );
<a name="l00281"></a>00281     <span class="keywordflow">if</span> ( success )
<a name="l00282"></a>00282     {
<a name="l00285"></a>00285         _local = parentWorldInv * transform;
<a name="l00286"></a>00286         _world = transform;
<a name="l00287"></a>00287 
<a name="l00289"></a>00289         _owner-&gt;<a class="code" href="class_gr_model.html#b29ae276eab8a6460d09a0f727765c40" title="forces transforms/bounds to be updated. Internal use only.">MarkAsDirty</a>();
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291 }       
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="comment">//----------------------------------------------------------</span>
<a name="l00294"></a>00294 <span class="keywordtype">void</span>
<a name="l00295"></a><a class="code" href="class_gr_model_node.html#2c131ad23d4aa9b499340a803690e3d0">00295</a> <a class="code" href="class_gr_model_node.html#2c131ad23d4aa9b499340a803690e3d0" title="builds a list of all unique meshes in the hierarchy.">GrModelNode::BuildMeshList</a>( <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray</a>&lt; <a class="code" href="class_u_ref.html">URef&lt; GrMesh &gt;</a> &gt;&amp; meshes )
<a name="l00296"></a>00296 {
<a name="l00298"></a>00298         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00299"></a>00299         {
<a name="l00300"></a>00300                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0;
<a name="l00301"></a>00301                 <span class="keywordflow">for</span> ( ; j &lt; meshes.GetElemCount(); ++j )
<a name="l00302"></a>00302                 {
<a name="l00303"></a>00303                         <span class="keywordflow">if</span> ( _meshes[ i ]-&gt;GetMesh() == meshes[ j ] )
<a name="l00304"></a>00304                                 <span class="keywordflow">break</span>;
<a name="l00305"></a>00305                 }
<a name="l00306"></a>00306                 <span class="keywordflow">if</span> ( j == meshes.GetElemCount() )
<a name="l00307"></a>00307                 {
<a name="l00308"></a>00308                         meshes.Push( _meshes[ i ]-&gt;GetMesh() );
<a name="l00309"></a>00309                 }
<a name="l00310"></a>00310         }
<a name="l00311"></a>00311 
<a name="l00313"></a>00313         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00314"></a>00314                 _children[ i ]-&gt;<a class="code" href="class_gr_model_node.html#2c131ad23d4aa9b499340a803690e3d0" title="builds a list of all unique meshes in the hierarchy.">BuildMeshList</a>( meshes );
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 <span class="comment">//----------------------------------------------------------</span>
<a name="l00318"></a>00318 <span class="keywordtype">void</span>
<a name="l00319"></a><a class="code" href="class_gr_model_node.html#6dd727604b84d6463b1ba282d0702b4a">00319</a> <a class="code" href="class_gr_model_node.html#6dd727604b84d6463b1ba282d0702b4a" title="optimize meshes on this node.">GrModelNode::Optimize</a>()
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00322"></a>00322                 _meshes[ i ]-&gt;GetMesh()-&gt;Optimize();
<a name="l00323"></a>00323 }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 <span class="comment">//----------------------------------------------------------</span>
<a name="l00326"></a>00326 <span class="keywordtype">void</span>
<a name="l00327"></a><a class="code" href="class_gr_model_node.html#8dfebc45736fa221d3988d7bc05f71bf">00327</a> <a class="code" href="class_gr_model_node.html#8dfebc45736fa221d3988d7bc05f71bf" title="caches or evicts child nodes.">GrModelNode::Cache</a>()
<a name="l00328"></a>00328 {
<a name="l00329"></a>00329         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00330"></a>00330                 _meshes[ i ]-&gt;<a class="code" href="class_gr_model_node.html#8dfebc45736fa221d3988d7bc05f71bf" title="caches or evicts child nodes.">Cache</a>();
<a name="l00331"></a>00331 
<a name="l00332"></a>00332         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00333"></a>00333                 _children[ i ]-&gt;<a class="code" href="class_gr_model_node.html#8dfebc45736fa221d3988d7bc05f71bf" title="caches or evicts child nodes.">Cache</a>();
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 <span class="comment">//----------------------------------------------------------</span>
<a name="l00337"></a>00337 <span class="keywordtype">void</span>
<a name="l00338"></a><a class="code" href="class_gr_model_node.html#598ada3ae0f7b3028d0b9f3cff6c1edd">00338</a> <a class="code" href="class_gr_model_node.html#598ada3ae0f7b3028d0b9f3cff6c1edd">GrModelNode::Evict</a>()
<a name="l00339"></a>00339 {
<a name="l00340"></a>00340         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00341"></a>00341                 _meshes[ i ]-&gt;<a class="code" href="class_gr_model_node.html#598ada3ae0f7b3028d0b9f3cff6c1edd">Evict</a>();
<a name="l00342"></a>00342 
<a name="l00343"></a>00343         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00344"></a>00344                 _children[ i ]-&gt;<a class="code" href="class_gr_model_node.html#598ada3ae0f7b3028d0b9f3cff6c1edd">Evict</a>();
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <span class="comment">//----------------------------------------------------------</span>
<a name="l00348"></a>00348 <span class="keywordtype">void</span>
<a name="l00349"></a><a class="code" href="class_gr_model_node.html#5232522d893c1b123115f95a6e1b1a7a">00349</a> <a class="code" href="class_gr_model_node.html#5232522d893c1b123115f95a6e1b1a7a" title="load and save the node tree.">GrModelNode::Save</a>( <a class="code" href="class_u_writer.html" title="Purpose: To wrap and simplify pointer write operations.">UWriter</a>&amp; writer )<span class="keyword"> const</span>
<a name="l00350"></a>00350 <span class="keyword"></span>{
<a name="l00352"></a>00352         writer.<a class="code" href="class_u_writer.html#bbe55ee0c4a3b202b365da202899d410" title="public methods">WriteString</a>( _name );
<a name="l00353"></a>00353 
<a name="l00355"></a>00355         _local.<a class="code" href="class_m_mat4x4.html#51096a071af230f20fe4d5a94db23913" title="saving and loading.">Save</a>( writer );
<a name="l00356"></a>00356 
<a name="l00358"></a>00358 <span class="comment">//      writer.WriteString( _light ? _light-&gt;GetId().GetPathString() : "" );</span>
<a name="l00359"></a>00359 
<a name="l00361"></a>00361         writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() );
<a name="l00362"></a>00362         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00363"></a>00363         {
<a name="l00364"></a>00364                 _meshes[ i ]-&gt;Save( writer );
<a name="l00365"></a>00365         }
<a name="l00366"></a>00366 
<a name="l00368"></a>00368         writer.<a class="code" href="class_u_writer.html#2012d798142a97cacf03227395c2e24c">WriteInt</a>( _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>() );
<a name="l00369"></a>00369         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00370"></a>00370         {
<a name="l00371"></a>00371                 _children[ i ]-&gt;Save( writer );
<a name="l00372"></a>00372         }
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 <span class="comment">//----------------------------------------------------------</span>
<a name="l00376"></a>00376 <span class="keywordtype">void</span>
<a name="l00377"></a><a class="code" href="class_gr_model_node.html#ad9c0636157e8cad390826cf91e16780">00377</a> <a class="code" href="class_gr_model_node.html#ad9c0636157e8cad390826cf91e16780" title="send to the renderer.">GrModelNode::GetRenderableObjects</a>( <a class="code" href="class_gr_render_list.html" title="class GrRenderList">GrRenderList</a>&amp; lightReceivers, <a class="code" href="class_gr_render_list.html" title="class GrRenderList">GrRenderList</a>* shadowCasters )<span class="keyword"> const</span>
<a name="l00378"></a>00378 <span class="keyword"></span>{
<a name="l00379"></a>00379         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _meshes.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00380"></a>00380         {
<a name="l00381"></a>00381                 lightReceivers.<a class="code" href="class_gr_render_list.html#2092d2e20fd57bb03c5090684201530c">AddMeshInst</a>( _meshes[ i ], <span class="keyword">false</span> );
<a name="l00382"></a>00382                 <span class="keywordflow">if</span> ( shadowCasters )
<a name="l00383"></a>00383                         shadowCasters-&gt;<a class="code" href="class_gr_render_list.html#2092d2e20fd57bb03c5090684201530c">AddMeshInst</a>( _meshes[ i ], <span class="keyword">false</span> );
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385 
<a name="l00387"></a>00387         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _children.<a class="code" href="class_u_fast_array.html#0f656de7d6eb46b1a090bd3b1c26cb35">GetElemCount</a>(); ++i )
<a name="l00388"></a>00388                 _children[ i ]-&gt;<a class="code" href="class_gr_model_node.html#ad9c0636157e8cad390826cf91e16780" title="send to the renderer.">GetRenderableObjects</a>( lightReceivers, shadowCasters );
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 <span class="comment">//==========================================================</span>
<a name="l00394"></a>00394 <span class="comment"></span><span class="comment">//==========================================================</span>
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 <span class="comment">//----------------------------------------------------------</span>
<a name="l00397"></a>00397 <span class="keywordtype">void</span>
<a name="l00398"></a>00398 GrModelNode::InitFromPolyNode( <a class="code" href="class_gr_model.html" title="class GrModel">GrModel</a>* owner, <a class="code" href="class_gr_polygon_node.html" title="class GrPolygonNode">GrPolygonNode</a>* fromTree,
<a name="l00399"></a>00399                                                            <span class="keyword">const</span> std::map&lt; <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>, std::vector&lt; GrMeshInst* &gt; &gt;&amp; meshes )
<a name="l00400"></a>00400 {
<a name="l00402"></a>00402         _name = fromTree-&gt;<a class="code" href="class_gr_polygon_node.html#716df79755b048ff14d3c1ee293f068e">GetName</a>();
<a name="l00403"></a>00403 
<a name="l00405"></a>00405         _local = fromTree-&gt;<a class="code" href="class_gr_polygon_node.html#8d035d5aba6b792c1a43823902922169">GetLocal</a>();
<a name="l00406"></a>00406 
<a name="l00408"></a>00408         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> meshCount = fromTree-&gt;<a class="code" href="class_gr_polygon_node.html#410f7e5c06508726df3f19bfe2754473" title="polygon group management.">GetMeshCount</a>();
<a name="l00409"></a>00409         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; meshCount; ++i )
<a name="l00410"></a>00410         {
<a name="l00412"></a>00412                 <a class="code" href="class_u_ref.html">URef&lt; GrPolygonMesh &gt;</a> polyMesh = fromTree-&gt;<a class="code" href="class_gr_polygon_node.html#9c47d84b59e6f24aeae3879895db0ff9">GetMesh</a>( i );
<a name="l00413"></a>00413                 <span class="keyword">const</span> <a class="code" href="common__afx_8h.html#816fa58fd77499b0edb2c69ebe803d5c" title="include BootstrapFS.">tstring</a>&amp; polyMeshName = polyMesh-&gt;GetName();
<a name="l00414"></a>00414 
<a name="l00416"></a>00416                 std::map&lt; tstring, std::vector&lt; GrMeshInst* &gt; &gt;::const_iterator iter = meshes.find( polyMeshName );
<a name="l00417"></a>00417                 <span class="keywordflow">if</span> ( iter != meshes.end() )
<a name="l00418"></a>00418                 {
<a name="l00419"></a>00419                         <span class="keyword">const</span> std::vector&lt; GrMeshInst* &gt;&amp; meshInstVec = iter-&gt;second;
<a name="l00420"></a>00420                         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; meshInstVec.size(); ++i )
<a name="l00421"></a>00421                         {
<a name="l00422"></a>00422                                 _meshes.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( meshInstVec[ i ]-&gt;<a class="code" href="class_gr_model_node.html#6bcd4b9a2763671b7bd20a5556aa1a22" title="clones a node hierarchy.">Clone</a>( <span class="keyword">false</span> ) );
<a name="l00423"></a>00423                         }
<a name="l00424"></a>00424                 }
<a name="l00425"></a>00425         }
<a name="l00426"></a>00426 
<a name="l00428"></a>00428         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> childCount = fromTree-&gt;<a class="code" href="class_gr_polygon_node.html#a03bfe625d9cab1a0ec3ae35bbeb816c" title="child management.">GetChildCount</a>();
<a name="l00429"></a>00429         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; childCount; ++i )
<a name="l00430"></a>00430         {
<a name="l00432"></a>00432                 <a class="code" href="class_gr_polygon_node.html" title="class GrPolygonNode">GrPolygonNode</a>* curChild = fromTree-&gt;<a class="code" href="class_gr_polygon_node.html#80255bc65053efad7bdee15dc46e20b4" title="public methods">GetChild</a>( i );
<a name="l00433"></a>00433                 <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>* newChild = <span class="keyword">new</span> <a class="code" href="class_gr_model_node.html#30cd7578448ddbb5b07276de2d96cfed" title="class header.">GrModelNode</a>( owner, curChild, meshes );
<a name="l00434"></a>00434 
<a name="l00436"></a>00436                 _children.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( newChild );
<a name="l00437"></a>00437                 newChild-&gt;<a class="code" href="class_gr_model_node.html#1eb8b2402f9bc872224e2de3da184a5d">_parent</a> = <span class="keyword">this</span>;
<a name="l00438"></a>00438         }
<a name="l00439"></a>00439 }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 <span class="comment">//----------------------------------------------------------</span>
<a name="l00442"></a>00442 <span class="keywordtype">void</span>
<a name="l00443"></a>00443 GrModelNode::Load( <a class="code" href="class_gr_model.html" title="class GrModel">GrModel</a>* owner, <a class="code" href="class_u_reader.html" title="Purpose: To wrap and simplify pointer read operations.">UReader</a>&amp; reader, <span class="keyword">const</span> <a class="code" href="class_u_fast_array.html" title="Purpose: To act like a std::vector, only faster. Avoids.">UFastArray</a>&lt; <a class="code" href="class_u_ref.html">URef&lt; GrMesh &gt;</a> &gt;&amp; meshes,
<a name="l00444"></a>00444                                    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> majorVer, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> minorVer )
<a name="l00445"></a>00445 {
<a name="l00447"></a>00447         _name = reader.<a class="code" href="class_u_reader.html#2c8ded1a48118dd661e60ce19a6c926a" title="public members">ReadString</a>();
<a name="l00448"></a>00448 
<a name="l00450"></a>00450         _local.<a class="code" href="class_m_mat4x4.html#3ca6c5ddab80f8b7eb30ec47f4f908c9">Load</a>( reader );
<a name="l00451"></a>00451 
<a name="l00454"></a>00454         <span class="keywordflow">if</span> ( majorVer &lt;= 1 &amp;&amp; minorVer &lt; 1 )
<a name="l00455"></a>00455                 reader.<a class="code" href="class_u_reader.html#2c8ded1a48118dd661e60ce19a6c926a" title="public members">ReadString</a>();
<a name="l00456"></a>00456 
<a name="l00458"></a>00458         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> meshInstCount = reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00459"></a>00459         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; meshInstCount; ++i )
<a name="l00460"></a>00460                 _meshes.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( <span class="keyword">new</span> <a class="code" href="class_gr_mesh_inst.html" title="class GrMeshInst">GrMeshInst</a>( reader, meshes ) );
<a name="l00461"></a>00461 
<a name="l00463"></a>00463         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> childCount = reader.<a class="code" href="class_u_reader.html#e30a8a2deaba30f2dc209781ea1bc16b">ReadInt</a>();
<a name="l00464"></a>00464         <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; childCount; ++i )
<a name="l00465"></a>00465         {
<a name="l00466"></a>00466                 <a class="code" href="class_gr_model_node.html" title="class GrModelNode">GrModelNode</a>* node = <span class="keyword">new</span> <a class="code" href="class_gr_model_node.html#30cd7578448ddbb5b07276de2d96cfed" title="class header.">GrModelNode</a>( owner, reader, meshes, majorVer, minorVer );
<a name="l00467"></a>00467                 node-&gt;<a class="code" href="class_gr_model_node.html#1eb8b2402f9bc872224e2de3da184a5d">_parent</a> = <span class="keyword">this</span>;
<a name="l00468"></a>00468                 _children.<a class="code" href="class_u_fast_array.html#23fd2ded4aa241f76b313a925861c828">Push</a>( node );
<a name="l00469"></a>00469         }
<a name="l00470"></a>00470 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Feb 13 17:19:56 2009 for Bootstrap Engine by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
